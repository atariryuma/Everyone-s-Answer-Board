# 🧪 リアクションシステムテストガイド

## 概要
回答ボードのリアクション機能（送受信・UI反映）の動作を包括的にテストするためのガイドです。

## 🎯 テスト項目

### 1. 基本機能テスト

#### A. 単一リアクションテスト
```javascript
// ブラウザコンソールで実行
await testReactionSystem({ cardIndex: 0, reaction: 'LIKE' });
```

**期待される結果:**
- ✅ カード存在確認: passed
- ✅ リアクションボタン存在確認: passed  
- ✅ 初期状態記録: passed
- ✅ クリック後状態: passed
- ✅ 状態変化検証: passed (reacted状態とcount値が変化)
- ✅ リアクション取消後状態: passed
- ✅ 完全サイクル検証: passed (初期状態に戻る)

#### B. 全リアクションタイプテスト
```javascript
// 全リアクション（LIKE, UNDERSTAND, CURIOUS）をテスト
await testAllReactions(0);
```

**期待される結果:**
- 各リアクションタイプで全テストが成功

### 2. UI整合性テスト

#### A. ボタン状態の視覚確認
1. **未選択状態**: アイコンがアウトライン、aria-pressed="false"
2. **選択状態**: アイコンが塗りつぶし、aria-pressed="true"  
3. **カウント表示**: 正確な数値表示
4. **カラー変化**: 選択時の適切な色変更

#### B. 属性の整合性確認
```javascript
// UI状態の詳細確認
debugGetAnswerCardInfo(0);
```

### 3. サーバー同期テスト

#### A. 永続化テスト
1. リアクションを選択
2. ページを再読み込み (F5)
3. **期待結果**: リアクション状態が保持されている

#### B. ローカルストレージ同期テスト
1. リアクションを選択
2. 開発者ツールでLocalStorageを確認
3. **期待結果**: `reactions_${userId}` キーに状態が保存されている

### 4. エラーハンドリングテスト

#### A. ネットワークエラーシミュレーション
1. 開発者ツール > Network > Offline に設定
2. リアクションをクリック
3. **期待結果**: エラーメッセージ表示、UI状態は楽観的更新

#### B. 不正データテスト
```javascript
// 存在しないカードでテスト
await testReactionSystem({ cardIndex: 999, reaction: 'LIKE' });
```

### 5. パフォーマンステスト

#### A. 連続クリックテスト
```javascript
// 連続で5回テスト実行
for(let i = 0; i < 5; i++) {
  await testReactionSystem({ cardIndex: 0, reaction: 'LIKE', verbose: false });
  await new Promise(r => setTimeout(r, 200));
}
```

#### B. 同時リアクションテスト
```javascript
// 複数リアクションの同時実行
Promise.all([
  testReactionSystem({ cardIndex: 0, reaction: 'LIKE', verbose: false }),
  testReactionSystem({ cardIndex: 0, reaction: 'UNDERSTAND', verbose: false }),
  testReactionSystem({ cardIndex: 0, reaction: 'CURIOUS', verbose: false })
]);
```

## 🔍 テスト手順

### 準備
1. 回答ボードにアクセス
2. 回答データが読み込まれていることを確認
3. 開発者ツール(F12)を開いてコンソールタブを表示

### 実行
1. **自動テスト**: `test-reactions.html` を開いてボタンクリック
2. **手動テスト**: ブラウザコンソールでコマンド実行
3. **目視確認**: UI変化を直接観察

### 検証ポイント
- [ ] リアクションボタンのクリック応答性
- [ ] アイコンの塗りつぶし状態切り替え
- [ ] カウント数値の正確性
- [ ] aria-pressed属性の正確性
- [ ] ローカルストレージの同期
- [ ] サーバーとの同期
- [ ] エラー時の適切な処理
- [ ] パフォーマンス（応答速度）

## 🐛 よくある問題と対処

### 問題1: テスト関数が見つからない
**原因**: ページが完全に読み込まれていない
**対処**: 数秒待ってから再実行

### 問題2: リアクション状態が保持されない  
**原因**: LocalStorage同期エラー
**対処**: LocalStorageをクリアして再テスト

### 問題3: UI更新が反映されない
**原因**: バッチ処理の遅延
**対処**: 1秒待ってから状態確認

### 問題4: サーバーエラー
**原因**: ネットワーク問題またはGAS制限
**対処**: しばらく待ってから再試行

## 📊 テスト結果の評価

### 合格基準
- 全自動テストで `success: true`
- UI状態変化が正常に動作
- サーバー同期が正常に機能
- エラーハンドリングが適切

### 不合格の場合
1. エラーログを詳細確認
2. 特定のテストケースで問題を特定
3. 該当するコード部分を修正
4. 再テスト実行

## 📝 テスト結果記録

テスト実行時は以下の情報を記録してください：

- 実行日時
- ブラウザ情報
- テスト結果（成功/失敗）
- エラーメッセージ（もしあれば）
- 修正が必要な項目