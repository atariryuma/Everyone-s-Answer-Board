# 🔒 セキュリティガイド - みんなの回答ボード

## 概要

みんなの回答ボードは、Google Cloud Platform (GCP) のサービスアカウントを利用した高度なセキュリティアーキテクチャを採用しています。このガイドでは、システムのセキュリティ機能、実装されている保護機能、および管理者が知っておくべきセキュリティ対策について説明します。

## 🛡️ セキュリティアーキテクチャ

### サービスアカウントによる認証

**サービスアカウントの役割:**
- Google Sheets API へのセキュアなアクセス
- スプレッドシートデータの読み取りと書き込み
- Google フォームとスプレッドシートの自動作成
- ユーザーデータベースの管理

**認証フロー:**
```
1. JWT トークンの生成（RSA-SHA256 署名）
2. Google OAuth2 トークンエンドポイントでのトークン交換
3. アクセストークンのキャッシュ（3500秒TTL）
4. 自動トークンリフレッシュ
```

### データ保護機能

**🔐 暗号化とアクセス制御:**
- サービスアカウント認証情報の安全な保存
- JWT ベースの認証（RSA-SHA256 署名）
- スコープ制限による最小権限アクセス
- ユーザーコンテキスト検証

**📊 データベースセキュリティ:**
- 中央データベーススプレッドシートによる一元管理
- ユーザー別スプレッドシートの分離
- 自動サービスアカウント権限付与
- キャッシュ無効化による整合性保証

## 🏫 教育機関向けプライバシー保護

### GIGAスクール構想対応

**Google Workspace for Education 連携:**
- ドメイン内でのセキュアな運用
- 生徒データの適切な取り扱い
- 教育機関のプライバシーポリシー準拠

**データ最小化原則:**
- 必要最小限のデータのみ収集
- 匿名化オプションの提供
- データ保持期間の適切な管理

### 生徒プライバシー保護機能

**個人情報保護:**
- 名前表示の ON/OFF 制御
- ニックネーム使用オプション
- クラス情報の任意入力
- リアクション機能による間接的フィードバック

## 🔧 技術的セキュリティ対策

### API セキュリティ

**認証・認可:**
```javascript
// Bearer トークン認証
Authorization: Bearer {access_token}

// スコープ制限
- https://www.googleapis.com/auth/spreadsheets
- https://www.googleapis.com/auth/drive
```

**入力検証:**
- スプレッドシート ID の形式検証
- ユーザー入力のサニタイゼーション
- SQLインジェクション対策（NoSQL環境）

### キャッシュセキュリティ

**トークン管理:**
- アクセストークンの安全なキャッシュ
- 自動期限切れ処理
- 並行処理時のロック機能

**データキャッシュ:**
- ユーザー情報の一時キャッシュ
- センシティブデータの自動削除
- キャッシュ無効化による即座の反映

## 🚨 セキュリティ監視

### 監査ログ

**記録される操作:**
- ユーザーログイン
- データアクセス
- 設定変更
- シート作成・削除

**ログ形式:**
```javascript
auditLog({
  action: "spreadsheet_access",
  userId: "user_id",
  resourceId: "spreadsheet_id",
  timestamp: new Date().toISOString(),
  details: "operation_details"
});
```

### アクセス制御

**権限レベル:**
- **管理者**: 全機能へのアクセス
- **利用者**: 自身のデータのみアクセス
- **システム**: サービスアカウントによる自動処理

## ⚠️ セキュリティ上の注意事項

### 管理者が気をつけるべき点

1. **認証情報の管理**
   - サービスアカウントキーの適切な保存
   - 定期的な認証情報の更新
   - 不要なアクセス権限の削除

2. **データアクセス**
   - 必要最小限のデータのみ収集
   - 定期的なデータ棚卸し
   - 不要データの削除

3. **ユーザー管理**
   - 適切な権限設定
   - 離任者のアクセス権削除
   - 定期的な権限レビュー

### インシデント対応

**疑わしい活動を発見した場合:**
1. 即座にシステム管理者に報告
2. 該当アカウントのアクセス停止
3. 影響範囲の調査
4. 必要に応じた生徒・保護者への通知

## 🔄 メンテナンスとアップデート

### 定期的なセキュリティチェック

**月次作業:**
- アクセスログの確認
- 異常なアクティビティの調査
- 権限設定の見直し

**年次作業:**
- サービスアカウントキーの更新
- セキュリティポリシーの見直し
- システム脆弱性の評価

### アップデート手順

1. **事前準備**
   - データのバックアップ
   - 影響範囲の確認
   - ロールバック計画の策定

2. **実行**
   - メンテナンス時間での実施
   - 段階的なデプロイ
   - 動作確認テスト

3. **事後確認**
   - セキュリティ機能の動作確認
   - ログの監視
   - ユーザーフィードバックの収集

## 📞 セキュリティに関するお問い合わせ

セキュリティに関する質問や懸念がある場合は、システム管理者までご連絡ください。

**緊急時の連絡先:**
- システム管理者: [連絡先情報]
- 技術サポート: [連絡先情報]

---

**最終更新:** 2025年7月
**バージョン:** 1.0
**責任者:** システム開発チーム