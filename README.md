# 📚 StudyQuest - Everyone's Answer Board

### *みんなの回答ボード - リアルタイム協調学習プラットフォーム*

[![GAS Platform](https://img.shields.io/badge/Platform-Google%20Apps%20Script-blue?logo=googleappsscript&logoColor=white)](https://script.google.com)
[![Zero Dependency](https://img.shields.io/badge/Architecture-Zero%20Dependency-green?logo=serverless&logoColor=white)](#architecture)
[![Real-time](https://img.shields.io/badge/Real--time-Collaboration-purple?logo=googledrive&logoColor=white)](#features)

**🎯 教育現場のための Google Sheets 連携リアルタイム協調学習システム**
**⚡ 学生同士の回答共有とリアルタイム反応機能による学習促進**

---

## 🎯 アプリケーション概要

**StudyQuest みんなの回答ボード**は、教育現場での学習効果を最大化するために設計されたリアルタイム協調学習プラットフォームです。**サイロ型マルチテナント方式**により、各教育機関・クラス・プロジェクトが完全に独立したデータ環境を持ち、Google Sheets と連携して学生が回答を共有し、互いの学習内容に対してリアルタイムで反応・評価できる環境を提供します。

### 🌟 教育効果
- **📖 学習の可視化**: 全員の回答を一覧表示し、多様な視点を共有
- **🤝 相互学習**: 他の学生の回答から新しい発見と学びを促進
- **⚡ リアルタイム反応**: 即座のフィードバックで学習意欲を向上
- **📊 学習状況把握**: 教師が学生の理解度をリアルタイムで確認

---

## 🏢 アーキテクチャ概要

### サイロ型マルチテナント方式
各教育機関・クラスのデータが完全に独立したテナント環境で動作します。

**データ分離**
- テナント別Google Sheets: 各回答ボードが独自のスプレッドシートを使用
- 管理台帳データベース: configJsonを含むシステム設定を一元管理
- クロステナント防御: テナント間の不正アクセスを完全遮断

**認証・権限制御**
- Google Apps Script サービスアカウント: 全データアクセスの基盤
- OAuth 2.0認証: Google Workspaceとの安全な連携
- 多層アクセス制御: データベース・スプレッドシート・アプリケーション層

---

## 🚀 主要機能

### メインボード（回答閲覧・反応）
Google Sheetsのデータをリアルタイムで表示し、学習者同士の相互作用を促進します。

**検索・フィルタ機能**
- キーワード検索: 回答内容・学生名での検索
- クラス別絞り込み: 複数クラス対応
- リアクション数フィルタ: 人気順・注目・バズ
- ソート: 新着順・ランダム順・リアクション順・スコア順

**リアクションシステム**
- UNDERSTAND（理解）: 分かりやすい回答への反応
- LIKE（いいね）: 素晴らしい回答への支持
- CURIOUS（興味深い）: 新しい視点への興味
- ハイライト機能: 重要回答のマーク
- リアルタイム反応数表示

**ユーザビリティ**
- レスポンシブデザイン: 全デバイス対応
- WCAG 2.1準拠: アクセシビリティ確保
- 高速レンダリング: 大量データ処理

### 認証システム
Google Apps Script の組み込み OAuth 2.0 による安全な認証とユーザー管理を提供します。

**認証フロー**
1. **Google アカウント認証**: Session.getActiveUser().getEmail() による自動認証
2. **データベース検索**: findUserByEmail() で既存ユーザー確認
3. **自動アカウント作成**: 新規ユーザーは自動的にデータベースに登録
4. **権限判定**: システム管理者・回答ボード所有者・一般ユーザーの自動識別
5. **適切なページへリダイレクト**: ユーザー状態に応じた画面表示

**主要API関数**
- `getCurrentEmail()`: 現在のユーザーメール取得
- `processLoginAction()`: ログイン処理とユーザー作成
- `isSystemAdmin()`: 管理者権限確認
- `getUser(infoType)`: ユーザー情報取得

**ユーザーデータ構造**
- userId: UUID形式の一意識別子
- userEmail: Google アカウントメールアドレス
- configJson: ユーザー設定（JSON形式）
  - setupStatus: 'pending'（初期）→ 'completed'（設定済み）
  - appPublished: 回答ボード公開状態
  - spreadsheetId: 連携するGoogle Sheetsの ID

### 初回セットアップ
教師が回答ボードを作成するための設定ウィザードです。

- Google Sheets選択と接続
- データ列の自動識別とマッピング（回答・クラス・名前列）
- 表示設定とプレビュー機能
- 設定の検証と保存

### 管理者パネル
システム全体の管理とユーザー制御機能を提供します。

**ユーザー管理**
- 全ユーザー一覧とアクセス権限設定
- アカウント削除とログ管理

**システム監視**
- リアルタイム利用状況監視
- パフォーマンス指標とデータ同期状況
- システム設定とメンテナンスモード制御

---

## 🎯 利用フロー

### 🔐 システム全体のアクセスフロー

**Webアプリエントリーポイント**: `/exec` アクセス → 必ずログインページから開始

```
/exec → LoginPage.html → [認証処理] → 適切なページへリダイレクト
```

### 👨‍🏫 教師による回答ボード作成フロー
1. **初回ログイン**: LoginPage.html で Google アカウント認証
2. **自動ユーザー作成**: processLoginAction() で新規ユーザーを自動登録
3. **セットアップ画面**: SetupPage.html で Google Sheets 選択と列マッピング設定
4. **設定保存**: configJson に spreadsheetId、列設定、表示設定を保存
5. **回答ボード公開**: 共有URL（mode=view&userId）生成
6. **管理画面アクセス**: AdminPanel.html で継続的な管理

### 👨‍🎓 学生・閲覧者の利用フロー
1. **直接アクセス**: 共有URL（?mode=view&userId=xxx）から Page.html へ直接アクセス
2. **匿名利用**: データベース登録不要（ゲストとして利用可能）
3. **回答カード閲覧**: リアルタイムでGoogle Sheetsデータを表示
4. **検索・フィルタリング**: キーワード検索、クラス別絞り込み、ソート機能
5. **リアクション送信**: UNDERSTAND/LIKE/CURIOUS による評価
6. **ハイライト機能**: 重要回答のマーク（セッション単位）
7. **リアルタイム更新**: 他ユーザーの反応を即座に反映

### 👑 管理者によるシステム管理フロー

1. **管理者認証**: ADMIN_EMAIL設定による管理者権限確認
2. **AdminPanel.html アクセス**: 管理者専用インターフェース
3. **ユーザー管理**: getAdminUsers() で全ユーザー情報取得
4. **システム監視**: リアルタイムパフォーマンス確認
5. **データ整合性確認**: データベースとスプレッドシートの同期状況確認

---

## 📊 ページ構成と機能詳細

### 🔐 LoginPage.html
**機能**: Google OAuth 2.0 認証とユーザー作成・ログイン処理
- Google アカウント情報表示（getUser('email')）
- ドメイン制限確認（getSystemDomainInfo()）
- ログインボタン（processLoginAction() 実行）
- 認証成功時の自動リダイレクト

### 📋 Page.html（メインボード）
**機能**: 回答ボード表示とリアクション機能
- Google Sheets データリアルタイム表示
- 検索・フィルタ・ソート機能
- リアクションシステム（addReaction()）
- ハイライト機能（toggleHighlight()）
- レスポンシブデザイン

### ⚙️ SetupPage.html
**機能**: 初回セットアップウィザード
- スプレッドシート選択と接続
- 列マッピング設定（回答・クラス・名前列の自動識別）
- プレビュー機能とバリデーション
- configJson設定保存

### 👑 AdminPanel.html
**機能**: システム管理者専用パネル
- 全ユーザー管理（getAdminUsers()）
- アクセス権限設定
- システム監視とパフォーマンス確認
- データ整合性確認

### 🚀 AppSetupPage.html
**機能**: アプリケーション初期設定
- システム全体の基本設定
- データベース接続設定
- 初期管理者設定

---

## 🔒 データアクセス制御

### データベース（管理台帳）
- システム管理者: フルアクセス権限
- サービスアカウント: 読み書き権限
- その他のユーザー: アクセス不可

### 回答ボード用スプレッドシート
- 回答ボード所有者（教師）: フルアクセス権限
- サービスアカウント: 読み書き権限
- 同一ドメインユーザー: 閲覧・編集権限
- 外部ユーザー: 直接アクセス不可

### ゲストユーザーアクセス
- 回答カード閲覧: 制限なし
- リアクション送信: 匿名で可能
- ハイライト機能: セッション単位
- スプレッドシート・データベース直接アクセス: 完全遮断

---

## 教育現場での活用

### 🌟 **ユーザーエクスペリエンス**
- **⚡ 高速レスポンス**: 最適化されたパフォーマンス
- **🎯 直感的操作**: 学習に集中できるシンプルなUI
- **📱 マルチデバイス**: デスクトップ・タブレット・スマートフォン対応
- **🎮 ゲーミフィケーション**: 学習意欲を向上させる要素

### 🎨 **ビジュアルデザイン**
- **🌙 ダークテーマ**: 目に優しい配色
- **🎨 Glassmorphism**: モダンなガラス風UI
- **⚡ アニメーション**: スムーズなトランジション
- **🌈 カラーコード**: 機能別の色分け

### ♿ **アクセシビリティ**
- **🔊 スクリーンリーダー**: 視覚障害者対応
- **⌨️ キーボード操作**: マウス無しでの完全操作
- **🎨 高コントラスト**: 読みやすい文字表示
- **📏 WCAG 2.1 準拠**: 国際アクセシビリティ基準

---

## 🔧 管理者向け機能詳細

### 📊 **システム監視**
- **👥 ユーザー活動**: リアルタイムユーザー数、アクセスパターン
- **⚡ パフォーマンス**: レスポンス時間、メモリ使用量
- **🔄 データ同期**: Google Sheets との同期状況
- **❌ エラー監視**: システムエラーの検出と通知

### 🛠️ **メンテナンス機能**
- **🔧 設定変更**: システム設定のリアルタイム変更
- **🗑️ データクリーンアップ**: 不要データの自動削除
- **📋 ログ管理**: 詳細ログの保存と分析
- **🔄 バックアップ**: 自動バックアップシステム

### 🔒 **セキュリティ管理**
- **👤 アクセス制御**: ユーザー別権限設定
- **🛡️ 不正アクセス検出**: 異常なアクセスパターンの監視
- **📊 監査ログ**: 全操作の記録と追跡
- **⚠️ セキュリティ通知**: セキュリティイベントの即座な通知

## 🛡️ **サービスアカウント・データアクセス制御**

### **📊 データベース（管理台帳）アクセス制御**
```
🔐 管理台帳データベース
├── ✅ システム管理者: フルアクセス権限
├── ✅ サービスアカウント: 読み書き権限
└── ❌ その他のユーザー: アクセス不可
```
- **⚙️ configJson 管理**: 全回答ボードの設定情報を安全に保存
- **👥 ユーザー管理**: テナント別ユーザー情報の一元管理
- **📊 システム設定**: グローバル設定とテナント別設定の管理

### **📋 回答ボード・スプレッドシートアクセス制御**
```
📊 回答ボード用スプレッドシート
├── ✅ 回答ボード所有者（教師）: フルアクセス権限
├── ✅ サービスアカウント: 読み書き権限
├── ✅ 同じドメインユーザー: 閲覧・編集権限
└── ❌ 外部ユーザー: 直接アクセス不可
```
- **🔐 サービスアカウント経由**: 全てのデータアクセスはサービスアカウント経由
- **🏫 ドメイン制限**: 教育機関ドメイン内でのセキュアな共有
- **📱 アプリケーション層制御**: 直接スプレッドシートアクセスを防止

### **👥 ゲストユーザー・アクセスモデル**
```
🌐 回答ボードURL共有
├── 📋 回答カード閲覧: ✅ 制限なし
├── 💡 リアクション送信: ✅ 匿名で可能
├── ⭐ ハイライト機能: ✅ セッション単位
├── 📊 スプレッドシート直接アクセス: ❌ 完全遮断
└── 🗃️ データベース直接アクセス: ❌ 完全遮断
```
- **🔗 URL ベースアクセス**: mode=view&userId形式のURLによる安全な共有
- **👤 登録不要**: データベース未登録でも回答ボード利用可能
- **🛡️ 間接アクセス**: サービスアカウント経由でのみデータ取得

---

## 🚀 教育現場での活用例

### 📚 **授業での活用**
- **💭 ブレインストーミング**: 創造的思考の共有
- **🤔 問題解決**: 多様な解決方法の発見
- **📖 読解活動**: 文章理解の共有と議論
- **🔬 実験結果**: 科学実験結果の比較検討

### 🎯 **学習効果の向上**
- **👀 多様性の認識**: 他者の視点からの学び
- **💪 学習意欲向上**: リアクション機能による動機付け
- **🤝 協調学習**: 互いに学び合う環境の構築
- **📊 理解度確認**: 教師による学習状況の把握

### 🏫 **運用パターン**
- **🕐 リアルタイム授業**: 授業中の即座な回答共有
- **📝 宿題・課題**: 授業外での学習成果共有
- **📋 復習活動**: 学習内容の振り返りと定着
- **🎪 イベント活動**: 学校行事での意見収集

---

## ⚠️ 開発者向け機能保護ガイドライン

### 🛡️ **重要機能の保護**

#### **📱 メインボード（Page.html）の必須機能**
- **🔍 検索・フィルタ機能**: 学習効果に直結する重要機能
- **💡 リアクションシステム**: 学習動機の核となる機能
- **⭐ ハイライト機能**: 重要回答の識別機能
- **🔄 リアルタイム更新**: 協調学習の基盤機能
- **📱 レスポンシブデザイン**: 多様なデバイス対応

#### **⚙️ セットアップ（SetupPage.html）の必須機能**
- **📊 スプレッドシート連携**: データソースとの接続
- **🏷️ 列マッピング**: データ構造の柔軟性
- **👀 プレビュー機能**: 設定確認の安全性
- **✅ バリデーション**: データ整合性の保証

#### **👑 管理者パネル（AdminPanel.html）の必須機能**
- **👥 ユーザー管理**: システム運用の制御
- **📊 監視機能**: システム健全性の確認
- **🔒 セキュリティ管理**: データ保護の実現
- **⚙️ 設定管理**: システム最適化の実現

### 🔧 **機能追加時の注意事項**

#### **✅ 推奨される追加**
- **📊 分析機能**: 学習効果測定の向上
- **🎨 カスタマイズ**: 教育現場に合わせた調整
- **🔄 同期機能**: 他システムとの連携
- **♿ アクセシビリティ**: より多くの学習者への対応

#### **⚠️ 避けるべき変更**
- **🔍 検索機能の削除**: 学習効果の大幅な低下
- **💡 リアクション機能の変更**: 学習動機システムの破綻
- **📱 モバイル対応の除去**: アクセシビリティの大幅な低下
- **🔒 セキュリティ機能の削除**: データ保護の破綻
- **🏢 マルチテナント分離の変更**: テナント間データ漏洩リスク
- **👤 サービスアカウント認証の変更**: システム全体のセキュリティ破綻

### 📋 **機能変更チェックリスト**

```markdown
機能変更前のチェック項目：
□ 学習効果への影響を評価したか？
□ ユーザビリティが維持されるか？
□ 既存の教育現場での使用に支障がないか？
□ アクセシビリティが確保されるか？
□ セキュリティが維持されるか？
□ 既存データとの互換性があるか？
□ 教師・学生双方のワークフローが保たれるか？
□ マルチテナント分離が維持されるか？
□ サービスアカウント認証が影響を受けないか？
□ テナント間のデータ漏洩リスクがないか？
□ クロステナント機能が正常に動作するか？
```

---

## 🎊 まとめ

**StudyQuest みんなの回答ボード**は、教育現場での協調学習を最大化するための包括的なプラットフォームです。リアルタイムな反応機能と直感的なインターフェースにより、学生の学習意欲向上と教師の効果的な指導を支援します。

### 🌟 **コア価値**
- **📚 学習効果の最大化**: 多様な視点の共有による深い学び
- **🤝 協調学習の促進**: リアルタイム反応による相互作用
- **⚡ 直感的な操作性**: 学習に集中できるシンプルなUI
- **🔒 安全なデータ管理**: Google Workspace 統合による信頼性
- **🏢 エンタープライズ級セキュリティ**: サイロ型マルチテナント完全分離
- **👤 信頼できる認証**: サービスアカウントベースの堅牢な認証システム

教育現場での実際のニーズに基づいて設計された各機能は、学習者中心の体験を提供し、21世紀型の協調学習環境を実現します。
