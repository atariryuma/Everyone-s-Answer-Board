# StudyQuest - みんなの回答ボード

このリポジトリは Google Apps Script で動作する回答共有アプリのソースコードです。
スプレッドシートに保存した回答を Web アプリとして公開し、生徒はリアクションを付けたり、クラス別に絞り込んで閲覧できます。管理者はどのシートを公開するかを設定し、公開を終了することも可能です。

## 必要環境

1. **Node.js 20** 以降をインストールしてください。
2. 依存パッケージをインストールします。
   ```bash
   npm install
   ```
3. `jest` が利用できることを確認します。
   ```bash
   npx jest --version
   ```
4. `clasp` で Google にログインします。
   ```bash
   npx clasp login
   ```
5. `.clasp.json` の `scriptId` をあなたの Apps Script プロジェクト ID に書き換えます。

## 使い方

- `npm run push` – `src/` の内容を Apps Script プロジェクトにアップロードします。
- `npm run pull` – Apps Script 側の最新コードを取得します。
- `npm run open` – ブラウザで Apps Script の編集画面を開きます。
- `npm run update-url` – デプロイされた Web アプリの URL をスクリプトプロパティに保存します。
- Apps Script から `getWebAppUrl()` を呼び出すと保存された URL を取得できます。

## スプレッドシートの構成

公開するシートには次の列が必要です。

- **タイムスタンプ**
- **メールアドレス**
- **クラス**
- **回答**
- **理由**
- **いいね！** (カンマ区切りのユーザー一覧)

不足している場合は **なるほど！**、**もっと知りたい！**、**ハイライト** の列が自動で追加されます。

## 回答ボードの管理

Web アプリの URL に `?mode=admin` を付けてアクセスすると管理画面が表示されます。ここでシートの公開・非公開や列設定を行います。シートを公開すると生徒向け URL から回答ボードを閲覧できます。公開を終了すると生徒はアクセスできなくなります。

管理者のメールアドレスは `ADMIN_EMAILS` スクリプトプロパティで設定してください。

## フロントエンドの機能

- レスポンシブなグリッド表示
- クラスごとの絞り込み
- 回答を開いてリアクションを付与
- リアクション数に応じたソート
- カラム数を調整できるスライダー

## ディレクトリ構成

Apps Script ファイルと HTML ファイルはすべて `src` 直下に配置します。サブディレクトリは作成しないでください。

## テスト

依存パッケージをインストール後、次のコマンドで実行できます。

```bash
npm test
```

