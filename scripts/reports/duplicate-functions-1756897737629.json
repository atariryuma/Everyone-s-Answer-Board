{
  "timestamp": "2025-09-03T11:08:57.629Z",
  "config": {
    "sourceDir": "/Users/ryuma/Everyone-s-Answer-Board/src",
    "extensions": [
      ".gs"
    ],
    "ignorePatterns": [
      {},
      {},
      {}
    ],
    "minFunctionBodyLines": 3
  },
  "results": {
    "exactDuplicates": [],
    "similarFunctions": [],
    "nameConflicts": [
      {
        "name": "generateUserUrls",
        "functions": [
          {
            "name": "generateUserUrls",
            "signature": "function generateUserUrls(userId)",
            "body": "const baseUrl = 'https://script.google.com/a/naha-okinawa.ed.jp/macros/s/AKfycbxcR5qQuyM_eMh5AT7abVVNjj-4I3xVppxl2Ah1_cUlBHWboJ0x_qTw3w865fUPoTsV/exec';\n  \n  return {\n    viewUrl: `${baseUrl}?mode=view&userId=${userId}`,\n    adminUrl: `${baseUrl}?mode=admin&userId=${userId}`\n  };\n}",
            "file": "AdminPanelBackend.gs",
            "lineNumber": 571,
            "endLineNumber": 578,
            "hash": "-1438527610",
            "normalizedBody": "const baseUrl = 'https://script.google.com/a/naha-okinawa.ed.jp/macros/s/AKfycbxcR5qQuyM_eMh5AT7abVVNjj-4I3xVppxl2Ah1_cUlBHWboJ0x_qTw3w865fUPoTsV/exec';return{viewUrl: `${baseUrl}?mode=view&userId=${userId}`,adminUrl: `${baseUrl}?mode=admin&userId=${userId}`};}"
          },
          {
            "name": "generateUserUrls",
            "signature": "function generateUserUrls(userId)",
            "body": "const baseUrl = getWebAppUrl();\n    if (!baseUrl) return { error: 'Base URL not available' };\n\n    return {\n      viewUrl: `${baseUrl}?mode=view&userId=${encodeURIComponent(userId)}`,\n      adminUrl: `${baseUrl}?mode=admin&userId=${encodeURIComponent(userId)}`,\n      editUrl: `${baseUrl}?mode=edit&userId=${encodeURIComponent(userId)}`, // å°†æ¥å®Ÿè£…\n    };\n  },",
            "file": "main.gs",
            "lineNumber": 721,
            "endLineNumber": 730,
            "hash": "-761308506",
            "normalizedBody": "const baseUrl = getWebAppUrl();if (!baseUrl) return{error: 'Base URL not available'};return{viewUrl: `${baseUrl}?mode=view&userId=${encodeURIComponent(userId)}`,adminUrl: `${baseUrl}?mode=admin&userId=${encodeURIComponent(userId)}`,editUrl: `${baseUrl}?mode=edit&userId=${encodeURIComponent(userId)}`,// å°†æ¥å®Ÿè£…};},"
          }
        ],
        "type": "name_conflict"
      },
      {
        "name": "verifyAdminAccess",
        "functions": [
          {
            "name": "verifyAdminAccess",
            "signature": "function verifyAdminAccess(userInfo, config, currentUserEmail)",
            "body": "const systemAdminEmail = PropertiesService.getScriptProperties().getProperty(\n      PROPS_KEYS.ADMIN_EMAIL\n    );\n\n    // è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°\n    console.log('ğŸ” ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ï¼ˆè©³ç´°ï¼‰:', {\n      currentUserEmail: currentUserEmail,\n      userInfoEmail: userInfo.userEmail,\n      systemAdminEmail: systemAdminEmail,\n      userId: userInfo.userId,\n      isActive: userInfo.isActive,\n      emailsMatch: currentUserEmail === userInfo.userEmail,\n      isSystemAdmin: currentUserEmail === systemAdminEmail,\n    });\n\n    // ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…\n    if (currentUserEmail === systemAdminEmail) {\n      console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¨ã—ã¦èªè¨¼æˆåŠŸ');\n      return this.createAccessResult(true, 'system_admin', config);\n    }\n\n    // ã‚ªãƒ¼ãƒŠãƒ¼\n    if (currentUserEmail === userInfo.userEmail) {\n      console.log('âœ… ãƒœãƒ¼ãƒ‰æ‰€æœ‰è€…ã¨ã—ã¦èªè¨¼æˆåŠŸ');\n      return this.createAccessResult(true, 'owner', config);\n    }\n\n    console.warn('âŒ ç®¡ç†è€…æ¨©é™ãªã—');\n    return this.createAccessResult(false, 'guest', null, 'ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');\n  }",
            "file": "Base.gs",
            "lineNumber": 406,
            "endLineNumber": 436,
            "hash": "617649017",
            "normalizedBody": "const systemAdminEmail = PropertiesService.getScriptProperties().getProperty( PROPS_KEYS.ADMIN_EMAIL );// è©³ç´°ãªãƒ‡ãƒãƒƒã‚°ãƒ­ã‚° console.log('ğŸ” ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ï¼ˆè©³ç´°ï¼‰:',{currentUserEmail: currentUserEmail,userInfoEmail: userInfo.userEmail,systemAdminEmail: systemAdminEmail,userId: userInfo.userId,isActive: userInfo.isActive,emailsMatch: currentUserEmail === userInfo.userEmail,isSystemAdmin: currentUserEmail === systemAdminEmail,});// ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€… if (currentUserEmail === systemAdminEmail){console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¨ã—ã¦èªè¨¼æˆåŠŸ');return this.createAccessResult(true,'system_admin',config);}// ã‚ªãƒ¼ãƒŠãƒ¼ if (currentUserEmail === userInfo.userEmail){console.log('âœ… ãƒœãƒ¼ãƒ‰æ‰€æœ‰è€…ã¨ã—ã¦èªè¨¼æˆåŠŸ');return this.createAccessResult(true,'owner',config);}console.warn('âŒ ç®¡ç†è€…æ¨©é™ãªã—');return this.createAccessResult(false,'guest',null,'ç®¡ç†è€…æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');}"
          },
          {
            "name": "verifyAdminAccess",
            "signature": "function verifyAdminAccess(userId)",
            "body": "try {\n    // åŸºæœ¬çš„ãªå¼•æ•°ãƒã‚§ãƒƒã‚¯\n    if (!userId || typeof userId !== 'string' || userId.trim() === '') {\n      console.warn('verifyAdminAccess: ç„¡åŠ¹ãªuserIdãŒæ¸¡ã•ã‚Œã¾ã—ãŸ:', userId);\n      return false;\n    }\n\n    // ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—\n    const activeUserEmail = User.email();\n    if (!activeUserEmail) {\n      console.warn('verifyAdminAccess: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');\n      return false;\n    }\n\n    console.log('verifyAdminAccess: èªè¨¼é–‹å§‹', { userId, activeUserEmail });\n\n    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—\n    let userFromDb = DB.findUserById(userId);\n\n    // è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å¼·åˆ¶ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§å†è©¦è¡Œ\n    if (!userFromDb) {\n      console.log('verifyAdminAccess: å¼·åˆ¶ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§å†æ¤œç´¢ä¸­...');\n      userFromDb = fetchUserFromDatabase('userId', userId, { forceFresh: true });\n    }\n\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯èªè¨¼å¤±æ•—\n    if (!userFromDb) {\n      console.warn('verifyAdminAccess: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', {\n        userId,\n        activeUserEmail,\n      });\n      return false;\n    }\n\n    // 3é‡ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ\n    // 1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç…§åˆ\n    const dbEmail = String(userFromDb.userEmail || '')\n      .toLowerCase()\n      .trim();\n    const currentEmail = String(activeUserEmail).toLowerCase().trim();\n    const isEmailMatched = dbEmail && currentEmail && dbEmail === currentEmail;\n\n    // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç…§åˆï¼ˆå¿µã®ãŸã‚ï¼‰\n    const isUserIdMatched = String(userFromDb.userId) === String(userId);\n\n    // 3. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç¢ºèª\n    const isActive = Boolean(userFromDb.isActive);\n\n    console.log('verifyAdminAccess: 3é‡ãƒã‚§ãƒƒã‚¯çµæœ:', {\n      isEmailMatched,\n      isUserIdMatched,\n      isActive,\n      dbEmail,\n      currentEmail,\n    });\n\n    // 3ã¤ã®æ¡ä»¶ã™ã¹ã¦ãŒæº€ãŸã•ã‚ŒãŸå ´åˆã®ã¿èªè¨¼æˆåŠŸ\n    if (isEmailMatched && isUserIdMatched && isActive) {\n      console.log('âœ… verifyAdminAccess: èªè¨¼æˆåŠŸ', { userId, email: activeUserEmail });\n      return true;\n    } else {\n      console.warn('âŒ verifyAdminAccess: èªè¨¼å¤±æ•—', {\n        userId,\n        activeUserEmail,\n        failures: {\n          email: !isEmailMatched,\n          userId: !isUserIdMatched,\n          active: !isActive,\n        },\n      });\n      return false;\n    }\n  } catch (error) {\n    console.error('[ERROR]', 'âŒ verifyAdminAccess: èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error.message);\n    return false;\n  }\n}",
            "file": "security.gs",
            "lineNumber": 126,
            "endLineNumber": 203,
            "hash": "-230927365",
            "normalizedBody": "try{// åŸºæœ¬çš„ãªå¼•æ•°ãƒã‚§ãƒƒã‚¯ if (!userId || typeof userId !== 'string' || userId.trim() === ''){console.warn('verifyAdminAccess: ç„¡åŠ¹ãªuserIdãŒæ¸¡ã•ã‚Œã¾ã—ãŸ:',userId);return false;}// ç¾åœ¨ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾— const activeUserEmail = User.email();if (!activeUserEmail){console.warn('verifyAdminAccess: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');return false;}console.log('verifyAdminAccess: èªè¨¼é–‹å§‹',{userId,activeUserEmail});// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾— let userFromDb = DB.findUserById(userId);// è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å¼·åˆ¶ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§å†è©¦è¡Œ if (!userFromDb){console.log('verifyAdminAccess: å¼·åˆ¶ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§å†æ¤œç´¢ä¸­...');userFromDb = fetchUserFromDatabase('userId',userId,{forceFresh: true});}// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯èªè¨¼å¤±æ•— if (!userFromDb){console.warn('verifyAdminAccess: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:',{userId,activeUserEmail,});return false;}// 3é‡ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ // 1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç…§åˆ const dbEmail = String(userFromDb.userEmail || '') .toLowerCase() .trim();const currentEmail = String(activeUserEmail).toLowerCase().trim();const isEmailMatched = dbEmail && currentEmail && dbEmail === currentEmail;// 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼IDç…§åˆï¼ˆå¿µã®ãŸã‚ï¼‰ const isUserIdMatched = String(userFromDb.userId) === String(userId);// 3. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç¢ºèª const isActive = Boolean(userFromDb.isActive);console.log('verifyAdminAccess: 3é‡ãƒã‚§ãƒƒã‚¯çµæœ:',{isEmailMatched,isUserIdMatched,isActive,dbEmail,currentEmail,});// 3ã¤ã®æ¡ä»¶ã™ã¹ã¦ãŒæº€ãŸã•ã‚ŒãŸå ´åˆã®ã¿èªè¨¼æˆåŠŸ if (isEmailMatched && isUserIdMatched && isActive){console.log('âœ… verifyAdminAccess: èªè¨¼æˆåŠŸ',{userId,email: activeUserEmail});return true;}else{console.warn('âŒ verifyAdminAccess: èªè¨¼å¤±æ•—',{userId,activeUserEmail,failures:{email: !isEmailMatched,userId: !isUserIdMatched,active: !isActive,},});return false;}}catch (error){console.error('[ERROR]','âŒ verifyAdminAccess: èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼:',error.message);return false;}}"
          }
        ],
        "type": "name_conflict"
      },
      {
        "name": "verifyUserAccess",
        "functions": [
          {
            "name": "verifyUserAccess",
            "signature": "function verifyUserAccess(requestUserId)",
            "body": "// AccessControllerã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨\n  const currentUserEmail = User.email();\n  const result = App.getAccess().verifyAccess(requestUserId, 'view', currentUserEmail);\n\n  if (!result.allowed) {\n    throw new Error(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${result.message}`);\n  }\n\n  console.log(\n    `âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼æˆåŠŸ: ${currentUserEmail} ã¯ ${requestUserId} ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚`\n  );\n  return result;\n}",
            "file": "Core.gs",
            "lineNumber": 451,
            "endLineNumber": 464,
            "hash": "-1612060190",
            "normalizedBody": "// AccessControllerã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ const currentUserEmail = User.email();const result = App.getAccess().verifyAccess(requestUserId,'view',currentUserEmail);if (!result.allowed){throw new Error(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${result.message}`);}console.log( `âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼æˆåŠŸ: ${currentUserEmail}ã¯ ${requestUserId}ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚` );return result;}"
          },
          {
            "name": "verifyUserAccess",
            "signature": "function verifyUserAccess(userId)",
            "body": "if (!userId) {\n    throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå¿…è¦ã§ã™');\n  }\n\n  // Base.gsã®AccessControllerã‚’ä½¿ç”¨ã—ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡\n  const result = App.getAccess().verifyAccess(userId, 'view', User.email());\n  if (!result.allowed) {\n    throw new Error('ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ: ' + result.reason);\n  }\n\n  return true;\n}",
            "file": "security.gs",
            "lineNumber": 241,
            "endLineNumber": 253,
            "hash": "-294077955",
            "normalizedBody": "if (!userId){throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå¿…è¦ã§ã™');}// Base.gsã®AccessControllerã‚’ä½¿ç”¨ã—ãŸã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ const result = App.getAccess().verifyAccess(userId,'view',User.email());if (!result.allowed){throw new Error('ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ: ' + result.reason);}return true;}"
          }
        ],
        "type": "name_conflict"
      }
    ],
    "stats": {
      "totalFunctions": 217,
      "uniqueNames": 214,
      "duplicateGroups": 0
    }
  },
  "summary": {
    "totalFunctions": 217,
    "exactDuplicates": 0,
    "nameConflicts": 3,
    "similarFunctions": 0
  }
}