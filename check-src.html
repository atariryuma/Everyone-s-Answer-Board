<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å®Ÿéš›ã®/srcãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼</title>
  <style>
    body { font-family: monospace; background: #1e1e1e; color: #fff; padding: 20px; }
    .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
    .success { background: #0d4f3b; }
    .warning { background: #4a3a00; }
    .error { background: #4a1414; }
    button { background: #007acc; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
    .console { background: #000; padding: 15px; border-radius: 5px; margin: 10px 0; max-height: 600px; overflow-y: scroll; }
  </style>
</head>
<body>
  <h1>ğŸ” /src ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿåœ°æ¤œè¨¼</h1>
  
  <div>
    <button onclick="checkHtmlFiles()">HTMLãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="checkJsFiles()">JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="checkGasFiles()">GASãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="checkAll()">å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
  </div>

  <div id="console" class="console"></div>
  <div id="results"></div>

  <script>
    function log(message, type) {
      const console = document.getElementById('console');
      const time = new Date().toLocaleTimeString();
      const emoji = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'ğŸ“';
      console.innerHTML += emoji + ' [' + time + '] ' + message + '\n';
      console.scrollTop = console.scrollHeight;
    }

    function addResult(name, status, details) {
      const results = document.getElementById('results');
      const div = document.createElement('div');
      div.className = 'result ' + status;
      div.innerHTML = '<strong>' + name + '</strong>: ' + details;
      results.appendChild(div);
    }

    async function loadFile(filename) {
      try {
        const response = await fetch('/src/' + filename);
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        return await response.text();
      } catch (error) {
        log('âŒ ' + filename + ' èª­ã¿è¾¼ã¿å¤±æ•—: ' + error.message, 'error');
        return null;
      }
    }

    async function checkHtmlFiles() {
      log('ğŸ—‚ï¸ HTMLãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯é–‹å§‹', 'info');
      
      const files = ['AdminPanel.html', 'AppSetupPage.html', 'LoginPage.html', 'Page.html'];
      
      for (const file of files) {
        const content = await loadFile(file);
        if (!content) {
          addResult(file, 'error', 'èª­ã¿è¾¼ã¿å¤±æ•—');
          continue;
        }

        let score = 0;
        let checks = [];
        
        // åŸºæœ¬HTMLæ§‹é€ 
        if (content.includes('<!DOCTYPE html>')) { score += 25; checks.push('DOCTYPE'); }
        if (content.includes('<html')) { score += 25; checks.push('HTML'); }
        if (content.includes('<head>')) { score += 25; checks.push('HEAD'); }
        if (content.includes('<body>')) { score += 25; checks.push('BODY'); }

        // ãƒ•ã‚¡ã‚¤ãƒ«å›ºæœ‰ãƒã‚§ãƒƒã‚¯
        if (file === 'AdminPanel.html') {
          if (content.includes('save') || content.includes('publish')) { score += 20; checks.push('ä¿å­˜æ©Ÿèƒ½'); }
          if (content.includes('sheet') || content.includes('select')) { score += 20; checks.push('ã‚·ãƒ¼ãƒˆé¸æŠ'); }
          if (content.includes('history')) { score += 10; checks.push('å±¥æ­´'); }
        } else if (file === 'LoginPage.html') {
          if (content.includes('login') || content.includes('email')) { score += 30; checks.push('ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½'); }
        } else if (file === 'AppSetupPage.html') {
          if (content.includes('setup') || content.includes('config')) { score += 30; checks.push('ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ©Ÿèƒ½'); }
        }

        const status = score >= 80 ? 'success' : score >= 60 ? 'warning' : 'error';
        log(file + ': ' + score + '% (' + checks.join(', ') + ')', status);
        addResult(file, status, score + '% - ' + checks.length + 'é …ç›®ç¢ºèª');
      }
    }

    async function checkJsFiles() {
      log('ğŸ“œ JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯é–‹å§‹', 'info');
      
      const files = [
        'adminPanel-core.js.html',
        'adminPanel-api.js.html', 
        'adminPanel-events.js.html',
        'page.js.html'
      ];
      
      for (const file of files) {
        const content = await loadFile(file);
        if (!content) {
          addResult(file, 'error', 'èª­ã¿è¾¼ã¿å¤±æ•—');
          continue;
        }

        let score = 0;
        let functions = [];
        
        // é–¢æ•°ã®æ¤œå‡º
        const functionMatches = content.match(/function\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g) || [];
        functions = functionMatches.map(f => f.replace('function ', ''));
        score += Math.min(functions.length * 10, 50);

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        if (content.includes('try') && content.includes('catch')) {
          score += 20;
          functions.push('ã‚¨ãƒ©ãƒ¼å‡¦ç†');
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å›ºæœ‰ã®é–¢æ•°ãƒã‚§ãƒƒã‚¯
        if (file.includes('core')) {
          if (content.includes('adminLog') || content.includes('log')) { 
            score += 15; functions.push('ãƒ­ã‚°é–¢æ•°'); 
          }
        } else if (file.includes('api')) {
          if (content.includes('runGasWithUserId') || content.includes('api')) { 
            score += 15; functions.push('APIé–¢æ•°'); 
          }
        } else if (file.includes('events')) {
          if (content.includes('addEventListener') || content.includes('event')) { 
            score += 15; functions.push('ã‚¤ãƒ™ãƒ³ãƒˆé–¢æ•°'); 
          }
        }

        const status = score >= 70 ? 'success' : score >= 40 ? 'warning' : 'error';
        log(file + ': ' + score + '% (' + functions.length + 'å€‹ã®æ©Ÿèƒ½)', status);
        addResult(file, status, score + '% - ' + functions.join(', '));
      }
    }

    async function checkGasFiles() {
      log('âš™ï¸ GASãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯é–‹å§‹', 'info');
      
      const files = ['main.gs', 'Core.gs', 'database.gs', 'config.gs'];
      
      for (const file of files) {
        const content = await loadFile(file);
        if (!content) {
          addResult(file, 'error', 'èª­ã¿è¾¼ã¿å¤±æ•—');
          continue;
        }

        let score = 0;
        let features = [];
        
        // åŸºæœ¬çš„ãªGASæ©Ÿèƒ½
        if (content.includes('function')) { score += 20; features.push('é–¢æ•°å®šç¾©'); }
        if (content.includes('SpreadsheetApp') || content.includes('SheetsApi')) { 
          score += 20; features.push('Sheets API'); 
        }
        if (content.includes('HtmlService')) { score += 20; features.push('HTML Service'); }
        if (content.includes('PropertiesService')) { score += 15; features.push('Properties'); }

        // ãƒ•ã‚¡ã‚¤ãƒ«å›ºæœ‰ã®é‡è¦é–¢æ•°
        const criticalFunctions = {
          'main.gs': ['doGet', 'include'],
          'Core.gs': ['verifyUserAccess', 'getPublishedSheetData'],
          'database.gs': ['createUser', 'updateUser'],
          'config.gs': ['getConfig']
        };

        const required = criticalFunctions[file] || [];
        let found = 0;
        required.forEach(func => {
          if (content.includes('function ' + func)) {
            found++;
            features.push(func);
          }
        });
        
        if (required.length > 0) {
          score += (found / required.length) * 25;
        } else {
          score += 25; // config.gsç­‰ã®å ´åˆ
        }

        const status = score >= 75 ? 'success' : score >= 50 ? 'warning' : 'error';
        log(file + ': ' + score + '% (' + found + '/' + required.length + ' é‡è¦é–¢æ•°)', status);
        addResult(file, status, Math.round(score) + '% - ' + features.join(', '));
      }
    }

    async function checkAll() {
      document.getElementById('results').innerHTML = '';
      log('ğŸš€ å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼é–‹å§‹', 'info');
      
      await checkHtmlFiles();
      await checkJsFiles(); 
      await checkGasFiles();
      
      log('ğŸ“Š å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å®Œäº†', 'success');
    }

    function clearLog() {
      document.getElementById('console').innerHTML = '';
      document.getElementById('results').innerHTML = '';
    }

    // åˆæœŸåŒ–
    window.addEventListener('DOMContentLoaded', () => {
      log('ğŸ” å®Ÿéš›ã®/srcãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'success');
      log('ğŸ’¡ å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ¤œè¨¼ã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
    });
  </script>
</body>
</html>