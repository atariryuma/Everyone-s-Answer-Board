# StudyQuest - みんなの回答ボード - エージェントガイド

このドキュメントは、StudyQuest「みんなの回答ボード」システムにおけるエージェントの役割と、システムとの効果的な連携方法について説明します。

## システム概要

StudyQuest「みんなの回答ボード」は、Google Apps Script (GAS) をバックエンド、HTML/CSS/JavaScript (TailwindCSS, Vanilla JS) をフロントエンドとするインタラクティブなWebアプリケーションです。生徒の回答をGoogleスプレッドシートから取得し、視覚的に魅力的なボード形式で表示します。

**主要な技術スタック:**
*   **バックエンド:** Google Apps Script (GAS) - V8ランタイム
*   **フロントエンド:** HTML, CSS (TailwindCSS), Vanilla JavaScript
*   **データベース:** Google Sheets (中央設定管理用と各ユーザーの回答データ用)
*   **認証:** Googleアカウント認証 (ユーザー)、サービスアカウント認証 (Google Sheets API, Google Drive API)

## エージェントの役割

エージェントは、このシステムの開発、保守、機能拡張、デバッグ、およびユーザーサポートにおいて重要な役割を担います。特に以下の領域で貢献が期待されます。

1.  **コードベースの理解と分析:**
    *   フロントエンド (HTML, CSS, JavaScript) とバックエンド (Google Apps Script) の両方のコードを深く理解し、既存の設計パターン、命名規則、およびベストプラクティスを遵守します。
    *   パフォーマンス最適化 (キャッシュ、バッチ処理、非同期処理) や安定性強化 (エラーハンドリング、リトライ、サーキットブレーカー) の実装を理解し、これらを維持・改善します。
    *   Google Apps Scriptの実行環境の特性 (実行時間制限、APIレート制限) を考慮した開発を行います。

2.  **機能開発と拡張:**
    *   ユーザーの要望に基づき、既存機能の改善や新機能の追加を行います。
    *   例えば、新しいリアクションタイプの追加、ボード表示オプションの拡張、管理者機能の強化などが考えられます。
    *   Google Workspaceサービス (Forms, Drive, Sheets) との連携を理解し、新たな連携機能を開発します。

3.  **デバッグと問題解決:**
    *   発生したバグやエラーの原因を特定し、修正します。
    *   ログ (GASの`console.log`、パフォーマンス監視ログ) を活用して問題を診断します。
    *   安定性強化システム (サーキットブレーカー、ヘルスモニター) の状態を分析し、システムの健全性を評価します。

4.  **テストと品質保証:**
    *   既存の包括的なテストスイート (`src/test.gs`) を実行し、変更がシステム全体に与える影響を確認します。
    *   必要に応じて、新しいテストケースを作成し、コードの品質と信頼性を保証します。

5.  **ドキュメントの更新:**
    *   システムに変更を加えた場合、関連するドキュメント (例: `AGENTS.md`, `Claude.md`, `Gemini.md`) を最新の状態に保ちます。

## システムの主要コンポーネントと連携ポイント

*   **フロントエンド (HTML/JS):**
    *   `AdminPanel.html`: 管理者向けUI。`google.script.run`を通じてバックエンドと連携し、ボードの作成、設定、公開を行います。
    *   `Page.html`: 生徒向けボード表示UI。`google.script.run`を通じて回答データを取得し、リアクションやハイライトの操作をバックエンドに送信します。
    *   `Registration.html`: 新規ユーザー登録とクイックスタートのUI。
    *   `SetupPage.html`: サービスアカウントと中央データベースの初期設定UI。
    *   `ClientOptimizer.html`: クライアントサイドのGAS呼び出しを最適化する共通ライブラリ。
*   **バックエンド (GAS):**
    *   `main.gs`: Webアプリのエントリーポイント (`doGet`)。URLパラメータに基づいて適切なHTMLページを配信します。
    *   `core.gs`: 主要なビジネスロジック (ユーザー登録、回答データ取得、リアクション処理、ハイライト、フォーム/スプレッドシート作成、クイックスタート)。
    *   `database.gs`: 中央データベース (Google Sheets) との連携。ユーザー情報のCRUD操作、Sheets API v4の直接利用による高速化。
    *   `auth.gs`: サービスアカウント認証 (JWTトークン生成とキャッシュ)。
    *   `config.gs`: アプリケーション設定、シートヘッダーマッピング、スプレッドシート追加、シート切り替え。
    *   `cache.gs`: 多層キャッシュシステム (Apps Script CacheServiceとインメモリキャッシュ)。
    *   `url.gs`: WebアプリURLの取得と生成。
    *   `optimizer.gs`: 高度なパフォーマンス最適化技術 (バッチ処理、メモリ管理、疑似並列処理)。
    *   `stability.gs`: 安定性強化パターン (サーキットブレーカー、リトライ、ヘルスモニタリング、データ整合性)。
    *   `monitor.gs`: パフォーマンスメトリクスの収集とレポート。
*   **Google Sheets API v4:** `database.gs`や`core.gs`内で`UrlFetchApp`を通じて直接利用され、高速なデータ操作を実現しています。
*   **Google Forms API:** `core.gs`内でフォームの作成と設定に使用されます。
*   **Google Drive API:** `core.gs`内でユーザー専用フォルダの作成とファイル移動に使用されます。

## エージェントへの指示

*   **既存コードの尊重:** 変更を加える際は、既存のコードスタイル、アーキテクチャ、および設計パターンを厳密に遵守してください。
*   **パフォーマンスと安定性:** 常にパフォーマンスと安定性を意識したコードを記述してください。最適化機能や安定性強化機能の利用を検討し、必要に応じて改善提案を行ってください。
*   **テスト駆動開発:** 変更を加える前に、関連するテスト (`src/test.gs`内の`UltraTestSuite`クラス) を実行し、機能が損なわれていないことを確認してください。必要に応じて新しいテストを追加してください。
*   **明確なコミュニケーション:** ユーザーへの説明は簡潔かつ明確に行い、技術的な詳細が必要な場合は適切に提供してください。