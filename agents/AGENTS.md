# コーディングスタイル＆ベストプラクティス

## 1. 役割と目的意識

* **フルスタック開発パートナー**として振る舞い、単なるコード生成にとどまらず、要件の理解・提案・実装まで一貫して担当。
* **README.md に即した実装** を最優先し、要件変更の根拠は必ず README.md にたどれること。
* **UX を重視**し、教師・児童が直感的に操作できる UI/UX 改善案を常に模索。

## 2. シングル・レスポンシビリティ原則

* **関数・モジュールは「ひとつの働き」だけ**

  * 150 行以下を目安に。必要なら helper に切り出す。
* **長い処理は分割**し、テスト可能な小さな単位で実装。

## 3. クライアント／サーバー分離

* **ビジネスロジックはサーバー側**に、UI 描画やイベントハンドリングはクライアント側に完全分離。
* **サーバー関数呼び出しは非同期で**

  ```js
  // クライアント JS
  showLoading();
  google.script.run
    .withSuccessHandler(renderData)
    .fetchData();
  ```

## 4. HTML Service ベストプラクティス

1. **HTML／CSS／JavaScript の分割管理**

   * `<style>` と `<script>` はそれぞれ別ファイル（`.css.html`/`.js.html`）で定義し、テンプレート内で `<?!= include('…'); ?>` で読み込む。
2. **HTML5 Doctype の明示**

   ```html
   <!DOCTYPE html>
   <html lang="ja">
     …
   </html>
   ```
3. **外部リソースはすべて HTTPS**
4. **スクリプトは `<body>` の末尾で読み込む**
5. **必要に応じて jQuery 活用**（ただし最新版を CDN 経由で）

## 5. パフォーマンス最適化

* **バッチ操作**

  * スプレッドシート操作は範囲取得・一括書き込みでまとめて実行。
* **キャッシュ利用**

  * 頻出データは `CacheService`、ブラウザでは `localStorage`。
* **トリガーの競合防止**

  * `LockService` を使って同時実行を排他制御。

## 6. セキュリティと権限管理

* **シークレットはスクリプトプロパティに格納**し、ソースコードに直書きしない。
* **OAuth スコープは最小限**
* **HTTPS／Content Security Policy** を遵守し、混在コンテンツやインジェクションを防止。

## 7. テストとデバッグ

* **ユニットテストの整備**

  * QUnit や Jest でサーバー側ロジックを網羅。
* **ログ出力**

  * デバッグ時は `Logger.log()`、本番では Stackdriver（`console`）を利用。
* **自動テストの CI 連携**

  * clasp／GitHub Actions で `npm run test` を必ずパスさせる。

## 8. コミット＆プルリクエスト

* **Conventional Commits**

  ```
  feat(script): add reactionService
  fix(ui): 修正ボタンの動作不具合対応
  test(server): fetchData のテスト追加
  ```
* **PR は小さく**、一つの目的に絞って作成。
* **PR 説明**に「何を」「なぜ」「どのように」を簡潔に記載。

## 9. 禁止事項

1. **秘密情報のコミット**
2. **main への直接プッシュ**
3. **巨大すぎる PR**（レビューしやすいサイズに分割）
4. **ファイル構造の独断変更**

