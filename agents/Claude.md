# 🤖 Agent's Guidebook for "みんなの回答ボード"

このドキュメントは、本プロジェクトに貢献するすべてのAIエージェント（および開発者）が遵守すべきガイドラインです。目的は、コードの品質と一貫性を保ち、効率的な開発を促進することです。

## 1. エージェントの役割と目標

あなたの役割は、単なるコード生成者ではなく、**教育現場で利用するユーザーの視点を持つプロダクト開発パートナー**です。

**目標:**
* `README.md` に基づき、堅牢で保守性の高い機能を実装すること。
* パフォーマンス、セキュリティ、アクセシビリティといった非機能要件を常に意識し、高品質なユーザー体験を追求すること。
* 教育現場での利用シーンを想定し、ITに不慣れな教師や生徒でも直感的に使えるUI/UXを提案・実装すること。

## 2. 基本原則

1.  **要件定義書が正義**: すべての実装は、`README.md` に記載された要件定義書を正とします。不明点や矛盾があれば、まず要件を確認してください。
2.  **シンプル is ベスト**: 複雑なコードよりも、シンプルで可読性の高いコードを優先します。
3.  **セキュリティ第一**: サービスアカウントのキーや個人情報など、機密情報の取り扱いには最大限の注意を払ってください。
4.  **テストなきコードは罪**: 新機能の実装やバグ修正には、必ずテストコードを伴わせてください。
5.  **ユーザー中心設計**: 機能開発の際は、常に教師と生徒の視点に立ち、その利便性を最優先に考えてください。

## 3. 開発ワークフロー

1.  **要件の理解**: Issueやタスク指示を読み込み、関連する`README.md` の箇所を熟読します。
2.  **設計**: 機能実装の前に、頭の中でクラスや関数の構成、データの流れを設計します。
3.  **実装 (Coding)**: `src` ディレクトリ内の適切なファイルに、コードスタイルガイドに従って実装します。
4.  **テスト**: `tests` ディレクトリに、実装した機能に対するJestテストを作成し、実行します。
5.  **セルフレビュー**: コミットする前に、自身のコードが基本原則と各種ガイドラインを満たしているか確認します。
6.  **コミット**: 後述の「コミットメッセージ形式」に従って、変更をコミットします。
7.  **プルリクエスト (PR)**: PRを作成し、変更内容と理由を明確に記述します。

## 4. コードスタイルガイド

* **言語**: Google Apps Script (GAS) は、最新のV8ランタイムで動作するJavaScriptです。
* **規約**: 基本的に **Google JavaScript Style Guide** に準拠します。
* **ブラウザ互換性**: 教育現場での幅広いデバイス・ブラウザ対応のため、**ES5互換のJavaScript**を使用してください。
  * **禁止構文**: アロー関数 (`=>`), デフォルトパラメータ (`param = 'default'`), オプショナルチェーニング (`obj?.prop`), for...of構文
  * **推奨構文**: `function() {}`, 従来のパラメータ処理 (`param = param || 'default'`), 論理演算子での安全アクセス (`obj && obj.prop`), 従来のforループ
  * **対象ブラウザ**: Internet Explorer 11以下、古いAndroidブラウザ、古いSafari、レガシーブラウザ全般
  * **コード例**:
    ```javascript
    // ❌ 禁止: ES6+構文
    const func = (param = 'default') => {
      for (const item of items) {
        console.log(item?.name);
      }
    };
    
    // ✅ 推奨: ES5互換構文
    function func(param) {
      param = param || 'default';
      for (var i = 0; i < items.length; i++) {
        var item = items[i];
        console.log(item && item.name ? item.name : null);
      }
    }
    ```
* **命名規則**:
    * 変数・関数: `camelCase` (例: `getUserInfo`)
    * クラス: `PascalCase` (例: `StudyQuestApp`)
    * 定数: `UPPER_SNAKE_CASE` (例: `CACHE_TTL`)
* **コメント**:
    * 複雑なロジックや、意図が分かりにくい箇所には必ずコメントを残します。
    * 公開する関数には **JSDoc** 形式でコメントを記述してください。
    ```javascript
    /**
     * 指定されたユーザーIDの情報を取得します。
     * @param {string} userId - 取得対象のユーザーID。
     * @returns {object|null} ユーザー情報オブジェクト。見つからない場合はnull。
     */
    function getUserInfo(userId) {
      // ...
    }
    ```
* **ファイル構成**: プロジェクトの既存のファイル分割ルールに従ってください（例: `core.gs`, `database.gs`, `auth.gs` など）。

## 5. テスト方針

* すべての新しいビジネスロジックには、**単体テスト**を追加してください。
* テストは `/tests` ディレクトリに、`*.test.js` という命名規則で作成します。
* 既存のテスト (`npm run test`) がすべてパスすることを確認してから、PRを作成してください。

## 6. コミット & PRメッセージ形式

変更内容が一目でわかるように、**Conventional Commits** の規約に従います。

**フォーマット:** `<type>(<scope>): <subject>`

* **type**:
    * `feat`: 新機能の追加
    * `fix`: バグ修正
    * `docs`: ドキュメントの変更
    * `style`: コードスタイルの修正（コードの動作に影響しないもの）
    * `refactor`: リファクタリング
    * `test`: テストの追加・修正
    * `chore`: ビルドプロセスや補助ツールの変更
* **scope (任意)**: 変更範囲（例: `auth`, `admin`, `ui`）
* **subject**: 変更内容の簡潔な説明（50字以内）

**良い例:**
```
feat(admin): 回答の承認機能を追加
fix(ui): リアクションボタンが二重に押せる問題を修正
docs(readme): セットアップ手順を更新
test(core): toggleHighlight関数のテストケースを追加
```

## 7. 禁止事項

1.  **機密情報を含めない**: APIキー、パスワード、サービスアカウントのJSONファイルなどを絶対にコードに含めないでください。
2.  **`main` ブランチへの直接プッシュ**: すべての変更は、必ずプルリクエストを通じて行ってください。
3.  **フォーマットの破壊**: `prettier` や `eslint` などのフォーマッタを無効にしないでください。
4.  **巨大なPRの作成**: 機能ごと、修正ごとに小さく分割してPRを作成してください。

---
このガイドラインは、プロジェクトの成長とともに更新されます。常に最新版を確認してください。