<!DOCTYPE html>
<!-- Layout Update v1.2 - 2025-07-19 - Fixed Header Overlap + Domain Display + Clean CSS -->
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <base target="_top">
  <title>ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰	ç®¡ç†ãƒ‘ãƒãƒ« - StudyQuest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1a1b26" />
  <meta name="description" content="StudyQuestã®å›ç­”ãƒœãƒ¼ãƒ‰ç®¡ç†ãƒ‘ãƒãƒ« - ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„æ•™è‚²ãƒ„ãƒ¼ãƒ«" />
  <!-- Shared Security Headers -->
  <?!= include('SharedSecurityHeaders'); ?>
  
  <!-- User ID will be retrieved dynamically from backend -->

  <!-- Shared TailwindCSS Configuration -->
  <?!= include('SharedTailwindConfig'); ?>
  <script>
  // Inject DEBUG_MODE from server into window before utilities load
  const __DEBUG_MODE_RAW__ = '<?= escapeJavaScript(shouldEnableDebugMode()) ?>';
  window.DEBUG_MODE = (__DEBUG_MODE_RAW__ === 'true' || __DEBUG_MODE_RAW__ === true);
  if (window.SYSTEM_CONSTANTS) { window.SYSTEM_CONSTANTS.DEBUG_MODE = window.DEBUG_MODE; }
  </script>

  <!-- Unified Styles and Shared Components -->
  <?!= include('UnifiedStyles'); ?>
  <?!= include('SharedUtilities'); ?>
  
  <!-- Admin Panel Specific Styles -->
  <?!= include('adminPanel-layout.css'); ?>
  
  
  <!-- Core JavaScript Libraries (must be loaded first) -->
  <?!= include('ClientOptimizer'); ?>
  <?!= include('UnifiedCache.js'); ?>
  <?!= include('adminPanel-framework.js.html'); ?>
  <script>
  // Console output control: respect global DEBUG_MODE and filter noisy GAS warnings
  (function() {
    try {
      const originalLog = console.log;
      const originalWarn = console.warn;
      // Read from injected DEBUG_MODE or SYSTEM_CONSTANTS fallback
      const isDebug = !!(window.DEBUG_MODE || (window.SYSTEM_CONSTANTS && window.SYSTEM_CONSTANTS.DEBUG_MODE));

      const warningFilters = [
        /Unrecognized feature.*ambient-light-sensor/i,
        /Unrecognized feature.*speaker/i,
        /Unrecognized feature.*vibrate/i,
        /Unrecognized feature.*vr/i,
        /iframe.*allow-scripts.*allow-same-origin.*sandbox/i,
      ];

      const shouldFilter = (msg) => {
        const s = String(msg || '');
        return warningFilters.some((re) => re.test(s));
      };

      console.log = function(...args) {
        if (!isDebug) return; // suppress in non-debug mode
        if (shouldFilter(args.join(' '))) return;
        try { originalLog.apply(console, args); } catch (_) {}
      };

      console.warn = function(...args) {
        if (!isDebug) return; // suppress in non-debug mode
        if (shouldFilter(args.join(' '))) return;
        try { originalWarn.apply(console, args); } catch (_) {}
      };
    } catch (e) {
      // Fail open: keep default console behavior
    }
  })();
  </script>
  
  <script>
  // GASOptimizer and UnifiedCache are now guaranteed to be defined
  // Enhanced Global Error Handling with Smart Recovery
  window.addEventListener('error', function(event) {
    const errorMessage = event.error?.message || '';
    const errorStack = event.error?.stack || '';
    const errorLine = event.lineno || 'unknown';
    
    // Non-critical GAS internal errors (suppress with logging)
    const suppressedErrors = [
      'document.write',
      'Unexpected token',
      'Failed to execute \'write\' on \'Document\'',
      'SyntaxError: Failed to execute \'write\'',
      'Identifier \'userId\' has already been declared',
      'mae_html_user_bin_i18n_mae_html_user',
      'warden_bin_i18n_warden',
      'unrecognized feature',
      'Unrecognized feature',
      'cdn.tailwindcss.com should not be used in production',
      'tailwindcss.com/docs/installation',
      'should not be used in production',
      'PostCSS plugin',
      'Tailwind CLI',
      'navigateToStep is not defined',
      'hidePrivacyModal is not defined', 
      'updateUIWithNewStatus is not defined',
      'showFormConfigModal is not defined',
      'toggleSection is not defined',
      'function not yet loaded',
      'function not available'
    ];
    
    // Critical errors that need intervention
    const criticalErrors = [
      'await is only valid in async functions',
      'Cannot set property',
      'Cannot read property',
      'is not defined',
      'is not a function'
    ];
    
    const shouldSuppress = suppressedErrors.some(pattern => 
      errorMessage.includes(pattern) || errorStack.includes(pattern)
    );
    
    const isCritical = criticalErrors.some(pattern => 
      errorMessage.includes(pattern) || errorStack.includes(pattern)
    );
    
    if (shouldSuppress) {
      // Log suppressed error for debugging (optional)
      console.debug('Suppressed Google Apps Script internal error:', errorMessage);
      event.preventDefault();
      return;
    }
    
    if (isCritical) {
      console.error('ğŸš¨ Critical Error Detected:', {
        message: errorMessage,
        line: errorLine,
        stack: errorStack.substring(0, 500) // Truncate for readability
      });
      
      // Attempt recovery for specific critical errors
      if (errorMessage.includes('is not defined') || errorMessage.includes('is not a function')) {
        console.log('ğŸ”§ Attempting function recovery...');
        // é‡è¤‡åˆæœŸåŒ–ã‚’é˜²ããŸã‚ã«åˆæœŸåŒ–çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
        setTimeout(() => {
          if (typeof window.initializeAdminPanelMaster === 'function' && 
              window.AdminPanel && 
              !window.AdminPanel.initialization?.isCompleted &&
              !window.AdminPanel.initialization?.isInProgress) {
            console.log('ğŸ”„ Re-initializing admin panel...');
            window.initializeAdminPanelMaster();
          } else {
            console.log('ğŸš« Skipping re-initialization: already initialized or in progress');
          }
        }, 1000);
      }
      
      // Show user-friendly error message for critical issues
      setTimeout(() => {
        if (window.showMessage && typeof window.showMessage === 'function') {
          window.showMessage('ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'warning');
        }
      }, 2000);
    }
    
    // Log important errors
    console.error('Global error caught:', event.error);
  });
  
  // Enhanced Promise rejection handling
  window.addEventListener('unhandledrejection', function(event) {
    const reason = event.reason?.toString() || '';
    
    // Suppress Google Apps Script internal promise rejections
    if (reason.includes('document.write') || 
        reason.includes('mae_html_user') ||
        reason.includes('warden_bin')) {
      console.debug('Suppressed internal promise rejection:', reason);
      event.preventDefault();
      return;
    }
    
    console.error('Unhandled promise rejection:', event.reason);
    event.preventDefault();
  });

  // GASOptimizer ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åˆæœŸåŒ–
  var gasOptimizer = new GASOptimizer();
  
  // UnifiedCache ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åˆæœŸåŒ–
  var unifiedCache = (typeof UnifiedCache !== 'undefined')
    ? new UnifiedCache()
    : { getOrSet: function(_, fn) { return fn(); } };
  
  // runGas ãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•° - ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾å¿œ
  function runGas(functionName, ...args) {
    return gasOptimizer.call(functionName, ...args);
  }
  
  // runGasWithUserId function is defined in adminPanel-api.js.html to avoid duplication
  
  // callWithCache é–¢æ•° - èª­ã¿å–ã‚Šå°‚ç”¨æ“ä½œç”¨
  function callWithCache(functionName, cacheKey, ttl, ...args) {
    return unifiedCache.getOrSet(cacheKey, function() {
      return gasOptimizer.call(functionName, ...args);
    }, ttl);
  }
  
  // ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ: callWithCacheWithUserIdé–¢æ•°
  function callWithCacheWithUserId(functionName, cacheKey, ttl, ...args) {
    if (!userId) {
      console.error('âŒ  - No userId available for cached call:', functionName);
      throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
    }
    
    return unifiedCache.getOrSet(cacheKey, function() {
      console.log('âœ…  - callWithCacheWithUserId:', functionName, 'userId:', userId);
      return gasOptimizer.call(functionName, userId, ...args);
    }, ttl);
  }
  </script>
  <script>
  const __IS_SYSTEM_ADMIN_RAW__ = '<?= escapeJavaScript(typeof isDeployUser !== "undefined" ? isDeployUser : "false") ?>';
  const __IS_SYSTEM_ADMIN__ = __IS_SYSTEM_ADMIN_RAW__ === 'true' || __IS_SYSTEM_ADMIN_RAW__ === true;
  window.isSystemAdmin = __IS_SYSTEM_ADMIN__;
  console.log('Template Debug:');
  console.log('- Raw template value:', __IS_SYSTEM_ADMIN_RAW__);
  console.log('- Raw template type:', typeof __IS_SYSTEM_ADMIN_RAW__);
  console.log('- Processed value:', __IS_SYSTEM_ADMIN__);
  console.log('- window.isSystemAdmin final:', window.isSystemAdmin);
  
  </script>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans">
  <!-- Unified Loading Overlay - Content managed by UnifiedLoadingManager -->
  <div id="loading-overlay" class="loading-overlay page-specific hidden"></div>
  <header id="admin-header" class="glass-panel border-b border-gray-700 fixed top-1 sm:top-2 left-2 right-2 sm:left-4 sm:right-4 z-50 rounded-lg sm:rounded-xl shadow-lg">
  <div class="relative -top-1 sm:-top-2 max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4">
        <!-- ãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="flex items-center gap-3 flex-shrink-0">
          <div class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
          </div>
          <div class="min-w-0">
            <div class="hidden sm:block">
              <h1 class="text-lg sm:text-xl font-bold text-white leading-tight truncate">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰	ç®¡ç†ãƒ‘ãƒãƒ«</h1>
              <p class="text-xs text-gray-400">StudyQuest</p>
            </div>
            <div class="sm:hidden">
              <h1 class="text-base font-bold text-white truncate">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰</h1>
            </div>
          </div>
        </div>
        
        <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
        <div class="flex items-center gap-2 flex-shrink-0">
          <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
          <div id="header-domain-info">
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆç·‘è‰²ãƒ‘ãƒãƒ«ï¼‰ -->
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-match" class="glass-panel bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-3 border border-green-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <div class="text-green-400 font-semibold text-sm" id="header-domain-match-text">G Suite ãƒ‰ãƒ¡ã‚¤ãƒ³</div>
                  <div class="text-green-200 text-xs">ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹</div>
                </div>
              </div>
            </div>
            
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´è¡¨ç¤ºï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-mismatch" class="glass-panel bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-3 border border-yellow-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <div>
                  <div class="text-yellow-400 font-semibold text-sm" id="header-domain-mismatch-text">ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´</div>
                  <div class="text-yellow-200 text-xs">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚ã‚Š</div>
                </div>
              </div>
            </div>
            
            <!-- åˆæœŸçŠ¶æ…‹è¡¨ç¤º -->
            <div id="header-domain-initial" class="glass-panel bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg p-3 border border-blue-400/30">
              <div class="flex items-center gap-2">
                <div id="header-status-dot" class="w-3 h-3 bg-blue-400 rounded-full animate-pulse flex-shrink-0"></div>
                <div>
                  <div class="text-blue-400 font-semibold text-sm" id="header-domain-name-initial">ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­</div>
                  <div class="text-blue-200 text-xs" id="header-status-text-initial">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­</div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </header>
  <main id="admin-main" class="flex-1 max-w-6xl mx-auto px-4 sm:px-6
              pt-16 sm:pt-20
              pb-16 sm:pb-20
              h-screen overflow-y-auto">
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼‹å·¦å³ãƒ‘ãƒãƒ« -->
    <div class="responsive-grid grid grid-cols-1 lg:grid-cols-3 gap-4">

    <!-- ã‚·ãƒ³ãƒ—ãƒ«çµ±åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
    <section class="col-span-1 lg:col-span-3">
      <div class="glass-panel p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <!-- å·¦å´: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-white" id="guidance-text">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</span>
              <div class="text-xs text-gray-400 mt-1" id="progress-message">3ã‚¹ãƒ†ãƒƒãƒ—ã§ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
            </div>
          </div>
          
          <!-- å³å´: ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º -->
          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1.5" id="step-1-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">1</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">ãƒ‡ãƒ¼ã‚¿æº–å‚™</span>
            </div>
            <div class="w-4 h-px bg-gradient-to-r from-gray-600 to-gray-500 rounded-full"></div>
            <div class="flex items-center gap-1.5" id="step-2-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">2</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">ã‚·ãƒ¼ãƒˆè¨­å®š</span>
            </div>
            <div class="w-4 h-px bg-gradient-to-r from-gray-600 to-gray-500 rounded-full"></div>
            <div class="flex items-center gap-1.5" id="step-3-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">3</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">è¡¨ç¤ºè¨­å®š</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å·¦å³ãƒ‘ãƒãƒ« -->
      <div class="left-panel col-span-2 space-y-2">
        
        <!-- è‡ªå‹•åœæ­¢é€šçŸ¥ãƒãƒŠãƒ¼ -->
        <div id="auto-stop-notification" class="hidden glass-panel p-4 border-l-4 border-yellow-500 bg-yellow-900/20">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-yellow-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <div class="flex-1">
              <h3 class="text-yellow-300 font-semibold mb-1">è‡ªå‹•åœæ­¢ã•ã‚Œã¾ã—ãŸ</h3>
              <p class="text-gray-300 text-sm mb-2">
                å›ç­”ãƒœãƒ¼ãƒ‰ã¯äºˆå®šæ™‚åˆ»ã«è‡ªå‹•çš„ã«éå…¬é–‹ã«ãªã‚Šã¾ã—ãŸã€‚
              </p>
              <div class="text-xs text-gray-400 mb-3" id="auto-stop-details">
                åœæ­¢æ™‚åˆ»: <span id="auto-stopped-time"></span>
              </div>
              <button type="button" id="republish-after-auto-stop-btn" 
                      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                å†å…¬é–‹ã™ã‚‹
              </button>
            </div>
            <button type="button" onclick="document.getElementById('auto-stop-notification').classList.add('hidden')" 
                    class="text-gray-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š -->
        <div class="glass-panel p-4 lg:p-6" id="data-setup-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-blue-400/20">
                1
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  ãƒ‡ãƒ¼ã‚¿æº–å‚™
                  <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">ãƒ•ã‚©ãƒ¼ãƒ ã‚„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®š</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step1-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step1-content" class="progressive-section expanded">
            <!-- çµ±åˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æº–å‚™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="google-integration p-4 rounded-xl text-white mb-4">
              <div class="flex items-center gap-3 mb-3">
                <svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <div>
                  <h3 class="font-semibold">ãƒ‡ãƒ¼ã‚¿æº–å‚™</h3>
                  <p class="text-xs opacity-90">ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ</p>
                </div>
              </div>
              <p class="text-sm mb-4 opacity-90">
                Google Workspaceã¨é€£æºã—ã¦ã€å­¦ç¿’è€…ã®æ„è¦‹ã‚’åé›†ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
              </p>
              
              <!-- æ°´å¹³é…ç½®ã®ãƒœã‚¿ãƒ³ -->
              <div class="flex gap-3">
                <button type="button" id="quickstart-btn" class="btn btn-google flex-1">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                  <span id="quickstart-text">ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
                </button>
                <button type="button" id="create-board-btn" class="btn btn-google flex-1">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  <span id="create-board-text">ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</span>
                </button>
              </div>
              
              <!-- ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆå®Œäº†è¡¨ç¤ºï¼ˆçµ±åˆç§»å‹•ï¼‰ -->
              <div class="mt-4 hidden" id="form-url-section">
                <div class="bg-gradient-to-r from-green-600/20 to-emerald-600/20 border border-green-500/30 rounded-xl p-4">
                  <div class="flex items-center gap-3 mb-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="text-base font-semibold text-green-300">ãƒ•ã‚©ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸ</h4>
                      <p class="text-xs text-gray-400">æ¬¡ã«ã‚·ãƒ¼ãƒˆè¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„</p>
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <input type="url" id="form-url-input" class="form-control flex-1 text-sm" readonly placeholder="ãƒ•ã‚©ãƒ¼ãƒ URLãŒç”Ÿæˆã•ã‚Œã¾ã™">
                    <button type="button" id="copy-form-url-btn" class="btn btn-secondary px-3" title="URLã‚’ã‚³ãƒ”ãƒ¼">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                      </svg>
                    </button>
                    <a id="open-form-url-link" href="#" target="_blank" class="btn btn-secondary px-3" title="ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- QuickStart Progress (æœ€é©åŒ–ã•ã‚ŒãŸé€²è¡Œè¡¨ç¤º) -->
            <div id="quickstart-progress" class="hidden bg-gradient-to-br from-emerald-900/20 to-blue-900/20 border border-emerald-400/30 rounded-xl p-5 mb-4 backdrop-blur-sm">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-white animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                </div>
                <div>
                  <h4 class="text-base font-semibold text-emerald-300">è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»å…¬é–‹é€²è¡Œä¸­</h4>
                  <p class="text-xs text-gray-400">ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆã‹ã‚‰å…¬é–‹ã¾ã§è‡ªå‹•ã§å®Œäº†ã—ã¾ã™</p>
                </div>
              </div>
              
              <!-- QuickStart 2-Step Progress (Simplified) -->
              <div class="space-y-3 mb-5">
                <div class="flex items-center gap-4" id="progress-step-1">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="progress-step-1-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="progress-step-1-text">ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ</div>
                    <div class="text-xs text-gray-500 mt-1" id="progress-step-1-detail">ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è‡ªå‹•ä½œæˆä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="progress-step-1-time">1åˆ†30ç§’</div>
                </div>
                
                <div class="flex items-center gap-4" id="progress-step-2">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="progress-step-2-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="progress-step-2-text">ãƒœãƒ¼ãƒ‰è¨­å®šã¨è‡ªå‹•å…¬é–‹</div>
                    <div class="text-xs text-gray-500 mt-1" id="progress-step-2-detail">å›ç­”ãƒœãƒ¼ãƒ‰ã®è¨­å®šã¨è‡ªå‹•å…¬é–‹ã‚’å®Ÿè¡Œä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="progress-step-2-time">1åˆ†</div>
                </div>
              </div>
              
              <!-- Enhanced Progress Bar -->
              <div class="bg-gray-800/50 rounded-full p-1 mb-4">
                <div class="flex items-center justify-between mb-2 px-2">
                  <span class="text-xs font-medium text-gray-300">å…¨ä½“ã®é€²æ—</span>
                  <span class="text-sm font-bold text-emerald-400" id="progress-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                  <div class="bg-gradient-to-r from-emerald-500 via-blue-500 to-purple-500 h-3 rounded-full transition-all duration-700 ease-out shadow-lg" style="width: 0%" id="progress-bar"></div>
                </div>
              </div>
              
              <div class="text-center bg-gray-800/30 rounded-lg p-3">
                <p class="text-sm font-medium text-emerald-300" id="progress-status">åˆæœŸåŒ–ä¸­...</p>
                <p class="text-xs text-gray-400 mt-1">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
              </div>
            </div>

            <!-- CustomSetup Progress (ç‹¬ç«‹ã—ãŸé€²è¡Œè¡¨ç¤º) -->
            <div id="customsetup-progress" class="hidden bg-gradient-to-br from-purple-900/20 to-pink-900/20 border border-purple-400/30 rounded-xl p-5 mb-4 backdrop-blur-sm">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-white animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                </div>
                <div>
                  <h4 class="text-base font-semibold text-purple-300">ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é€²è¡Œä¸­</h4>
                  <p class="text-xs text-gray-400">é«˜ç²¾åº¦AIåˆ¤å®šã‚’å«ã‚€è©³ç´°è¨­å®šã‚’å®Ÿè¡Œä¸­</p>
                </div>
                <div class="ml-auto">
                  <button type="button" id="customsetup-cancel-btn" class="px-3 py-1 text-xs bg-red-600/20 hover:bg-red-600/30 text-red-300 hover:text-red-200 border border-red-500/30 rounded-lg transition-colors duration-200">
                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    ä¸­æ–­
                  </button>
                </div>
              </div>
              
              <!-- CustomSetup 2-Step Progress (Simplified) -->
              <div class="space-y-3 mb-5">
                <div class="flex items-center gap-4" id="custom-progress-step-1">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="custom-progress-step-1-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="custom-progress-step-1-text">ãƒ‡ãƒ¼ã‚¿æº–å‚™ã¨ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ</div>
                    <div class="text-xs text-gray-500 mt-1" id="custom-progress-step-1-detail">Googleãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ§‹ç¯‰ä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="custom-progress-step-1-time">1åˆ†30ç§’</div>
                </div>

                <div class="flex items-center gap-4" id="custom-progress-step-2">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="custom-progress-step-2-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="custom-progress-step-2-text">AIã«ã‚ˆã‚‹åˆ—åˆ†æ</div>
                    <div class="text-xs text-gray-500 mt-1" id="custom-progress-step-2-detail">AIãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’åˆ†æã—ã€æœ€é©ãªè¨­å®šã‚’ææ¡ˆä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="custom-progress-step-2-time">2åˆ†</div>
                </div>
              </div>
              
              <!-- CustomSetup Progress Bar -->
              <div class="bg-gray-800/50 rounded-full p-1 mb-4">
                <div class="flex items-center justify-between mb-2 px-2">
                  <span class="text-xs font-medium text-gray-300">å…¨ä½“ã®é€²æ—</span>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400" id="custom-progress-eta">æ¨å®šæ®‹ã‚Šæ™‚é–“: 5åˆ†</span>
                    <span class="text-sm font-bold text-purple-400" id="custom-progress-percentage">0%</span>
                  </div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                  <div class="bg-gradient-to-r from-purple-500 via-pink-500 to-indigo-500 h-3 rounded-full transition-all duration-700 ease-out shadow-lg" style="width: 0%" id="custom-progress-bar"></div>
                </div>
              </div>
              
              <div class="text-center bg-gray-800/30 rounded-lg p-3">
                <p class="text-sm font-medium text-purple-300" id="custom-progress-status">åˆæœŸåŒ–ä¸­...</p>
                <p class="text-xs text-gray-400 mt-1">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
              </div>
            </div>

            <!-- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
            <div id="existing-user-section" class="hidden bg-gray-800/30 border border-gray-600/30 rounded-xl p-4 mb-4">
              <h4 class="text-sm font-semibold text-gray-300 mb-3">è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h4>
              <button type="button" id="create-additional-form-btn" class="btn btn-secondary w-full text-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span id="create-additional-form-text" class="text-gray-200">æ–°è¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</span>
              </button>
              <p class="text-xs text-gray-400 mt-2">ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰ã«é€£æºã™ã‚‹æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</p>
            </div>
            
            <!-- å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘) -->
            <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
              <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘)
              </summary>
              <div class="p-4 pt-0 space-y-4">
                <div class="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-4">
                  <label class="block text-sm font-medium text-cyan-200 mb-2">
                    Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URL
                  </label>
                  <div class="space-y-3">
                    <input type="url" 
                           id="resource-url-input" 
                           placeholder="https://docs.google.com/spreadsheets/d/..."
                           class="form-control"
                           aria-describedby="resource-url-help">
                    <p id="resource-url-help" class="text-xs text-cyan-300 mt-1">
                      æ—¢å­˜ã®Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                    </p>
                    <button type="button" id="add-resource-btn" class="btn btn-primary w-full">
                      <span id="add-resource-text">ãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ </span>
                    </button>
                  </div>
                </div>
              </div>
            </details>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="custom-form-info-section" class="hidden mt-4">
              <!-- updateCustomFormInfo()ã§å‹•çš„ã«å†…å®¹ãŒè¨­å®šã•ã‚Œã‚‹ -->
            </div>
          </div>
        </div>


        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆè¨­å®š -->
        <div class="glass-panel p-4 lg:p-6" id="sheet-selection-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-green-400/20">
                2
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  ã‚·ãƒ¼ãƒˆè¨­å®š
                  <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">è³ªå•å†…å®¹ã¨è¡¨ç¤ºè¨­å®šã‚’ç®¡ç†</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step2-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step2-content" class="progressive-section expanded">
            <div class="space-y-4">
              <!-- ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆé¸æŠã®èª¬æ˜ -->
              <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  <span class="text-sm font-medium text-green-200">ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆé¸æŠ</span>
                </div>
                <p class="text-xs text-green-300">ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‹ã‚‰è³ªå•æ–‡ã¨å›ç­”ã‚¿ã‚¤ãƒ—ã‚’è¨­å®šã—ã¾ã™</p>
              </div>
              
              <!-- Enhanced Sheet Selection Control -->
              <div class="space-y-4">
                <label for="sheet-select" class="block text-sm font-medium text-white">
                  <span class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ
                    <span class="text-xs text-green-400 bg-green-400/10 px-2 py-1 rounded-full">é¸æŠã™ã‚‹ã¨å³åº§ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–</span>
                  </span>
                </label>
                <div class="flex gap-2">
                  <div class="flex-1 relative">
                    <select id="sheet-select" class="form-control w-full" aria-describedby="sheet-help">
                      <option>èª­ã¿è¾¼ã¿ä¸­...</option>
                    </select>
                    <!-- Loading indicator for sheet selection -->
                    <div id="sheet-loading" class="hidden absolute right-10 top-1/2 transform -translate-y-1/2">
                      <svg class="w-4 h-4 text-green-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                      </svg>
                    </div>
                  </div>
                  <button type="button" id="open-spreadsheet-btn-step2" class="btn btn-secondary px-3 flex-shrink-0" title="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                  </button>
                </div>
                
                <!-- Enhanced Help and Status -->
                <div class="space-y-2">
                  <p id="sheet-help" class="text-xs text-gray-400">
                    ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­”ã‚„è¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„
                  </p>
                  
                  <!-- Active Sheet Status -->
                  <div id="active-sheet-status" class="hidden bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                      <span class="text-sm text-green-300 font-medium">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒ¼ãƒˆ:</span>
                      <span id="active-sheet-name" class="text-sm text-white font-medium"></span>
                    </div>
                    <div class="mt-2 text-xs text-green-200">
                      <span id="active-sheet-info">åˆ—è¨­å®šãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™</span>
                    </div>
                  </div>
                  
                  <!-- Selection Confirmation -->
                  <div id="sheet-selection-feedback" class="hidden">
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                      <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm text-blue-300 font-medium">ã‚·ãƒ¼ãƒˆå¤‰æ›´å®Œäº†</span>
                      </div>
                      <p class="text-xs text-blue-200 mt-1">åˆ—é¸æŠãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚Step 3ã§è©³ç´°è¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: è¡¨ç¤ºè¨­å®šãƒ»å…¬é–‹ -->
        <div class="glass-panel p-4 lg:p-6" id="config-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-purple-400/20">
                3
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  è¡¨ç¤ºè¨­å®šãƒ»å…¬é–‹
                  <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">åˆ—è¨­å®šã¨è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step3-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step3-content" class="progressive-section expanded">
            <!-- ãƒ‰ãƒ©ãƒ•ãƒˆãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div id="draft-mode-indicator-section" class="mb-4 hidden">
              <div class="glass-panel bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border border-yellow-400/30 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                      <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                      </svg>
                    </div>
                    <div>
                      <div class="text-sm font-medium text-yellow-200">ğŸ“ ãƒ‰ãƒ©ãƒ•ãƒˆç·¨é›†ä¸­</div>
                      <div class="text-xs text-yellow-300">è¨­å®šã‚’å¤‰æ›´ä¸­ã§ã™ã€‚ã€Œå…¬é–‹ã€ãƒœã‚¿ãƒ³ã§ç¢ºå®šã•ã‚Œã¾ã™ã€‚</div>
                    </div>
                  </div>
                  <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
                </div>
              </div>
            </div>
            
            <div id="config-area" class="space-y-4 hidden">
              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span class="text-sm font-medium text-purple-200">åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š</span>
                </div>
                <p class="text-xs text-purple-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’å›ç­”ãƒœãƒ¼ãƒ‰ã®é …ç›®ã«å‰²ã‚Šå½“ã¦ã¾ã™</p>
              </div>
              
              <!-- å¿…é ˆè¨­å®š -->
              <div class="space-y-4">
                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                  <label class="block">
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-white">å›ç­”ãƒ‡ãƒ¼ã‚¿åˆ—</span>
                      <span class="px-2 py-1 bg-red-500 text-white text-xs rounded-full">å¿…é ˆ</span>
                    </div>
                    <div class="flex gap-2">
                      <select id="opinionHeader" class="form-control flex-1" aria-describedby="main-help"></select>
                      <button type="button" id="reguess-headers-btn" class="btn bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-600 hover:to-purple-700 text-white px-3 py-2 relative overflow-hidden group" title="AIæ­è¼‰ é«˜ç²¾åº¦åˆ—åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ ">
                        <span class="relative z-10 flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                          </svg>
                          <span class="text-xs font-bold">AIåˆ¤å®š</span>
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-purple-500/20 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                      </button>
                    </div>
                    <p id="main-help" class="text-xs text-red-300 mt-1">
                      å›ç­”å†…å®¹ãŒå«ã¾ã‚Œã‚‹åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„
                    </p>
                  </label>
                </div>
                
                <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š -->
                <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
                  <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                    </svg>
                    ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆä»»æ„ï¼‰
                  </summary>
                  <div class="p-4 pt-0 space-y-4" id="detail-options">
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ç†ç”±åˆ—</span>
                      <select id="reason-column" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">åå‰åˆ—</span>
                      <select id="name-column" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ã‚¯ãƒ©ã‚¹åˆ—</span>
                      <select id="class-column" class="form-control"></select>
                    </label>
                    
                    <div class="flex items-center mt-4">
                      <input type="checkbox" id="show-names" name="show-names" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="show-names" class="ml-2 block text-sm text-gray-300">åå‰ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                    <div class="flex items-center mt-2">
                      <input type="checkbox" id="show-counts" name="show-counts" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="show-counts" class="ml-2 block text-sm text-gray-300">ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                  </div>
                </details>
              </div>
              
              <!-- Enhanced Preview and Publish Section -->
              <div class="space-y-4 pt-4">
                <!-- Preview Settings Summary -->
                <div id="publish-preview-panel" class="hidden bg-gradient-to-br from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded-xl p-4">
                  <div class="flex items-center gap-3 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="text-base font-semibold text-purple-300">å…¬é–‹å‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                      <p class="text-xs text-gray-400">è¨­å®šå†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å…¬é–‹ã§ãã¾ã™</p>
                    </div>
                  </div>
                  
                  <!-- Configuration Summary -->
                  <div class="space-y-3 mb-4">
                    <div class="grid grid-cols-2 gap-3 text-sm">
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">å¯¾è±¡ã‚·ãƒ¼ãƒˆ</div>
                        <div class="text-white font-medium" id="preview-sheet-name">æœªé¸æŠ</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">è³ªå•æ–‡åˆ—</div>
                        <div class="text-white font-medium" id="preview-opinion-column">æœªè¨­å®š</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">åå‰åˆ—</div>
                        <div class="text-white font-medium" id="preview-name-column">æœªè¨­å®š</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">ã‚¯ãƒ©ã‚¹åˆ—</div>
                        <div class="text-white font-medium" id="preview-class-column">æœªè¨­å®š</div>
                      </div>
                    </div>
                    
                    <!-- Sample Data Preview -->
                    <div id="sample-data-preview" class="hidden bg-gray-800/30 rounded-lg p-3">
                      <div class="text-xs text-gray-400 mb-2">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (æœ€æ–°3ä»¶)</div>
                      <div class="space-y-2 text-xs" id="sample-data-list">
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                  </div>
                  
                  <!-- Preview Actions -->
                  <div class="flex gap-2">
                    <button type="button" id="preview-board-btn" class="btn btn-secondary flex-1 text-sm">
                      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                      </svg>
                      ãƒœãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    </button>
                    <button type="button" id="refresh-preview-btn" class="btn btn-secondary px-3" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-3">
                  <!-- ãƒ‰ãƒ©ãƒ•ãƒˆæ©Ÿèƒ½ãƒ˜ãƒ«ãƒ— -->
                  <div id="draft-help-section" class="hidden bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                    <div class="flex items-start gap-2">
                      <svg class="w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <div class="text-xs text-blue-300">
                        <div class="font-medium mb-1">ğŸ’¡ ãƒ‰ãƒ©ãƒ•ãƒˆæ©Ÿèƒ½ã«ã¤ã„ã¦</div>
                        <div>å±¥æ­´ã‹ã‚‰å¾©å…ƒã—ãŸè¨­å®šã¯ã€ã€Œå…¬é–‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§ä¸‹æ›¸ãçŠ¶æ…‹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ã‹ã‚‰å…¬é–‹ã§ãã¾ã™ã€‚</div>
                      </div>
                    </div>
                  </div>
                  
                  <button type="button" id="save-publish-btn" disabled class="btn btn-primary w-full btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span id="save-publish-text">è¨­å®šã‚’ä¿å­˜ã—ã¦å…¬é–‹</span>
                  </button>

                  <button type="button" id="unpublish-board-btn" class="btn btn-warning w-full hidden">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636"></path>
                    </svg>
                    <span id="unpublish-board-text">å…¬é–‹ã‚’åœæ­¢</span>
                  </button>
                </div>
              </div>
            </div>
            
            <div id="config-placeholder" class="text-center py-8">
              <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                <div class="loading-skeleton w-full h-full rounded-full hidden" id="config-loading"></div>
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
              </div>
              <p class="text-gray-400 text-sm">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã™ã‚‹ã¨åˆ—è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å³å´ï¼šæƒ…å ±ãƒ»ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ« -->
      <div class="right-panel space-y-4">
        
        <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ -->
        <div id="system-info-panel" class="glass-panel p-4 lg:p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-8 h-8 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
      </div>
      <h3 class="font-semibold text-gray-300">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³</h3>
    </div>

    <div class="space-y-4">
      <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
            <span class="text-white font-medium" id="info-admin-email">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</span>
            <span class="text-white font-mono text-xs bg-gray-700 px-1.5 py-0.5 rounded" id="info-user-id">-</span>
          </div>
          <div class="text-right pt-2">
          <button type="button" onclick="adminPanel.logoutAndRedirect()" class="text-cyan-400 hover:text-cyan-300 hover:underline text-xs">
            ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
          </button>
          </div>
        </div>
      </div>

      <!-- å…¬é–‹è¨­å®š -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          å…¬é–‹è¨­å®š
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">å…¬é–‹çŠ¶æ…‹:</span>
            <span class="px-2 py-1 rounded text-xs font-medium" id="info-publish-status">
              <span class="inline-flex items-center gap-1">
                <div class="w-2 h-2 rounded-full" id="info-publish-indicator"></div>
                <span id="info-publish-text">ç¢ºèªä¸­</span>
              </span>
            </span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">å…¬é–‹ã‚·ãƒ¼ãƒˆ:</span>
            <span class="text-white font-semibold" id="info-published-sheet">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰:</span>
            <span class="text-white" id="info-display-mode">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º:</span>
            <span class="text-white" id="info-show-counts">-</span>
          </div>
        </div>
      </div>

      <!-- ãƒªã‚½ãƒ¼ã‚¹ -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
          </svg>
          ãƒªã‚½ãƒ¼ã‚¹
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex gap-2">
            <button type="button" id="open-spreadsheet-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ
            </button>
            <button type="button" id="open-form-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              ãƒ•ã‚©ãƒ¼ãƒ (å›ç­”)
            </button>
          </div>
        </div>
        
      </div>

      <!-- ã‚¢ãƒ—ãƒªè¨­å®šãƒªãƒ³ã‚¯ -->
<? if (isDeployUser) { ?>
      <div id="app-setup-link" class="bg-blue-900/10 border border-blue-500/30 rounded-lg p-3 transition-all hover:border-blue-500/50">
        <button type="button" onclick="openAppSetupPage()" class="w-full flex items-center justify-between text-sm font-medium text-blue-300 hover:text-blue-200 transition-colors">
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span>ã‚¢ãƒ—ãƒªè¨­å®šç®¡ç†</span>
          </div>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
          </svg>
        </button>
        <p class="text-xs text-blue-200/70 mt-2 ml-6">
          ã‚¢ãƒ—ãƒªã®æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹ã‚’ç®¡ç†ã§ãã¾ã™
        </p>
      </div>
<? } ?>
      
      <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨çµ±åˆæƒ…å ± -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨çµ±åˆ
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex items-center justify-between">
            <a href="#" onclick="showSecurityInfo(); return false;" class="text-cyan-400 hover:text-cyan-300 hover:underline">
              ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã¤ã„ã¦
            </a>
          </div>
          <div class="flex items-center justify-between">
            <a href="#" onclick="showGoogleIntegrationInfo(); return false;" class="text-cyan-400 hover:text-cyan-300 hover:underline">
              Googleé€£æºã®åˆ©ç‚¹
            </a>
          </div>
        </div>
      </div>
      
      <details id="account-deletion-section" class="bg-red-900/10 border border-red-500/30 rounded-lg transition-all hover:border-red-500/50">
        <summary class="p-3 cursor-pointer text-sm font-medium text-red-300 hover:text-red-200 flex items-center justify-between">
          <span>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†</span>
          <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-3 pt-0 space-y-3">
          <p class="text-xs text-red-200/80 mb-3">
            ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã¨ã€ä½œæˆã—ãŸã™ã¹ã¦ã®ãƒœãƒ¼ãƒ‰ã¨è¨­å®šãŒå®Œå…¨ã«æ¶ˆå»ã•ã‚Œã¾ã™ã€‚
          </p>
          
          <!-- è¨­å®šåˆæœŸåŒ–ãƒ„ãƒ¼ãƒ« -->
          <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-3">
            <div class="flex items-start gap-2 mb-2">
              <svg class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div class="flex-1">
                <h5 class="text-xs font-medium text-orange-300 mb-1">è¨­å®šã‚’åˆæœŸåŒ–</h5>
                <p class="text-xs text-orange-200/80 mb-3">ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨ºæ–­ã—ã€å•é¡Œã«å¿œã˜ã¦è‡ªå‹•ä¿®å¾©ã¾ãŸã¯è¨­å®šåˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ã€‚</p>
                <button type="button" id="initialize-settings-btn" 
                        class="text-xs bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded border border-orange-500 transition-colors flex items-center gap-1.5"
                        title="è¨­å®šã®è¨ºæ–­ãƒ»ä¿®å¾©ãƒ»åˆæœŸåŒ–ã‚’çµ±åˆå®Ÿè¡Œ">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  è¨­å®šã‚’åˆæœŸåŒ–
                </button>
              </div>
            </div>
          </div>
          
          <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ãƒœã‚¿ãƒ³ -->
          <button type="button" id="delete-account-btn" class="btn btn-danger w-full text-sm py-2">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            <span>è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å®Œå…¨ã«å‰Šé™¤ã™ã‚‹</span>
          </button>
        </div>
      </details>
      </div>
    </div>
  </main>
  
  <!-- çµ±åˆãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer id="admin-footer" class="fixed bottom-0 left-0 right-0 glass-panel border-t border-gray-700 min-h-16 sm:min-h-20 hidden">
    <div class="max-w-6xl mx-auto px-6 py-4">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4" id="footer-content">
        <!-- ä¸Šå´/å·¦å´: å…¬é–‹ä¸­ã®å•é¡Œæ–‡ã¨çµ‚äº†æ—¥æ™‚ -->
        <div class="flex-1">
          <div class="flex items-center gap-4 mb-1">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-green-400 font-semibold text-sm">å…¬é–‹ä¸­:</span>
            </div>
            
            <!-- äºˆå®šçµ‚äº†æ—¥æ™‚è¡¨ç¤º -->
            <div class="flex items-center gap-2" id="scheduled-end-display">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-xs text-gray-400">äºˆå®šçµ‚äº†:</span>
              <span class="text-xs font-medium" id="scheduled-end-time">æœªè¨­å®š</span>
            </div>
          </div>
          <p class="text-blue-300 font-medium text-lg break-words" id="current-topic-text" style="max-width: 60ch; line-height: 1.4;">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
        
        <!-- ä¸‹å´/å³å´: ãƒœãƒ¼ãƒ‰URLæ“ä½œ -->
        <div class="flex items-center gap-3 flex-shrink-0">
          <input type="text" id="board-url" readonly
                 class="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-sm cursor-pointer hover:bg-gray-700 focus:ring-2 focus:ring-green-400 min-w-[300px]"
                 onclick="this.select()" placeholder="URLãŒç”Ÿæˆã•ã‚Œã¾ã™">
          <button type="button" onclick="copyBoardUrl(this)" class="btn btn-secondary px-3 py-2 flex items-center" title="URLã‚’ã‚³ãƒ”ãƒ¼" aria-label="ç”Ÿå¾’ç”¨URLã‚’ã‚³ãƒ”ãƒ¼">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
          </button>
          <a id="view-board-link" href="#" target="_blank" rel="noopener noreferrer" 
             class="btn bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white px-4 py-2 flex items-center gap-2 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl" 
             title="å›ç­”ãƒœãƒ¼ãƒ‰ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã" aria-label="æ–°ã—ã„ã‚¿ãƒ–ã§å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹ã">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            <span class="font-semibold text-sm">ãƒœãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>
  <div id="message-area" class="fixed top-32 right-6 z-50" aria-live="polite" role="status"></div>
  
  <!-- å…±é€šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
  <?!= include('SharedModals'); ?>
  
  <!-- Admin Panel JavaScript Components -->
  <!-- Constants must be loaded first -->
  <?!= include('constants.js'); ?>
  <!-- Backend progress sync system -->
  <?!= include('backendProgressSync.js'); ?>
  <!-- Error handling system must be loaded first -->
  <?!= include('errorMessages.js'); ?>
  <?!= include('adminPanel-core.js.html'); ?>
  <?!= include('adminPanel-ui.js.html'); ?>
  <?!= include('adminPanel-status.js.html'); ?>
  <?!= include('adminPanel-api.js.html'); ?>
  <?!= include('adminPanel-forms.js.html'); ?>
  <?!= include('adminPanel-events.js.html'); ?>
  <?!= include('adminPanel.js.html'); ?>

  <script>
    // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      if (window.sharedModals) {
        window.sharedModals.loadAdminModals();
      }
    });
  </script>

</body>
</html>
