<!DOCTYPE html>
<!-- Layout Update v1.2 - 2025-07-19 - Fixed Header Overlap + Domain Display + Clean CSS -->
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <base target="_top">
  <title>ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰	ç®¡ç†ãƒ‘ãƒãƒ« - StudyQuest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1a1b26" />
  <meta name="description" content="StudyQuestã®å›ç­”ãƒœãƒ¼ãƒ‰ç®¡ç†ãƒ‘ãƒãƒ« - ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„æ•™è‚²ãƒ„ãƒ¼ãƒ«" />
  <!-- Shared Security Headers -->
  <?!= include('SharedSecurityHeaders.html'); ?>
  
  <!-- User ID will be retrieved dynamically from backend -->

  <!-- Shared TailwindCSS Configuration -->
  <?!= include('SharedTailwindConfig.html'); ?>
  <script>
  // Simple initialization system for GAS environment
  window.onerror = function(message, source, lineno, colno, error) { 
    // Suppress specific syntax errors that don't affect functionality
    if (message && message.includes('Unexpected end of input')) {
      return true; // Suppress this specific error
    }
    return true; // Suppress all errors for stability
  };
  window.onunhandledrejection = function() { return true; };
  
  // Debug mode setting
  const __DEBUG_MODE_RAW__ = '<?= escapeJavaScript(shouldEnableDebugMode()) ?>';
  window.DEBUG_MODE = (__DEBUG_MODE_RAW__ === 'true' || __DEBUG_MODE_RAW__ === true);
  
  // Minimal log suppression for production
  if (!window.DEBUG_MODE) {
    const originalLog = console.log;
    console.log = function(...args) {
      const msg = args.join(' ');
      if (msg.match(/[âœ…ğŸ”§ğŸ›¡ï¸ğŸ”ğŸ‰ğŸ“ğŸ”ğŸš€ğŸ”„]/)) return; // Suppress emoji logs
      if (msg.includes('loaded successfully') || msg.includes('initialized')) return;
      originalLog.apply(console, args);
    };
  }
  
  // =============================================================================
  // UTILITY FUNCTIONS - Core UI Interactions
  // =============================================================================
  function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const button = document.querySelector(`[onclick="toggleSection('${sectionId}')"]`);
    if (!section) return;
    
    const isExpanded = section.classList.contains('expanded');
    if (isExpanded) {
      section.classList.remove('expanded');
      section.classList.add('collapsed');
      if (button) button.setAttribute('aria-expanded', 'false');
    } else {
      section.classList.remove('collapsed');
      section.classList.add('expanded');  
      if (button) button.setAttribute('aria-expanded', 'true');
    }
    
    // Rotate chevron icon
    const chevron = button?.querySelector('svg');
    if (chevron) {
      chevron.style.transform = isExpanded ? 'rotate(90deg)' : 'rotate(0deg)';
    }
  }
  
  function copyBoardUrl(button) {
    const urlInput = document.getElementById('board-url');
    if (!urlInput || !urlInput.value) {
      logError('Board URL not found or empty');
      return;
    }
    
    urlInput.select();
    urlInput.setSelectionRange(0, 99999); // For mobile
    
    try {
      document.execCommand('copy');
      // Visual feedback
      const originalText = button.innerHTML;
      button.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
      setTimeout(() => {
        button.innerHTML = originalText;
      }, 1500);
      logInfo('âœ… URL copied to clipboard');
    } catch (err) {
      logError('Failed to copy URL:', err);
    }
  }
  
  function showSecurityInfo() {
    if (window.sharedModals && window.sharedModals.showSecurityModal) {
      window.sharedModals.showSecurityModal();
    } else {
      logInfo('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±: naha-okinawa.ed.jp ãƒ‰ãƒ¡ã‚¤ãƒ³å°‚ç”¨ã‚·ã‚¹ãƒ†ãƒ ');
    }
  }
  
  function showGoogleIntegrationInfo() {
    if (window.sharedModals && window.sharedModals.showGoogleIntegrationModal) {
      window.sharedModals.showGoogleIntegrationModal();
    } else {
      logInfo('Googleé€£æº: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨ãƒ•ã‚©ãƒ¼ãƒ ã®è‡ªå‹•ä½œæˆãƒ»ç®¡ç†');
    }
  }
  
  window.adminPanel = window.adminPanel || {};
  window.adminPanel.logoutAndRedirect = function() {
    if (confirm('ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
      const webAppUrl = getWebAppUrl?.() || ScriptApp?.getService()?.getUrl() || window.location.origin;
      window.location.href = webAppUrl + '?mode=login';
    }
  };
  
  // Legacy function stubs for compatibility
  window.openAppSetupPage = window.openAppSetupPage || function() { 
    logInfo('ã‚¢ãƒ—ãƒªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™');
  };
  window.runHeaderGuessing = function() {
    logInfo('ğŸ¤– AIåˆ—åˆ¤å®šã‚’å®Ÿè¡Œä¸­...');
    AdminPanel_callGAS('autoMapHeaders', window.AdminPanel.currentUserId, window.AdminPanel.currentSpreadsheetId, document.getElementById('sheet-select').value)
      .then(response => {
        if (response && response.success) {
          logInfo('âœ… AIåˆ¤å®šå®Œäº†: åˆ—è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ');
          populateColumnSelects(response.headers);
        } else {
          logError('AIåˆ¤å®šã«å¤±æ•—ã—ã¾ã—ãŸ:', response?.message);
        }
      })
      .catch(error => logError('AIåˆ¤å®šã‚¨ãƒ©ãƒ¼:', error));
  };
  window.addResource = function() { 
    logInfo('ãƒªã‚½ãƒ¼ã‚¹è¿½åŠ æ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™');
  };
  window.initializeUserSettingsWithUI = window.initializeUserSettingsWithUI || function() { 
    console.warn('initializeUserSettingsWithUI function not yet loaded'); 
  };
  </script>

  <!-- Unified Styles and Shared Components -->
  <?!= include('UnifiedStyles.html'); ?>
  <?!= include('SharedUtilities.html'); ?>
  
  <!-- Admin Panel Specific Styles -->
  <?!= include('adminPanel-layout.css.html'); ?>
  
  
  <!-- Core JavaScript Libraries (must be loaded first) -->
  <!-- ES5 Compatibility Layer - MUST LOAD FIRST -->
  <?!= include('es5-compatibility-layer.js.html'); ?>
  <?!= include('ClientOptimizer.html'); ?>
  <!-- UnifiedCache.js.html removed - class is defined in page.js.html -->
  
  <!-- Unified Admin Panel JavaScript (no duplicates) -->
  <script>
  const __IS_SYSTEM_ADMIN_RAW__ = '<?= escapeJavaScript(typeof isDeployUser !== "undefined" ? isDeployUser : "false") ?>';
  const __IS_SYSTEM_ADMIN__ = __IS_SYSTEM_ADMIN_RAW__ === 'true' || __IS_SYSTEM_ADMIN_RAW__ === true;
  window.isSystemAdmin = __IS_SYSTEM_ADMIN__;

  // =============================================================================
  // UNIFIED ADMIN PANEL NAMESPACE - No Function Duplication
  // =============================================================================
  window.AdminPanel = window.AdminPanel || {
    errors: {},
    ui: {},
    state: {
      current: null,
      selectedSheet: '',
      updateStatus(status) {
        this.current = status;
      }
    },
    initialization: {
      isInProgress: false,
      isCompleted: false,
      completedPhases: new Set(),
      startTime: null,
      lastLoadStatusCall: null,
      loadStatusCallCount: 0
    }
  };

  // =============================================================================
  // UNIFIED LOGGING SYSTEM - Single Definition
  // =============================================================================
  function AdminPanel_log(level, ...args) {
    const isDebugModeEnabled = window.AdminPanel && window.AdminPanel.stateManager && window.AdminPanel.stateManager.state.debugMode || window.DEBUG_MODE;
    if (!isDebugModeEnabled && level === 'debug') return;
    
    switch (level) {
      case 'error':
        console.error('[AdminPanel]', ...args);
        break;
      case 'warn':
        console.warn('[AdminPanel]', ...args);
        break;
      case 'info':
        console.log('[AdminPanel]', ...args);
        break;
      case 'debug':
        if (isDebugModeEnabled) console.log('[AdminPanel:DEBUG]', ...args);
        break;
      default:
        console.log('[AdminPanel]', ...args);
    }
  }

  // Logging functions are defined in adminPanel-framework.js.html

  // =============================================================================
  // STATE MANAGER - Using framework definition
  // =============================================================================
  // State manager is defined in adminPanel-framework.js.html

  // =============================================================================
  // UNIFIED API COMMUNICATION - Single Definition
  // =============================================================================
  function AdminPanel_callGAS(functionName, ...args) {
    return new Promise((resolve, reject) => {
      logDebug(`ğŸ“ About to call ${functionName}`, args);
      
      google.script.run
        .withSuccessHandler(function(response) {
          logDebug(`ğŸ“¥ ${functionName} response:`, response);
          resolve(response);
        })
        .withFailureHandler(function(error) {
          logError(`âŒ ${functionName} failed:`, error);
          reject(error);
        })[functionName](...args);
    });
  }

  // =============================================================================
  // USER INITIALIZATION - Unified Function
  // =============================================================================
  function initializeUserId() {
    logDebug('ğŸ” Initializing UserId');
    return AdminPanel_callGAS('getCurrentUserStatus')
      .then(response => {
        if (response && response.status === 'success') {
          window.AdminPanel.currentUserId = response.userInfo.userId;
          window.AdminPanel.userEmail = response.userInfo.adminEmail;
          logDebug('âœ… AdminPanel: User authenticated, userId:', window.AdminPanel.currentUserId);
          return response;
        } else {
          throw new Error('User authentication failed');
        }
      });
  }

  // =============================================================================
  // DOMAIN SECURITY STATUS FUNCTIONS
  // =============================================================================
  function initializeDomainStatus() {
    AdminPanel_callGAS('getSystemDomainInfo')
      .then(info => {
        if (info && info.adminDomain && !info.error) {
          if (info.isDomainMatch) {
            updateDomainDisplay('match', info.adminDomain, 'ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹');
            logDebug('Domain security status: Secure access enabled');
          } else {
            updateDomainDisplay('mismatch', info.adminDomain, 'ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚ã‚Š');
            logDebug('Domain security status: Access restricted');
          }
        } else {
          logDebug('Domain info not available, keeping initial display');
          updateDomainDisplay('initial', 'ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­', 'ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­');
        }
      })
      .catch(function(error) {
        logError('Failed to get domain info:', error);
        updateDomainDisplay('initial', 'ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­', 'ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­');
      });
  }
  
  function updateDomainDisplay(type, domainText, statusText) {
    const initialDiv = document.getElementById('header-domain-initial');
    const matchDiv = document.getElementById('header-domain-match');
    const mismatchDiv = document.getElementById('header-domain-mismatch');

    if (initialDiv) initialDiv.classList.add('hidden');
    if (matchDiv) matchDiv.classList.add('hidden');
    if (mismatchDiv) mismatchDiv.classList.add('hidden');

    if (type === 'match') {
      if (matchDiv) {
        matchDiv.classList.remove('hidden');
        const textEl = document.getElementById('header-domain-match-text');
        if (textEl) textEl.textContent = domainText;
      }
    } else if (type === 'mismatch') {
      if (mismatchDiv) {
        mismatchDiv.classList.remove('hidden');
        const textEl = document.getElementById('header-domain-mismatch-text');
        if (textEl) textEl.textContent = domainText;
      }
    } else { // initial
      if (initialDiv) {
        initialDiv.classList.remove('hidden');
        const domainEl = document.getElementById('header-domain-name-initial');
        const statusEl = document.getElementById('header-status-text-initial');
        if (domainEl) domainEl.textContent = domainText;
        if (statusEl) statusEl.textContent = statusText;
      }
    }
  }

  // =============================================================================
  // CORE UI FUNCTIONS - Preserved Interface
  // =============================================================================
  // loadStatus function is defined in adminPanel-api.js.html

  function createBoard() {
    return AdminPanel_callGAS('executeQuickStartSetup')
      .then(response => {
        if (response && response.status === 'success') {
          logInfo('âœ… Board created successfully');
          return response;
        } else {
          throw new Error(response.message || 'Failed to create board');
        }
      });
  }

  // =============================================================================
  // DOM UTILITY FUNCTIONS - Preserved Interface
  // =============================================================================
  function safeSetText(elementId, text) {
    try {
      const element = document.getElementById(elementId);
      if (element) {
        element.textContent = text;
        return true;
      } else {
        logWarn(`Element not found: ${elementId}`);
        return false;
      }
    } catch (error) {
      logError(`Error setting text for ${elementId}:`, error);
      return false;
    }
  }

  function showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
  }

  function hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }

  // =============================================================================
  // DATA SAVE FUNCTIONS - Database Operations
  // =============================================================================
  function saveSheetConfiguration() {
    const sheetSelect = document.getElementById('sheet-select');
    const nameColumn = document.getElementById('name-column');
    const showNames = document.getElementById('show-names');
    const showCounts = document.getElementById('show-counts');
    
    if (!sheetSelect || !sheetSelect.value) {
      logError('ã‚·ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
      return Promise.reject(new Error('ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„'));
    }
    
    const config = {
      nameHeader: nameColumn ? nameColumn.value : '',
      displayMode: showNames && showNames.checked ? 'NAMED' : 'ANONYMOUS',
      showReactionCounts: showCounts ? showCounts.checked : false
    };
    
    const userId = window.AdminPanel.currentUserId;
    const spreadsheetId = window.AdminPanel.currentSpreadsheetId || '';
    const sheetName = sheetSelect.value;
    
    logDebug('Saving sheet configuration:', { userId, spreadsheetId, sheetName, config });
    
    return AdminPanel_callGAS('saveSheetConfig', userId, spreadsheetId, sheetName, config)
      .then(response => {
        if (response && response.success) {
          logInfo('âœ… è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ');
          return response;
        } else {
          throw new Error(response ? response.message : 'è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      });
  }
  
  function saveAndPublish() {
    return saveSheetConfiguration()
      .then(() => {
        const userId = window.AdminPanel.currentUserId;
        const sheetName = document.getElementById('sheet-select').value;
        const spreadsheetId = window.AdminPanel.currentSpreadsheetId || '';
        
        return AdminPanel_callGAS('activateSheet', userId, spreadsheetId, sheetName);
      })
      .then(response => {
        if (response && response.success) {
          logInfo('âœ… ãƒœãƒ¼ãƒ‰ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ');
          updateUIStatus(response);
          refreshAllDisplays();
          return response;
        } else {
          throw new Error(response ? response.message : 'å…¬é–‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      });
  }
  
  function setDisplayOptions(options) {
    const userId = window.AdminPanel.currentUserId;
    
    return AdminPanel_callGAS('setDisplayOptions', userId, options)
      .then(response => {
        if (response && response.success) {
          logInfo('âœ… è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
          refreshAllDisplays();
          return response;
        } else {
          throw new Error(response ? response.message : 'è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      });
  }
  
  function loadSheetConfiguration(sheetName) {
    const userId = window.AdminPanel.currentUserId;
    const spreadsheetId = window.AdminPanel.currentSpreadsheetId || '';
    
    logDebug('Loading configuration for sheet:', sheetName);
    
    return AdminPanel_callGAS('getSheetDetails', userId, spreadsheetId, sheetName)
      .then(response => {
        if (response && response.config) {
          // Update UI with loaded configuration
          const nameColumn = document.getElementById('name-column');
          const showNames = document.getElementById('show-names');
          const showCounts = document.getElementById('show-counts');
          
          if (nameColumn && response.config.nameHeader) {
            nameColumn.value = response.config.nameHeader;
          }
          
          if (showNames) {
            showNames.checked = response.config.displayMode === 'NAMED';
          }
          
          if (showCounts) {
            showCounts.checked = response.config.showReactionCounts === true;
          }
          
          logInfo('âœ… ã‚·ãƒ¼ãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
          return response;
        }
        return response;
      })
      .catch(error => {
        logError('Sheet configuration load failed:', error);
        return null;
      });
  }
  
  function switchToSheet(sheetName) {
    const userId = window.AdminPanel.currentUserId;
    const spreadsheetId = window.AdminPanel.currentSpreadsheetId || '';
    
    return AdminPanel_callGAS('switchToSheet', userId, spreadsheetId, sheetName)
      .then(response => {
        if (response && response.success) {
          logInfo('âœ… ã‚·ãƒ¼ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
          loadSheetConfiguration(sheetName);
          return response;
        } else {
          throw new Error(response ? response.message : 'ã‚·ãƒ¼ãƒˆã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      });
  }

  // =============================================================================
  // ESSENTIAL EVENT HANDLERS - Unified
  // =============================================================================
  function setupEssentialEventHandlers() {
    // Save and publish button
    const savePublishBtn = document.getElementById('save-publish-btn');
    if (savePublishBtn) {
      savePublishBtn.addEventListener('click', function() {
        saveAndPublish().catch(error => logError('Save and publish failed:', error));
      });
    }

    // Sheet selection with auto-load configuration
    const sheetSelect = document.getElementById('sheet-select');
    if (sheetSelect) {
      sheetSelect.addEventListener('change', function() {
        const selectedSheet = this.value;
        window.AdminPanel.state.selectedSheet = selectedSheet;
        logDebug('Sheet selected:', selectedSheet);
        
        // Load configuration for selected sheet
        if (selectedSheet) {
          loadSheetConfiguration(selectedSheet);
        }
      });
    }
    
    // Display options change handlers
    const showNames = document.getElementById('show-names');
    const showCounts = document.getElementById('show-counts');
    
    if (showNames) {
      showNames.addEventListener('change', function() {
        const options = {
          displayMode: this.checked ? 'NAMED' : 'ANONYMOUS',
          showReactionCounts: showCounts ? showCounts.checked : false
        };
        setDisplayOptions(options).catch(error => logError('Display options update failed:', error));
      });
    }
    
    if (showCounts) {
      showCounts.addEventListener('change', function() {
        const options = {
          displayMode: showNames && showNames.checked ? 'NAMED' : 'ANONYMOUS',
          showReactionCounts: this.checked
        };
        setDisplayOptions(options).catch(error => logError('Display options update failed:', error));
      });
    }

    // Delete account button
    const deleteAccountBtn = document.getElementById('delete-account-btn');
    if (deleteAccountBtn) {
      deleteAccountBtn.addEventListener('click', function() {
        if (confirm('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
          AdminPanel_callGAS('deleteUserAccount')
            .then(response => {
              if (response.status === 'success') {
                alert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚');
                window.location.href = '/';
              }
            })
            .catch(error => logError('Delete account failed:', error));
        }
      });
    }

    // Modal handlers
    const modals = ['form-config-modal', 'security-details-modal', 'google-integration-modal'];
    modals.forEach(modalId => {
      const modal = document.getElementById(modalId);
      if (modal) {
        // Close on backdrop click
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            hideModal(modalId);
          }
        });
        
        // Close button
        const closeBtn = modal.querySelector('[data-modal-close]');
        if (closeBtn) {
          closeBtn.addEventListener('click', () => hideModal(modalId));
        }
      }
    });

    logDebug('Essential event handlers attached');
  }

  // =============================================================================
  // UI STATUS UPDATE FUNCTIONS - Preserved Interface
  // =============================================================================
  function updateUIStatus(statusData) {
    if (!statusData) return;

    // Update user info display
    if (statusData.userInfo) {
      safeSetText('info-admin-email', statusData.userInfo.adminEmail || '');
      safeSetText('info-user-id', statusData.userInfo.userId || '');
      safeSetText('header-domain-name-initial', statusData.userInfo.adminEmail ? statusData.userInfo.adminEmail.split('@')[1] : 'ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­');
    }

    // Update form status
    if (statusData.formUrl) {
      const openFormBtn = document.getElementById('open-form-btn');
      if (openFormBtn) {
        openFormBtn.href = statusData.formUrl;
        openFormBtn.classList.remove('hidden');
      }
    }

    // Update spreadsheet link
    if (statusData.spreadsheetUrl) {
      const openSpreadsheetBtn = document.getElementById('open-spreadsheet-btn');
      if (openSpreadsheetBtn) {
        openSpreadsheetBtn.href = statusData.spreadsheetUrl;
        openSpreadsheetBtn.classList.remove('hidden');
      }
    }

    logDebug('UI status updated');
  }

  // =============================================================================
  // FORM HANDLING - Unified
  // =============================================================================
  function handleFormSubmission(formId, gasFunction) {
    const form = document.getElementById(formId);
    if (!form) return;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      AdminPanel_callGAS(gasFunction, data)
        .then(response => {
          if (response.status === 'success') {
            logInfo('Form submitted successfully');
            loadStatus(); // Refresh status
          } else {
            logError('Form submission failed:', response.message);
          }
        })
        .catch(error => logError('Form submission error:', error));
    });
  }

  // =============================================================================
  // ADDITIONAL EVENT HANDLERS - Missing Button Functionality
  // =============================================================================
  function setupAdditionalEventHandlers() {
    // AI Header guessing button
    const reguessBtn = document.getElementById('reguess-headers-btn');
    if (reguessBtn) {
      reguessBtn.addEventListener('click', function() {
        window.runHeaderGuessing();
      });
    }
    
    // Open spreadsheet buttons
    const openSpreadsheetBtns = document.querySelectorAll('#open-spreadsheet-btn, #open-spreadsheet-btn-step2');
    openSpreadsheetBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const spreadsheetId = window.AdminPanel.currentSpreadsheetId;
        if (spreadsheetId) {
          const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit`;
          window.open(url, '_blank');
          logInfo('ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ã„ã¾ã™...');
        } else {
          logError('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
      });
    });
    
    // Open form button
    const openFormBtn = document.getElementById('open-form-btn');
    if (openFormBtn) {
      openFormBtn.addEventListener('click', function() {
        AdminPanel_callGAS('getActiveFormInfo', window.AdminPanel.currentUserId)
          .then(response => {
            if (response && response.formUrl) {
              window.open(response.formUrl, '_blank');
              logInfo('ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã„ã¦ã„ã¾ã™...');
            } else {
              logError('ãƒ•ã‚©ãƒ¼ãƒ URLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
          })
          .catch(error => logError('ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error));
      });
    }
    
    // Preview board button
    const previewBtn = document.getElementById('preview-board-btn');
    if (previewBtn) {
      previewBtn.addEventListener('click', function() {
        const userId = window.AdminPanel.currentUserId;
        if (userId) {
          AdminPanel_callGAS('generateUserUrls', userId)
            .then(response => {
              if (response && response.viewUrl) {
                window.open(response.viewUrl, '_blank');
                logInfo('ğŸ‘€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã„ã¦ã„ã¾ã™...');
              } else {
                logError('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
              }
            })
            .catch(error => logError('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error));
        }
      });
    }
    
    // Refresh preview button
    const refreshPreviewBtn = document.getElementById('refresh-preview-btn');
    if (refreshPreviewBtn) {
      refreshPreviewBtn.addEventListener('click', function() {
        refreshAllDisplays();
        logInfo('ğŸ”„ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™...');
      });
    }
    
    // Republish after auto-stop button
    const republishBtn = document.getElementById('republish-after-auto-stop-btn');
    if (republishBtn) {
      republishBtn.addEventListener('click', function() {
        saveAndPublish()
          .then(() => {
            document.getElementById('auto-stop-notification')?.classList.add('hidden');
            logInfo('âœ… å†å…¬é–‹ãŒå®Œäº†ã—ã¾ã—ãŸ');
          })
          .catch(error => logError('å†å…¬é–‹ã‚¨ãƒ©ãƒ¼:', error));
      });
    }
  }

  // =============================================================================
  // INITIALIZATION - Auto-start
  // =============================================================================
  document.addEventListener('DOMContentLoaded', function() {
    logDebug('DOM ready, initializing admin panel...');
    
    // Setup essential event handlers
    setupEssentialEventHandlers();
    setupAdditionalEventHandlers();
    
    // Initialize user authentication with fallback
    initializeUserId()
      .then(response => {
        logInfo('Admin panel initialized');
        updateUIStatus(response);
        // Initialize domain security status
        initializeDomainStatus();
        return loadStatus();
      })
      .catch(function(error) {
        logError('Initialization failed:', error);
        handleInitializationFailure();
        
        // Try emergency diagnostic
        AdminPanel_callGAS('emergencyDiagnostic')
          .then(diagnostic => {
            displayEmergencyDiagnostic(diagnostic);
          })
          .catch(diagError => {
            logError('Emergency diagnostic failed:', diagError);
          });
      })
      .then(statusResponse => {
        logDebug('Initial status loaded:', statusResponse);
        
        // Store spreadsheet ID and other essential data
        if (statusResponse && statusResponse.userInfo) {
          window.AdminPanel.currentSpreadsheetId = statusResponse.userInfo.spreadsheetId || '';
          window.AdminPanel.currentUserId = statusResponse.userInfo.userId || window.AdminPanel.currentUserId;
        }
        
        // Populate sheet dropdown
        if (statusResponse && statusResponse.allSheets) {
          const sheetSelect = document.getElementById('sheet-select');
          if (sheetSelect) {
            sheetSelect.innerHTML = '<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            statusResponse.allSheets.forEach(sheet => {
              const option = document.createElement('option');
              option.value = sheet.name;
              option.textContent = sheet.name;
              if (statusResponse.activeSheetName === sheet.name) {
                option.selected = true;
              }
              sheetSelect.appendChild(option);
            });
          }
        }
        
        updateUIStatus(statusResponse);
        refreshAllDisplays();
      })
      .catch(function(error) {
        logError('Admin panel initialization failed:', error);
      });
  });
  
  // =============================================================================
  // EMERGENCY FALLBACK HANDLERS
  // =============================================================================
  function handleInitializationFailure() {
    logError('ğŸš¨ Admin panel initialization failed - entering fallback mode');
    
    // Update UI to show initialization failure
    safeSetText('info-admin-email', 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãŒå¿…è¦ã§ã™');
    safeSetText('info-user-id', 'N/A');
    safeSetText('info-publish-text', 'è¨­å®šã‚¨ãƒ©ãƒ¼');
    
    // Show diagnostic area
    const diagnosticArea = createDiagnosticArea();
    const mainContent = document.querySelector('main');
    if (mainContent) {
      mainContent.insertBefore(diagnosticArea, mainContent.firstChild);
    }
    
    // Enable emergency setup options
    enableEmergencyMode();
  }
  
  function createDiagnosticArea() {
    const diagnosticDiv = document.createElement('div');
    diagnosticDiv.id = 'emergency-diagnostic';
    diagnosticDiv.className = 'glass-panel p-4 rounded-lg mb-4 border-2 border-red-500/50 bg-red-900/20';
    diagnosticDiv.innerHTML = `
      <div class="flex items-center gap-3 mb-3">
        <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
        <h3 class="text-red-300 font-semibold">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h3>
      </div>
      <div id="diagnostic-content" class="text-sm text-gray-300 mb-3">
        ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚è¨ºæ–­æƒ…å ±ã‚’å–å¾—ä¸­...
      </div>
      <div class="flex gap-2">
        <button type="button" id="emergency-test-btn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-sm">
          è¨ºæ–­ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        </button>
        <button type="button" id="emergency-setup-btn" class="btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 text-sm">
          ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        </button>
      </div>
    `;
    
    // Add event listeners
    setTimeout(() => {
      const testBtn = document.getElementById('emergency-test-btn');
      const setupBtn = document.getElementById('emergency-setup-btn');
      
      if (testBtn) {
        testBtn.addEventListener('click', function() {
          runEmergencyTest();
        });
      }
      
      if (setupBtn) {
        setupBtn.addEventListener('click', function() {
          runEmergencySetup();
        });
      }
    }, 100);
    
    return diagnosticDiv;
  }
  
  function displayEmergencyDiagnostic(diagnostic) {
    const content = document.getElementById('diagnostic-content');
    if (!content || !diagnostic) return;
    
    let html = '<div class="space-y-2">';
    
    if (diagnostic.error) {
      html += `<div class="text-red-400">âŒ è¨ºæ–­ã‚¨ãƒ©ãƒ¼: ${diagnostic.error}</div>`;
    } else {
      html += '<div class="text-sm space-y-1">';
      html += '<div><strong>Script Properties:</strong></div>';
      html += `<div class="ml-4">ğŸ“„ DATABASE_ID: ${diagnostic.scriptProperties.DATABASE_SPREADSHEET_ID ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'}</div>`;
      html += `<div class="ml-4">ğŸ” SERVICE_ACCOUNT: ${diagnostic.scriptProperties.SERVICE_ACCOUNT_CREDS ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'}</div>`;
      html += `<div class="ml-4">ğŸ‘¤ ADMIN_EMAIL: ${diagnostic.scriptProperties.ADMIN_EMAIL ? 'âœ… è¨­å®šæ¸ˆã¿' : 'âŒ æœªè¨­å®š'}</div>`;
      
      html += '<div><strong>èªè¨¼:</strong></div>';
      if (diagnostic.authentication.currentUserEmail) {
        html += `<div class="ml-4">âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${diagnostic.authentication.currentUserEmail}</div>`;
      } else {
        html += `<div class="ml-4">âŒ èªè¨¼ã‚¨ãƒ©ãƒ¼: ${diagnostic.authentication.error}</div>`;
      }
      
      html += '<div><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:</strong></div>';
      if (diagnostic.database.accessible) {
        html += `<div class="ml-4">âœ… æ¥ç¶šå¯èƒ½: ${diagnostic.database.id}</div>`;
      } else {
        html += `<div class="ml-4">âŒ æ¥ç¶šå¤±æ•—: ${diagnostic.database.error}</div>`;
      }
      
      html += '</div>';
    }
    
    html += '</div>';
    content.innerHTML = html;
  }
  
  function enableEmergencyMode() {
    // Enable quickstart button if available
    const quickstartBtn = document.getElementById('quickstart-btn');
    if (quickstartBtn) {
      quickstartBtn.disabled = false;
      quickstartBtn.textContent = 'ğŸš‘ ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—';
      quickstartBtn.addEventListener('click', function() {
        runEmergencySetup();
      });
    }
  }
  
  function runEmergencyTest() {
    logInfo('ğŸ”§ Running emergency test...');
    AdminPanel_callGAS('testCoreFunction')
      .then(result => {
        logInfo('Emergency test result:', result);
        alert('ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèªã—ã¦ãã ã•ã„');
      })
      .catch(function(error) {
        logError('Emergency test failed:', error);
        alert(`ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error}`);
      });
  }
  
  function runEmergencySetup() {
    if (confirm('ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿæ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã•ã‚Œã¾ã™ã€‚')) {
      logInfo('ğŸš‘ Running emergency setup...');
      AdminPanel_callGAS('createEmergencyUser')
        .then(result => {
          if (result.status === 'success') {
            alert('ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
            location.reload();
          } else {
            alert(`ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${result.message}`);
          }
        })
        .catch(function(error) {
          logError('Emergency setup failed:', error);
          alert(`ç·Šæ€¥ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error}`);
        });
    }
  }

  // =============================================================================
  // REAL-TIME DATA REFRESH SYSTEM
  // =============================================================================
  function refreshAllDisplays() {
    Promise.all([
      updateSystemInfo(),
      updatePublishStatus(), 
      updatePreviewPanel()
    ]).then(() => {
      logDebug('All displays refreshed');
    }).catch(error => {
      logError('Display refresh error:', error);
    });
  }
  
  function updateSystemInfo() {
    return AdminPanel_callGAS('getCurrentUserStatus', window.AdminPanel.currentUserId)
      .then(response => {
        if (response && response.userInfo) {
          safeSetText('info-admin-email', response.userInfo.adminEmail || '');
          safeSetText('info-user-id', response.userInfo.userId || '');
          window.AdminPanel.currentSpreadsheetId = response.userInfo.spreadsheetId;
        }
        return response;
      })
      .catch(error => logError('System info update failed:', error));
  }
  
  function updatePublishStatus() {
    return AdminPanel_callGAS('getInitialData', window.AdminPanel.currentUserId)
      .then(response => {
        if (response && response.config) {
          const isPublished = response.config.appPublished || false;
          const statusEl = document.getElementById('info-publish-status');
          const indicatorEl = document.getElementById('info-publish-indicator');
          const textEl = document.getElementById('info-publish-text');
          
          if (statusEl) {
            statusEl.className = isPublished ? 'px-2 py-1 rounded text-xs font-medium bg-green-900/30 text-green-300' : 'px-2 py-1 rounded text-xs font-medium bg-gray-700 text-gray-400';
          }
          if (indicatorEl) {
            indicatorEl.className = isPublished ? 'w-2 h-2 rounded-full bg-green-400' : 'w-2 h-2 rounded-full bg-gray-500';
          }
          if (textEl) {
            textEl.textContent = isPublished ? 'å…¬é–‹ä¸­' : 'éå…¬é–‹';
          }
          
          safeSetText('info-published-sheet', response.config.publishedSheetName || '-');
          safeSetText('info-display-mode', response.config.displayMode || '-');
          safeSetText('info-show-counts', response.config.showReactionCounts ? 'ON' : 'OFF');
          
          // Update board URL
          if (isPublished) {
            AdminPanel_callGAS('generateUserUrls', window.AdminPanel.currentUserId)
              .then(urlResponse => {
                if (urlResponse && urlResponse.viewUrl) {
                  const urlInput = document.getElementById('board-url');
                  const viewLink = document.getElementById('view-board-link');
                  if (urlInput) urlInput.value = urlResponse.viewUrl;
                  if (viewLink) viewLink.href = urlResponse.viewUrl;
                }
              });
          }
        }
        return response;
      })
      .catch(error => logError('Publish status update failed:', error));
  }
  
  function updatePreviewPanel() {
    const sheetSelect = document.getElementById('sheet-select');
    if (!sheetSelect || !sheetSelect.value) return Promise.resolve();
    
    const previewPanel = document.getElementById('publish-preview-panel');
    if (previewPanel && !previewPanel.classList.contains('hidden')) {
      safeSetText('preview-sheet-name', sheetSelect.value);
      const opinionSelect = document.getElementById('opinionHeader');
      const nameSelect = document.getElementById('name-column');
      const classSelect = document.getElementById('class-column');
      
      safeSetText('preview-opinion-column', opinionSelect?.value || 'æœªè¨­å®š');
      safeSetText('preview-name-column', nameSelect?.value || 'æœªè¨­å®š');  
      safeSetText('preview-class-column', classSelect?.value || 'æœªè¨­å®š');
    }
    
    return Promise.resolve();
  }

  </script>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans">
  <!-- Unified Loading Overlay - Content managed by UnifiedLoadingManager -->
  <div id="loading-overlay" class="loading-overlay page-specific hidden"></div>
  <header id="admin-header" class="glass-panel border-b border-gray-700 fixed top-1 sm:top-2 left-2 right-2 sm:left-4 sm:right-4 z-50 rounded-lg sm:rounded-xl shadow-lg">
  <div class="relative -top-1 sm:-top-2 max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4">
        <!-- ãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="flex items-center gap-3 flex-shrink-0">
          <div class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
          </div>
          <div class="min-w-0">
            <div class="hidden sm:block">
              <h1 class="text-lg sm:text-xl font-bold text-white leading-tight truncate">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰	ç®¡ç†ãƒ‘ãƒãƒ«</h1>
              <p class="text-xs text-gray-400">StudyQuest</p>
            </div>
            <div class="sm:hidden">
              <h1 class="text-base font-bold text-white truncate">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰</h1>
            </div>
          </div>
        </div>
        
        <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
        <div class="flex items-center gap-2 flex-shrink-0">
          <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
          <div id="header-domain-info">
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆç·‘è‰²ãƒ‘ãƒãƒ«ï¼‰ -->
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-match" class="glass-panel bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-3 border border-green-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <div class="text-green-400 font-semibold text-sm" id="header-domain-match-text">G Suite ãƒ‰ãƒ¡ã‚¤ãƒ³</div>
                  <div class="text-green-200 text-xs">ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹</div>
                </div>
              </div>
            </div>
            
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´è¡¨ç¤ºï¼ˆLogin.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-mismatch" class="glass-panel bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-3 border border-yellow-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <div>
                  <div class="text-yellow-400 font-semibold text-sm" id="header-domain-mismatch-text">ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´</div>
                  <div class="text-yellow-200 text-xs">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚ã‚Š</div>
                </div>
              </div>
            </div>
            
            <!-- åˆæœŸçŠ¶æ…‹è¡¨ç¤º -->
            <div id="header-domain-initial" class="glass-panel bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg p-3 border border-blue-400/30">
              <div class="flex items-center gap-2">
                <div id="header-status-dot" class="w-3 h-3 bg-blue-400 rounded-full animate-pulse flex-shrink-0"></div>
                <div>
                  <div class="text-blue-400 font-semibold text-sm" id="header-domain-name-initial">ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­</div>
                  <div class="text-blue-200 text-xs" id="header-status-text-initial">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­</div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </header>
  <main id="admin-main" class="flex-1 max-w-6xl mx-auto px-4 sm:px-6
              pt-16 sm:pt-20
              pb-16 sm:pb-20
              h-screen overflow-y-auto">
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼‹å·¦å³ãƒ‘ãƒãƒ« -->
    <div class="responsive-grid grid grid-cols-1 lg:grid-cols-3 gap-4">

    <!-- ã‚·ãƒ³ãƒ—ãƒ«çµ±åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
    <section class="col-span-1 lg:col-span-3">
      <div class="glass-panel p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <!-- å·¦å´: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-white" id="guidance-text">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</span>
              <div class="text-xs text-gray-400 mt-1" id="progress-message">3ã‚¹ãƒ†ãƒƒãƒ—ã§ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
            </div>
          </div>
          
          <!-- å³å´: ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º -->
          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1.5" id="step-1-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">1</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">ãƒ‡ãƒ¼ã‚¿æº–å‚™</span>
            </div>
            <div class="w-4 h-px bg-gradient-to-r from-gray-600 to-gray-500 rounded-full"></div>
            <div class="flex items-center gap-1.5" id="step-2-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">2</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">ã‚·ãƒ¼ãƒˆè¨­å®š</span>
            </div>
            <div class="w-4 h-px bg-gradient-to-r from-gray-600 to-gray-500 rounded-full"></div>
            <div class="flex items-center gap-1.5" id="step-3-indicator">
              <div class="w-7 h-7 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all duration-300">3</div>
              <span class="text-xs text-gray-400 hidden sm:inline font-medium">è¡¨ç¤ºè¨­å®š</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å·¦å³ãƒ‘ãƒãƒ« -->
      <div class="left-panel col-span-2 space-y-2">
        
        <!-- è‡ªå‹•åœæ­¢é€šçŸ¥ãƒãƒŠãƒ¼ -->
        <div id="auto-stop-notification" class="hidden glass-panel p-4 border-l-4 border-yellow-500 bg-yellow-900/20">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-yellow-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            <div class="flex-1">
              <h3 class="text-yellow-300 font-semibold mb-1">è‡ªå‹•åœæ­¢ã•ã‚Œã¾ã—ãŸ</h3>
              <p class="text-gray-300 text-sm mb-2">
                å›ç­”ãƒœãƒ¼ãƒ‰ã¯äºˆå®šæ™‚åˆ»ã«è‡ªå‹•çš„ã«éå…¬é–‹ã«ãªã‚Šã¾ã—ãŸã€‚
              </p>
              <div class="text-xs text-gray-400 mb-3" id="auto-stop-details">
                åœæ­¢æ™‚åˆ»: <span id="auto-stopped-time"></span>
              </div>
              <button type="button" id="republish-after-auto-stop-btn" 
                      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                å†å…¬é–‹ã™ã‚‹
              </button>
            </div>
            <button type="button" onclick="document.getElementById('auto-stop-notification').classList.add('hidden')" 
                    class="text-gray-400 hover:text-white transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š -->
        <div class="glass-panel p-4 lg:p-6" id="data-setup-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-blue-400/20">
                1
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  ãƒ‡ãƒ¼ã‚¿æº–å‚™
                  <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">ãƒ•ã‚©ãƒ¼ãƒ ã‚„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®š</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step1-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step1-content" class="progressive-section expanded">
            <!-- çµ±åˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿æº–å‚™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="google-integration p-4 rounded-xl text-white mb-4">
              <div class="flex items-center gap-3 mb-3">
                <svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                <div>
                  <h3 class="font-semibold">ãƒ‡ãƒ¼ã‚¿æº–å‚™</h3>
                  <p class="text-xs opacity-90">ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ</p>
                </div>
              </div>
              <p class="text-sm mb-4 opacity-90">
                Google Workspaceã¨é€£æºã—ã¦ã€å­¦ç¿’è€…ã®æ„è¦‹ã‚’åé›†ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†ç”¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
              </p>
              
              <!-- æ°´å¹³é…ç½®ã®ãƒœã‚¿ãƒ³ -->
              <div class="flex gap-3">
                <button type="button" id="quickstart-btn" class="btn btn-google flex-1">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                  <span id="quickstart-text">ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ</span>
                </button>
                <button type="button" id="create-board-btn" class="btn btn-google flex-1">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  <span id="create-board-text">ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</span>
                </button>
              </div>
              
              <!-- ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆå®Œäº†è¡¨ç¤ºï¼ˆçµ±åˆç§»å‹•ï¼‰ -->
              <div class="mt-4 hidden" id="form-url-section">
                <div class="bg-gradient-to-r from-green-600/20 to-emerald-600/20 border border-green-500/30 rounded-xl p-4">
                  <div class="flex items-center gap-3 mb-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="text-base font-semibold text-green-300">ãƒ•ã‚©ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸ</h4>
                      <p class="text-xs text-gray-400">æ¬¡ã«ã‚·ãƒ¼ãƒˆè¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„</p>
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <input type="url" id="form-url-input" class="form-control flex-1 text-sm" readonly placeholder="ãƒ•ã‚©ãƒ¼ãƒ URLãŒç”Ÿæˆã•ã‚Œã¾ã™">
                    <button type="button" id="copy-form-url-btn" class="btn btn-secondary px-3" title="URLã‚’ã‚³ãƒ”ãƒ¼">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                      </svg>
                    </button>
                    <a id="open-form-url-link" href="#" target="_blank" class="btn btn-secondary px-3" title="ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- QuickStart Progress (æœ€é©åŒ–ã•ã‚ŒãŸé€²è¡Œè¡¨ç¤º) -->
            <div id="quickstart-progress" class="hidden bg-gradient-to-br from-emerald-900/20 to-blue-900/20 border border-emerald-400/30 rounded-xl p-5 mb-4 backdrop-blur-sm">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-blue-500 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-white animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                </div>
                <div>
                  <h4 class="text-base font-semibold text-emerald-300">è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»å…¬é–‹é€²è¡Œä¸­</h4>
                  <p class="text-xs text-gray-400">ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆã‹ã‚‰å…¬é–‹ã¾ã§è‡ªå‹•ã§å®Œäº†ã—ã¾ã™</p>
                </div>
              </div>
              
              <!-- QuickStart 2-Step Progress (Simplified) -->
              <div class="space-y-3 mb-5">
                <div class="flex items-center gap-4" id="progress-step-1">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="progress-step-1-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="progress-step-1-text">ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ</div>
                    <div class="text-xs text-gray-500 mt-1" id="progress-step-1-detail">ãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è‡ªå‹•ä½œæˆä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="progress-step-1-time">1åˆ†30ç§’</div>
                </div>
                
                <div class="flex items-center gap-4" id="progress-step-2">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="progress-step-2-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="progress-step-2-text">ãƒœãƒ¼ãƒ‰è¨­å®šã¨è‡ªå‹•å…¬é–‹</div>
                    <div class="text-xs text-gray-500 mt-1" id="progress-step-2-detail">å›ç­”ãƒœãƒ¼ãƒ‰ã®è¨­å®šã¨è‡ªå‹•å…¬é–‹ã‚’å®Ÿè¡Œä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="progress-step-2-time">1åˆ†</div>
                </div>
              </div>
              
              <!-- Enhanced Progress Bar -->
              <div class="bg-gray-800/50 rounded-full p-1 mb-4">
                <div class="flex items-center justify-between mb-2 px-2">
                  <span class="text-xs font-medium text-gray-300">å…¨ä½“ã®é€²æ—</span>
                  <span class="text-sm font-bold text-emerald-400" id="progress-percentage">0%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                  <div class="bg-gradient-to-r from-emerald-500 via-blue-500 to-purple-500 h-3 rounded-full transition-all duration-700 ease-out shadow-lg" style="width: 0%" id="progress-bar"></div>
                </div>
              </div>
              
              <div class="text-center bg-gray-800/30 rounded-lg p-3">
                <p class="text-sm font-medium text-emerald-300" id="progress-status">åˆæœŸåŒ–ä¸­...</p>
                <p class="text-xs text-gray-400 mt-1">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
              </div>
            </div>

            <!-- CustomSetup Progress (ç‹¬ç«‹ã—ãŸé€²è¡Œè¡¨ç¤º) -->
            <div id="customsetup-progress" class="hidden bg-gradient-to-br from-purple-900/20 to-pink-900/20 border border-purple-400/30 rounded-xl p-5 mb-4 backdrop-blur-sm">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                  <svg class="w-4 h-4 text-white animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                </div>
                <div>
                  <h4 class="text-base font-semibold text-purple-300">ã‚«ã‚¹ã‚¿ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é€²è¡Œä¸­</h4>
                  <p class="text-xs text-gray-400">é«˜ç²¾åº¦AIåˆ¤å®šã‚’å«ã‚€è©³ç´°è¨­å®šã‚’å®Ÿè¡Œä¸­</p>
                </div>
                <div class="ml-auto">
                  <button type="button" id="customsetup-cancel-btn" class="px-3 py-1 text-xs bg-red-600/20 hover:bg-red-600/30 text-red-300 hover:text-red-200 border border-red-500/30 rounded-lg transition-colors duration-200">
                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                    ä¸­æ–­
                  </button>
                </div>
              </div>
              
              <!-- CustomSetup 2-Step Progress (Simplified) -->
              <div class="space-y-3 mb-5">
                <div class="flex items-center gap-4" id="custom-progress-step-1">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="custom-progress-step-1-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="custom-progress-step-1-text">ãƒ‡ãƒ¼ã‚¿æº–å‚™ã¨ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ</div>
                    <div class="text-xs text-gray-500 mt-1" id="custom-progress-step-1-detail">Googleãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ§‹ç¯‰ä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="custom-progress-step-1-time">1åˆ†30ç§’</div>
                </div>

                <div class="flex items-center gap-4" id="custom-progress-step-2">
                  <div class="w-8 h-8 rounded-full bg-gray-700 border-2 border-gray-600 flex items-center justify-center transition-all duration-300">
                    <div class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300" id="custom-progress-step-2-dot"></div>
                  </div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-gray-300" id="custom-progress-step-2-text">AIã«ã‚ˆã‚‹åˆ—åˆ†æ</div>
                    <div class="text-xs text-gray-500 mt-1" id="custom-progress-step-2-detail">AIãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’åˆ†æã—ã€æœ€é©ãªè¨­å®šã‚’ææ¡ˆä¸­...</div>
                  </div>
                  <div class="text-xs text-gray-400 opacity-0 transition-opacity duration-300" id="custom-progress-step-2-time">2åˆ†</div>
                </div>
              </div>
              
              <!-- CustomSetup Progress Bar -->
              <div class="bg-gray-800/50 rounded-full p-1 mb-4">
                <div class="flex items-center justify-between mb-2 px-2">
                  <span class="text-xs font-medium text-gray-300">å…¨ä½“ã®é€²æ—</span>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400" id="custom-progress-eta">æ¨å®šæ®‹ã‚Šæ™‚é–“: 5åˆ†</span>
                    <span class="text-sm font-bold text-purple-400" id="custom-progress-percentage">0%</span>
                  </div>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                  <div class="bg-gradient-to-r from-purple-500 via-pink-500 to-indigo-500 h-3 rounded-full transition-all duration-700 ease-out shadow-lg" style="width: 0%" id="custom-progress-bar"></div>
                </div>
              </div>
              
              <div class="text-center bg-gray-800/30 rounded-lg p-3">
                <p class="text-sm font-medium text-purple-300" id="custom-progress-status">åˆæœŸåŒ–ä¸­...</p>
                <p class="text-xs text-gray-400 mt-1">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</p>
              </div>
            </div>

            <!-- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
            <div id="existing-user-section" class="hidden bg-gray-800/30 border border-gray-600/30 rounded-xl p-4 mb-4">
              <h4 class="text-sm font-semibold text-gray-300 mb-3">è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h4>
              <button type="button" id="create-additional-form-btn" class="btn btn-secondary w-full text-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span id="create-additional-form-text" class="text-gray-200">æ–°è¦ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</span>
              </button>
              <p class="text-xs text-gray-400 mt-2">ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰ã«é€£æºã™ã‚‹æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</p>
            </div>
            
            <!-- å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘) -->
            <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
              <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘)
              </summary>
              <div class="p-4 pt-0 space-y-4">
                <div class="bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-4">
                  <label class="block text-sm font-medium text-cyan-200 mb-2">
                    Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URL
                  </label>
                  <div class="space-y-3">
                    <input type="url" 
                           id="resource-url-input" 
                           placeholder="https://docs.google.com/spreadsheets/d/..."
                           class="form-control"
                           aria-describedby="resource-url-help">
                    <p id="resource-url-help" class="text-xs text-cyan-300 mt-1">
                      æ—¢å­˜ã®Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                    </p>
                    <button type="button" id="add-resource-btn" class="btn btn-primary w-full">
                      <span id="add-resource-text">ãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ </span>
                    </button>
                  </div>
                </div>
              </div>
            </details>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="custom-form-info-section" class="hidden mt-4">
              <!-- updateCustomFormInfo()ã§å‹•çš„ã«å†…å®¹ãŒè¨­å®šã•ã‚Œã‚‹ -->
            </div>
          </div>
        </div>


        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆè¨­å®š -->
        <div class="glass-panel p-4 lg:p-6" id="sheet-selection-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-green-400/20">
                2
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  ã‚·ãƒ¼ãƒˆè¨­å®š
                  <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">è³ªå•å†…å®¹ã¨è¡¨ç¤ºè¨­å®šã‚’ç®¡ç†</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step2-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step2-content" class="progressive-section expanded">
            <div class="space-y-4">
              <!-- ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆé¸æŠã®èª¬æ˜ -->
              <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  <span class="text-sm font-medium text-green-200">ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆé¸æŠ</span>
                </div>
                <p class="text-xs text-green-300">ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆã‹ã‚‰è³ªå•æ–‡ã¨å›ç­”ã‚¿ã‚¤ãƒ—ã‚’è¨­å®šã—ã¾ã™</p>
              </div>
              
              <!-- Enhanced Sheet Selection Control -->
              <div class="space-y-4">
                <label for="sheet-select" class="block text-sm font-medium text-white">
                  <span class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ
                    <span class="text-xs text-green-400 bg-green-400/10 px-2 py-1 rounded-full">é¸æŠã™ã‚‹ã¨å³åº§ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–</span>
                  </span>
                </label>
                <div class="flex gap-2">
                  <div class="flex-1 relative">
                    <select id="sheet-select" class="form-control w-full" aria-describedby="sheet-help">
                      <option>èª­ã¿è¾¼ã¿ä¸­...</option>
                    </select>
                    <!-- Loading indicator for sheet selection -->
                    <div id="sheet-loading" class="hidden absolute right-10 top-1/2 transform -translate-y-1/2">
                      <svg class="w-4 h-4 text-green-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                      </svg>
                    </div>
                  </div>
                  <button type="button" id="open-spreadsheet-btn-step2" class="btn btn-secondary px-3 flex-shrink-0" title="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                  </button>
                </div>
                
                <!-- Enhanced Help and Status -->
                <div class="space-y-2">
                  <p id="sheet-help" class="text-xs text-gray-400">
                    ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­”ã‚„è¡¨ç¤ºã—ãŸã„ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„
                  </p>
                  
                  <!-- Active Sheet Status -->
                  <div id="active-sheet-status" class="hidden bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                    <div class="flex items-center gap-2">
                      <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                      <span class="text-sm text-green-300 font-medium">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒ¼ãƒˆ:</span>
                      <span id="active-sheet-name" class="text-sm text-white font-medium"></span>
                    </div>
                    <div class="mt-2 text-xs text-green-200">
                      <span id="active-sheet-info">åˆ—è¨­å®šãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™</span>
                    </div>
                  </div>
                  
                  <!-- Selection Confirmation -->
                  <div id="sheet-selection-feedback" class="hidden">
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                      <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm text-blue-300 font-medium">ã‚·ãƒ¼ãƒˆå¤‰æ›´å®Œäº†</span>
                      </div>
                      <p class="text-xs text-blue-200 mt-1">åˆ—é¸æŠãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚Step 3ã§è©³ç´°è¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</p>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: è¡¨ç¤ºè¨­å®šãƒ»å…¬é–‹ -->
        <div class="glass-panel p-4 lg:p-6" id="config-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg ring-2 ring-purple-400/20">
                3
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                  è¡¨ç¤ºè¨­å®šãƒ»å…¬é–‹
                  <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                </h2>
                <p class="text-xs text-gray-400">åˆ—è¨­å®šã¨è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step3-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step3-content" class="progressive-section expanded">
            <!-- ãƒ‰ãƒ©ãƒ•ãƒˆãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div id="draft-mode-indicator-section" class="mb-4 hidden">
              <div class="glass-panel bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border border-yellow-400/30 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                      <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                      </svg>
                    </div>
                    <div>
                      <div class="text-sm font-medium text-yellow-200">ğŸ“ ãƒ‰ãƒ©ãƒ•ãƒˆç·¨é›†ä¸­</div>
                      <div class="text-xs text-yellow-300">è¨­å®šã‚’å¤‰æ›´ä¸­ã§ã™ã€‚ã€Œå…¬é–‹ã€ãƒœã‚¿ãƒ³ã§ç¢ºå®šã•ã‚Œã¾ã™ã€‚</div>
                    </div>
                  </div>
                  <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
                </div>
              </div>
            </div>
            
            <div id="config-area" class="space-y-4 hidden">
              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span class="text-sm font-medium text-purple-200">åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š</span>
                </div>
                <p class="text-xs text-purple-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’å›ç­”ãƒœãƒ¼ãƒ‰ã®é …ç›®ã«å‰²ã‚Šå½“ã¦ã¾ã™</p>
              </div>
              
              <!-- å¿…é ˆè¨­å®š -->
              <div class="space-y-4">
                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                  <label class="block">
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-white">å›ç­”ãƒ‡ãƒ¼ã‚¿åˆ—</span>
                      <span class="px-2 py-1 bg-red-500 text-white text-xs rounded-full">å¿…é ˆ</span>
                    </div>
                    <div class="flex gap-2">
                      <select id="opinionHeader" class="form-control flex-1" aria-describedby="main-help"></select>
                      <button type="button" id="reguess-headers-btn" class="btn bg-gradient-to-r from-purple-600/80 to-purple-700/80 hover:from-purple-600 hover:to-purple-700 text-white px-3 py-2 relative overflow-hidden group" title="AIæ­è¼‰ é«˜ç²¾åº¦åˆ—åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ ">
                        <span class="relative z-10 flex items-center gap-1">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                          </svg>
                          <span class="text-xs font-bold">AIåˆ¤å®š</span>
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-purple-500/20 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                      </button>
                    </div>
                    <p id="main-help" class="text-xs text-red-300 mt-1">
                      å›ç­”å†…å®¹ãŒå«ã¾ã‚Œã‚‹åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„
                    </p>
                  </label>
                </div>
                
                <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š -->
                <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
                  <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                    </svg>
                    ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆä»»æ„ï¼‰
                  </summary>
                  <div class="p-4 pt-0 space-y-4" id="detail-options">
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ç†ç”±åˆ—</span>
                      <select id="reason-column" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">åå‰åˆ—</span>
                      <select id="name-column" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ã‚¯ãƒ©ã‚¹åˆ—</span>
                      <select id="class-column" class="form-control"></select>
                    </label>
                    
                    <div class="flex items-center mt-4">
                      <input type="checkbox" id="show-names" name="show-names" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="show-names" class="ml-2 block text-sm text-gray-300">åå‰ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                    <div class="flex items-center mt-2">
                      <input type="checkbox" id="show-counts" name="show-counts" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="show-counts" class="ml-2 block text-sm text-gray-300">ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                  </div>
                </details>
              </div>
              
              <!-- Enhanced Preview and Publish Section -->
              <div class="space-y-4 pt-4">
                <!-- Preview Settings Summary -->
                <div id="publish-preview-panel" class="hidden bg-gradient-to-br from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded-xl p-4">
                  <div class="flex items-center gap-3 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                      <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                      </svg>
                    </div>
                    <div>
                      <h4 class="text-base font-semibold text-purple-300">å…¬é–‹å‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
                      <p class="text-xs text-gray-400">è¨­å®šå†…å®¹ã‚’ç¢ºèªã—ã¦ã‹ã‚‰å…¬é–‹ã§ãã¾ã™</p>
                    </div>
                  </div>
                  
                  <!-- Configuration Summary -->
                  <div class="space-y-3 mb-4">
                    <div class="grid grid-cols-2 gap-3 text-sm">
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">å¯¾è±¡ã‚·ãƒ¼ãƒˆ</div>
                        <div class="text-white font-medium" id="preview-sheet-name">æœªé¸æŠ</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">è³ªå•æ–‡åˆ—</div>
                        <div class="text-white font-medium" id="preview-opinion-column">æœªè¨­å®š</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">åå‰åˆ—</div>
                        <div class="text-white font-medium" id="preview-name-column">æœªè¨­å®š</div>
                      </div>
                      <div class="bg-gray-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">ã‚¯ãƒ©ã‚¹åˆ—</div>
                        <div class="text-white font-medium" id="preview-class-column">æœªè¨­å®š</div>
                      </div>
                    </div>
                    
                    <!-- Sample Data Preview -->
                    <div id="sample-data-preview" class="hidden bg-gray-800/30 rounded-lg p-3">
                      <div class="text-xs text-gray-400 mb-2">ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ (æœ€æ–°3ä»¶)</div>
                      <div class="space-y-2 text-xs" id="sample-data-list">
                        <!-- Dynamically populated -->
                      </div>
                    </div>
                  </div>
                  
                  <!-- Preview Actions -->
                  <div class="flex gap-2">
                    <button type="button" id="preview-board-btn" class="btn btn-secondary flex-1 text-sm">
                      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                      </svg>
                      ãƒœãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                    </button>
                    <button type="button" id="refresh-preview-btn" class="btn btn-secondary px-3" title="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-3">
                  <!-- ãƒ‰ãƒ©ãƒ•ãƒˆæ©Ÿèƒ½ãƒ˜ãƒ«ãƒ— -->
                  <div id="draft-help-section" class="hidden bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                    <div class="flex items-start gap-2">
                      <svg class="w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <div class="text-xs text-blue-300">
                        <div class="font-medium mb-1">ğŸ’¡ ãƒ‰ãƒ©ãƒ•ãƒˆæ©Ÿèƒ½ã«ã¤ã„ã¦</div>
                        <div>å±¥æ­´ã‹ã‚‰å¾©å…ƒã—ãŸè¨­å®šã¯ã€ã€Œå…¬é–‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§ä¸‹æ›¸ãçŠ¶æ…‹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ã‹ã‚‰å…¬é–‹ã§ãã¾ã™ã€‚</div>
                      </div>
                    </div>
                  </div>
                  
                  <button type="button" id="save-publish-btn" disabled class="btn btn-primary w-full btn-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span id="save-publish-text">è¨­å®šã‚’ä¿å­˜ã—ã¦å…¬é–‹</span>
                  </button>

                  <button type="button" id="unpublish-board-btn" class="btn btn-warning w-full hidden">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636"></path>
                    </svg>
                    <span id="unpublish-board-text">å…¬é–‹ã‚’åœæ­¢</span>
                  </button>
                </div>
              </div>
            </div>
            
            <div id="config-placeholder" class="text-center py-8">
              <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                <div class="loading-skeleton w-full h-full rounded-full hidden" id="config-loading"></div>
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
              </div>
              <p class="text-gray-400 text-sm">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã™ã‚‹ã¨åˆ—è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å³å´ï¼šæƒ…å ±ãƒ»ãƒ˜ãƒ«ãƒ—ãƒ‘ãƒãƒ« -->
      <div class="right-panel space-y-4">
        
        <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ -->
        <div id="system-info-panel" class="glass-panel p-4 lg:p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-8 h-8 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
      </div>
      <h3 class="font-semibold text-gray-300">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³</h3>
    </div>

    <div class="space-y-4">
      <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
            <span class="text-white font-medium" id="info-admin-email">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</span>
            <span class="text-white font-mono text-xs bg-gray-700 px-1.5 py-0.5 rounded" id="info-user-id">-</span>
          </div>
          <div class="text-right pt-2">
          <button type="button" onclick="adminPanel.logoutAndRedirect()" class="text-cyan-400 hover:text-cyan-300 hover:underline text-xs">
            ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
          </button>
          </div>
        </div>
      </div>

      <!-- å…¬é–‹è¨­å®š -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          å…¬é–‹è¨­å®š
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">å…¬é–‹çŠ¶æ…‹:</span>
            <span class="px-2 py-1 rounded text-xs font-medium" id="info-publish-status">
              <span class="inline-flex items-center gap-1">
                <div class="w-2 h-2 rounded-full" id="info-publish-indicator"></div>
                <span id="info-publish-text">ç¢ºèªä¸­</span>
              </span>
            </span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">å…¬é–‹ã‚·ãƒ¼ãƒˆ:</span>
            <span class="text-white font-semibold" id="info-published-sheet">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰:</span>
            <span class="text-white" id="info-display-mode">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º:</span>
            <span class="text-white" id="info-show-counts">-</span>
          </div>
        </div>
      </div>

      <!-- ãƒªã‚½ãƒ¼ã‚¹ -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
          </svg>
          ãƒªã‚½ãƒ¼ã‚¹
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex gap-2">
            <button type="button" id="open-spreadsheet-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ
            </button>
            <button type="button" id="open-form-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              ãƒ•ã‚©ãƒ¼ãƒ (å›ç­”)
            </button>
          </div>
        </div>
        
      </div>

      <!-- ã‚¢ãƒ—ãƒªè¨­å®šãƒªãƒ³ã‚¯ -->
<? if (isDeployUser) { ?>
      <div id="app-setup-link" class="bg-blue-900/10 border border-blue-500/30 rounded-lg p-3 transition-all hover:border-blue-500/50">
        <button type="button" id="app-setup-btn" class="w-full flex items-center justify-between text-sm font-medium text-blue-300 hover:text-blue-200 transition-colors">
          <div class="flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span>ã‚¢ãƒ—ãƒªè¨­å®šç®¡ç†</span>
          </div>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
          </svg>
        </button>
        <p class="text-xs text-blue-200/70 mt-2 ml-6">
          ã‚¢ãƒ—ãƒªã®æœ‰åŠ¹/ç„¡åŠ¹çŠ¶æ…‹ã‚’ç®¡ç†ã§ãã¾ã™
        </p>
      </div>
<? } ?>
      
      <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨çµ±åˆæƒ…å ± -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨çµ±åˆ
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex items-center justify-between">
            <a href="#" onclick="showSecurityInfo(); return false;" class="text-cyan-400 hover:text-cyan-300 hover:underline">
              ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜ã«ã¤ã„ã¦
            </a>
          </div>
          <div class="flex items-center justify-between">
            <a href="#" onclick="showGoogleIntegrationInfo(); return false;" class="text-cyan-400 hover:text-cyan-300 hover:underline">
              Googleé€£æºã®åˆ©ç‚¹
            </a>
          </div>
        </div>
      </div>
      
      <!-- å±¥æ­´ç®¡ç† (ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ) -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <div class="flex items-center justify-between mb-3">
          <h4 class="text-sm font-medium text-gray-200 flex items-center gap-2">
            <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            å…¬é–‹å±¥æ­´
          </h4>
          <button type="button" id="clear-history-btn" 
                  class="text-xs text-red-400 hover:text-red-300 px-2 py-1 rounded border border-red-400/50 hover:bg-red-500/10 transition-colors"
                  title="å±¥æ­´ã‚’ã‚¯ãƒªã‚¢">
            ã‚¯ãƒªã‚¢
          </button>
        </div>
        
        <div class="max-h-48 overflow-y-auto">
          <table class="w-full text-xs">
            <thead class="border-b border-gray-600/50">
              <tr>
                <th class="text-left py-2 px-2 text-gray-400 font-medium">è¨­å•</th>
                <th class="text-left py-2 px-2 text-gray-400 font-medium w-20">æ—¥æ™‚</th>
                <th class="text-right py-2 px-2 text-gray-400 font-medium w-12">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="history-table-body">
              <tr>
                <td colspan="3" class="text-gray-500 text-center py-4">å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <details id="account-deletion-section" class="bg-red-900/10 border border-red-500/30 rounded-lg transition-all hover:border-red-500/50">
        <summary class="p-3 cursor-pointer text-sm font-medium text-red-300 hover:text-red-200 flex items-center justify-between">
          <span>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†</span>
          <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-3 pt-0 space-y-3">
          <p class="text-xs text-red-200/80 mb-3">
            ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã¨ã€ä½œæˆã—ãŸã™ã¹ã¦ã®ãƒœãƒ¼ãƒ‰ã¨è¨­å®šãŒå®Œå…¨ã«æ¶ˆå»ã•ã‚Œã¾ã™ã€‚
          </p>
          
          <!-- è¨­å®šåˆæœŸåŒ–ãƒ„ãƒ¼ãƒ« -->
          <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-3">
            <div class="flex items-start gap-2 mb-2">
              <svg class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div class="flex-1">
                <h5 class="text-xs font-medium text-orange-300 mb-1">è¨­å®šã‚’åˆæœŸåŒ–</h5>
                <p class="text-xs text-orange-200/80 mb-3">ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨ºæ–­ã—ã€å•é¡Œã«å¿œã˜ã¦è‡ªå‹•ä¿®å¾©ã¾ãŸã¯è¨­å®šåˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ã€‚</p>
                <button type="button" id="initialize-settings-btn" 
                        class="text-xs bg-orange-600 hover:bg-orange-700 text-white px-3 py-1.5 rounded border border-orange-500 transition-colors flex items-center gap-1.5"
                        title="è¨­å®šã®è¨ºæ–­ãƒ»ä¿®å¾©ãƒ»åˆæœŸåŒ–ã‚’çµ±åˆå®Ÿè¡Œ">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  è¨­å®šã‚’åˆæœŸåŒ–
                </button>
              </div>
            </div>
          </div>
          
          <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ãƒœã‚¿ãƒ³ -->
          <button type="button" id="delete-account-btn" class="btn btn-danger w-full text-sm py-2">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            <span>è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å®Œå…¨ã«å‰Šé™¤ã™ã‚‹</span>
          </button>
        </div>
      </details>
      </div>
    </div>
  </main>
  
  <!-- çµ±åˆãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer id="admin-footer" class="fixed bottom-0 left-0 right-0 glass-panel border-t border-gray-700 min-h-16 sm:min-h-20 hidden">
    <div class="max-w-6xl mx-auto px-6 py-4">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4" id="footer-content">
        <!-- ä¸Šå´/å·¦å´: å…¬é–‹ä¸­ã®å•é¡Œæ–‡ã¨çµ‚äº†æ—¥æ™‚ -->
        <div class="flex-1">
          <div class="flex items-center gap-4 mb-1">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-green-400 font-semibold text-sm">å…¬é–‹ä¸­:</span>
            </div>
            
            <!-- äºˆå®šçµ‚äº†æ—¥æ™‚è¡¨ç¤º -->
            <div class="flex items-center gap-2" id="scheduled-end-display">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-xs text-gray-400">äºˆå®šçµ‚äº†:</span>
              <span class="text-xs font-medium" id="scheduled-end-time">æœªè¨­å®š</span>
            </div>
          </div>
          <p class="text-blue-300 font-medium text-lg break-words" id="current-topic-text" style="max-width: 60ch; line-height: 1.4;">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
        
        <!-- ä¸‹å´/å³å´: ãƒœãƒ¼ãƒ‰URLæ“ä½œ -->
        <div class="flex items-center gap-3 flex-shrink-0">
          <input type="text" id="board-url" readonly
                 class="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-sm cursor-pointer hover:bg-gray-700 focus:ring-2 focus:ring-green-400 min-w-[300px]"
                 onclick="this.select()" placeholder="URLãŒç”Ÿæˆã•ã‚Œã¾ã™">
          <button type="button" onclick="copyBoardUrl(this)" class="btn btn-secondary px-3 py-2 flex items-center" title="URLã‚’ã‚³ãƒ”ãƒ¼" aria-label="ç”Ÿå¾’ç”¨URLã‚’ã‚³ãƒ”ãƒ¼">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
          </button>
          <a id="view-board-link" href="#" target="_blank" rel="noopener noreferrer" 
             class="btn bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white px-4 py-2 flex items-center gap-2 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl" 
             title="å›ç­”ãƒœãƒ¼ãƒ‰ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã" aria-label="æ–°ã—ã„ã‚¿ãƒ–ã§å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹ã">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            <span class="font-semibold text-sm">ãƒœãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>
  <div id="message-area" class="fixed top-32 right-6 z-50" aria-live="polite" role="status"></div>
  
  <!-- å…±é€šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ -->
  <?!= include('SharedModals.html'); ?>
  
  <!-- Admin Panel JavaScript Components -->
  <!-- Constants must be loaded first -->
  <?!= include('constants.js.html'); ?>
  <!-- Backend progress sync system -->
  <?!= include('backendProgressSync.js.html'); ?>
  <!-- Admin Panel Framework - must be loaded before other admin panel components -->
  <?!= include('adminPanel-framework.js.html'); ?>
  <!-- Error handling system must be loaded first -->
  <?!= include('errorMessages.js.html'); ?>
  <!-- Consolidated Admin Panel Components -->
  <?!= include('admin-consolidated.js.html'); ?>
  <?!= include('adminPanel-api.js.html'); ?>
  <?!= include('adminPanel-ui.js.html'); ?>
  <?!= include('adminPanel-events.js.html'); ?>
  <!-- History compatibility layer -->
  <?!= include('adminPanel-simple-history-compat.js.html'); ?>

  <script>
    // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // ã‚¢ãƒ—ãƒªè¨­å®šãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
      const appSetupBtn = document.getElementById('app-setup-btn');
      if (appSetupBtn && typeof openAppSetupPage === 'function') {
        appSetupBtn.addEventListener('click', function(e) {
          e.preventDefault();
          openAppSetupPage();
        });
      }
      if (window.sharedModals) {
        window.sharedModals.loadAdminModals();
      }
    });
  </script>

</body>
</html>
