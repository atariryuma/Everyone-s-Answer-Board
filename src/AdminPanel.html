<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <base target="_top" />
    <title>StudyQuest ç®¡ç†ãƒ‘ãƒãƒ«</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Shared Security Headers -->
    <?!= include('SharedSecurityHeaders'); ?>

    <!-- Shared Error Handling -->
    <?!= include('SharedErrorHandling'); ?>

    <!-- Shared TailwindCSS Configuration -->
    <?!= include('SharedTailwindConfig'); ?>
    
    <!-- Unified Styles -->
    <?!= include('UnifiedStyles'); ?>
    
    <!-- Shared Utilities -->
    <?!= include('SharedUtilities'); ?>
    
    <!-- Safe template variable injection using HTML data attributes -->
    <div id="app-data" data-user-id="<?= userInfo && userInfo.userId ? userInfo.userId.replace(/"/g, '&quot;').replace(/'/g, '&#39;') : '' ?>" style="display: none;"></div>
    <style>
      /* AdminPanelå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« - commit 421e817 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€  + ç¾åœ¨ã®ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ */
      body {
        margin: 0;
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        min-height: 100vh;
      }

      .admin-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1rem;
        min-height: 100vh;
        padding: 1rem;
      }

      .main-editor {
        padding: 1.5rem;
      }

      .info-panel {
        padding: 1rem;
        overflow-y: auto;
      }

      .card {
        margin-bottom: 1rem;
      }

      .info-card {
        margin-bottom: 0.75rem;
      }

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .status-header {
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .status-header h1 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
      }


      /* é€²æ—ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç°¡ç´ åŒ– */
      .setup-progress {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .step {
        flex: 1;
        text-align: center;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        background: rgba(107, 114, 128, 0.1);
        color: rgba(156, 163, 175, 1);
        transition: all 0.2s;
      }

      .step.completed {
        background: rgba(34, 197, 94, 0.2);
        color: rgba(34, 197, 94, 1);
      }

      .step.current {
        background: rgba(59, 130, 246, 0.2);
        color: rgba(59, 130, 246, 1);
        border: 2px solid rgba(59, 130, 246, 0.5);
      }

      /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  - Tailwindã‚¹ã‚¿ã‚¤ãƒ«ã§ç½®ãæ›ãˆ */
      .form-group {
        margin-bottom: 1rem;
      }

      .modern-select,
      input[type='text'] {
        width: 100%;
        padding: 0.75rem;
        background: rgba(55, 65, 81, 0.8);
        border: 1px solid rgba(75, 85, 99, 0.5);
        border-radius: 0.5rem;
        color: white;
        font-size: 0.875rem;
        transition: all 0.2s;
      }

      .modern-select:focus,
      input[type='text']:focus {
        outline: none;
        border-color: rgba(59, 130, 246, 0.8);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }

      /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ - ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒå¯¾å¿œ */
      .toggle-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        color: rgba(209, 213, 219, 1);
      }

      .toggle-switch input {
        display: none;
      }

      .slider {
        width: 44px;
        height: 24px;
        background: rgba(107, 114, 128, 0.5);
        border-radius: 12px;
        position: relative;
        transition: all 0.3s;
      }

      .slider:before {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: white;
        top: 2px;
        left: 2px;
        transition: all 0.3s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .toggle-switch input:checked + .slider {
        background: rgba(59, 130, 246, 0.8);
      }

      .toggle-switch input:checked + .slider:before {
        transform: translateX(20px);
      }

      /* ãƒœã‚¿ãƒ³ - ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒå¯¾å¿œ */
      .btn-primary,
      .btn-secondary {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
        border: none;
        font-size: 0.875rem;
      }

      .btn-primary {
        background: linear-gradient(to right, rgba(59, 130, 246, 1), rgba(147, 51, 234, 1));
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(to right, rgba(37, 99, 235, 1), rgba(126, 34, 206, 1));
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: rgba(75, 85, 99, 0.5);
        color: rgba(209, 213, 219, 1);
        border: 1px solid rgba(107, 114, 128, 0.5);
      }

      .btn-secondary:hover {
        background: rgba(75, 85, 99, 0.7);
      }

      .action-buttons {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      /* å³ãƒ‘ãƒãƒ«ã®æƒ…å ±è¡¨ç¤º - ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒå¯¾å¿œ */
      .config-summary {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .config-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: rgba(55, 65, 81, 0.8);
        border-radius: 0.5rem;
        color: rgba(209, 213, 219, 1);
      }

      .label {
        font-weight: 500;
        color: rgba(156, 163, 175, 1);
        font-size: 0.875rem;
      }

      .link-btn {
        background: rgba(59, 130, 246, 0.2);
        color: rgba(96, 165, 250, 1);
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
      }

      .link-btn:hover {
        background: rgba(59, 130, 246, 0.3);
      }

      .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .status-badge.unpublished {
        background: rgba(245, 158, 11, 0.2);
        color: rgba(245, 158, 11, 1);
      }

      .status-badge.published {
        background: rgba(34, 197, 94, 0.2);
        color: rgba(34, 197, 94, 1);
      }

      .status-badge.error {
        background: rgba(239, 68, 68, 0.2);
        color: rgba(239, 68, 68, 1);
      }



      /* ä¿¡é ¼åº¦ãƒãƒƒã‚¸ã‚¹ã‚¿ã‚¤ãƒ« */
      .confidence-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 500;
        gap: 0.25rem;
      }

      .confidence-badge.high {
        background: rgba(34, 197, 94, 0.2);
        color: rgba(34, 197, 94, 1);
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      .confidence-badge.medium {
        background: rgba(245, 158, 11, 0.2);
        color: rgba(245, 158, 11, 1);
        border: 1px solid rgba(245, 158, 11, 0.3);
      }

      .confidence-badge.low {
        background: rgba(239, 68, 68, 0.2);
        color: rgba(239, 68, 68, 1);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .confidence-badge.manual {
        background: rgba(168, 85, 247, 0.2);
        color: rgba(168, 85, 247, 1);
        border: 1px solid rgba(168, 85, 247, 0.3);
      }

      /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³é¸æŠæ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
      .modern-select.has-ai-selection {
        border-color: rgba(59, 130, 246, 0.6);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      .modern-select.has-manual-selection {
        border-color: rgba(168, 85, 247, 0.6);
        box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
      }

      .expandable-section {
        margin-top: 0.75rem;
      }

      .expandable-section summary {
        cursor: pointer;
        font-weight: 500;
        color: rgba(96, 165, 250, 1);
        padding: 0.75rem 0;
      }

      /* åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¡¨ç¤º - ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ */
      .auto-detected-columns {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .column-match {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        border-radius: 0.5rem;
      }

      .column-type {
        font-weight: 600;
        color: rgba(34, 197, 94, 1);
      }

      .detected-column {
        background: rgba(34, 197, 94, 0.2);
        color: rgba(34, 197, 94, 1);
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .confidence {
        font-size: 0.8rem;
        color: rgba(34, 197, 94, 0.8);
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
      @media (max-width: 768px) {
        .admin-container {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto;
          padding: 1rem;
        }

        .status-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }

        .setup-progress {
          flex-direction: column;
          gap: 0.5rem;
        }

      }

      /* SharedUtilitiesã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ */

      /* =============================================================================
     * ãƒ•ãƒƒã‚¿ãƒ¼ï¼šç¾åœ¨ã®ãƒœãƒ¼ãƒ‰æƒ…å ±è¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«
     * ============================================================================= */
      #boardInfoFooter {
        /* æ—¢å­˜ã®z-indexã‚ˆã‚Šã‚‚ä½ãè¨­å®šï¼ˆé€šçŸ¥ã‚³ãƒ³ãƒ†ãƒŠã‚ˆã‚Šä¸‹ï¼‰ */
        z-index: 30;
      }

      #boardInfoFooter .glass-panel {
        /* ãƒ•ãƒƒã‚¿ãƒ¼å°‚ç”¨ã®ã‚¬ãƒ©ã‚¹èª¿ã‚¹ã‚¿ã‚¤ãƒ« */
        background: rgba(55, 65, 81, 0.95);
        border: 1px solid rgba(75, 85, 99, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      #boardInfoFooter .glass-panel:hover {
        border-color: rgba(96, 165, 250, 0.4);
        transition: border-color 0.2s ease;
      }

      /* å•é¡Œæ–‡è¡¨ç¤ºã‚¨ãƒªã‚¢ */
      #currentQuestionText {
        max-width: 100%;
        line-height: 1.4;
      }

      /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
      @media (max-width: 768px) {
        #boardInfoFooter .flex.items-center.justify-between {
          flex-direction: column;
          align-items: stretch;
          gap: 1rem;
        }

        #boardInfoFooter .flex-1.min-w-0 {
          flex: none;
          text-align: center;
        }

        #boardInfoFooter .flex.items-center.gap-2.flex-shrink-0 {
          justify-content: center;
          flex-wrap: wrap;
        }

        #currentQuestionText {
          white-space: normal;
          overflow: visible;
          text-overflow: unset;
        }
      }

      /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«å¾®èª¿æ•´ */
      #boardInfoFooter .btn-primary,
      #boardInfoFooter .btn-secondary {
        white-space: nowrap;
        min-width: fit-content;
      }

      /* ã‚³ãƒ”ãƒ¼å®Œäº†çŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #copyViewUrlBtn:disabled {
        opacity: 0.8;
        cursor: not-allowed;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼è¡¨ç¤ºæ™‚ã®bodyä½™ç™½èª¿æ•´ */
      body.has-footer {
        padding-bottom: 100px;
      }
    </style>
  </head>
  <body>
    <div
      id="loading-overlay"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-[9999] hidden"
    >
      <div
        class="loading-spinner w-16 h-16 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"
      ></div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-4 right-4 z-[10000] space-y-2"></div>

    <div class="admin-container">
      <!-- å·¦ãƒ‘ãƒãƒ«: ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿ -->
      <div class="main-editor">
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="status-header glass-panel rounded-xl">
          <h1 class="text-cyan-400 font-bold">StudyQuest ç®¡ç†ãƒ‘ãƒãƒ«</h1>
        </header>

        <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é€²æ— -->
        <div class="setup-progress">
          <div class="step current">1. ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š</div>
          <div class="step">2. å…¬é–‹è¨­å®š</div>
        </div>
        <!-- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠã‚«ãƒ¼ãƒ‰ -->
        <section class="card glass-panel rounded-xl p-6">
          <h2 class="text-xl font-semibold text-white mb-4">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠ</h2>

          <!-- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠæ–¹å¼ -->
          <div class="mb-6">
            <div class="flex gap-4 mb-4">
              <label class="flex items-center cursor-pointer">
                <input
                  type="radio"
                  name="source-method"
                  value="url"
                  checked
                  class="mr-2"
                  id="method-url"
                />
                <span class="text-gray-300">ğŸ”— URLç›´æ¥å…¥åŠ›</span>
              </label>
              <label class="flex items-center cursor-pointer">
                <input type="radio" name="source-method" value="dropdown" class="mr-2" id="method-dropdown" />
                <span class="text-gray-300">ğŸ“‹ ä¸€è¦§ã‹ã‚‰é¸æŠ</span>
              </label>
            </div>
          </div>

          <!-- URLç›´æ¥å…¥åŠ›æ–¹å¼ -->
          <div id="url-method" class="space-y-4">
            <div class="form-group">
              <label for="spreadsheet-url" class="block text-sm font-medium text-gray-300 mb-2"
                >ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL:</label
              >
              <input
                type="text"
                id="spreadsheet-url"
                class="modern-select"
                placeholder="https://docs.google.com/spreadsheets/d/your-spreadsheet-id/edit#gid=0"
                oninput="validateUrlInput(this)"
              />
              <div class="text-xs text-gray-400 mt-1" id="url-validation-message">
                ğŸ’¡ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
              </div>
            </div>
            <div class="form-group">
              <label for="sheet-name-input" class="block text-sm font-medium text-gray-300 mb-2"
                >ã‚·ãƒ¼ãƒˆå:</label
              >
              <input
                type="text"
                id="sheet-name-input"
                class="modern-select"
                placeholder="ã‚·ãƒ¼ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­” 1ï¼‰"
              />
            </div>
            <!-- ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±è¡¨ç¤º -->
            <div id="form-info-url" class="form-info hidden">
              <div class="bg-blue-900/30 border border-blue-500/30 rounded-lg p-4 mt-4">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-blue-400">ğŸ“‹</span>
                  <span class="text-sm font-medium text-blue-300">é€£æºãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±</span>
                </div>
                <div class="text-sm text-gray-300">
                  <div class="mb-1">
                    <span class="font-medium">ã‚¿ã‚¤ãƒˆãƒ«:</span>
                    <span id="form-title-url">-</span>
                  </div>
                  <div class="mb-1">
                    <span class="font-medium">ãƒ•ã‚¡ã‚¤ãƒ«å:</span>
                    <span id="spreadsheet-name-url" class="text-gray-400">-</span>
                  </div>
                  <div>
                    <span class="font-medium">URL:</span>
                    <a id="form-url-url" href="#" target="_blank" class="text-blue-400 hover:underline break-all">-</a>
                  </div>
                </div>
              </div>
            </div>
            <div class="action-buttons">
              <button id="url-validate" class="btn-secondary" type="button">âœ… URLæ¤œè¨¼</button>
              <button id="connect-url-source" class="btn-primary" type="button">æ¥ç¶š</button>
            </div>
          </div>

          <!-- ä¸€è¦§é¸æŠæ–¹å¼ -->
          <div id="dropdown-method" class="space-y-4 hidden">
            <div class="form-group">
              <label for="spreadsheet-select" class="block text-sm font-medium text-gray-300 mb-2"
                >ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ:</label
              >
              <select id="spreadsheet-select" class="modern-select">
                <option value="">-- ã‚¯ãƒªãƒƒã‚¯ã—ã¦èª­ã¿è¾¼ã¿ --</option>
              </select>
            </div>
            <div class="form-group">
              <label for="sheet-select" class="block text-sm font-medium text-gray-300 mb-2"
                >ã‚·ãƒ¼ãƒˆ:</label
              >
              <select id="sheet-select" class="modern-select">
                <option value="">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>
              </select>
            </div>
            <!-- ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±è¡¨ç¤º -->
            <div id="form-info" class="form-info hidden">
              <div class="bg-blue-900/30 border border-blue-500/30 rounded-lg p-4 mt-4">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-blue-400">ğŸ“‹</span>
                  <span class="text-sm font-medium text-blue-300">é€£æºãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±</span>
                </div>
                <div class="text-sm text-gray-300">
                  <div class="mb-1">
                    <span class="font-medium">ã‚¿ã‚¤ãƒˆãƒ«:</span>
                    <span id="form-title">-</span>
                  </div>
                  <div class="mb-1">
                    <span class="font-medium">ãƒ•ã‚¡ã‚¤ãƒ«å:</span>
                    <span id="spreadsheet-name" class="text-gray-400">-</span>
                  </div>
                  <div>
                    <span class="font-medium">URL:</span>
                    <a id="form-url" href="#" target="_blank" class="text-blue-400 hover:underline break-all">-</a>
                  </div>
                </div>
              </div>
            </div>
            <div class="action-buttons">
              <button id="refresh-data" class="btn-secondary" type="button">ğŸ”„ æ›´æ–°</button>
              <button id="connect-source" class="btn-primary" type="button">æ¥ç¶š</button>
            </div>
          </div>
        </section>

        <!-- åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ -->
        <section class="card glass-panel rounded-xl p-6">
          <h2 class="text-xl font-semibold text-white mb-4">ğŸ“‹ åˆ—è¨­å®š</h2>

          <div class="column-dropdowns space-y-4 mb-4">
            <!-- å›ç­”åˆ—é¸æŠ -->
            <div class="form-group">
              <label
                for="answer-column-select"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                ğŸ’¬ å›ç­”åˆ—:
                <span class="text-xs text-gray-400 ml-2">(å€‹åˆ¥ã®å›ç­”å†…å®¹ãŒå…¥ã£ã¦ã„ã‚‹åˆ—)</span>
              </label>
              <select id="answer-column-select" class="modern-select" data-column-type="answer">
                <option value="">é¸æŠã—ã¦ãã ã•ã„...</option>
              </select>
              <div id="answer-confidence" class="text-xs mt-1 hidden">
                <span class="confidence-badge"></span>
              </div>
            </div>

            <!-- ç†ç”±åˆ—é¸æŠ -->
            <div class="form-group">
              <label
                for="reason-column-select"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                ğŸ“‹ ç†ç”±åˆ—:
                <span class="text-xs text-gray-400 ml-2">(å›ç­”ã®ç†ç”±ãƒ»æ ¹æ‹ ãŒå…¥ã£ã¦ã„ã‚‹åˆ—)</span>
              </label>
              <select id="reason-column-select" class="modern-select" data-column-type="reason">
                <option value="">é¸æŠã—ã¦ãã ã•ã„...</option>
              </select>
              <div id="reason-confidence" class="text-xs mt-1 hidden">
                <span class="confidence-badge"></span>
              </div>
            </div>

            <!-- ã‚¯ãƒ©ã‚¹åˆ—é¸æŠ -->
            <div class="form-group">
              <label for="class-column-select" class="block text-sm font-medium text-gray-300 mb-2">
                ğŸ« ã‚¯ãƒ©ã‚¹åˆ—:
                <span class="text-xs text-gray-400 ml-2">(æ‰€å±ã‚¯ãƒ©ã‚¹æƒ…å ±ãŒå…¥ã£ã¦ã„ã‚‹åˆ—)</span>
              </label>
              <select id="class-column-select" class="modern-select" data-column-type="class">
                <option value="">é¸æŠã—ã¦ãã ã•ã„...</option>
              </select>
              <div id="class-confidence" class="text-xs mt-1 hidden">
                <span class="confidence-badge"></span>
              </div>
            </div>

            <!-- åå‰åˆ—é¸æŠ -->
            <div class="form-group">
              <label for="name-column-select" class="block text-sm font-medium text-gray-300 mb-2">
                ğŸ‘¤ åå‰åˆ—:
                <span class="text-xs text-gray-400 ml-2">(å›ç­”è€…ã®åå‰ãŒå…¥ã£ã¦ã„ã‚‹åˆ—)</span>
              </label>
              <select id="name-column-select" class="modern-select" data-column-type="name">
                <option value="">é¸æŠã—ã¦ãã ã•ã„...</option>
              </select>
              <div id="name-confidence" class="text-xs mt-1 hidden">
                <span class="confidence-badge"></span>
              </div>
            </div>

          </div>

          <div class="action-buttons">
            <button id="verify-mapping" class="btn-primary" type="button">è¨­å®šã‚’ç¢ºèª</button>
          </div>
        </section>

        <!-- è¡¨ç¤ºè¨­å®šã‚«ãƒ¼ãƒ‰ -->
        <section class="card glass-panel rounded-xl p-6">
          <h2 class="text-xl font-semibold text-white mb-4">âš™ï¸ è¡¨ç¤ºè¨­å®š</h2>
          <div class="space-y-4">
            <!-- è¡¨ç¤ºè¨­å®šï¼ˆå¿ƒç†çš„å®‰å…¨æ€§é‡è¦–ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆOFFï¼‰ -->
            <div class="mb-4">
              <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-3 mb-4">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-yellow-400">ğŸ”’</span>
                  <span class="text-sm font-medium text-yellow-300">å¿ƒç†çš„å®‰å…¨æ€§ã¸ã®é…æ…®</span>
                </div>
                <p class="text-xs text-yellow-200">åˆæœŸè¨­å®šã§ã¯å›ç­”è€…ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¿è­·ã—ã¦ã„ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦è¡¨ç¤ºè¨­å®šã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>
              </div>
              <div class="toggle-group">
                <label class="toggle-switch">
                  <input type="checkbox" id="show-names" />
                  <span class="slider"></span>
                  å›ç­”è€…åã‚’è¡¨ç¤º
                </label>
                <label class="toggle-switch">
                  <input type="checkbox" id="show-reactions" />
                  <span class="slider"></span>
                  ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’è¡¨ç¤º
                </label>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <button id="save-draft" class="btn-secondary" type="button">ä¸‹æ›¸ãä¿å­˜</button>
            <button id="publish-now" class="btn-primary" type="button">ä»Šã™ãå…¬é–‹</button>
          </div>
        </section>
      </div>

      <!-- å³ãƒ‘ãƒãƒ«: æƒ…å ±è¡¨ç¤º -->
      <div class="info-panel">
        <!-- ç¾åœ¨ã®è¨­å®šã‚µãƒãƒªãƒ¼ -->
        <section class="info-card glass-panel rounded-xl p-4">
          <h3 class="text-lg font-semibold text-white mb-3">ğŸ“‹ ç¾åœ¨ã®è¨­å®š</h3>
          <div class="config-summary">
            <div class="config-item">
              <span class="label">å…¬é–‹çŠ¶æ…‹:</span>
              <span id="app-publish-status" class="status-badge unpublished">æœªå…¬é–‹</span>
            </div>
            <div class="config-item">
              <span class="label">ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:</span>
              <span id="current-datasource" class="text-sm text-gray-400">æœªè¨­å®š</span>
            </div>
            <div class="config-item">
              <span class="label">ã‚·ãƒ¼ãƒˆå:</span>
              <span id="current-sheetname" class="text-sm text-gray-400">æœªè¨­å®š</span>
            </div>
            <div class="config-item">
              <span class="label">æœ€çµ‚æ›´æ–°:</span>
              <span id="last-updated-time" class="text-sm text-gray-400">--:--</span>
            </div>
          </div>
        </section>

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
        <div class="info-card glass-panel rounded-xl p-4">
          <h3 class="text-lg font-semibold text-white mb-3">ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
              <span class="text-gray-300">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
              <span id="current-user-email" class="text-cyan-400">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
              <span class="text-gray-300">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</span>
              <span id="current-user-id" class="text-gray-400">èª­ã¿è¾¼ã¿ä¸­...</span>
            </div>
            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
              <span class="text-gray-300">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:</span>
              <button
                onclick="window.sharedUtilities.auth.switchToAnotherAccount()"
                type="button"
                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm transition-colors"
              >
                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              </button>
            </div>
          </div>
        </div>

        <!-- ãƒªã‚½ãƒ¼ã‚¹ -->
        <section class="info-card glass-panel rounded-xl p-4">
          <h3 class="text-lg font-semibold text-white mb-3">ğŸ“š ãƒªã‚½ãƒ¼ã‚¹</h3>
          <div class="resource-buttons space-y-2">
            <button
              id="open-spreadsheet-btn"
              class="resource-btn w-full px-3 py-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
              onclick="openSpreadsheet()"
              disabled
              type="button"
            >
              <span>ğŸ“Š</span>
              <span>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã</span>
            </button>

            <button
              id="open-form-btn"
              class="resource-btn w-full px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed hidden"
              onclick="openForm()"
              disabled
              type="button"
            >
              <span>ğŸ“</span>
              <span>ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã</span>
            </button>


            <div id="resource-status" class="text-xs text-gray-400 mt-2 text-center">
              è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...
            </div>
          </div>
        </section>

        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="info-card glass-panel rounded-xl p-4">
          <h3 class="text-lg font-semibold text-white mb-3">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
          <div class="space-y-3">
            <button
              class="link-btn w-full text-center"
              type="button"
              onclick="window.open('https://drive.google.com', '_blank')"
            >
              ğŸ“ Googleãƒ‰ãƒ©ã‚¤ãƒ–ã‚’é–‹ã
            </button>
            <button
              class="link-btn w-full text-center"
              type="button"
              onclick="window.open('https://docs.google.com/forms/', '_blank')"
            >
              ğŸ“ Googleãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
            </button>
            <button
              class="link-btn w-full text-center"
              type="button"
              onclick="window.open('https://classroom.google.com', '_blank')"
            >
              ğŸ“ Googleã‚¯ãƒ©ã‚¹ãƒ«ãƒ¼ãƒ ã‚’é–‹ã
            </button>
            <button
              id="open-board-btn"
              class="link-btn w-full text-center"
              type="button"
              onclick="openAnswerBoard()"
              disabled
            >
              ğŸ“Š å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
            </button>
            <!-- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ç”¨ãƒœã‚¿ãƒ³ -->
            <button
              id="app-setup-btn"
              class="link-btn w-full text-center"
              type="button"
              onclick="openAppSetup()"
              style="display: none;"
            >
              âš™ï¸ ã‚¢ãƒ—ãƒªè¨­å®š
            </button>
          </div>
        </section>
      </div>
    </div>


    <!-- ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰æƒ…å ±ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer
      id="boardInfoFooter"
      class="fixed bottom-0 left-0 right-0 z-30 p-3 hidden"
    >
      <div class="glass-panel rounded-xl p-4 max-w-5xl mx-auto">
        <div class="flex items-center justify-between gap-4">
          <!-- å·¦å´ï¼šå•é¡Œæ–‡è¡¨ç¤º -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <span class="text-yellow-400">ğŸ“</span>
              <span class="text-xs text-gray-400">ç¾åœ¨ã®å›ç­”ãƒœãƒ¼ãƒ‰</span>
            </div>
            <div id="currentQuestionText" class="text-white font-medium truncate">
              èª­ã¿è¾¼ã¿ä¸­...
            </div>
          </div>

          <!-- å³å´ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
          <div class="flex items-center gap-2 flex-shrink-0">
            <button
              id="copyViewUrlBtn"
              class="btn-secondary text-sm px-3 py-2"
              title="é–²è¦§ç”¨URLã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå…±æœ‰ç”¨ï¼‰"
              type="button"
            >
              ğŸ“‹ URLã‚³ãƒ”ãƒ¼
            </button>
            <button
              id="openBoardBtn"
              class="btn-primary text-sm px-3 py-2"
              title="å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹ã"
              type="button"
            >
              ğŸ“Š ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
            </button>
            <button
              id="refreshBoardInfo"
              class="btn-secondary text-sm px-2 py-2"
              title="æƒ…å ±ã‚’æ›´æ–°"
              type="button"
            >
              ğŸ”„
            </button>
          </div>
        </div>


        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆæœ€å°é™ï¼‰ -->
        <div class="text-xs text-gray-500 mt-2" id="boardStatus">æœ€çµ‚æ›´æ–°: --:--</div>
      </div>
    </footer>

    <!-- AdminPanel JavaScript -->
    <?!= include('AdminPanel.js'); ?>
  </body>
</html>