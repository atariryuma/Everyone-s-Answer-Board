<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <base target="_top">
  <title>StudyQuest ç®¡ç†ç”»é¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --primary-color: #3b82f6;
      --secondary-color: #6366f1;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border-color: #475569;
    }
    
    body { 
      margin: 0; 
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    .glass-card {
      background: rgba(51, 65, 85, 0.8);
      -webkit-backdrop-filter: blur(8px);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      transition: all 0.2s ease;
    }
    
    .glass-card:hover {
      border-color: var(--primary-color);
      transform: translateY(-1px);
    }
    
    .nav-item {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      transition: all 0.2s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .nav-item:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--primary-color);
    }
    
    .nav-item.active {
      background: var(--primary-color);
      color: white;
    }
    
    .metric-card {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
    }
    
    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .btn-secondary:hover {
      background: var(--bg-secondary);
      border-color: var(--primary-color);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    
    .status-active { background: var(--success-color); }
    .status-warning { background: var(--warning-color); }
    .status-error { background: var(--error-color); }
    
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .section-content {
      display: none;
    }
    
    .section-content.active {
      display: block;
    }
    
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="sidebar w-64 bg-slate-800 border-r border-slate-700 flex-shrink-0">
      <div class="p-6 border-b border-slate-700">
        <h1 class="text-xl font-bold text-white flex items-center gap-3">
          <span class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </span>
          StudyQuest
        </h1>
        <p class="text-sm text-slate-400 mt-1">ç®¡ç†ç”»é¢</p>
      </div>
      
      <nav class="p-4">
        <ul class="space-y-2">
          <li>
            <div class="nav-item active" onclick="showSection('dashboard')" data-section="dashboard">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
              ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
            </div>
          </li>
          <li>
            <div class="nav-item" onclick="showSection('spreadsheets')" data-section="spreadsheets">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm2 10a1 1 0 10-2 0v3a1 1 0 102 0v-3zm2-3a1 1 0 011 1v5a1 1 0 11-2 0v-5a1 1 0 011-1zm4-1a1 1 0 10-2 0v7a1 1 0 102 0V8z" clip-rule="evenodd"/>
              </svg>
              ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç®¡ç†
            </div>
          </li>
          <li>
            <div class="nav-item" onclick="showSection('boards')" data-section="boards">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
              </svg>
              ãƒœãƒ¼ãƒ‰ç®¡ç†
            </div>
          </li>
          <li>
            <div class="nav-item" onclick="showSection('settings')" data-section="settings">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
              </svg>
              è¨­å®š
            </div>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="flex-1 bg-slate-900">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <header class="bg-slate-800 border-b border-slate-700 px-6 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 id="page-title" class="text-2xl font-bold text-white">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
            <p id="page-subtitle" class="text-slate-400 text-sm mt-1">ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦ã¨ä¸»è¦ãªæŒ‡æ¨™</p>
          </div>
          <div class="flex items-center gap-4">
            <div class="relative">
              <span id="status-indicator" class="status-dot status-warning"></span>
              <span id="system-status" class="text-sm text-slate-300">æº–å‚™ä¸­</span>
            </div>
          </div>
        </div>
      </header>

      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
      <div class="p-6">
        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div id="dashboard-section" class="section-content active">
          <!-- KPI ã‚«ãƒ¼ãƒ‰ -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="metric-card">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-400 text-sm">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒœãƒ¼ãƒ‰</p>
                  <p id="active-boards" class="text-2xl font-bold text-white">0</p>
                </div>
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="metric-card">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-400 text-sm">ç·å›ç­”æ•°</p>
                  <p id="total-answers" class="text-2xl font-bold text-white">0</p>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="metric-card">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-400 text-sm">ç·åå¿œæ•°</p>
                  <p id="total-reactions" class="text-2xl font-bold text-white">0</p>
                </div>
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
            </div>

            <div class="metric-card">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-400 text-sm">æœ€çµ‚æ›´æ–°</p>
                  <p id="last-updated" class="text-lg font-bold text-white">--</p>
                </div>
                <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                  <svg class="w-6 h-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="glass-card p-6">
              <h3 class="text-lg font-semibold text-white mb-4">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
              <div class="space-y-3">
                <button type="button" class="btn-primary w-full" onclick="openBoard()">
                  ğŸ“– ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
                </button>
                <button type="button" class="btn-secondary w-full" onclick="showSection('spreadsheets')">
                  ğŸ“Š æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®š
                </button>
                <button type="button" class="btn-secondary w-full" onclick="showSection('boards')">
                  âš™ï¸ ãƒœãƒ¼ãƒ‰ç®¡ç†
                </button>
              </div>
            </div>

            <div class="glass-card p-6">
              <h3 class="text-lg font-semibold text-white mb-4">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
              <div class="space-y-4">
                <div class="flex items-center justify-between">
                  <span class="text-slate-300">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š</span>
                  <span class="flex items-center">
                    <span class="status-dot status-active"></span>
                    <span class="text-sm text-green-400">æ­£å¸¸</span>
                  </span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-slate-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶š</span>
                  <span class="flex items-center" id="spreadsheet-status">
                    <span class="status-dot status-warning"></span>
                    <span class="text-sm text-yellow-400">æœªè¨­å®š</span>
                  </span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-slate-300">ç®¡ç†æ©Ÿèƒ½</span>
                  <span class="flex items-center">
                    <span class="status-dot status-active"></span>
                    <span class="text-sm text-green-400">æœ‰åŠ¹</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç®¡ç† -->
        <div id="spreadsheets-section" class="section-content">
          <div class="max-w-4xl mx-auto">
            <!-- æ–°è¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­å®š -->
            <div class="glass-card p-6 mb-6">
              <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-3">
                <span class="w-8 h-8 bg-yellow-500 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                  </svg>
                </span>
                æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®š
              </h3>
              <p class="text-slate-400 mb-6">æ—¢å­˜ã®Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’StudyQuestãƒœãƒ¼ãƒ‰ã¨ã—ã¦è¨­å®šã§ãã¾ã™</p>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">
                    ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURL <span class="text-red-400">*</span>
                  </label>
                  <input 
                    type="url" 
                    id="new-spreadsheet-url" 
                    placeholder="https://docs.google.com/spreadsheets/d/..."
                    class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  >
                </div>
                <div class="flex gap-3">
                  <button type="button" class="btn-primary" onclick="setupNewSpreadsheet()">
                    ğŸš€ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®š
                  </button>
                  <button type="button" class="btn-secondary" onclick="showSpreadsheetHelp()">
                    â“ ãƒ˜ãƒ«ãƒ—
                  </button>
                </div>
              </div>
            </div>

            <!-- ç¾åœ¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæƒ…å ± -->
            <div class="glass-card p-6">
              <h3 class="text-xl font-semibold text-white mb-4">ç¾åœ¨ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-slate-300 mb-2">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚·ãƒ¼ãƒˆ</label>
                  <select 
                    id="sheet-select" 
                    class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500"
                    onchange="switchSheet()"
                  >
                    <option>èª­ã¿è¾¼ã¿ä¸­...</option>
                  </select>
                  <div class="flex gap-2 mt-3">
                    <button type="button" class="btn-secondary flex-1" onclick="refreshSheetList()">
                      ğŸ”„ æ›´æ–°
                    </button>
                    <span class="px-3 py-2 bg-slate-700 text-slate-300 rounded-lg text-sm" id="sheet-count">0 æš</span>
                  </div>
                </div>
                
                <div>
                  <h4 class="text-sm font-medium text-slate-300 mb-3">ã‚·ãƒ¼ãƒˆæƒ…å ±</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                      <span class="text-slate-400">ç¾åœ¨ã®ã‚·ãƒ¼ãƒˆ:</span>
                      <span class="text-white" id="current-sheet-name">--</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">å›ç­”æ•°:</span>
                      <span class="text-white" id="current-answer-count">0</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">æœ€çµ‚æ›´æ–°:</span>
                      <span class="text-white text-xs" id="current-last-update">--</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ãƒœãƒ¼ãƒ‰ç®¡ç† -->
        <div id="boards-section" class="section-content">
          <div class="glass-card p-6">
            <h3 class="text-xl font-semibold text-white mb-6">ãƒœãƒ¼ãƒ‰ç®¡ç†</h3>
            
            <!-- åˆ—è¨­å®š -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">
                  å•é¡Œæ–‡ãƒ»å›ç­”åˆ— <span class="text-red-400">*</span>
                </label>
                <select 
                  id="question-answer-header" 
                  class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500"
                  onchange="updateConfig()"
                >
                  <option value="">åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">
                  ç†ç”±åˆ—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                </label>
                <select 
                  id="reason-header" 
                  class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500"
                  onchange="updateConfig()"
                >
                  <option value="">é¸æŠã—ãªã„</option>
                </select>
              </div>
            </div>

            <!-- è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
            <div class="border-t border-slate-600 pt-6">
              <h4 class="text-lg font-medium text-white mb-4">è¡¨ç¤ºè¨­å®š</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                  <span class="text-slate-300">åå‰è¡¨ç¤º</span>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="show-names" class="sr-only peer" onchange="updateDisplayOptions()">
                    <div class="w-11 h-6 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                  </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                  <span class="text-slate-300">ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º</span>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="show-counts" class="sr-only peer" onchange="updateDisplayOptions()">
                    <div class="w-11 h-6 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                  </label>
                </div>
              </div>
              <button type="button" class="btn-primary mt-4" onclick="applyDisplayOptions()">
                âœ… è¨­å®šã‚’é©ç”¨
              </button>
            </div>
          </div>
        </div>

        <!-- è¨­å®š -->
        <div id="settings-section" class="section-content">
          <div class="glass-card p-6">
            <h3 class="text-xl font-semibold text-white mb-6">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3>
            <div class="space-y-6">
              <div>
                <h4 class="text-lg font-medium text-white mb-3">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h4>
                <div class="space-y-3">
                  <button type="button" class="btn-secondary" onclick="exportData()">
                    ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                  </button>
                  <button type="button" class="btn-secondary" onclick="clearCache()">
                    ğŸ—‘ï¸ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
                  </button>
                </div>
              </div>
              
              <div class="border-t border-slate-600 pt-6">
                <h4 class="text-lg font-medium text-white mb-3">ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-slate-400">ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</span>
                      <span class="text-white">v2.0.0</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">æœ€çµ‚æ›´æ–°:</span>
                      <span class="text-white" id="system-last-update">--</span>
                    </div>
                  </div>
                  <div class="space-y-2">
                    <div class="flex justify-between">
                      <span class="text-slate-400">ç’°å¢ƒ:</span>
                      <span class="text-white">Production</span>
                    </div>
                    <div class="flex justify-between">
                      <span class="text-slate-400">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</span>
                      <span class="text-green-400">ç¨¼åƒä¸­</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  -->
  <div id="notification" class="fixed top-4 right-4 z-50 max-w-sm"></div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-slate-800 p-6 rounded-lg">
      <div class="flex items-center space-x-3">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
        <span class="text-white" id="loading-message">å‡¦ç†ä¸­...</span>
      </div>
    </div>
  </div>

  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let currentSection = 'dashboard';
    
    // ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ
    function showSection(section) {
      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›´æ–°
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`[data-section="${section}"]`).classList.add('active');
      
      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.section-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${section}-section`).classList.add('active');
      
      // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã®æ›´æ–°
      const titles = {
        dashboard: { title: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', subtitle: 'ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦ã¨ä¸»è¦ãªæŒ‡æ¨™' },
        spreadsheets: { title: 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç®¡ç†', subtitle: 'Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¨­å®šã¨ç®¡ç†' },
        boards: { title: 'ãƒœãƒ¼ãƒ‰ç®¡ç†', subtitle: 'å›ç­”ãƒœãƒ¼ãƒ‰ã®è¨­å®šã¨è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³' },
        settings: { title: 'è¨­å®š', subtitle: 'ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†' }
      };
      
      const titleInfo = titles[section] || titles.dashboard;
      document.getElementById('page-title').textContent = titleInfo.title;
      document.getElementById('page-subtitle').textContent = titleInfo.subtitle;
      
      currentSection = section;
      
      // ã‚»ã‚¯ã‚·ãƒ§ãƒ³å›ºæœ‰ã®åˆæœŸåŒ–
      if (section === 'spreadsheets') {
        refreshSheetList();
      } else if (section === 'dashboard') {
        loadDashboard();
      }
    }
    
    // é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const colors = {
        success: 'bg-green-600',
        error: 'bg-red-600',
        warning: 'bg-yellow-600',
        info: 'bg-blue-600'
      };
      
      const notificationEl = document.createElement('div');
      notificationEl.className = `${colors[type]} text-white p-4 rounded-lg shadow-lg mb-2 fade-in`;
      notificationEl.textContent = message;
      
      notification.appendChild(notificationEl);
      
      setTimeout(() => {
        notificationEl.remove();
      }, 5000);
    }
    
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    function setLoading(show, message = 'å‡¦ç†ä¸­...') {
      const overlay = document.getElementById('loading-overlay');
      const messageEl = document.getElementById('loading-message');
      
      if (show) {
        messageEl.textContent = message;
        overlay.classList.remove('hidden');
      } else {
        overlay.classList.add('hidden');
      }
    }
    
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
    function loadDashboard() {
      setLoading(true, 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿ä¸­...');
      
      google.script.run
        .withSuccessHandler((result) => {
          if (result.status === 'success') {
            updateDashboardMetrics(result.data);
            updateSystemStatus(result.data);
          }
          setLoading(false);
        })
        .withFailureHandler((error) => {
          setLoading(false);
          showNotification('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        })
        .getDashboardData();
    }
    
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æŒ‡æ¨™æ›´æ–°
    function updateDashboardMetrics(data) {
      document.getElementById('active-boards').textContent = data.activeBoards || 0;
      document.getElementById('total-answers').textContent = data.totalAnswers || 0;
      document.getElementById('total-reactions').textContent = data.totalReactions || 0;
      document.getElementById('last-updated').textContent = data.lastUpdated ? 
        new Date(data.lastUpdated).toLocaleDateString('ja-JP') : '--';
    }
    
    // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
    function updateSystemStatus(data) {
      const statusEl = document.getElementById('system-status');
      const indicatorEl = document.getElementById('status-indicator');
      const spreadsheetStatusEl = document.getElementById('spreadsheet-status');
      
      if (data.hasActiveSpreadsheet) {
        statusEl.textContent = 'ç¨¼åƒä¸­';
        indicatorEl.className = 'status-dot status-active';
        spreadsheetStatusEl.innerHTML = `
          <span class="status-dot status-active"></span>
          <span class="text-sm text-green-400">æ¥ç¶šæ¸ˆã¿</span>
        `;
      } else {
        statusEl.textContent = 'è¨­å®šãŒå¿…è¦';
        indicatorEl.className = 'status-dot status-warning';
      }
    }
    
    // ã‚·ãƒ¼ãƒˆä¸€è¦§æ›´æ–°
    function refreshSheetList() {
      setLoading(true, 'ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’æ›´æ–°ä¸­...');
      
      google.script.run
        .withSuccessHandler((result) => {
          if (result.status === 'success') {
            updateSheetSelect(result.sheets);
            showNotification('ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
          } else {
            showNotification(result.message || 'ã‚·ãƒ¼ãƒˆä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          }
          setLoading(false);
        })
        .withFailureHandler((error) => {
          setLoading(false);
          showNotification('ã‚·ãƒ¼ãƒˆä¸€è¦§ã®æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        })
        .getAvailableSheets();
    }
    
    // ã‚·ãƒ¼ãƒˆé¸æŠæ›´æ–°
    function updateSheetSelect(sheets) {
      const sheetSelect = document.getElementById('sheet-select');
      const sheetCount = document.getElementById('sheet-count');
      
      if (sheetSelect) {
        sheetSelect.innerHTML = '<option value="">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
        
        if (sheets && sheets.length > 0) {
          sheets.forEach(sheet => {
            const option = document.createElement('option');
            option.value = sheet.name;
            option.textContent = sheet.name;
            if (sheet.isActive) {
              option.selected = true;
            }
            sheetSelect.appendChild(option);
          });
        }
      }
      
      if (sheetCount) {
        const count = sheets ? sheets.length : 0;
        sheetCount.textContent = `${count} æš`;
      }
    }
    
    // æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­å®š
    function setupNewSpreadsheet() {
      const urlInput = document.getElementById('new-spreadsheet-url');
      const url = urlInput.value.trim();
      
      if (!url) {
        showNotification('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        return;
      }
      
      // URLæ¤œè¨¼
      if (!url.includes('docs.google.com/spreadsheets')) {
        showNotification('æœ‰åŠ¹ãªGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      setLoading(true, 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®šä¸­...');
      
      const spreadsheetId = extractSpreadsheetId(url);
      
      google.script.run
        .withSuccessHandler((result) => {
          if (result.status === 'success') {
            showNotification('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            urlInput.value = '';
            loadDashboard();
            refreshSheetList();
          } else {
            showNotification(result.message || 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          }
          setLoading(false);
        })
        .withFailureHandler((error) => {
          setLoading(false);
          showNotification('è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
        })
        .setupSpreadsheet(spreadsheetId);
    }
    
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDæŠ½å‡º
    function extractSpreadsheetId(url) {
      const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
      return match ? match[1] : url;
    }
    
    // ã‚·ãƒ¼ãƒˆåˆ‡ã‚Šæ›¿ãˆ
    function switchSheet() {
      const selectedSheet = document.getElementById('sheet-select').value;
      if (!selectedSheet) return;
      
      setLoading(true, 'ã‚·ãƒ¼ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆä¸­...');
      
      google.script.run
        .withSuccessHandler((result) => {
          if (result.status === 'success') {
            showNotification('ã‚·ãƒ¼ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ', 'success');
            loadDashboard();
          } else {
            showNotification(result.message || 'ã‚·ãƒ¼ãƒˆã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          }
          setLoading(false);
        })
        .withFailureHandler((error) => {
          setLoading(false);
          showNotification('åˆ‡ã‚Šæ›¿ãˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        })
        .switchToSheet(selectedSheet);
    }
    
    // ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
    function openBoard() {
      const baseUrl = window.location.origin + window.location.pathname;
      const boardUrl = baseUrl + '?action=view';
      window.open(boardUrl, '_blank');
    }
    
    // è¨­å®šæ›´æ–°ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
    function updateConfig() {
      // å®Ÿè£…ãŒå¿…è¦
    }
    
    function updateDisplayOptions() {
      // å®Ÿè£…ãŒå¿…è¦
    }
    
    function applyDisplayOptions() {
      // å®Ÿè£…ãŒå¿…è¦
    }
    
    function exportData() {
      // å®Ÿè£…ãŒå¿…è¦
    }
    
    function clearCache() {
      // å®Ÿè£…ãŒå¿…è¦
    }
    
    function showSpreadsheetHelp() {
      const helpText = `ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨­å®šãƒ˜ãƒ«ãƒ—:

1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã®å–å¾—æ–¹æ³•
   â€¢ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã
   â€¢ ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®URLã‚’ã‚³ãƒ”ãƒ¼
   â€¢ ä¾‹: https://docs.google.com/spreadsheets/d/1ABC...xyz/edit

2. å¿…è¦ãªæ¨©é™
   â€¢ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ç·¨é›†æ¨©é™ãŒå¿…è¦ã§ã™
   â€¢ ã€Œé–²è¦§ã®ã¿ã€æ¨©é™ã§ã¯è¨­å®šã§ãã¾ã›ã‚“

3. æ¨å¥¨ã•ã‚Œã‚‹ã‚·ãƒ¼ãƒˆæ§‹é€ 
   â€¢ 1è¡Œç›®ã«ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆåˆ—åï¼‰
   â€¢ 2è¡Œç›®ä»¥é™ã«ãƒ‡ãƒ¼ã‚¿
   â€¢ Googleãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­”ã‚·ãƒ¼ãƒˆãŒæœ€é©`;
      
      alert(helpText);
    }
    
    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      loadDashboard();
    });
  </script>
</body>
</html>