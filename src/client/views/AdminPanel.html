<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <base target="_top">
  <title>ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã€€ç®¡ç†ãƒ‘ãƒãƒ« - StudyQuest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1a1b26" />
  <meta name="description" content="StudyQuestã®å›ç­”ãƒœãƒ¼ãƒ‰ç®¡ç†ãƒ‘ãƒãƒ« - ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„æ•™è‚²ãƒ„ãƒ¼ãƒ«" />
  <!-- User ID will be set by JavaScript to avoid template injection issues -->
  <meta name="user-id" content="" id="user-id-meta">
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    window.addEventListener('error', function(event) {
      console.error('Global error caught:', event.error);
      // document.writeã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ç‰¹åˆ¥ãªå‡¦ç†
      if (event.error && event.error.message && event.error.message.includes('document.write')) {
        console.warn('document.write ã‚¨ãƒ©ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚å®‰å…¨ãªDOMæ“ä½œã«åˆ‡ã‚Šæ›¿ãˆã¦ã„ã¾ã™ã€‚');
        event.preventDefault();
      }
    });
    
    // Promise rejection ã®ã‚­ãƒ£ãƒƒãƒ
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
      event.preventDefault();
    });
  </script>
  
  <?! include('styles/main.css.html'); ?>
  <?! include('styles/AdminPanel.css.html'); ?>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans">
  <header class="glass-panel border-b border-gray-700 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
      <div class="flex items-center justify-between">
        <!-- ãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
          </div>
          <div class="hidden sm:block">
            <h1 class="text-lg sm:text-xl font-bold text-white leading-tight">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã€€ç®¡ç†ãƒ‘ãƒãƒ«</h1>
            <p class="text-xs text-gray-400">StudyQuest</p>
          </div>
          <div class="sm:hidden">
            <h1 class="text-lg font-bold text-white">ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰</h1>
          </div>
        </div>
        
        <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
        <div class="flex items-center gap-2 sm:gap-3">
          <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ï¼ˆRegistration.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
          <div id="header-domain-info">
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆç·‘è‰²ãƒ‘ãƒãƒ«ï¼‰ -->
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´è¡¨ç¤ºï¼ˆRegistration.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-match" class="glass-panel bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-3 border border-green-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <div class="text-green-400 font-semibold text-sm" id="header-domain-match-text">G Suite ãƒ‰ãƒ¡ã‚¤ãƒ³</div>
                  <div class="text-green-200 text-xs">ã‚»ã‚­ãƒ¥ã‚¢ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹</div>
                </div>
              </div>
            </div>
            
            <!-- ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´è¡¨ç¤ºï¼ˆRegistration.htmlã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ -->
            <div id="header-domain-mismatch" class="glass-panel bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-3 border border-yellow-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <div>
                  <div class="text-yellow-400 font-semibold text-sm" id="header-domain-mismatch-text">ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´</div>
                  <div class="text-yellow-200 text-xs">ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã‚ã‚Š</div>
                </div>
              </div>
            </div>
            
            <!-- åˆæœŸçŠ¶æ…‹è¡¨ç¤º -->
            <div id="header-domain-initial" class="glass-panel bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg p-3 border border-blue-400/30">
              <div class="flex items-center gap-2">
                <div id="header-status-dot" class="w-3 h-3 bg-blue-400 rounded-full animate-pulse flex-shrink-0"></div>
                <div>
                  <div class="text-blue-400 font-semibold text-sm" id="header-domain-name-initial">ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèªä¸­</div>
                  <div class="text-blue-200 text-xs" id="header-status-text-initial">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  
  <main class="flex-1 max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-8 pb-40">
    <!-- ã‚·ãƒ³ãƒ—ãƒ«çµ±åˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
    <section class="mb-4">
      <div class="glass-panel p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <!-- å·¦å´: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-white" id="guidance-text">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</span>
              <div class="text-xs text-gray-400 mt-1">3ã‚¹ãƒ†ãƒƒãƒ—ã§ç°¡å˜ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
            </div>
          </div>
          
          <!-- å³å´: ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1" id="step-1-indicator">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">1</div>
              <span class="text-xs text-gray-300 hidden sm:inline">ãƒ‡ãƒ¼ã‚¿æº–å‚™</span>
            </div>
            <div class="w-4 h-px bg-gray-600"></div>
            <div class="flex items-center gap-1" id="step-2-indicator">
              <div class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">2</div>
              <span class="text-xs text-gray-300 hidden sm:inline">ã‚·ãƒ¼ãƒˆé¸æŠ</span>
            </div>
            <div class="w-4 h-px bg-gray-600"></div>
            <div class="flex items-center gap-1" id="step-3-indicator">
              <div class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">3</div>
              <span class="text-xs text-gray-300 hidden sm:inline">è¨­å®šãƒ»å…¬é–‹</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
    <div class="responsive-grid">
      <!-- å·¦å´ï¼šã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ¼ -->
      <div class="space-y-3 sm:space-y-4">
        
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿æº–å‚™ -->
        <div class="glass-panel p-4 sm:p-6" id="data-setup-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                1
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">ãƒ‡ãƒ¼ã‚¿æº–å‚™</h2>
                <p class="text-xs text-gray-400">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ ã‚’æº–å‚™</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step1-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step1-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step1-content" class="progressive-section expanded">
            <!-- åˆå¿ƒè€…å‘ã‘ï¼šç°¡å˜ä½œæˆ -->
            <div class="mb-6">
              <div class="google-integration p-4 rounded-xl text-white">
                <div class="flex items-center gap-3 mb-3">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  <h3 class="font-semibold">æ¨å¥¨ï¼šè‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h3>
                </div>
                <p class="text-sm mb-4 opacity-90">Googleãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’Workspaceä¸Šã§è‡ªå‹•ä½œæˆã—ã¾ã™</p>
                <div class="space-y-2">
                  <button type="button" id="create-board-btn" class="btn btn-google w-full">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span id="create-board-text">æ–°ã—ã„ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆ</span>
                  </button>
                  
                  <!-- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ -->
                  <div id="existing-user-section" class="hidden">
                    <button type="button" id="create-additional-form-btn" class="btn btn-secondary w-full text-sm">
                      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      <span id="create-additional-form-text" class="text-gray-200">è¿½åŠ ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</span>
                    </button>
                    <p class="text-xs text-gray-400 mt-1">ç¾åœ¨ã®ãƒœãƒ¼ãƒ‰ã«é€£æºã™ã‚‹æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘) -->
            <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
              <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®é€£æº (ä¸Šç´šè€…å‘ã‘)
              </summary>
              <div class="p-4 pt-0 space-y-4">
                <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                  <label class="block text-sm font-medium text-purple-200 mb-2">
                    Googleãƒ•ã‚©ãƒ¼ãƒ ã¾ãŸã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URL
                  </label>
                  <div class="space-y-3">
                    <input type="url" 
                           id="resource-url-input" 
                           placeholder="https://docs.google.com/forms/d/... ã¾ãŸã¯ https://docs.google.com/spreadsheets/d/..."
                           class="form-control"
                           aria-describedby="resource-url-help">
                    <p id="resource-url-help" class="text-xs text-purple-300 mt-1">
                      æ—¢å­˜ã®Googleãƒ•ã‚©ãƒ¼ãƒ ã¾ãŸã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                    </p>
                    <div class="flex gap-2">
                      <button type="button" id="add-resource-btn" class="btn btn-primary flex-1">
                        <span id="add-resource-text">ãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ </span>
                      </button>
                      <button type="button" id="open-resource-btn" class="btn btn-secondary px-3" disabled title="ãƒ•ã‚©ãƒ¼ãƒ ã¾ãŸã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                        <span id="open-resource-text" class="ml-1 text-xs hidden sm:inline">é–‹ã</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </details>
            
            <!-- ä½œæˆã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹è¡¨ç¤º -->
            <div class="space-y-3 hidden" id="form-url-section">
              <div class="success-state">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span class="font-medium">ãƒ•ã‚©ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸ</span>
                </div>
                <div class="flex gap-2">
                  <input type="url" id="form-url-input" class="form-control flex-1 text-sm" readonly placeholder="ãƒ•ã‚©ãƒ¼ãƒ URLãŒç”Ÿæˆã•ã‚Œã¾ã™">
                  <button type="button" id="copy-form-url-btn" class="btn btn-secondary" title="URLã‚’ã‚³ãƒ”ãƒ¼">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                  </button>
                  <a id="open-form-url-link" href="#" target="_blank" class="btn btn-secondary" title="ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚·ãƒ¼ãƒˆé¸æŠ -->
        <div class="glass-panel p-4 sm:p-6" id="sheet-selection-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                2
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">ã‚·ãƒ¼ãƒˆé¸æŠ</h2>
                <p class="text-xs text-gray-400">è¡¨ç¤ºã—ãŸã„ã‚·ãƒ¼ãƒˆã‚’é¸æŠ</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step2-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step2-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step2-content" class="progressive-section expanded">
            <div class="space-y-4">
              <div class="space-y-3">
                <!-- ã‚·ãƒ¼ãƒˆé¸æŠã®èª¬æ˜ -->
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                  <div class="flex items-center gap-2 mb-2">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <span class="text-sm font-medium text-green-200">ã‚·ãƒ¼ãƒˆé¸æŠ</span>
                  </div>
                  <p class="text-xs text-green-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚·ãƒ¼ãƒˆã‚’å›ç­”ãƒœãƒ¼ãƒ‰ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚·ãƒ¼ãƒˆã«æŒ‡å®šã—ã¾ã™</p>
                </div>
                
                <!-- ã‚·ãƒ³ãƒ—ãƒ«ã‚·ãƒ¼ãƒˆé¸æŠ -->
                <label for="sheet-select" class="block text-sm font-medium text-white">
                  è¡¨ç¤ºã—ãŸã„ã‚·ãƒ¼ãƒˆã‚’é¸æŠ
                </label>
                <div class="flex gap-2">
                    <select id="sheet-select" class="form-control flex-1" aria-describedby="sheet-help">
                      <option>èª­ã¿è¾¼ã¿ä¸­...</option>
                    </select>
                    <button type="button" id="open-spreadsheet-btn" class="btn btn-secondary px-3" title="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: è¨­å®šãƒ»å…¬é–‹ -->
        <div class="glass-panel p-4 sm:p-6" id="config-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                3
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">è¨­å®šãƒ»å…¬é–‹</h2>
                <p class="text-xs text-gray-400">åˆ—è¨­å®šã‚’è¡Œã„å…¬é–‹</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step3-content')" aria-expanded="true" aria-label="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step3-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step3-content" class="progressive-section expanded">
            <div id="config-area" class="space-y-4 hidden">
              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span class="text-sm font-medium text-purple-200">åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š</span>
                </div>
                <p class="text-xs text-purple-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—ã‚’å›ç­”ãƒœãƒ¼ãƒ‰ã®é …ç›®ã«å‰²ã‚Šå½“ã¦ã¾ã™</p>
              </div>
              
              <!-- å¿…é ˆè¨­å®š -->
              <div class="space-y-4">
                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                  <label class="block">
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-white">å›ç­”ãƒ‡ãƒ¼ã‚¿åˆ—</span>
                      <span class="px-2 py-1 bg-red-500 text-white text-xs rounded-full">å¿…é ˆ</span>
                    </div>
                    <div class="flex gap-2">
                      <select id="opinionHeader" class="form-control flex-1" aria-describedby="main-help"></select>
                      <button type="button" id="reguess-headers-btn" class="btn btn-secondary px-3 py-2" title="åˆ—ã‚’è‡ªå‹•ã§å†åˆ¤å®šã—ã¾ã™" aria-label="åˆ—ã‚’è‡ªå‹•ã§å†åˆ¤å®š">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                      </button>
                    </div>
                    <p id="main-help" class="text-xs text-red-300 mt-1">
                      å›ç­”å†…å®¹ãŒå«ã¾ã‚Œã‚‹åˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„
                    </p>
                  </label>
                </div>
                
                <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š -->
                <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
                  <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                    </svg>
                    ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆä»»æ„ï¼‰
                  </summary>
                  <div class="p-4 pt-0 space-y-4" id="detail-options">
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ç†ç”±ãƒ»è©³ç´°åˆ—</span>
                      <select id="reasonHeader" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">åå‰åˆ—</span>
                      <select id="nameHeader" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">ã‚¯ãƒ©ã‚¹åˆ—</span>
                      <select id="classHeader" class="form-control"></select>
                    </label>
                    <div class="flex items-center mt-4">
                      <input type="checkbox" id="showNames" name="showNames" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="showNames" class="ml-2 block text-sm text-gray-300">åå‰ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                    <div class="flex items-center mt-2">
                      <input type="checkbox" id="showCounts" name="showCounts" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="showCounts" class="ml-2 block text-sm text-gray-300">ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚’è¡¨ç¤ºã™ã‚‹</label>
                    </div>
                  </div>
                </details>
              </div>
              
              <button type="button" id="save-config-btn" disabled class="btn btn-primary w-full">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                </svg>
                <span id="save-config-text">è¨­å®šã‚’ä¿å­˜</span>
              </button>
            </div>
            
            <div id="config-placeholder" class="text-center py-8">
              <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                <div class="loading-skeleton w-full h-full rounded-full hidden" id="config-loading"></div>
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
              </div>
              <p class="text-gray-400 text-sm mb-1">ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</p>
              <p class="text-gray-500 text-xs">è¨­å®šé …ç›®ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
          </div>
        </div>
      </div>

      <!-- å³å´ï¼šæƒ…å ±ãƒ‘ãƒãƒ« -->
      <aside class="space-y-4">
        <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ãƒ‘ãƒãƒ« -->
        <div class="glass-panel p-4 sm:p-6">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex justify-between items-center">
              <span class="text-gray-400">ç®¡ç†è€…:</span>
              <span id="info-admin-email" class="font-mono text-cyan-300">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-400">å…¬é–‹ãƒœãƒ¼ãƒ‰:</span>
              <span id="info-published-sheet" class="font-mono text-green-300">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-gray-400">å›ç­”æ•°:</span>
              <span id="info-answer-count" class="font-mono text-yellow-300 font-bold">-</span>
            </div>
            
            <!-- æ›´æ–°æƒ…å ± -->
            <div class="pt-3 border-t border-gray-600">
              <div class="flex justify-between items-center text-xs">
                <span class="text-gray-500">æœ€çµ‚æ›´æ–°:</span>
                <span id="info-last-updated" class="text-gray-400">æœªå–å¾—</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œãƒ‘ãƒãƒ« -->
        <div class="glass-panel p-4 sm:p-6">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
            </svg>
            æ“ä½œ
          </h3>
          <div class="space-y-3">
            <a id="view-board-link" href="#" target="_blank" class="btn btn-secondary w-full" disabled>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
              ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            </a>
            <button type="button" id="open-form-btn" class="btn btn-secondary w-full" disabled>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
            </button>
          </div>
        </div>
        
        <!-- ã‚µãƒãƒ¼ãƒˆãƒ‘ãƒãƒ« -->
        <div class="glass-panel p-4 sm:p-6">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            ã‚µãƒãƒ¼ãƒˆ
          </h3>
          <div class="space-y-3">
            <button type="button" id="security-info-btn" class="btn btn-secondary w-full text-sm">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
              ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±
            </button>
            <button type="button" id="refresh-status-btn" class="btn btn-secondary w-full text-sm">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
              ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            </button>
          </div>
          
          <!-- ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
          <div class="mt-4 pt-3 border-t border-gray-600">
            <div class="flex items-center gap-2 text-xs">
              <div id="system-status-indicator" class="status-indicator status-active"></div>
              <span id="system-status-text" class="text-gray-400">ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸</span>
            </div>
          </div>
        </div>
        
        <div class="space-y-3 text-sm">
          <div class="flex justify-between items-center py-2 border-b border-gray-700">
            <span class="text-gray-400">ç®¡ç†è€…:</span>
            <span id="info-admin-email" class="font-mono text-cyan-300">-</span>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-gray-700">
            <span class="text-gray-400">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID:</span>
            <span id="info-spreadsheet-id" class="font-mono text-yellow-300 text-xs">-</span>
          </div>
          <div class="flex justify-between items-center py-2 border-b border-gray-700">
            <span class="text-gray-400">å…¬é–‹ãƒœãƒ¼ãƒ‰:</span>
            <span id="info-published-sheet" class="font-mono text-green-300">-</span>
          </div>
          <div class="flex justify-between items-center py-2">
            <span class="text-gray-400">å›ç­”æ•°:</span>
            <span id="info-answer-count" class="font-mono text-yellow-300 font-bold">-</span>
          </div>
          
          <!-- æ›´æ–°æƒ…å ± -->
          <div class="pt-3 border-t border-gray-600">
            <div class="flex justify-between items-center text-xs">
              <span class="text-gray-500">æœ€çµ‚æ›´æ–°:</span>
              <span id="info-last-updated" class="text-gray-400">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="glass-panel p-4 sm:p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
          </div>
          <h3 class="font-semibold text-purple-400">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
        </div>
        
        <div class="space-y-3">
          <a id="view-board-link" href="#" target="_blank" class="btn btn-secondary w-full text-sm disabled:opacity-50" disabled>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
            å›ç­”ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
          </a>
          <button type="button" id="open-form-btn" class="btn btn-secondary w-full text-sm" disabled>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
          </button>
        </div>
      </div>

        </div>
      </div>
    </div>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
    <div id="message-area" class="text-center min-h-[24px]" role="alert" aria-live="polite"></div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer id="footer" class="hidden bg-gray-800/30 backdrop-blur border-t border-gray-700 py-4 mt-8 text-center text-xs text-gray-500">
      <p>&copy; 2025 StudyQuest. All rights reserved.</p>
    </footer>
    
  </div>
  </main>

  <script>
    // Progressive disclosure functionality
    function toggleSection(sectionId) {
      var section = document.getElementById(sectionId);
      var iconId = sectionId.replace('-content', '-icon');
      var icon = document.getElementById(iconId);
      
      if (!section) return;
      
      if (section.classList.contains('expanded')) {
        section.classList.remove('expanded');
        section.classList.add('collapsed');
        if (icon) icon.style.transform = 'rotate(-90deg)';
      } else {
        section.classList.remove('collapsed');
        section.classList.add('expanded');
        if (icon) icon.style.transform = 'rotate(0deg)';
      }
    }
    
    // Mobile layout optimization
    function adjustLayout() {
      var isMobile = window.innerWidth < 768;
      var responsiveGrid = document.querySelector('.responsive-grid');
      
      if (responsiveGrid) {
        if (isMobile) {
          responsiveGrid.style.gridTemplateColumns = '1fr';
        } else if (window.innerWidth >= 1024) {
          responsiveGrid.style.gridTemplateColumns = '2fr 1fr';
        } else {
          responsiveGrid.style.gridTemplateColumns = '1fr 1fr';
        }
      }
    }
    
    // Debounce function for performance
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    // Initialize error handling
    function initializeErrorHandling() {
      // Enhanced error catching with better UX
      window.addEventListener('error', function(event) {
        console.error('Client error caught:', event.error);
        
        // Show user-friendly error message
        var messageArea = document.getElementById('message-area');
        if (messageArea) {
          showStatusMessage('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚', 'error');
        }
      });
      
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled promise rejection:', event.reason);
        event.preventDefault();
      });
    }
    
    function showStatusMessage(message, type) {
      var messageArea = document.getElementById('message-area');
      if (!messageArea) return;
      
      messageArea.textContent = message;
      messageArea.className = 'text-center min-h-[24px] ' + 
        (type === 'error' ? 'text-red-400' : 
         type === 'success' ? 'text-green-400' : 'text-blue-400');
      
      // Auto-hide after 5 seconds for non-error messages
      if (type !== 'error') {
        setTimeout(function() {
          if (messageArea.textContent === message) {
            messageArea.textContent = '';
            messageArea.className = 'text-center min-h-[24px]';
          }
        }, 5000);
      }
    }
    
    // Clear client-side cache function
    function clearClientSideCache(treatAsNew) {
      try {
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ï¼ˆç‰¹å®šã®ãƒ•ãƒ©ã‚°ä»¥å¤–ï¼‰
        var accountSwitchRequested = localStorage.getItem('account_switch_requested');
        localStorage.clear();
        if (treatAsNew) {
          localStorage.setItem('treat_as_new_account', treatAsNew);
        }
        
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢ï¼ˆå¿…è¦ãªãƒ•ãƒ©ã‚°ä»¥å¤–ï¼‰
        var switchRequested = sessionStorage.getItem('account_switch_requested');
        var treatAsNewSession = sessionStorage.getItem('treat_as_new_account');
        sessionStorage.clear();
        if (switchRequested) {
          sessionStorage.setItem('account_switch_requested', switchRequested);
        }
        if (treatAsNewSession) {
          sessionStorage.setItem('treat_as_new_account', treatAsNewSession);
        }
        
        console.log('ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
      } catch (e) {
        console.warn('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€å‡¦ç†ã‚’ç¶šè¡Œã—ã¾ã™:', e.message);
      }
    }

    // Progressive section management
    var completedSteps = new Set();
    
    function markStepCompleted(stepNumber) {
      completedSteps.add(stepNumber);
      
      // Close completed sections except step 3
      if (stepNumber !== 3) {
        var stepContent = document.getElementById('step' + stepNumber + '-content');
        if (stepContent && stepContent.classList.contains('expanded')) {
          toggleSection('step' + stepNumber + '-content');
        }
      }
      
      // If step 3 is completed, reopen all sections
      if (stepNumber === 3) {
        reopenAllSections();
      }
    }
    
    function reopenAllSections() {
      ['step1-content', 'step2-content', 'step3-content'].forEach(function(sectionId) {
        var section = document.getElementById(sectionId);
        if (section && section.classList.contains('collapsed')) {
          toggleSection(sectionId);
        }
      });
    }
    
    // Initialize progressive disclosure on page load
    window.addEventListener('DOMContentLoaded', function() {
      // Set initial states: all sections open initially
      var step1Content = document.getElementById('step1-content');
      var step2Content = document.getElementById('step2-content');
      var step3Content = document.getElementById('step3-content');
      
      if (step1Content) step1Content.classList.add('expanded');
      if (step2Content) step2Content.classList.add('expanded');
      if (step3Content) step3Content.classList.add('expanded');
      
      // Initialize step icons (all pointing down for expanded)
      var step1Icon = document.getElementById('step1-icon');
      var step2Icon = document.getElementById('step2-icon');
      var step3Icon = document.getElementById('step3-icon');
      
      if (step1Icon) step1Icon.style.transform = 'rotate(0deg)';
      if (step2Icon) step2Icon.style.transform = 'rotate(0deg)';
      if (step3Icon) step3Icon.style.transform = 'rotate(0deg)';
      adjustLayout();
    });
    
    // Window resize event listener for layout adjustment
    window.addEventListener('resize', debounce(adjustLayout, 100));
    
  </script>

  <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="security-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-white">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã«ã¤ã„ã¦</h2>
          <button type="button" id="security-modal-close" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div class="space-y-6 text-gray-300">
          <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã®æ¦‚è¦ -->
          <section>
            <h3 class="text-lg font-semibold text-green-400 mb-3">å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–</h3>
            
            <div class="space-y-4">
              <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-green-300 mb-2">ğŸ” Google ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆèªè¨¼</h4>
                <p class="text-sm">Google Cloud Platform (GCP) ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ãŸJWT (JSON Web Token) ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã€‚RSA-SHA256 ç½²åã«ã‚ˆã‚Šã€æœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã¯ä¸€åˆ‡ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚</p>
              </div>

              <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-blue-300 mb-2">ğŸ—ï¸ Google Apps Script ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </h4>
                <p class="text-sm">Googleã®å…¬å¼ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¸Šã§å‹•ä½œã—ã€Google Cloudã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ã‚’æ´»ç”¨ã€‚ãƒ‡ãƒ¼ã‚¿ã¯Google Driveã«æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã€Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹åŸºæº–ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚</p>
              </div>

              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-purple-300 mb-2">ğŸ›¡ï¸ ã‚¹ã‚³ãƒ¼ãƒ—åˆ¶é™ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡</h4>
                <p class="text-sm">Google Sheets API ã¨Google Drive API ã¸ã®é™å®šçš„ãªã‚¢ã‚¯ã‚»ã‚¹ã®ã¿ã‚’ä½¿ç”¨ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯è‡ªå‹•çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ç·¨é›†è€…æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ãŒã€ä»–ã®ãƒ‡ãƒ¼ã‚¿ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚</p>
              </div>

              <div class="bg-teal-900/20 border border-teal-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-teal-300 mb-2">âš¡ è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†</h4>
                <p class="text-sm">ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¯3500ç§’ã®TTLï¼ˆTime To Liveï¼‰ã§å®‰å…¨ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã€è‡ªå‹•çš„ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚æœŸé™åˆ‡ã‚Œã‚„ä¸æ­£ãªãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’é˜²æ­¢ã—ã¾ã™ã€‚</p>
              </div>

              <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-yellow-300 mb-2">ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶é™</h4>
                <p class="text-sm">æ•™è‚²æ©Ÿé–¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã®åˆ©ç”¨æ™‚ã€åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã§ã®ã¿ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã€‚çµ„ç¹”å¤–ã‹ã‚‰ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²æ­¢ã—ã¾ã™ã€‚</p>
              </div>

              <div class="bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-indigo-300 mb-2">ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–</h4>
                <p class="text-sm">HTTPSé€šä¿¡ã«ã‚ˆã‚‹æš—å·åŒ–ã€Google Driveã®ä¿å­˜æ™‚æš—å·åŒ–ã‚’æ´»ç”¨ã€‚è»¢é€ä¸­ãŠã‚ˆã³ä¿å­˜ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã—ã¾ã™ã€‚</p>
              </div>
            </div>
          </section>

          <!-- æ½œåœ¨çš„ãªãƒªã‚¹ã‚¯ -->
          <section>
            <h3 class="text-lg font-semibold text-orange-400 mb-3">æ½œåœ¨çš„ãªãƒªã‚¹ã‚¯ã¨æ³¨æ„ç‚¹</h3>
            
            <div class="space-y-3">
              <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-orange-300 mb-2">âš ï¸ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è²¬ä»»</h4>
                <p class="text-sm">ã‚·ã‚¹ãƒ†ãƒ ã¯Google Cloud Platformã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®èªè¨¼æƒ…å ±ã‚’é©åˆ‡ã«ç®¡ç†ã—ã€å®šæœŸçš„ãªæ¨©é™è¦‹ç›´ã—ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
              </div>

              <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-red-300 mb-2">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ç¯„å›²</h4>
                <p class="text-sm">ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è‡ªå‹•çš„ã«ç·¨é›†è€…æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šãƒ»æ›¸ãè¾¼ã¿ã‚’è¡Œã„ã¾ã™ãŒã€é©åˆ‡ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒãƒªã‚·ãƒ¼ã®éµå®ˆãŒé‡è¦ã§ã™ã€‚</p>
              </div>

              <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-yellow-300 mb-2">ğŸ”„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†</h4>
                <p class="text-sm">ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã¯ä¸€æ™‚çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™ãŒã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šæ‰±ã„ã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p>
              </div>

              <div class="bg-gray-700 border border-gray-500 rounded-lg p-4">
                <h4 class="font-semibold text-gray-300 mb-2">ğŸŒ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜</h4>
                <p class="text-sm">Google Cloud Platform ã¨Google Workspace ã‚µãƒ¼ãƒ“ã‚¹ã®å¯ç”¨æ€§ã«ä¾å­˜ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹éšœå®³æ™‚ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼å¤‰æ›´ã®å½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
              </div>
            </div>
          </section>

          <!-- æ¨å¥¨äº‹é … -->
          <section>
            <h3 class="text-lg font-semibold text-cyan-400 mb-3">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ã®æ¨å¥¨äº‹é …</h3>
            
            <ul class="space-y-2 text-sm">
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ”§</span>
                <span><strong>å®šæœŸçš„ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã®ç›£æŸ»:</strong> ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¨©é™ã‚’å®šæœŸçš„ã«ç¢ºèªã—ã€ä¸è¦ãªã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ¥</span>
                <span><strong>æ•™è‚²æ©Ÿé–¢ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã®åˆ©ç”¨:</strong> Google Workspace for Education ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼ˆçµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹åŸºæº–ãŒé©ç”¨ã•ã‚Œã¾ã™ï¼‰</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ›¡ï¸</span>
                <span><strong>ãƒ‡ãƒ¼ã‚¿æœ€å°åŒ–ã®åŸå‰‡:</strong> æ©Ÿå¯†æ€§ã®é«˜ã„å€‹äººæƒ…å ±ã®åé›†ã¯é¿ã‘ã€æ•™è‚²ç›®çš„ã«å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’æ‰±ã£ã¦ãã ã•ã„</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ”‘</span>
                <span><strong>èªè¨¼æƒ…å ±ã®ç®¡ç†:</strong> ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®å®šæœŸçš„ãªæ›´æ–°ï¼ˆå¹´1å›æ¨å¥¨ï¼‰ã¨ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®ç›£è¦–ã‚’è¡Œã£ã¦ãã ã•ã„</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ—‘ï¸</span>
                <span><strong>ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†:</strong> åˆ©ç”¨çµ‚äº†æ™‚ã¯ã€ä¸è¦ã«ãªã£ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€ãƒ•ã‚©ãƒ¼ãƒ ã€ãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ¨©é™ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">ğŸ“‹</span>
                <span><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:</strong> è©³ç´°ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦ã¯ã€<a href="/SECURITY.md" target="_blank" class="text-blue-400 hover:text-blue-300 underline">SECURITY.md</a> ã‚’ã”å‚ç…§ãã ã•ã„</span>
              </li>
            </ul>
          </section>
        </div>

        <div class="mt-6 pt-4 border-t border-gray-600">
          <button type="button" id="security-modal-confirm" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            ç†è§£ã—ã¾ã—ãŸ
          </button>
        </div>
      </div>
    </div>
  </div>

  <?! include('scripts/main.js.html'); ?>
  <?! include('scripts/AdminPanel.js.html'); ?>
</body>
</html>