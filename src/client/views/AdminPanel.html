<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <base target="_top">
  <title>みんなの回答ボード　管理パネル - StudyQuest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1a1b26" />
  <meta name="description" content="StudyQuestの回答ボード管理パネル - 直感的で使いやすい教育ツール" />
  <!-- User ID will be set by JavaScript to avoid template injection issues -->
  <meta name="user-id" content="" id="user-id-meta">
  
  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <?!= include('styles/AdminPanel.css.html'); ?>

</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans">
  <header class="glass-panel border-b border-gray-700 sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
      <div class="flex items-center justify-between">
        <!-- ロゴとタイトル -->
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
          </div>
          <div class="hidden sm:block">
            <h1 class="text-lg sm:text-xl font-bold text-white leading-tight">みんなの回答ボード　管理パネル</h1>
            <p class="text-xs text-gray-400">StudyQuest</p>
          </div>
          <div class="sm:hidden">
            <h1 class="text-lg font-bold text-white">みんなの回答ボード</h1>
          </div>
        </div>
        
        <!-- ドメイン・ステータス情報 -->
        <div class="flex items-center gap-2 sm:gap-3">
          <!-- ドメイン情報（Registration.htmlスタイル） -->
          <div id="header-domain-info">
            <!-- ドメイン一致表示（緑色パネル） -->
            <!-- ドメイン一致表示（Registration.htmlスタイル） -->
            <div id="header-domain-match" class="glass-panel bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-3 border border-green-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                  <div class="text-green-400 font-semibold text-sm" id="header-domain-match-text">G Suite ドメイン</div>
                  <div class="text-green-200 text-xs">セキュアアクセス有効</div>
                </div>
              </div>
            </div>
            
            <!-- ドメイン不一致表示（Registration.htmlスタイル） -->
            <div id="header-domain-mismatch" class="glass-panel bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-3 border border-yellow-400/30 hidden">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <div>
                  <div class="text-yellow-400 font-semibold text-sm" id="header-domain-mismatch-text">ドメイン不一致</div>
                  <div class="text-yellow-200 text-xs">アクセス制限あり</div>
                </div>
              </div>
            </div>
            
            <!-- 初期状態表示 -->
            <div id="header-domain-initial" class="glass-panel bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg p-3 border border-blue-400/30">
              <div class="flex items-center gap-2">
                <div id="header-status-dot" class="w-3 h-3 bg-blue-400 rounded-full animate-pulse flex-shrink-0"></div>
                <div>
                  <div class="text-blue-400 font-semibold text-sm" id="header-domain-name-initial">ドメイン確認中</div>
                  <div class="text-blue-200 text-xs" id="header-status-text-initial">セットアップ中</div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
  </header>
  <main class="flex-1 max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-8 pb-40">
    <!-- シンプル統合ステータスバー -->
    <section class="mb-4">
      <div class="glass-panel p-4 rounded-lg">
        <div class="flex items-center justify-between">
          <!-- 左側: ステータス表示 -->
          <div class="flex items-center gap-3">
            <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-white" id="guidance-text">セットアップを開始してください</span>
              <div class="text-xs text-gray-400 mt-1">3ステップで簡単セットアップ</div>
            </div>
          </div>
          
          <!-- 右側: コンパクトステップナビゲーション -->
          <div class="flex items-center gap-2">
            <div class="flex items-center gap-1" id="step-1-indicator">
              <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">1</div>
              <span class="text-xs text-gray-300 hidden sm:inline">データ準備</span>
            </div>
            <div class="w-4 h-px bg-gray-600"></div>
            <div class="flex items-center gap-1" id="step-2-indicator">
              <div class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">2</div>
              <span class="text-xs text-gray-300 hidden sm:inline">シート選択</span>
            </div>
            <div class="w-4 h-px bg-gray-600"></div>
            <div class="flex items-center gap-1" id="step-3-indicator">
              <div class="w-6 h-6 bg-gray-600 text-white rounded-full flex items-center justify-center font-bold text-xs transition-all">3</div>
              <span class="text-xs text-gray-300 hidden sm:inline">設定・公開</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- メインコンテンツエリア -->
    <div class="responsive-grid">
      <!-- 左側：セットアップフロー -->
      <div class="space-y-3 sm:space-y-4">
        
        <!-- ステップ1: データ準備 -->
        <div class="glass-panel p-4 sm:p-6" id="data-setup-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                1
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">データ準備</h2>
                <p class="text-xs text-gray-400">スプレッドシートまたはフォームを準備</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step1-content')" aria-expanded="true" aria-label="セクションを展開/折りたたみ">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step1-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step1-content" class="progressive-section expanded">
            <!-- 初心者向け：簡単作成 -->
            <div class="mb-6">
              <div class="google-integration p-4 rounded-xl text-white">
                <div class="flex items-center gap-3 mb-3">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  <h3 class="font-semibold">推奨：自動セットアップ</h3>
                </div>
                <p class="text-sm mb-4 opacity-90">GoogleフォームとスプレッドシートをWorkspace上で自動作成します</p>
                <div class="space-y-2">
                  <button type="button" id="create-board-btn" class="btn btn-google w-full">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span id="create-board-text">新しいボードを作成</span>
                  </button>
                  
                  <!-- 既存ユーザー向けの新しいフォーム作成 -->
                  <div id="existing-user-section" class="hidden">
                    <button type="button" id="create-additional-form-btn" class="btn btn-secondary w-full text-sm">
                      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      <span id="create-additional-form-text" class="text-gray-200">追加のフォームを作成</span>
                    </button>
                    <p class="text-xs text-gray-400 mt-1">現在のボードに連携する新しいフォームを作成</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 外部リソースの連携 (上級者向け) -->
            <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
              <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                </svg>
                外部リソースの連携 (上級者向け)
              </summary>
              <div class="p-4 pt-0 space-y-4">
                <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                  <label class="block text-sm font-medium text-purple-200 mb-2">
                    GoogleフォームまたはスプレッドシートのURL
                  </label>
                  <div class="space-y-3">
                    <input type="url" 
                           id="resource-url-input" 
                           placeholder="https://docs.google.com/forms/d/... または https://docs.google.com/spreadsheets/d/..."
                           class="form-control"
                           aria-describedby="resource-url-help">
                    <p id="resource-url-help" class="text-xs text-purple-300 mt-1">
                      既存のGoogleフォームまたはスプレッドシートのURLを貼り付けてください
                    </p>
                    <div class="flex gap-2">
                      <button type="button" id="add-resource-btn" class="btn btn-primary flex-1">
                        <span id="add-resource-text">リソースを追加</span>
                      </button>
                      <button type="button" id="open-resource-btn" class="btn btn-secondary px-3" disabled title="フォームまたはスプレッドシートを開く">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                        <span id="open-resource-text" class="ml-1 text-xs hidden sm:inline">開く</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </details>
            
            <!-- 作成されたリソース表示 -->
            <div class="space-y-3 hidden" id="form-url-section">
              <div class="success-state">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span class="font-medium">フォームが作成されました</span>
                </div>
                <div class="flex gap-2">
                  <input type="url" id="form-url-input" class="form-control flex-1 text-sm" readonly placeholder="フォームURLが生成されます">
                  <button type="button" id="copy-form-url-btn" class="btn btn-secondary" title="URLをコピー">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                  </button>
                  <a id="open-form-url-link" href="#" target="_blank" class="btn btn-secondary" title="フォームを開く">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ステップ2: シート選択 -->
        <div class="glass-panel p-4 sm:p-6" id="sheet-selection-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                2
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">シート選択</h2>
                <p class="text-xs text-gray-400">表示したいシートを選択</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step2-content')" aria-expanded="true" aria-label="セクションを展開/折りたたみ">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step2-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step2-content" class="progressive-section expanded">
            <div class="space-y-4">
              <div class="space-y-3">
                <!-- シート選択の説明 -->
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                  <div class="flex items-center gap-2 mb-2">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <span class="text-sm font-medium text-green-200">シート選択</span>
                  </div>
                  <p class="text-xs text-green-300">スプレッドシートのシートを回答ボードとして表示するシートに指定します</p>
                </div>
                
                <!-- シンプルシート選択 -->
                <label for="sheet-select" class="block text-sm font-medium text-white">
                  表示したいシートを選択
                </label>
                <div class="flex gap-2">
                    <select id="sheet-select" class="form-control flex-1" aria-describedby="sheet-help">
                      <option>読み込み中...</option>
                    </select>
                    <button type="button" id="open-spreadsheet-btn" class="btn btn-secondary px-3" title="スプレッドシートを開く">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ステップ3: 設定・公開 -->
        <div class="glass-panel p-4 sm:p-6" id="config-section">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl flex items-center justify-center font-bold text-sm shadow-lg">
                3
              </div>
              <div>
                <h2 class="text-lg font-semibold text-white">設定・公開</h2>
                <p class="text-xs text-gray-400">列設定を行い公開</p>
              </div>
            </div>
            <button type="button" class="toggle-section" onclick="toggleSection('step3-content')" aria-expanded="true" aria-label="セクションを展開/折りたたみ">
              <svg class="w-5 h-5 text-gray-400 transition-transform" id="step3-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
          </div>
          
          <div id="step3-content" class="progressive-section expanded">
            <div id="config-area" class="space-y-4 hidden">
              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <div class="flex items-center gap-2 mb-2">
                  <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span class="text-sm font-medium text-purple-200">列マッピング設定</span>
                </div>
                <p class="text-xs text-purple-300">スプレッドシートの列を回答ボードの項目に割り当てます</p>
              </div>
              
              <!-- 必須設定 -->
              <div class="space-y-4">
                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                  <label class="block">
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-sm font-medium text-white">回答データ列</span>
                      <span class="px-2 py-1 bg-red-500 text-white text-xs rounded-full">必須</span>
                    </div>
                    <div class="flex gap-2">
                      <select id="opinionHeader" class="form-control flex-1" aria-describedby="main-help"></select>
                      <button type="button" id="reguess-headers-btn" class="btn btn-secondary px-3 py-2" title="列を自動で再判定します">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                      </button>
                    </div>
                    <p id="main-help" class="text-xs text-red-300 mt-1">
                      回答内容が含まれる列を選択してください
                    </p>
                  </label>
                </div>
                
                <!-- オプション設定 -->
                <details class="bg-gray-800/30 border border-gray-600/30 rounded-xl">
                  <summary class="p-4 cursor-pointer text-sm font-medium text-gray-300 hover:text-white flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                    </svg>
                    オプション設定（任意）
                  </summary>
                  <div class="p-4 pt-0 space-y-4" id="detail-options">
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">理由・詳細列</span>
                      <select id="reasonHeader" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">名前列</span>
                      <select id="nameHeader" class="form-control"></select>
                    </label>
                    <label class="block">
                      <span class="text-sm text-gray-300 mb-2 block">クラス列</span>
                      <select id="classHeader" class="form-control"></select>
                    </label>
                    <div class="flex items-center mt-4">
                      <input type="checkbox" id="showNames" name="showNames" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="showNames" class="ml-2 block text-sm text-gray-300">名前を表示する</label>
                    </div>
                    <div class="flex items-center mt-2">
                      <input type="checkbox" id="showCounts" name="showCounts" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                      <label for="showCounts" class="ml-2 block text-sm text-gray-300">リアクション数を表示する</label>
                    </div>
                  </div>
                </details>
              </div>
              
              <button type="button" id="save-config-btn" disabled class="btn btn-primary w-full">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                </svg>
                <span id="save-config-text">設定を保存</span>
              </button>
            </div>
            
            <div id="config-placeholder" class="text-center py-8">
              <div class="w-12 h-12 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                <div class="loading-skeleton w-full h-full rounded-full hidden" id="config-loading"></div>
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                </svg>
              </div>
              <p class="text-gray-400 text-sm">シートを選択すると列設定が表示されます</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 右側：情報・ヘルプパネル -->
      <div class="space-y-4 sm:space-y-6">
        
        <!-- 使い方ガイド -->
        <div class="glass-panel p-4 sm:p-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-8 h-8 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
              </svg>
            </div>
            <h3 class="font-semibold text-amber-400">使い方ガイド</h3>
          </div>
          
          <div class="space-y-4">
            <!-- 基本フロー -->
            <div class="bg-amber-900/20 border border-amber-500/30 rounded-lg p-4">
              <h4 class="font-medium text-amber-200 mb-3 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                基本の流れ
              </h4>
              <ol class="list-decimal list-inside space-y-2 text-xs text-amber-100">
                <li>データ準備：フォーム作成またはスプレッドシート追加</li>
                <li>シート選択：表示したいシートを選択</li>
                <li>設定・公開：列設定を行い回答ボードを公開</li>
              </ol>
            </div>
            
            <!-- Google連携の利点 -->
            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
              <h4 class="font-medium text-green-200 mb-3 flex items-center gap-2">
                <svg class="w-4 h-4" viewBox="0 0 24 24">
                  <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285f4"/>
                  <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34a853"/>
                  <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#fbbc05"/>
                  <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#ea4335"/>
                </svg>
                Google連携の利点
              </h4>
              <ul class="list-disc list-inside space-y-1 text-xs text-green-100">
                <li>自動でフォームとシートを作成</li>
                <li>リアルタイムでデータを同期</li>
                <li>複数のクラスで同時利用可能</li>
                <li>セキュアで安全なデータ管理 
                  <button type="button" id="security-info-btn" class="ml-2 text-blue-400 hover:text-blue-300 underline text-xs">
                    セキュリティについて詳しく
                  </button>
                </li>
              </ul>
            </div>
            
            <!-- デジタルシティズンシップガイド -->
            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
              <h4 class="font-medium text-blue-200 mb-3 flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
                デジタルシティズンシップ
              </h4>
              <p class="text-xs text-blue-100 mb-3">責任あるデジタル利用と指導のポイントを確認しましょう</p>
              <button type="button" id="show-digital-citizenship-guide" class="btn btn-secondary w-full text-sm py-2">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                指導ガイドを開く
              </button>
            </div>
            
          </div>
        </div>
        
        <div class="space-y-4 sm:space-y-6">

  <div id="system-info-panel" class="glass-panel p-4 sm:p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="w-8 h-8 bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl flex items-center justify-center">
        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
      </div>
      <h3 class="font-semibold text-gray-300">システム状況</h3>
    </div>

    <div class="space-y-4">
      <!-- アカウント情報 -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          アカウント
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">メールアドレス:</span>
            <span class="text-white font-medium" id="info-admin-email">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">ユーザーID:</span>
            <span class="text-white font-mono text-xs bg-gray-700 px-1.5 py-0.5 rounded" id="info-user-id">-</span>
          </div>
          <div class="text-right pt-2">
            <a href="#" onclick="switchToAnotherAccount(); return false;" class="text-cyan-400 hover:text-cyan-300 hover:underline text-xs">
              別のアカウントでログイン
            </a>
          </div>
        </div>
      </div>

      <!-- 公開設定 -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          公開設定
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">公開状態:</span>
            <span class="px-2 py-1 rounded text-xs font-medium" id="info-publish-status">
              <span class="inline-flex items-center gap-1">
                <div class="w-2 h-2 rounded-full" id="info-publish-indicator"></div>
                <span id="info-publish-text">確認中</span>
              </span>
            </span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">公開シート:</span>
            <span class="text-white font-semibold" id="info-published-sheet">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">表示モード:</span>
            <span class="text-white" id="info-display-mode">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">カウント表示:</span>
            <span class="text-white" id="info-show-counts">-</span>
          </div>
        </div>
      </div>

      <!-- データ状況 -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          データ状況
        </h4>
        <div class="space-y-2 text-xs">
          <div class="flex justify-between items-center">
            <span class="text-gray-400">総回答数:</span>
            <span class="text-white font-bold text-lg" id="info-answer-count">-</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-gray-400">総リアクション数:</span>
            <span class="text-white font-bold text-lg" id="info-reaction-count">-</span>
          </div>
        </div>
      </div>

      <!-- リソース -->
      <div class="bg-gray-800/30 border border-gray-600/30 rounded-lg p-4">
        <h4 class="text-sm font-medium text-gray-200 mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
          </svg>
          リソース
        </h4>
        <div class="space-y-3 text-xs">
          <div class="flex gap-2">
            <button type="button" id="open-spreadsheet-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              スプレッドシート
            </button>
            <button type="button" id="open-form-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded flex items-center justify-center gap-2 transition-all" disabled>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              フォーム
            </button>
          </div>
        </div>
      </div>
      
      <details class="bg-red-900/10 border border-red-500/30 rounded-lg transition-all hover:border-red-500/50">
        <summary class="p-3 cursor-pointer text-sm font-medium text-red-300 hover:text-red-200 flex items-center justify-between">
          <span>アカウントの管理</span>
          <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </summary>
        <div class="p-3 pt-0">
          <p class="text-xs text-red-200/80 mb-3">
            この操作は元に戻せません。アカウントを削除すると、作成したすべてのボードと設定が完全に消去されます。
          </p>
          <button type="button" id="delete-account-btn" class="btn btn-danger w-full text-sm py-2">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            <span>自分のアカウントを完全に削除する</span>
          </button>
        </div>
      </details>
    </div>
  </div>
  </div>
      </div>
    </div>
  </main>
  
  <!-- 統合フッター -->
  <footer id="admin-footer" class="fixed bottom-0 left-0 right-0 glass-panel border-t border-gray-700 hidden">
    <div class="max-w-6xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <!-- 左側: 公開中の問題文 -->
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-1">
            <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="text-green-400 font-semibold text-sm">公開中:</span>
          </div>
          <p class="text-blue-300 font-medium text-lg" id="current-topic-text">読み込み中...</p>
        </div>
        
        <!-- 右側: ボードURL操作 -->
        <div class="flex items-center gap-3">
          <input type="text" id="board-url" readonly
                 class="px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-sm cursor-pointer hover:bg-gray-700 focus:ring-2 focus:ring-green-400 min-w-[300px]"
                 onclick="this.select()" placeholder="URLが生成されます">
          <button type="button" onclick="copyBoardUrl()" class="btn btn-secondary px-3 py-2 flex items-center" title="URLをコピー" aria-label="生徒用URLをコピー">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
          </button>
          <a id="view-board-link" href="#" target="_blank" rel="noopener noreferrer" class="btn btn-primary px-3 py-2 flex items-center" title="回答ボードを開く" aria-label="新しいタブで回答ボードを開く">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </footer>
  <div id="message-area" class="fixed top-20 right-6 z-50" aria-live="polite" role="status"></div>
  <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
    <div class="glass-panel p-8 rounded-xl max-w-md w-full slide-up">
      <h3 id="modal-title" class="text-xl font-bold text-cyan-400 mb-4"></h3>
      <p id="modal-message" class="text-gray-300 mb-6"></p>
      <div class="flex justify-end gap-4">
        <button type="button" id="modal-cancel-btn" class="btn btn-secondary">キャンセル</button>
        <button type="button" id="modal-confirm-btn" class="btn btn-primary">はい、実行します</button>
      </div>
    </div>
  </div>

  <!-- 公開選択モーダル -->
  <div id="publish-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
    <div class="glass-panel p-8 rounded-xl max-w-md w-full slide-up">
      <h3 class="text-xl font-bold text-cyan-400 mb-4">📋 設定保存完了</h3>
      <p class="text-gray-300 mb-6">設定が正常に保存されました。<br>回答ボードを公開しますか？</p>
      <div class="space-y-3 mb-6">
        <div class="bg-gray-800/50 p-3 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
            <span class="text-sm text-gray-300">公開する：生徒がボードにアクセス可能</span>
          </div>
        </div>
        <div class="bg-gray-800/50 p-3 rounded-lg">
          <div class="flex items-center">
            <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
            <span class="text-sm text-gray-300">非公開：設定のみ保存（後で公開可能）</span>
          </div>
        </div>
      </div>
      <div class="flex justify-end gap-4">
        <button type="button" id="publish-modal-private-btn" class="btn btn-secondary">非公開のまま</button>
        <button type="button" id="publish-modal-publish-btn" class="btn btn-primary">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          公開する
        </button>
      </div>
    </div>
  </div>

  <!-- 自動プライバシー機能モーダル -->
  <div id="privacy-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="glass-panel p-8 max-w-2xl w-full mx-4 relative">
      <div class="flex items-center mb-6">
        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-white">🔒 自動プライバシー機能とセキュリティ</h3>
      </div>
      
      <div class="text-gray-300 mb-6 space-y-4">
        <p class="text-lg font-medium text-blue-300">みんなの回答ボードのプライバシー保護機能についてご説明します。</p>
        
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-white mb-2">🔄 自動非公開システム</h4>
          <p>ボードは<strong class="text-yellow-300">6時間後に自動で非公開</strong>になります。これにより、データの意図しない公開を防いでいます。</p>
        </div>
        
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-white mb-2">🔐 アクセス制御</h4>
          <p>ボードへのアクセスは、<strong class="text-green-300">授業で使用するドメインとGoogleアカウントのみ</strong>に制限されます。</p>
        </div>
        
        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-white mb-2">👥 匿名性の保護</h4>
          <p>生徒のプライバシーを守るため、<strong class="text-purple-300">回答は匹名で表示</strong>されます。名前表示は先生が選択できます。</p>
        </div>

        <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
          <h4 class="font-semibold text-white mb-2">📊 データ所有権とサービスアカウント</h4>
          <p class="mb-2">
            生徒の回答データが保存されるGoogleスプレッドシートは、<strong class="text-blue-300">アプリケーションをデプロイした管理者（あなた）が所有者</strong>となります。
          </p>
          <p class="mb-2">
            アプリケーションは、Googleの<strong class="text-blue-300">サービスアカウント</strong>という「ボット」のような仕組みを利用して、あなたのスプレッドシートにのみデータ（回答やリアクション）の読み書きを行います。
          </p>
          <p>
            このサービスアカウントによるアクセスは、厳格な権限設定に基づいており、<strong class="text-blue-300">他の一般ユーザーが直接あなたのスプレッドシートのデータを見ることはできません</strong>。データは安全に保護されています。
          </p>
        </div>

        <div class="bg-green-900 bg-opacity-30 border border-green-500 p-4 rounded-lg">
          <h4 class="font-semibold text-green-300 mb-2">✅ デジタルシティズンシップの実践</h4>
          <p>これらの機能は、生徒が安心して意見を交換できるデジタル環境を提供し、責任あるオンライン行動を学ぶためのものです。</p>
        </div>
      </div>
      
      <div class="flex justify-end gap-4">
        <button type="button" id="privacy-modal-cancel" class="btn btn-secondary">キャンセル</button>
        <button type="button" id="privacy-modal-continue" class="btn btn-primary">理解しました、継続</button>
      </div>
    </div>
  </div>

  <!-- デジタルシティズンシップ指導モーダル -->
  <div id="digital-citizenship-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="glass-panel p-8 max-w-4xl w-full mx-4 relative max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-white">🌐 デジタルシティズンシップ教育ガイド</h3>
        </div>
        <button type="button" id="digital-citizenship-modal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-300">
        <!-- デジタルシティズンシップの重要性 -->
        <div class="bg-gradient-to-r from-blue-900/30 to-purple-900/30 border border-blue-500/30 rounded-lg p-6">
          <h4 class="text-xl font-semibold text-blue-300 mb-4">📚 デジタルシティズンシップとは</h4>
          <p class="mb-4">デジタル技術を責任を持って適切に使用するための知識、スキル、態度です。</p>
          <div class="grid md:grid-cols-2 gap-4">
            <div class="bg-blue-800/20 p-4 rounded-lg">
              <h5 class="font-semibold text-blue-200 mb-2">🛡️ セキュリティとプライバシー</h5>
              <p class="text-sm">個人情報やデジタル足跡を守る方法を学びます。</p>
            </div>
            <div class="bg-purple-800/20 p-4 rounded-lg">
              <h5 class="font-semibold text-purple-200 mb-2">🤝 デジタルコミュニケーション</h5>
              <p class="text-sm">オンラインでの適切なコミュニケーション方法を習得します。</p>
            </div>
          </div>
        </div>
        
        <!-- みんなの回答ボードでの実践 -->
        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-6">
          <h4 class="text-xl font-semibold text-green-300 mb-4">🌱 みんなの回答ボードでの実践</h4>
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center mt-1">
                <span class="text-green-300 font-semibold">1</span>
              </div>
              <div>
                <h5 class="font-semibold text-green-200">尊重と共感</h5>
                <p class="text-sm text-gray-300">他の人の意見を尊重し、共感を示すことを学びます。</p>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center mt-1">
                <span class="text-green-300 font-semibold">2</span>
              </div>
              <div>
                <h5 class="font-semibold text-green-200">建設的なフィードバック</h5>
                <p class="text-sm text-gray-300">「いいね！」「なるほど！」等のリアクションでポジティブな交流を促進します。</p>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div class="w-8 h-8 bg-green-500/20 rounded-full flex items-center justify-center mt-1">
                <span class="text-green-300 font-semibold">3</span>
              </div>
              <div>
                <h5 class="font-semibold text-green-200">プライバシーの理解</h5>
                <p class="text-sm text-gray-300">名前表示の選択や個人情報の扱いについて考えます。</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 指導のポイント -->
        <div class="bg-amber-900/20 border border-amber-500/30 rounded-lg p-6">
          <h4 class="text-xl font-semibold text-amber-300 mb-4">🌟 指導のポイント</h4>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <h5 class="font-semibold text-amber-200 mb-2">事前指導</h5>
              <ul class="list-disc list-inside space-y-1 text-sm text-gray-300">
                <li>オンラインでのルールとマナーの確認</li>
                <li>プライバシー設定の重要性</li>
                <li>建設的なコメントの例示</li>
              </ul>
            </div>
            <div>
              <h5 class="font-semibold text-amber-200 mb-2">活動中のサポート</h5>
              <ul class="list-disc list-inside space-y-1 text-sm text-gray-300">
                <li>生徒の投稿をモニタリング</li>
                <li>適切なフィードバックの提供</li>
                <li>デジタルエチケットの実践例を示す</li>
              </ul>
            </div>
          </div>
        </div>
        
        <!-- リソース -->
        <div class="bg-gray-800/50 border border-gray-600 rounded-lg p-6">
          <h4 class="text-xl font-semibold text-gray-200 mb-4">📚 参考リソース</h4>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <h5 class="font-semibold text-gray-300 mb-2">文部科学省のガイドライン</h5>
              <p class="text-sm text-gray-400">「GIGAスクール構想」における情報モラル教育の取り組み</p>
            </div>
            <div>
              <h5 class="font-semibold text-gray-300 mb-2">デジタルシティズンシップ教育</h5>
              <p class="text-sm text-gray-400">適切なデジタル技術の活用と情報モラルの育成</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex justify-end mt-6">
        <button type="button" id="digital-citizenship-modal-close-btn" class="btn btn-primary">理解しました</button>
      </div>
    </div>
  </div>


  <!-- セキュリティ情報モーダル -->
  <div id="security-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-gray-800 rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-white">セキュリティ対策について</h2>
          <button type="button" id="security-modal-close" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div class="space-y-6 text-gray-300">
          <!-- セキュリティ対策の概要 -->
          <section>
            <h3 class="text-lg font-semibold text-green-400 mb-3">実装されているセキュリティ対策</h3>
            
            <div class="space-y-4">
              <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-green-300 mb-2">🔐 Google サービスアカウント認証</h4>
                <p class="text-sm">Google Cloud Platform (GCP) のサービスアカウントを使用したJWT (JSON Web Token) ベースの認証。RSA-SHA256 署名により、最高レベルのセキュリティを確保しています。ユーザーの認証情報は一切保存されません。</p>
              </div>

              <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-blue-300 mb-2">🏗️ Google Apps Script プラットフォーム</h4>
                <p class="text-sm">Googleの公式プラットフォーム上で動作し、Google Cloudのエンタープライズグレードのセキュリティ基盤を活用。データはGoogle Driveに暗号化されて保存され、Googleのセキュリティポリシーとコンプライアンス基準が適用されます。</p>
              </div>

              <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-purple-300 mb-2">🛡️ スコープ制限とアクセス制御</h4>
                <p class="text-sm">Google Sheets API とGoogle Drive API への限定的なアクセスのみを使用。サービスアカウントは自動的にユーザーのスプレッドシートに編集者権限を付与しますが、他のデータにはアクセスできません。</p>
              </div>

              <div class="bg-teal-900/20 border border-teal-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-teal-300 mb-2">⚡ 自動トークン管理</h4>
                <p class="text-sm">アクセストークンは3500秒のTTL（Time To Live）で安全にキャッシュされ、自動的にリフレッシュされます。期限切れや不正なトークンによるセキュリティリスクを防止します。</p>
              </div>

              <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-yellow-300 mb-2">ドメイン制限</h4>
                <p class="text-sm">教育機関ドメインでの利用時、同一ドメイン内でのみデータアクセスが可能。組織外からの不正アクセスを防止します。</p>
              </div>

              <div class="bg-indigo-900/20 border border-indigo-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-indigo-300 mb-2">データ暗号化</h4>
                <p class="text-sm">HTTPS通信による暗号化、Google Driveの保存時暗号化を活用。転送中および保存中のデータを保護します。</p>
              </div>
            </div>
          </section>

          <!-- 潜在的なリスク -->
          <section>
            <h3 class="text-lg font-semibold text-orange-400 mb-3">潜在的なリスクと注意点</h3>
            
            <div class="space-y-3">
              <div class="bg-orange-900/20 border border-orange-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-orange-300 mb-2">⚠️ サービスアカウントの管理責任</h4>
                <p class="text-sm">システムはGoogle Cloud Platformのサービスアカウントを使用してデータにアクセスします。システム管理者は、サービスアカウントの認証情報を適切に管理し、定期的な権限見直しを行う必要があります。</p>
              </div>

              <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-red-300 mb-2">📊 データアクセス範囲</h4>
                <p class="text-sm">サービスアカウントはユーザーのスプレッドシートに自動的に編集者権限を付与します。これにより、システムがデータの読み取り・書き込みを行いますが、適切なデータ管理ポリシーの遵守が重要です。</p>
              </div>

              <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                <h4 class="font-semibold text-yellow-300 mb-2">🔄 キャッシュとトークン管理</h4>
                <p class="text-sm">アクセストークンとユーザーデータは一時的にキャッシュされます。セキュリティ強化のため、キャッシュは自動的に無効化されますが、機密データの取り扱いには注意が必要です。</p>
              </div>

              <div class="bg-gray-700 border border-gray-500 rounded-lg p-4">
                <h4 class="font-semibold text-gray-300 mb-2">🌐 クラウドサービス依存</h4>
                <p class="text-sm">Google Cloud Platform とGoogle Workspace サービスの可用性に依存します。サービス障害時は利用できません。また、Googleのセキュリティポリシー変更の影響を受ける可能性があります。</p>
              </div>
            </div>
          </section>

          <!-- 推奨事項 -->
          <section>
            <h3 class="text-lg font-semibold text-cyan-400 mb-3">セキュリティ強化のための推奨事項</h3>
            
            <ul class="space-y-2 text-sm">
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">🔧</span>
                <span><strong>定期的なアクセス権限の監査:</strong> スプレッドシートの共有設定とサービスアカウント権限を定期的に確認し、不要なアクセス権限を削除してください</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">🏫</span>
                <span><strong>教育機関ドメインでの利用:</strong> Google Workspace for Education アカウントでの利用を推奨します（組織のセキュリティポリシーとコンプライアンス基準が適用されます）</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">🛡️</span>
                <span><strong>データ最小化の原則:</strong> 機密性の高い個人情報の収集は避け、教育目的に必要最小限のデータのみを扱ってください</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">🔑</span>
                <span><strong>認証情報の管理:</strong> サービスアカウントキーの定期的な更新（年1回推奨）と、アクセスログの監視を行ってください</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">🗑️</span>
                <span><strong>データライフサイクル管理:</strong> 利用終了時は、不要になったスプレッドシート、フォーム、およびサービスアカウント権限を削除してください</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-cyan-400 mt-1">📋</span>
                <span><strong>セキュリティドキュメント:</strong> 詳細なセキュリティガイドについては、<a href="/SECURITY.md" target="_blank" class="text-blue-400 hover:text-blue-300 underline">SECURITY.md</a> をご参照ください</span>
              </li>
            </ul>
          </section>
        </div>

        <div class="mt-6 pt-4 border-t border-gray-600">
          <button type="button" id="security-modal-confirm" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            理解しました
          </button>
        </div>
      </div>
    </div>
  </div>

  <?!= include('scripts/AdminPanel.js.html'); ?>
</body>
</html>
