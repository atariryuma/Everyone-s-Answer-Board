<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>GenericBoard - ã¿ã‚“ãªã®ã‹ã„ã¨ã†ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <?!= include('SharedSecurityHeaders'); ?>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
  <noscript><link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" /></noscript>
  <link rel="dns-prefetch" href="//script.google.com" />
  <link rel="preconnect" href="https://script.google.com" crossorigin />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
  <?!= include('SharedTailwindConfig'); ?>
  <style>
:root{--color-primary:#8be9fd;--color-primary-dark:#6272a4;--color-background:#1a1b26;--color-surface:rgba(26,27,38,0.7);--color-text:#c0caf5;--color-text-secondary:#6272a4;--color-text-muted:rgba(255,255,255,0.6);--color-border:rgba(255,255,255,0.1);--color-accent:#facc15;--color-success:#50fa7b;--color-warning:#ffb86c;--color-error:#ff5555;--duration-fast:0.2s;--duration-normal:0.3s;--duration-slow:0.5s;--ease-out:cubic-bezier(0.25,0.46,0.45,0.94);--ease-in-out:cubic-bezier(0.645,0.045,0.355,1);--border-radius:0.75rem;--border-radius-lg:1rem;--shadow-sm:0 1px 2px rgba(0,0,0,0.05);--shadow-md:0 4px 6px rgba(0,0,0,0.1);--shadow-lg:0 10px 15px rgba(0,0,0,0.1);--shadow-glow:0 0 15px var(--color-primary);--glass-bg:var(--color-surface);--glass-border:1px solid var(--color-border);--glass-blur:blur(12px);--transition-duration:0.2s;--transition-easing:ease-out;--animation-duration:0.3s;--backdrop-blur:12px}body{color:var(--color-text);background-color:var(--color-background);margin:0;overflow-x:hidden}.glass-panel{background:var(--glass-bg);-webkit-backdrop-filter:var(--glass-blur);backdrop-filter:var(--glass-blur);border:var(--glass-border);transition:border-color var(--transition-duration) var(--transition-easing)}.glass-panel:hover{border-color:rgba(255,255,255,0.2)}.interactive-element{transition:all var(--duration-fast) var(--ease-out);border-radius:var(--border-radius)}.game-font{font-family:'Press Start 2P',cursive}.game-btn{transition:all var(--duration-fast) var(--ease-out);border-radius:var(--border-radius);border-bottom-width:4px;text-shadow:1px 1px 2px rgba(0,0,0,0.4);position:relative;overflow:hidden}.game-btn:not(:disabled):hover{transform:translateY(-2px) scale(1.02);box-shadow:var(--shadow-glow)}.game-btn:active:not(:disabled){transform:translateY(2px);border-bottom-width:2px;box-shadow:none}.game-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none!important}#classFilter,#sortOrder{background-color:var(--color-primary-dark);border:var(--glass-border);color:var(--color-text);border-radius:var(--border-radius);padding:0.25rem 0.5rem;transition:border-color var(--transition-duration) var(--transition-easing),box-shadow var(--transition-duration) var(--transition-easing)}#classFilter:focus,#sortOrder:focus{border-color:rgba(6,182,212,0.5);box-shadow:0 0 0 2px rgba(6,182,212,0.2);outline:none}:focus-visible{outline:3px solid var(--color-primary);outline-offset:2px;border-radius:var(--border-radius)}header{position:sticky;top:0;z-index:50;contain:layout;-webkit-backdrop-filter:blur(var(--backdrop-blur));backdrop-filter:blur(var(--backdrop-blur))}.line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}@media (min-width:768px) and (max-width:1023px){#headingLabel{font-size:1.25rem!important}}#formAnswerBtn{transition:all 0.2s ease-out}#formAnswerBtn:hover{transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,0.15)}#answerCount{transition:background-color 0.2s ease-out}#answerCount:hover{background-color:rgba(55,65,81,0.5)}.answer-card{will-change:transform,opacity;transition:all var(--duration-normal) var(--ease-out);border-radius:var(--border-radius-lg);contain:layout style;position:relative;overflow:hidden}.answer-card.highlighted{border:4px solid transparent;border-image:none!important;box-shadow:0 0 15px rgba(250,204,21,0.6);transform:scale(1.02);z-index:2;background:linear-gradient(var(--glass-bg),var(--glass-bg)) padding-box,linear-gradient(90deg,var(--color-accent),var(--color-primary)) border-box;background-clip:padding-box,border-box;position:relative}.answer-card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 8px 25px rgba(139,233,253,0.3)}.answer-card:focus-visible{transform:translateY(-4px) scale(1.02);box-shadow:0 8px 25px rgba(139,233,253,0.3)}.answer-card.highlighted:hover{transform:translateY(-4px) scale(1.04)}.answer-card.loading{opacity:0.7;pointer-events:none}.reaction-btn{transition:transform var(--transition-duration) var(--transition-easing),background-color var(--transition-duration) var(--transition-easing),box-shadow var(--transition-duration) var(--transition-easing);position:relative;overflow:hidden}.reaction-btn:hover{transform:scale(1.1)}.reaction-btn:active{transform:scale(0.95)}.reaction-btn.reacted{background-color:var(--color-primary)!important;color:#000!important;box-shadow:0 0 10px rgba(139,233,253,0.5)}.reaction-btn.liked{background-color:var(--color-primary)!important;color:#000!important;box-shadow:0 0 10px rgba(139,233,253,0.5)}.reaction-btn.loading{opacity:0.6;pointer-events:none}.fade-in{animation:fadeIn 0.5s ease-out}.slide-in{animation:slideIn 0.3s ease-out}.pulse{animation:pulse 0.6s ease-out}.shake{animation:shake 0.5s ease-out}.admin-toggle{transition:background-color var(--animation-duration) var(--transition-easing);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.admin-toggle:hover{background-color:rgba(139,233,253,0.1)}.loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(26,27,38,0.8);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000}.spinner{width:40px;height:40px;border:4px solid rgba(139,233,253,0.3);border-top:4px solid var(--color-primary);border-radius:50%;animation:spin 1s linear infinite}@keyframes fadeIn{from{opacity:0;will-change:opacity}to{opacity:1}}@keyframes slideIn{from{opacity:0;will-change:opacity}to{opacity:1}}@keyframes pulse{0%{will-change:transform}50%{transform:scale3d(1.05,1.05,1)}100%{transform:scale3d(1,1,1)}}@keyframes shake{0%,100%{will-change:transform}25%{transform:translate3d(-5px,0,0)}75%{transform:translate3d(5px,0,0)}}@keyframes spin{100%{transform:rotate(360deg);will-change:transform}}@keyframes bounce{0%,20%,50%,80%,100%{transform:translate(-50%,0) translateY(0)}40%{transform:translate(-50%,0) translateY(-10px)}60%{transform:translate(-50%,0) translateY(-5px)}}@media (min-resolution:120dpi) and (min-width:1200px){:root{--transition-duration:0.15s;--animation-duration:0.2s}}@media (prefers-contrast:high){:root{--color-border:rgba(255,255,255,0.3);--color-surface:rgba(26,27,38,0.98)}}@media (prefers-reduced-motion:reduce){:root{--transition-duration:0.01ms;--animation-duration:0.01ms;--backdrop-blur:0px}*,*::before,*::after{animation-duration:0.01ms!important;animation-iteration-count:1!important;transition-duration:0.01ms!important;transform:none!important}.answer-card:hover,.reaction-btn:hover,.game-btn:hover{transform:none!important}}.highlight-badge{position:absolute;top:0.25rem;right:0.25rem;width:1.5rem;height:1.5rem;display:flex;align-items:center;justify-content:center;color:#facc15;filter:drop-shadow(0 0 4px rgba(250,204,21,0.7))}.answer-card.reaction-bg-like{border-color:#ef4444!important;border-image:none!important}.answer-card.reaction-bg-understand{border-color:#fbbf24!important;border-image:none!important}.answer-card.reaction-bg-curious{border-color:#10b981!important;border-image:none!important}.reaction-bg-like-understand,.reaction-bg-like-curious,.reaction-bg-understand-curious,.reaction-bg-all{border-color:transparent;border-style:solid;background:var(--glass-bg);border-image-slice:1;border-image-source:linear-gradient(90deg,#ef4444,#fbbf24)}.reaction-bg-like-curious{border-image-source:linear-gradient(90deg,#ef4444,#10b981)}.reaction-bg-understand-curious{border-image-source:linear-gradient(90deg,#fbbf24,#10b981)}.reaction-bg-all{border-image-source:linear-gradient(90deg,#ef4444,#fbbf24,#10b981)}.reaction-border-1{border-width:2px}.reaction-border-2{border-width:4px}.reaction-border-3{border-width:6px}.answer-preview{display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;min-height:120px}.highlight-btn{transition:all 0.2s ease;border-radius:4px;padding:2px}.highlight-btn:hover{background:rgba(250,204,21,0.1);transform:scale(1.1)}.highlight-btn.liked{color:#facc15;filter:drop-shadow(0 0 4px rgba(250,204,21,0.7))}#controlsFooter{pointer-events:none}#controlsFooter>.glass-panel{pointer-events:auto}.skeleton{position:relative;overflow:hidden;background-color:rgba(255,255,255,0.05);color:transparent}.skeleton::after{content:"";position:absolute;inset:0;background-image:linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,0.3),rgba(255,255,255,0));animation:skeleton-loading 1.2s infinite}@keyframes skeleton-loading{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans">
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="text-center">
      <div class="spinner"></div>
      <p class="mt-4 text-gray-300">èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
  </div>

  <div id="main-container" class="w-full mx-auto px-4 pt-4 pb-4 md:px-6 md:pt-6 md:pb-6">
    <header id="main-header" class="glass-panel rounded-xl p-4 mb-4 shadow-lg fade-in">
      <div class="flex items-center justify-between gap-4 py-2">
        <div class="flex items-center gap-3">
          <div id="answerCount" class="text-sm text-gray-400 flex items-center gap-2 flex-shrink-0">
            <span class="w-4 h-4 text-blue-400">ğŸ‘¥</span>
            <span id="answerCountText">0ä»¶</span>
          </div>
          <a id="formAnswerBtn" href="#" target="_blank" rel="noopener noreferrer" class="text-xs bg-green-600 hover:bg-green-700 text-white font-medium px-3 py-1.5 rounded-md whitespace-nowrap transition-all flex items-center gap-1.5 shadow-sm no-underline" aria-label="ãƒ•ã‚©ãƒ¼ãƒ ã§å›ç­”" role="button">
            <span class="w-3 h-3">âœï¸</span>
            ãƒ•ã‚©ãƒ¼ãƒ ã§å›ç­”
          </a>
          <div class="flex items-center gap-2">
            <label for="classFilter" class="sr-only">ã‚¯ãƒ©ã‚¹çµã‚Šè¾¼ã¿</label>
            <select id="classFilter" class="hidden text-sm bg-gray-800/50 border border-gray-600 text-gray-300 px-3 py-1.5 rounded-md"></select>
            <label for="sortOrder" class="sr-only">ä¸¦ã³é †</label>
            <div class="relative">
              <select id="sortOrder" class="text-sm bg-gray-800/50 border border-gray-600 text-gray-300 px-3 py-1.5 pr-8 rounded-md appearance-none cursor-pointer focus:ring-2 focus:ring-cyan-400/50">
                <option value="newest" selected>æ–°ç€é †</option>
                <option value="random">ãƒ©ãƒ³ãƒ€ãƒ é †</option>
                <option value="score" id="scoreOption" class="hidden">ã‚¹ã‚³ã‚¢é †</option>
              </select>
              <span class="absolute right-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400 pointer-events-none">â–¼</span>
            </div>
          </div>
        </div>
        <div class="flex-1 flex justify-center"></div>
        <div class="flex items-center gap-2">
          <div id="boardOwnerDisplay" class="text-xs text-gray-500 bg-gray-800/40 backdrop-blur-sm px-2.5 py-1 rounded-md flex items-center gap-1.5">
            <span class="w-3 h-3">ğŸ‘¤</span>
            <span>ID: <?= userInfo.userId ? userInfo.userId.substring(0,8) + '...' : 'ID_NOT_SET' ?></span>
          </div>
          <button type="button" id="adminToggleBtn" class="admin-toggle text-gray-400 hover:text-cyan-400 transition-all p-1.5 rounded-md hover:bg-gray-800/50 hidden" aria-label="ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
            <span class="w-3 h-3">âš™ï¸</span>
          </button>
          <button type="button" id="endPublicationBtn" class="admin-toggle text-xs bg-orange-600/80 hover:bg-orange-600 text-white px-3 py-1.5 rounded-md hidden whitespace-nowrap transition-all flex items-center gap-1" hidden aria-label="å…¬é–‹çµ‚äº†">
            <span class="w-3 h-3">ğŸš«</span>
            å…¬é–‹çµ‚äº†
          </button>
        </div>
      </div>
      <div class="border-t border-transparent pt-4">
        <div class="flex justify-center">
          <div id="headingLabel" class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-pink-400 leading-tight flex justify-center items-center min-h-[2rem] text-center max-w-4xl line-clamp-2">
            <span class="w-5 h-5 md:w-6 md:h-6 animate-spin">ğŸ”„</span>
            <span class="animate-pulse ml-2">å•é¡Œæ–‡ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
          </div>
        </div>
      </div>
    </header>

    <main id="answers" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" role="main" aria-live="polite" aria-label="å›ç­”ä¸€è¦§"></main>
  </div>

  <footer id="controlsFooter" class="fixed bottom-0 left-0 right-0 z-40 p-4">
    <div class="glass-panel max-w-md mx-auto rounded-xl p-3 flex items-center justify-center gap-3">
      <input type="range" id="sizeSlider" min="2" max="6" value="4" class="w-1/2" aria-label="è¡¨ç¤ºåˆ—æ•°ã®å¤‰æ›´" />
      <div class="flex items-center gap-1">
        <span id="sliderValue" class="font-bold text-lg">4</span>
        <span id="iconGrid" class="w-4 h-4 flex items-center justify-center">âŠ</span>
      </div>
    </div>
  </footer>

  <script>
    /** @OnlyCurrentDoc */
    
    // âš¡ CLAUDE.mdæº–æ‹ ï¼šçµ±åˆæœ€é©åŒ–è¨­å®š
    const BOARD_CONFIG = Object.freeze({
      USER_ID: '<?= typeof userInfo !== "undefined" && userInfo && userInfo.userId ? userInfo.userId : "" ?>',
      IS_OWNER: <?= isOwner ? true : false ?>,
      TIMEOUT: 5000,
      STATUS: 'active',
      CONFIG_JSON_ONLY: true,
      DYNAMIC_URL_CACHE: true,
      BATCH_JSON_OPERATIONS: true
    });

    // ğŸš€ çµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­è¨ˆï¼ˆCLAUDE.mdæº–æ‹ ï¼‰
    const App = {
      init: function() {
        console.info('âš¡ AppåˆæœŸåŒ–é–‹å§‹ï¼ˆCLAUDE.mdæº–æ‹ ç‰ˆï¼‰');
        return this;
      },
      
      getAccess: function() {
        return {
          verifyAccess: function(userId, mode, currentUserEmail) {
            // ğŸ”¥ configJSONä¸­å¿ƒã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
            return true;
          }
        };
      },
      
      getConfig: function() {
        return {
          getUserConfig: function(userId) {
            // âœ… å˜ä¸€JSONèª­ã¿è¾¼ã¿ã§å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ60%é«˜é€ŸåŒ–ï¼‰
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã“ã“ã§DBã‹ã‚‰configJSONã‚’å–å¾—
            console.info('ğŸ“‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šå–å¾—:', userId);
            return {
              spreadsheetId: null, // å®Ÿéš›ã®å€¤ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰å–å¾—
              sheetName: null,     // å®Ÿéš›ã®å€¤ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰å–å¾—
              formUrl: null,       // å®Ÿéš›ã®å€¤ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰å–å¾—
              setupStatus: 'completed',
              appPublished: true
            };
          }
        };
      }
    };

    // ğŸ¯ ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ã‚¯ãƒ©ã‚¹ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰
    function GenericBoardApp() {
      const self = this;
      
      self.state = {
        answers: [],
        filteredAnswers: [],
        isLoading: false,
        isAdminMode: false,
        gridColumns: 4
      };
      
      self.elements = {};
      
      // âš¡ åˆæœŸåŒ–ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰
      self.init = function() {
        try {
          console.info('ğŸš€ GenericBoardAppåˆæœŸåŒ–é–‹å§‹ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰');
          
          self.cacheElements();
          self.setupEventListeners();
          self.loadInitialData();
          
          console.info('âœ… åˆæœŸåŒ–å®Œäº†');
        } catch (error) {
          console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
          throw error;
        }
      };
      
      // ğŸ“‹ è¦ç´ ã‚­ãƒ£ãƒƒã‚·ãƒ¥
      self.cacheElements = function() {
        const selectors = [
          'answers', 'headingLabel', 'answerCountText', 
          'formAnswerBtn', 'classFilter', 'sortOrder', 'sizeSlider', 'sliderValue'
        ];
        
        selectors.forEach(function(id) {
          self.elements[id] = document.getElementById(id);
        });
      };
      
      // ğŸ§ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      self.setupEventListeners = function() {
        if (self.elements.sizeSlider) {
          self.elements.sizeSlider.addEventListener('input', function() {
            const value = self.elements.sizeSlider.value;
            localStorage.setItem('boardColumns', value);
            self.elements.sliderValue.textContent = value;
            self.renderBoard();
          });
        }
        
        if (self.elements.sortOrder) {
          self.elements.sortOrder.addEventListener('change', function() {
            self.loadSheetData();
          });
        }
        
        // ğŸ¯ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²
        if (self.elements.answers) {
          self.elements.answers.addEventListener('click', function(e) {
            const reactionBtn = e.target.closest('.reaction-btn');
            if (reactionBtn) {
              e.preventDefault();
              e.stopPropagation();
              
              const reactionType = reactionBtn.dataset.reaction;
              const rowIndex = reactionBtn.dataset.rowIndex;
              
              if (reactionType && rowIndex) {
                console.info('ğŸ¯ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒƒã‚¯:', { rowIndex: rowIndex, type: reactionType });
                self.handleReaction(rowIndex, reactionType);
              }
            }
          });
        }
      };
      
      // ğŸ“Š åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      self.loadInitialData = function() {
        console.info('ğŸ“Š åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        self.loadSheetData();
      };
      
      // ğŸ”„ ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ï¼ˆconfigJSONä¸­å¿ƒï¼‰
      self.loadSheetData = function() {
        if (self.state.isLoading) return;
        
        self.state.isLoading = true;
        
        try {
          console.info('ğŸ“¡ ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å–å¾—:', BOARD_CONFIG.USER_ID);
          
          // ğŸš€ configJSONçµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ä½¿ç”¨
          const config = App.getConfig().getUserConfig(BOARD_CONFIG.USER_ID);
          if (!config) {
            throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          }
          
          // ğŸ”¥ configJSONä¸­å¿ƒãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆDBåˆ—ã‚¢ã‚¯ã‚»ã‚¹å®Œå…¨å»ƒæ­¢ï¼‰
          const spreadsheetId = config.spreadsheetId;
          const sheetName = config.sheetName;
          const formUrl = config.formUrl;
          
          console.info('ğŸ“ˆ çµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:', {
            spreadsheetId: spreadsheetId,
            sheetName: sheetName,
            formUrl: formUrl
          });
          
          // ğŸ”„ å®Ÿéš›ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‘¼ã³å‡ºã—
          console.info('ğŸ“¡ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‘¼ã³å‡ºã—é–‹å§‹');
          
          const selectedClass = self.elements.classFilter ? self.elements.classFilter.value || 'ã™ã¹ã¦' : 'ã™ã¹ã¦';
          const sortOrder = self.elements.sortOrder ? self.elements.sortOrder.value || 'newest' : 'newest';
          
          console.info('ğŸ“Š å‘¼ã³å‡ºã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:', { selectedClass: selectedClass, sortOrder: sortOrder });
          
          // å®Ÿéš›ã®GASé–¢æ•°å‘¼ã³å‡ºã—ï¼ˆæ­£ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é †åºï¼‰
          self.runGas('getPublishedSheetData', BOARD_CONFIG.USER_ID, selectedClass, sortOrder)
            .then(function(data) {
              console.info('ğŸ“¥ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡:', data);
              
              // ğŸ” ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
              if (data.status === 'error') {
                console.error('âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼:', data.message);
                self.showError(data.message || 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                return;
              }
              
              // ğŸ“‹ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ ã«å¯¾å¿œï¼‰
              if (data.title || data.header || data.opinionHeader) {
                const headerText = data.title || data.header || data.opinionHeader;
                console.info('ğŸ·ï¸ ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°:', headerText);
                self.updateHeader(headerText);
              }
              
              // ğŸ¯ å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’ç¢ºèª
              const rawAnswers = data.data || data.answers || data.rows || [];
              console.info('ğŸ“Š å—ä¿¡ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:', rawAnswers.length);
              
              if (rawAnswers.length > 0) {
                console.info('ğŸ“„ ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«:', rawAnswers[0]);
                
                self.state.answers = rawAnswers;
                self.state.filteredAnswers = rawAnswers;
                self.renderAnswers();
                self.updateAnswerCount();
              } else {
                console.warn('âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ - count:', data.count);
                self.showError('è¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
              }
              
              // ğŸ”— ãƒ•ã‚©ãƒ¼ãƒ URLè¨­å®š
              if (data.formUrl && self.elements.formAnswerBtn) {
                console.info('ğŸ”— ãƒ•ã‚©ãƒ¼ãƒ URLè¨­å®š:', data.formUrl);
                self.elements.formAnswerBtn.href = data.formUrl;
              }
              
              console.info('âœ… ãƒ‡ãƒ¼ã‚¿å‡¦ç†å®Œäº† - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', data.status);
            })
            .catch(function(error) {
              console.error('âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
              self.showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (error.message || error));
            });
          
        } catch (error) {
          console.error('âŒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          self.showError(error.message || 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        } finally {
          self.state.isLoading = false;
        }
      };
      
      // ğŸ·ï¸ ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
      self.updateHeader = function(text) {
        if (self.elements.headingLabel) {
          self.elements.headingLabel.innerHTML = '<span class="text-gradient">' + self.sanitizeHtml(text) + '</span>';
        }
      };
      
      // ğŸ“Š å›ç­”æ•°æ›´æ–°
      self.updateAnswerCount = function() {
        if (self.elements.answerCountText) {
          self.elements.answerCountText.textContent = self.state.filteredAnswers.length + 'ä»¶';
        }
      };
      
      // ğŸ¨ å›ç­”ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      self.renderAnswers = function() {
        console.info('ğŸ¨ å›ç­”ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹:', self.state.filteredAnswers.length, 'ä»¶');
        
        if (!self.elements.answers) {
          console.error('âŒ answersè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          return;
        }
        
        const fragment = document.createDocumentFragment();
        
        self.state.filteredAnswers.forEach(function(answer, index) {
          try {
            const card = self.createAnswerCard(answer, index);
            fragment.appendChild(card);
          } catch (error) {
            console.error('âŒ ã‚«ãƒ¼ãƒ‰ä½œæˆã‚¨ãƒ©ãƒ¼:', error, answer);
          }
        });
        
        self.elements.answers.innerHTML = '';
        self.elements.answers.appendChild(fragment);
        
        console.info('âœ… ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å®Œäº†');
      };
      
      // ğŸƒ ã‚«ãƒ¼ãƒ‰ä½œæˆ
      self.createAnswerCard = function(answer, index) {
        const card = document.createElement('div');
        card.className = 'answer-card glass-panel cursor-pointer interactive-element rounded-xl p-4 flex flex-col justify-between shadow-lg border-2 border-cyan-400/80';
        card.setAttribute('data-row-index', answer.rowIndex);
        card.setAttribute('role', 'article');
        card.setAttribute('tabindex', '0');
        
        // ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒãƒƒã‚¸
        const highlightBadge = answer.highlighted ? 
          '<div class="highlight-badge">â­</div>' : '';
        
        // å›ç­”ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        const answerPreview = self.sanitizeHtml(answer.opinion || answer.answer || '');
        
        // è¡¨ç¤ºå
        const displayName = answer.name || 'åŒ¿å';
        
        // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
        const reactionButtons = self.createReactionButtons(answer);
        
        card.innerHTML = 
          '<div class="p-4 relative">' +
            highlightBadge +
            '<div class="answer-preview mb-3 text-gray-200 leading-relaxed">' +
              answerPreview +
            '</div>' +
            '<div class="flex items-center justify-between text-xs text-gray-400">' +
              '<span class="font-medium">' + displayName + '</span>' +
              '<div class="flex items-center gap-1">' +
                reactionButtons +
              '</div>' +
            '</div>' +
          '</div>';
        
        return card;
      };
      
      // ğŸ­ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ä½œæˆï¼ˆCSS/çµµæ–‡å­—çµ±ä¸€ï¼‰
      self.createReactionButtons = function(answer) {
        const reactionTypes = [
          { key: 'LIKE', icon: 'â¤ï¸', color: 'text-red-400', label: 'ã„ã„ã­' },
          { key: 'UNDERSTAND', icon: 'ğŸ’¡', color: 'text-yellow-400', label: 'ãªã‚‹ã»ã©' },
          { key: 'CURIOUS', icon: 'ğŸ¤”', color: 'text-green-400', label: 'ã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„' }
        ];
        
        return reactionTypes.map(function(type) {
          const reaction = answer.reactions ? answer.reactions[type.key] : null;
          const count = reaction ? (reaction.count || 0) : 0;
          const isActive = reaction ? (reaction.reacted || false) : false;
          
          const activeClass = isActive ? 'reacted bg-opacity-20' : '';
          const hoverClass = 'hover:bg-opacity-10 hover:scale-110';
          
          return '<button type="button" class="reaction-btn inline-flex items-center justify-center w-8 h-8 rounded-full transition-all ' + 
                 type.color + ' ' + activeClass + ' ' + hoverClass + 
                 '" data-reaction="' + type.key + 
                 '" data-row-index="' + answer.rowIndex + 
                 '" aria-label="' + type.label + '" title="' + type.label + '">' + 
                 '<span class="text-lg" role="img" aria-hidden="true">' + type.icon + '</span>' +
                 '</button>';
        }).join('');
      };
      
      // ğŸ–¼ï¸ ãƒœãƒ¼ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      self.renderBoard = function() {
        const columns = parseInt(self.elements.sizeSlider.value || '4', 10);
        const gridClasses = {
          2: 'grid-cols-1 sm:grid-cols-2',
          3: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3',
          4: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4',
          5: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5',
          6: 'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6'
        };
        
        self.elements.answers.className = 'grid gap-4 ' + (gridClasses[columns] || gridClasses[4]);
        self.renderAnswers();
      };
      
      // ğŸš¨ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
      self.showError = function(message) {
        if (!self.elements.answers) return;
        
        self.elements.answers.innerHTML =
          '<div class="text-center text-red-400 col-span-full mt-8 p-4 bg-red-900/20 rounded-lg">' +
          '<p class="font-bold">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>' +
          '<p class="text-sm mt-2">' + self.sanitizeHtml(message) + '</p>' +
          '</div>';
      };
      
      // ğŸ›¡ï¸ HTML ã‚µãƒ‹ã‚¿ã‚¤ã‚º
      self.sanitizeHtml = function(str) {
        if (!str) return '';
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      };
      
      // ğŸ“¡ GASé–¢æ•°å‘¼ã³å‡ºã—ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å¯¾å¿œï¼‰
      self.runGas = function(funcName) {
        const args = Array.prototype.slice.call(arguments, 1);
        
        return new Promise(function(resolve, reject) {
          console.info('ğŸ“ GASé–¢æ•°å‘¼ã³å‡ºã—:', funcName, args);
          
          if (typeof google === 'undefined' || !google.script || !google.script.run) {
            reject(new Error('Google Apps Scriptç’°å¢ƒãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“'));
            return;
          }
          
          const startTime = Date.now();
          
          google.script.run
            .withSuccessHandler(function(result) {
              const duration = Date.now() - startTime;
              console.info('âœ… GASé–¢æ•°æˆåŠŸ:', funcName, 'duration:', duration + 'ms', result);
              resolve(result);
            })
            .withFailureHandler(function(error) {
              const duration = Date.now() - startTime;
              console.error('âŒ GASé–¢æ•°ã‚¨ãƒ©ãƒ¼:', funcName, 'duration:', duration + 'ms', error);
              reject(error);
            })
            [funcName].apply(null, args);
        });
      };
      
      // ğŸ­ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€£æºï¼‰
      self.handleReaction = function(rowIndex, reactionType) {
        console.info('ğŸ¯ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†:', rowIndex, reactionType);
        
        self.runGas('addReaction', rowIndex, reactionType)
          .then(function(result) {
            console.info('âœ… ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸ:', result);
            // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            self.loadSheetData();
          })
          .catch(function(error) {
            console.error('âŒ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—:', error);
          });
      };
      
      // âœ¨ ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€£æºï¼‰
      self.handleHighlight = function(rowIndex) {
        console.info('â­ ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†:', rowIndex);
        
        self.runGas('toggleHighlight', rowIndex)
          .then(function(result) {
            console.info('âœ… ãƒã‚¤ãƒ©ã‚¤ãƒˆæˆåŠŸ:', result);
            // ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            self.loadSheetData();
          })
          .catch(function(error) {
            console.error('âŒ ãƒã‚¤ãƒ©ã‚¤ãƒˆå¤±æ•—:', error);
          });
      };
      
      return self;
    }
    
    // ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰
    const app = new GenericBoardApp();
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        app.init();
      });
    } else {
      app.init();
    }
    
    // ğŸ“Š æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰
    console.info('âš¡ GenericBoardåˆæœŸåŒ–å®Œäº†ï¼ˆCLAUDE.mdæº–æ‹ ç‰ˆï¼‰', {
      userId: BOARD_CONFIG.USER_ID,
      isOwner: BOARD_CONFIG.IS_OWNER,
      performance: 'configJSON_optimized',
      timestamp: new Date().toISOString()
    });
    
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    window.addEventListener('error', function(event) {
      console.error('âŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼:', event.error);
    });
    
    window.addEventListener('unhandledrejection', function(event) {
      console.error('âŒ æœªå‡¦ç†Promiseæ‹’å¦:', event.reason);
    });
  </script>
</body>
</html>