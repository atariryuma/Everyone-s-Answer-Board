<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyQuest - åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</title>
    <meta name="theme-color" content="#1a1b26" />
    <meta name="description" content="StudyQuestã®åˆå›ã‚·ã‚¹ãƒ†ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸" />
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=()" />
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Unified Styles and Shared Components -->
    <?!= include('UnifiedStyles'); ?>
    <?!= include('SharedUtilities'); ?>
    <?!= include('SharedJavaScript'); ?>
    <?!= include('SetupLogic'); ?>
</head>
<body class="unified-theme bg-[#1a1b26] text-gray-200 font-sans min-h-screen">
    <div class="max-w-2xl mx-auto">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-cyan-400 mb-2">ğŸ“š StudyQuest</h1>
            <p class="text-xl text-gray-300">åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</p>
            <p class="text-sm text-gray-400 mt-2">ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨é–‹å§‹ã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¡Œã„ã¾ã™</p>
        </div>

        <!-- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
        <div id="inline-message-area" class="mb-6"></div>

        <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="glass-panel rounded-xl p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4">ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
            
            <form id="setup-form" class="space-y-6">
                <!-- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON -->
                <div>
                    <label for="service-account-json" class="block text-sm font-medium text-gray-300 mb-2">
                        ğŸ”‘ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSONã‚­ãƒ¼
                    </label>
                    <textarea 
                        id="service-account-json" 
                        name="serviceAccountJson"
                        rows="8" 
                        class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-gray-100 font-mono text-xs resize-vertical focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                        placeholder='{"type": "service_account", "project_id": "...", "private_key_id": "...", ...}'
                        required></textarea>
                    <p class="text-xs text-gray-400 mt-1">Google Cloud Consoleã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</p>
                </div>

                <!-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID -->
                <div>
                    <label for="database-id" class="block text-sm font-medium text-gray-300 mb-2">
                        ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID
                    </label>
                    <input 
                        type="text" 
                        id="database-id" 
                        name="databaseId"
                        class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-gray-100 font-mono focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500"
                        placeholder="1BcD3fGhIjKlMnOpQrStUvWxYz0123456789ABCDEFGH"
                        pattern="[a-zA-Z0-9_\-]{44}"
                        maxlength="44"
                        required>
                    <p class="text-xs text-gray-400 mt-1">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç”¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ44æ–‡å­—ï¼‰</p>
                </div>

                <!-- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ -->
                <button 
                    type="submit" 
                    id="setup-btn"
                    class="w-full btn bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg">
                    <span id="setup-text">ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹</span>
                    <div id="setup-spinner" class="loading-spinner w-5 h-5 border-2 border-white border-t-transparent rounded-full mx-auto hidden"></div>
                </button>
            </form>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã«è¡¨ç¤ºï¼‰ -->
        <div id="test-section" class="glass-panel rounded-xl p-6 hidden">
            <h3 class="text-lg font-semibold text-white mb-4">âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†</h3>
            <p class="text-gray-300 mb-4">ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèªã‚’è¡Œãˆã¾ã™ã€‚</p>
            <button 
                id="test-btn"
                class="btn bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-2 px-4 rounded-lg">
                ğŸ” ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
            <div class="mt-4">
                <button type="button" id="start-studyquest-btn" onclick="startApp()" class="inline-block btn bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-2 px-4 rounded-lg">
                    ğŸ“š StudyQuestã‚’é–‹å§‹
                </button>
            </div>
        </div>

        <!-- ãƒ˜ãƒ«ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="glass-panel rounded-xl p-6">
            <h3 class="text-lg font-semibold text-white mb-4">â“ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ãŠå›°ã‚Šã®å ´åˆ</h3>
            <div class="space-y-3 text-sm text-gray-300">
                <details class="cursor-pointer">
                    <summary class="font-medium text-cyan-400 hover:text-cyan-300">ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSONã®å–å¾—æ–¹æ³•</summary>
                    <div class="mt-2 pl-4 text-gray-400">
                        <ol class="list-decimal list-inside space-y-1">
                            <li>Google Cloud Consoleã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                            <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã¾ãŸã¯ä½œæˆ</li>
                            <li>ã€ŒIAMã¨ç®¡ç†ã€â†’ã€Œã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€</li>
                            <li>ã€Œã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€</li>
                            <li>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€ã€Œã‚­ãƒ¼ã€ã‚¿ãƒ–ã‹ã‚‰JSONã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                        </ol>
                    </div>
                </details>
                <details class="cursor-pointer">
                    <summary class="font-medium text-cyan-400 hover:text-cyan-300">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã®å–å¾—æ–¹æ³•</summary>
                    <div class="mt-2 pl-4 text-gray-400">
                        <ol class="list-decimal list-inside space-y-1">
                            <li>Google Sheetsã§æ–°ã—ã„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ</li>
                            <li>URLã‹ã‚‰44æ–‡å­—ã®IDã‚’ã‚³ãƒ”ãƒ¼ï¼ˆ/d/ã®å¾Œã®éƒ¨åˆ†ï¼‰</li>
                            <li>ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ç·¨é›†è€…ã¨ã—ã¦è¿½åŠ </li>
                        </ol>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <!-- Message area for notifications -->
    <div id="message-area" class="fixed top-4 right-4 z-50" aria-live="polite" role="status"></div>
    
    <script>
        /* =============================================================================
           SetupPage.html - Minimal JavaScript 
           Main logic moved to SetupLogic.html and SharedJavaScript.html
           ============================================================================= */
        
        // Backward compatibility functions using shared utilities
        var showMessage = window.setupUtilities?.legacy?.showMessage || 
                         window.sharedUtilities?.message?.show || 
                         function(msg, type) { console.log(`[${type}] ${msg}`); };
        
        var validateJSON = window.setupUtilities?.validation?.validateJSON || function(json) {
            console.log('JSON validation not available');
            return true;
        };
        
        var validateSpreadsheetId = window.setupUtilities?.validation?.validateSpreadsheetId || function(id) {
            console.log('Spreadsheet ID validation not available');
            return true;
        };
        
        var startApp = window.setupUtilities?.navigation?.startApp || function() {
            console.log('Start app function not available');
        };
        
        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”§ SetupPage: Using unified utilities and logic files');
            
            // Initialize setup utilities if available
            if (window.setupUtilities) {
                console.log('âœ… SetupPage: Setup utilities loaded');
            }
            
            if (window.sharedUtilities) {
                console.log('âœ… SetupPage: Shared utilities loaded');
            }
        });
    </script>
</body>
</html>