<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>初回セットアップ - StudyQuest</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Scripts -->
    <?!= include('SharedUtilities'); ?>
</head>
<body>
    <div class="app-setup-container">
        <header class="page-header">
            <h1>📚 初回セットアップ</h1>
            <p>システムを使用開始するための設定を行います</p>
        </header>

        <div id="message-area"></div>

        <main>
            <section class="content-card">
                <h2>🔧 システム設定</h2>
                <form id="setup-form" class="form-grid">
                    <div class="form-group">
                        <label for="service-account-json">🔑 サービスアカウントJSONキー</label>
                        <textarea id="service-account-json" name="serviceAccountJson" rows="8" class="textarea-field font-mono" placeholder='{"type": "service_account", ...}' required></textarea>
                        <p class="help-text">Google Cloud ConsoleからダウンロードしたサービスアカウントのJSONファイルの内容を貼り付けてください</p>
                    </div>

                    <div class="form-group">
                        <label for="database-id">📊 データベーススプレッドシートID</label>
                        <input type="text" id="database-id" name="databaseId" class="input-field font-mono" placeholder="1BcD3fGhIjKlMnOpQrStUvWxYz0123456789ABCDEFGH" pattern="[a-zA-Z0-9_\-]{44}" maxlength="44" required>
                        <p class="help-text">データベース用スプレッドシートのIDを入力してください（44文字）</p>
                    </div>

                    <button type="submit" id="setup-btn" class="btn btn-primary">
                        <span id="setup-text">🚀 セットアップを開始</span>
                        <div id="setup-spinner" class="spinner hidden"></div>
                    </button>
                </form>
            </section>

            <section id="test-section" class="content-card hidden">
                <h3>✅ セットアップ完了</h3>
                <p>セットアップが正常に完了しました。システムの動作確認を行えます。</p>
                <button id="test-btn" class="btn btn-success">🔍 システムテスト実行</button>
                <button id="start-studyquest-btn" onclick="startApp()" class="btn btn-primary">📚 StudyQuestを開始</button>
            </section>

            <section class="content-card help-section">
                <h2>❓ セットアップでお困りの場合</h2>
                <details>
                    <summary>サービスアカウントJSONの取得方法</summary>
                    <div class="details-content">
                        <ol>
                            <li>Google Cloud Consoleにアクセス</li>
                            <li>プロジェクトを選択または作成</li>
                            <li>「IAMと管理」→「サービスアカウント」</li>
                            <li>「サービスアカウントを作成」</li>
                            <li>アカウント作成後、「キー」タブからJSONキーをダウンロード</li>
                        </ol>
                    </div>
                </details>
                <details>
                    <summary>スプレッドシートIDの取得方法</summary>
                    <div class="details-content">
                        <ol>
                            <li>Google Sheetsで新しいスプレッドシートを作成</li>
                            <li>URLから44文字のIDをコピー（/d/の後の部分）</li>
                            <li>サービスアカウントをスプレッドシートの編集者として追加</li>
                        </ol>
                    </div>
                </details>
            </section>
        </main>
    </div>

    <script>
        // The original script content is preserved here.
        // ...
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>