<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; padding: 30px; background-color: #f8f9fa; color: #333; }
        .container { max-width: 700px; margin: 0 auto; background-color: #fff; border: 1px solid #dee2e6; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #495057; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="url"] { width: 100%; padding: 10px; margin-bottom: 20px; box-sizing: border-box; border: 1px solid #ced4da; border-radius: 4px; }
        button { padding: 12px 22px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:disabled { background-color: #6c757d; }
        #message { margin-top: 20px; font-weight: bold; padding: 10px; border-radius: 4px; }
        .success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb;}
        .error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb;}
    </style>
</head>
<body>
    <div class="container">
        <h2>みんなの回答ボード - 初回セットアップ</h2>
        <p>「管理者向けログ記録API」をデプロイした際にコピーした、ウェブアプリのURLを以下に貼り付けてください。</p>
        <form id="setupForm">
            <label for="apiUrl">Logger API Web App URL:</label>
            <input type="url" id="apiUrl" name="apiUrl" required placeholder="https://script.google.com/macros/s/...">
            <button type="submit" id="submitBtn">設定を保存してデータベースを作成</button>
        </form>
        <div id="message"></div>
    </div>

    <script>
        document.getElementById('setupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const apiUrl = document.getElementById('apiUrl').value;
            const btn = document.getElementById('submitBtn');
            const msgDiv = document.getElementById('message');

            btn.disabled = true;
            btn.textContent = '処理中...';
            msgDiv.textContent = '';
            msgDiv.className = '';

            google.script.run
                .withSuccessHandler(function(message) {
                    msgDiv.textContent = message;
                    if (message.startsWith('✅')) {
                        msgDiv.className = 'success';
                        btn.style.backgroundColor = '#28a745';
                        btn.textContent = '完了';
                    } else {
                        msgDiv.className = 'error';
                        btn.disabled = false;
                        btn.textContent = '設定を保存してデータベースを作成';
                    }
                })
                .withFailureHandler(function(error) {
                    msgDiv.className = 'error';
                    msgDiv.textContent = 'エラー: ' + error.message;
                    btn.disabled = false;
                    btn.textContent = '設定を保存してデータベースを作成';
                })
                .saveSettingsAndCreateDb(apiUrl);
        });
    </script>
</body>
</html>