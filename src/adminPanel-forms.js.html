<script>
// 文字数カウンター機能
function setupCharacterCounters() {
  const titleInput = document.getElementById('custom-form-title');
  const questionTextarea = document.getElementById('custom-main-question');
  const titleCounter = document.getElementById('title-counter');
  const questionCounter = document.getElementById('question-counter');

  if (titleInput && titleCounter) {
    titleInput.addEventListener('input', function() {
      const count = this.value.length;
      titleCounter.textContent = `${count}/100`;
      titleCounter.className = count > 90 ? 'small text-danger' : 'small text-secondary';
    });
  }

  if (questionTextarea && questionCounter) {
    questionTextarea.addEventListener('input', function() {
      const count = this.value.length;
      questionCounter.textContent = `${count}/500`;
      questionCounter.className = count > 450 ? 'small text-danger' : 'small text-secondary';
    });
  }
}

// セキュリティ情報表示関数
function showSecurityInfo() {
  if (window.sharedModals) {
    window.sharedModals.showSecurityDetails();
  } else {
    showModal('security-details-modal');
  }
}

// Google連携の利点表示関数
function showGoogleIntegrationInfo() {
  if (window.sharedModals) {
    window.sharedModals.showGoogleIntegration();
  } else {
    showModal('google-integration-modal');
  }
}

// モーダル表示時にカウンターを初期化
document.addEventListener('DOMContentLoaded', function() {
  setupCharacterCounters();
});

// フォーム設定モーダルが開かれたときにカウンターをリセット
// この機能は既にshowFormConfigModal内で適切に処理されています
document.addEventListener('DOMContentLoaded', function() {
  // モーダルが表示されるたびにカウンターをセットアップ
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const modal = document.getElementById('form-config-modal');
        if (modal && !modal.classList.contains('d-none')) {
          setTimeout(setupCharacterCounters, 100);
        }
      }
    });
  });

  // モーダルの監視を開始
  const modal = document.getElementById('form-config-modal');
  if (modal) {
    observer.observe(modal, { attributes: true });
  }
});
</script>
