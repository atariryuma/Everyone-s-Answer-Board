<script>
// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½
function setupCharacterCounters() {
  const questionTextarea = document.getElementById('custom-main-question');
  const questionCounter = document.getElementById('question-counter');

  if (questionTextarea && questionCounter) {
    questionTextarea.addEventListener('input', function() {
      const count = this.value.length;
      questionCounter.textContent = `${count}/500`;
      questionCounter.className = count > 450 ? 'text-xs text-red-400' : 'text-xs text-gray-500';
    });
  }
}

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±è¡¨ç¤ºé–¢æ•°
function showSecurityInfo() {
  if (window.sharedModals) {
    window.sharedModals.showSecurityDetails();
  } else {
    showModal('security-details-modal');
  }
}

// Googleé€£æºã®åˆ©ç‚¹è¡¨ç¤ºé–¢æ•°
function showGoogleIntegrationInfo() {
  if (window.sharedModals) {
    window.sharedModals.showGoogleIntegration();
  } else {
    showModal('google-integration-modal');
  }
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–
// åˆæœŸåŒ–ã¯ adminPanel-core.js ã®çµ±åˆåˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ ã§ç®¡ç†ã•ã‚Œã¾ã™

// ãƒ•ã‚©ãƒ¼ãƒ è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã‹ã‚ŒãŸã¨ãã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
// ã“ã®æ©Ÿèƒ½ã¯æ—¢ã«showFormConfigModalå†…ã§é©åˆ‡ã«å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™
// å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ– - CoreåˆæœŸåŒ–å¾Œã«å®Ÿè¡Œ
function safeInitializeForms() {
  // CoreåˆæœŸåŒ–å®Œäº†ã‚’å¾…æ©Ÿ
  if (typeof window.coreInitialized !== 'undefined' && window.coreInitialized) {
    initializeFormComponents();
  } else {
    // CoreåˆæœŸåŒ–ã‚’å¾…ã£ã¦å†è©¦è¡Œ
    setTimeout(safeInitializeForms, 200);
  }
}

function initializeFormComponents() {
  console.log('ğŸ“ Initializing form components...');
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã³ã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        const modal = document.getElementById('form-config-modal');
        if (modal && !modal.classList.contains('hidden')) {
          setTimeout(setupCharacterCounters, 100);
        }
      }
    });
  });
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ç›£è¦–ã‚’é–‹å§‹
  const modal = document.getElementById('form-config-modal');
  if (modal) {
    observer.observe(modal, { attributes: true });
  }
  
  window.apiInitialized = true; // FormsåˆæœŸåŒ–å®Œäº†ãƒ•ãƒ©ã‚°
}

// ç«¶åˆã‚’é¿ã‘ã‚‹ãŸã‚ã€CoreåˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹
if (document.readyState !== 'loading') {
  // æ—¢ã«DOMãŒãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã®å ´åˆã¯å³åº§ã«å®Ÿè¡Œ
  setTimeout(safeInitializeForms, 200);
} else {
  // DOMãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã«å®Ÿè¡Œï¼ˆCoreã‚ˆã‚Šå¾Œã«ãªã‚‹ï¼‰
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(safeInitializeForms, 700); // UIåˆæœŸåŒ–ã‚’å¾…ã¤
  });
}
</script>
