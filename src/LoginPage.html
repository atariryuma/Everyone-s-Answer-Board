<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <title>StudyQuest - ログイン</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#1a1b26">
  <meta name="description" content="StudyQuest 回答ボードシステム - ログイン">
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=()" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Handle Tailwind CDN production warnings and deprecation warnings
    if (typeof console !== 'undefined' && console.warn) {
      const originalWarn = console.warn;
      console.warn = function(...args) {
        if (args[0] && (
          args[0].includes('cdn.tailwindcss.com should not be used in production') ||
          args[0].includes('-ms-high-contrast is in the process of being deprecated')
        )) {
          return; // Suppress these warnings
        }
        originalWarn.apply(console, args);
      };
    }
  </script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Google APIs -->
  <script src="https://apis.google.com/js/api.js" async defer></script>

  <!-- Include shared styles and utilities -->
  <?!= include('UnifiedStyles'); ?>
  <?!= include('SharedUtilities'); ?>

  <!-- Login-specific styles -->
  <?!= include('login.css.html'); ?>
</head>
<body class="login-container flex items-center justify-center p-4">
  <div class="login-card w-full max-w-md p-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="login-title">StudyQuest</h1>
      <p class="login-subtitle">みんなの回答ボード</p>

      <!-- Organization Info -->
      <div class="organization-info mt-4 hidden" id="organization-info">
        <div class="organization-badge">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H3m2 0h4m6 0a7 7 0 11-14 0m2 0a7 7 0 012 0h4a7 7 0 012 0z"/>
          </svg>
          <span id="organization-name">組織名</span>
        </div>
        <p class="organization-description">この組織で展開されています</p>
      </div>
    </div>

    <!-- Account Information -->
    <div class="account-info">
      <div class="account-label">ログイン中のアカウント</div>
      <div class="user-email" id="user-email-display">-</div>
      <div id="domain-status-badge" class="hidden"></div>
    </div>

    <!-- Login Actions -->
    <div class="space-y-4">
      <button type="button" id="login-btn" class="login-btn" disabled>
        ログイン
      </button>

      <div class="text-center">
        <a href="#" id="switch-account-link" class="footer-link">
          別のアカウントでログイン
        </a>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-8 text-center">
      <a href="#" id="security-modal-trigger" class="footer-link">
        セキュリティ仕様について
      </a>
    </div>
  </div>

  <!-- Set global variables for login -->
  <script>
    (function() {
      // Global error handling for document.write issues in GAS
      if (typeof window !== 'undefined' && typeof document !== 'undefined') {
        document.write = () => {
          console.warn('document.write blocked in GAS context');
        };
        document.writeln = () => {
          console.warn('document.writeln blocked in GAS context');
        };
      }

      window.GOOGLE_CLIENT_ID = '<?= GOOGLE_CLIENT_ID ?>';
    })();
  </script>

  <!-- Include login-specific JavaScript -->
  <?!= include('login.js.html'); ?>
</body>
</html>
