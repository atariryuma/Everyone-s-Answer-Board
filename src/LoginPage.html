<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <title>StudyQuest - ログイン</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#6366f1">
  <meta name="description" content="StudyQuest 回答ボードシステム - ログイン">
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), payment=(), usb=(), serial=(), bluetooth=(), screen-wake-lock=(), accelerometer=(), gyroscope=(), magnetometer=(), ambient-light-sensor=(), speaker=(), vibrate=(), vr=()" />

  <!-- Modern Flat Dark Theme CSS -->
  <?!= include('login.css'); ?>

  <!-- Unified CSS System -->
  <?!= include('unified-styles.css'); ?>
  
  <!-- Shared Utilities -->
  <?!= include('SharedUtilities'); ?>
</head>
<body>
  <!-- Main Login Container -->
  <div class="login-container">
    <div class="login-card">
      <!-- Header Section -->
      <header class="login-header">
        <div class="logo-section">
          <div class="logo-icon">🎓</div>
          <h1 class="app-title">StudyQuest</h1>
        </div>
        <div class="login-subtitle">
          <h2>ログイン</h2>
          <p class="subtitle-text">初回利用時は自動的にアカウントが作成されます</p>
        </div>
      </header>

      <!-- Organization Info Panel -->
      <div class="organization-panel" id="organization-panel">
        <div class="organization-content">
          <div class="organization-icon">🏢</div>
          <div class="organization-text">
            <div class="organization-name" id="organization-name">組織名</div>
            <div class="organization-desc">この組織で展開されています</div>
          </div>
        </div>
      </div>

      <!-- Account Information -->
      <div class="account-section">
        <h3 class="section-title">
          <span class="section-icon">👤</span>
          使用するアカウント
        </h3>
        <div class="account-display">
          <div class="user-email" id="user-email-display">ユーザー情報を取得中...</div>
        </div>
      </div>

      <!-- Login Actions -->
      <div class="login-actions">
        <button type="button" id="login-btn" class="login-button" disabled>
          <span class="button-text">はじめる</span>
        </button>

        <div class="secondary-actions">
          <button id="switch-account-btn" onclick="switchAccount()" class="link-button">
            別のアカウントでログイン
          </button>
          <button onclick="showSecurityModal()" class="link-button secondary">
            セキュリティ仕様について
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Security Modal -->
  <div id="security-modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">
          <span class="modal-icon">🔒</span>
          セキュリティ仕様
        </h3>
        <button onclick="closeSecurityModal()" class="modal-close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-content">
        <div class="security-section">
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">🏢</span>
              ドメイン制限
            </h4>
            <p class="security-desc">
              このシステムは<strong>naha-okinawa.ed.jp</strong>ドメインのユーザーのみアクセス可能です。組織外からのアクセスは制限されています。
            </p>
          </div>
          
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">🔐</span>
              認証システム
            </h4>
            <p class="security-desc">
              Google Workspace内部OAuth認証を使用しており、外部認証は受け付けません。組織のセキュリティポリシーに準拠しています。
            </p>
          </div>
          
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">🛡️</span>
              データ保護
            </h4>
            <ul class="security-list">
              <li>Content Security Policy (CSP) による外部リソース制限</li>
              <li>X-Content-Type-Options: nosniff による MIME タイプ保護</li>
              <li>Referrer-Policy による情報漏洩防止</li>
              <li>ユーザーデータの暗号化と安全な保存</li>
            </ul>
          </div>
          
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">👥</span>
              アクセス制御
            </h4>
            <p class="security-desc">
              マルチテナント環境での権限分離により、ユーザーは自分のデータのみアクセス可能です。管理者権限は適切に分離されています。
            </p>
          </div>
          
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">📝</span>
              監査ログ
            </h4>
            <p class="security-desc">
              システムの全操作は監査ログに記録され、セキュリティインシデントの追跡と分析が可能です。
            </p>
          </div>
          
          <div class="security-item">
            <h4 class="security-title">
              <span class="security-icon">⚙️</span>
              システム設計
            </h4>
            <p class="security-desc">
              Google Apps Script環境での実行により、Googleのインフラストラクチャのセキュリティ基準を活用しています。
            </p>
          </div>
        </div>
        
        <div class="modal-footer">
          <button onclick="closeSecurityModal()" class="modal-button">
            理解しました
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <?!= include('login.js'); ?>
</body>
</html>