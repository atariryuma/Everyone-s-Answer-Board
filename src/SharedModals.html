<!-- SharedModals.html - 共通モーダルコンポーネント -->
<!-- GAS include用のモーダルコンポーネント集 -->

<!-- 確認モーダル -->
<div id="confirmation-modal" class="fixed inset-0 bg-black/80 z-[60] hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-md w-full">
      <h3 id="modal-title" class="text-xl font-bold text-cyan-400 mb-4"></h3>
      <p id="modal-message" class="text-gray-300 mb-6"></p>
      <div class="flex justify-end gap-3">
        <button type="button" id="modal-cancel-btn" class="btn btn-secondary">キャンセル</button>
        <button type="button" id="modal-confirm-btn" class="btn btn-primary">はい、実行します</button>
      </div>
    </div>
  </div>
</div>

<!-- 公開モーダル -->
<div id="publish-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-md w-full">
      <h3 class="text-xl font-bold text-cyan-400 mb-4">
        <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        公開準備完了
      </h3>
      <p class="text-gray-300 mb-6">
        シートの設定が完了しました。<br>
        学習者がアクセスできるよう公開しますか？
      </p>
      <div class="flex justify-end gap-3">
        <button type="button" id="publish-modal-private-btn" class="btn btn-secondary">非公開のまま</button>
        <button type="button" id="publish-modal-publish-btn" class="btn btn-primary">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          公開する
        </button>
      </div>
    </div>
  </div>
</div>

<!-- プライバシーモーダル -->
<div id="privacy-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-lg w-full">
      <div class="flex items-center gap-3 mb-4">
        <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
        </svg>
        <h3 class="text-xl font-bold text-yellow-400">プライバシーとデータ保護</h3>
      </div>
      <div class="space-y-4 text-gray-300">
        <p>このシステムは教育目的でのみ使用されます。</p>
        <div class="glass-panel bg-yellow-500/10 rounded-lg p-4 border border-yellow-400/30">
          <h4 class="font-semibold text-yellow-400 mb-2">重要な注意事項</h4>
          <ul class="text-sm space-y-1">
            <li>• 個人情報は適切に保護されます</li>
            <li>• 回答データは教育目的でのみ使用されます</li>
            <li>• 管理者は適切なアクセス権限を持っています</li>
            <li>• データは法的要件に従って管理されます</li>
          </ul>
        </div>
      </div>
      <div class="flex justify-end gap-3 mt-6">
        <button type="button" id="privacy-modal-cancel" class="btn btn-secondary">キャンセル</button>
        <button type="button" id="privacy-modal-continue" class="btn btn-primary">理解しました、継続</button>
      </div>
    </div>
  </div>
</div>

<!-- デジタルシティズンシップモーダル -->
<div id="digital-citizenship-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-cyan-400">デジタル・シティズンシップに基づく回答ボード指導</h3>
        <button type="button" id="digital-citizenship-modal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-300">
        <div class="glass-panel bg-cyan-500/10 rounded-lg p-4 border border-cyan-400/30 mb-4">
          <h4 class="font-semibold text-cyan-400 mb-2">🌐 デジタル・シティズンシップとは</h4>
          <p class="text-sm">デジタル社会における責任ある市民として、技術を適切かつ効果的に使用する能力です。回答ボードを通じて、この重要な概念を実践的に指導しましょう。</p>
        </div>
        
        <div class="glass-panel bg-blue-500/10 rounded-lg p-4 border border-blue-400/30">
          <h4 class="font-semibold text-blue-400 mb-2">📝 デジタル・リテラシーの育成</h4>
          <p class="text-sm">適切な質問設計を通じて、学習者がデジタル環境で建設的な議論ができるよう導きましょう。情報を批判的に評価し、根拠に基づいた意見を表現する力を育成します。</p>
        </div>
        
        <div class="glass-panel bg-green-500/10 rounded-lg p-4 border border-green-400/30">
          <h4 class="font-semibold text-green-400 mb-2">🤝 デジタル・コミュニケーション</h4>
          <p class="text-sm">多様な意見を尊重し、相手の立場を理解する姿勢を重視しましょう。リアクション機能の適切な使い方を指導し、建設的なフィードバック文化を形成します。</p>
        </div>
        
        <div class="glass-panel bg-purple-500/10 rounded-lg p-4 border border-purple-400/30">
          <h4 class="font-semibold text-purple-400 mb-2">🛡️ デジタル・セキュリティと倫理</h4>
          <p class="text-sm">個人情報保護の重要性を学習者に伝え、デジタル環境でのプライバシー意識を高めましょう。名前表示設定を通じて、適切な情報開示について考える機会を提供します。</p>
        </div>
        
        <div class="glass-panel bg-red-500/10 rounded-lg p-4 border border-red-400/30">
          <h4 class="font-semibold text-red-400 mb-2">⚖️ デジタル・責任と法的理解</h4>
          <p class="text-sm">デジタル空間での行動にも実世界と同様の責任が伴うことを指導しましょう。不適切な投稿への対応を通じて、デジタル環境でのルールとマナーを学ばせます。</p>
        </div>
        
        <div class="glass-panel bg-yellow-500/10 rounded-lg p-4 border border-yellow-400/30">
          <h4 class="font-semibold text-yellow-400 mb-2">📊 デジタル・フットプリントと振り返り</h4>
          <p class="text-sm">デジタル活動の記録が残ることを意識させ、学習データを活用した振り返りの価値を伝えましょう。自らの学習過程を客観視する力を育成します。</p>
        </div>
      </div>
      
      <div class="flex justify-end mt-6">
        <button type="button" id="digital-citizenship-modal-close-btn" class="btn btn-primary">理解しました</button>
      </div>
    </div>
  </div>
</div>

<!-- 教師ガイドモーダル -->
<div id="teacherGuideModal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-cyan-400">教師向けガイド</h2>
        <button type="button" id="teacherGuideModal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-300">
        <div class="glass-panel bg-blue-500/10 rounded-lg p-4 border border-blue-400/30">
          <h3 class="font-semibold text-blue-400 mb-2">📚 学習目標の設定</h3>
          <p class="text-sm">明確な学習目標を設定し、学習者がアクティブに参加できる環境を作りましょう。</p>
        </div>
        
        <div class="glass-panel bg-green-500/10 rounded-lg p-4 border border-green-400/30">
          <h3 class="font-semibold text-green-400 mb-2">🎯 効果的な質問設計</h3>
          <p class="text-sm">学習者の思考を促進する質問を設計し、多様な回答を引き出しましょう。</p>
        </div>
        
        <div class="glass-panel bg-purple-500/10 rounded-lg p-4 border border-purple-400/30">
          <h3 class="font-semibold text-purple-400 mb-2">📊 データ活用</h3>
          <p class="text-sm">収集したデータを分析し、学習指導の改善に活用しましょう。</p>
        </div>
      </div>
      
      <div class="flex justify-end mt-6">
        <button type="button" id="teacherGuideModal-close-btn" class="btn btn-primary">理解しました</button>
      </div>
    </div>
  </div>
</div>

<!-- 汎用アラートモーダル -->
<div id="alert-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-md w-full">
      <div class="flex items-center gap-3 mb-4">
        <svg id="alert-modal-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 id="alert-modal-title" class="text-xl font-bold"></h3>
      </div>
      <p id="alert-modal-message" class="text-gray-300 mb-6"></p>
      <div class="flex justify-end">
        <button type="button" id="alert-modal-close-btn" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>
</div>

<!-- ローディングモーダル -->
<div id="loading-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-md w-full text-center">
      <div class="spinner mx-auto mb-4"></div>
      <h3 id="loading-modal-title" class="text-xl font-bold text-cyan-400 mb-2">処理中...</h3>
      <p id="loading-modal-message" class="text-gray-300">しばらくお待ちください</p>
    </div>
  </div>
</div>

<!-- 使い方ガイドモーダル -->
<div id="usage-guide-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-amber-400">
          <svg class="w-8 h-8 inline mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          使い方ガイド
        </h3>
        <button type="button" id="usage-guide-modal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500" aria-label="閉じる">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-300">
        <!-- 回答ボード管理の流れ -->
        <div class="glass-panel bg-amber-500/10 rounded-lg p-6 border border-amber-400/30">
          <h4 class="font-semibold text-amber-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
            回答ボード管理の流れ
          </h4>
          <ol class="list-decimal list-inside space-y-3 text-sm">
            <li><strong class="text-amber-300">データソース準備</strong><br>
              <span class="text-gray-400">• 自動作成：GoogleフォームとスプレッドシートがWorkspace連携で自動作成</span><br>
              <span class="text-gray-400">• 外部連携：既存のフォーム・シートもURL入力で連携可能</span><br>
              <span class="text-gray-400">• サービスアカウント共有：スプレッドシートが自動でサービスアカウントと共有</span>
            </li>
            <li><strong class="text-amber-300">シート選択と設定</strong><br>
              <span class="text-gray-400">• 動的シート検出：連携スプレッドシート内の利用可能シートを自動取得</span><br>
              <span class="text-gray-400">• シート切り替え：複数シート間での簡単な選択・切り替え</span><br>
              <span class="text-gray-400">• リアルタイムプレビュー：シートヘッダーとデータ構造の即座確認</span>
            </li>
            <li><strong class="text-amber-300">高度な列設定</strong><br>
              <span class="text-gray-400">• AI自動判定：機械学習による列の用途の自動識別</span><br>
              <span class="text-gray-400">• 手動調整：ドロップダウンによる精密な列マッピング制御</span><br>
              <span class="text-gray-400">• 必須・任意設定：回答列（必須）、理由・名前・クラス列（任意）</span>
            </li>
            <li><strong class="text-amber-300">表示・公開管理</strong><br>
              <span class="text-gray-400">• 表示モード制御：匿名・記名表示の切り替え</span><br>
              <span class="text-gray-400">• リアクション管理：いいね数表示・種類の設定</span><br>
              <span class="text-gray-400">• 公開ステータス管理：ワンクリックでの公開・非公開切り替え</span>
            </li>
            <li><strong class="text-amber-300">ユーザー・アクセス管理</strong><br>
              <span class="text-gray-400">• ドメインベース制御：G Suite/Workspaceドメインの自動検証</span><br>
              <span class="text-gray-400">• ユーザー登録システム：一意ID管理による集中ユーザーデータベース</span>
            </li>
          </ol>
          
          <div class="mt-4 p-3 bg-amber-800/30 rounded text-sm">
            <strong class="text-amber-300">💡 管理のヒント</strong><br>
            <span class="text-gray-300">• 公開後は管理モード切り替えで学習者と同じ画面を確認可能</span><br>
            <span class="text-gray-300">• AI活用：列の自動判定機能で設定時間を大幅短縮</span><br>
            <span class="text-gray-300">• リアルタイム更新：フォーム回答が即座にボードに反映</span><br>
            <span class="text-gray-300">• バックアップ機能：設定の自動バックアップでデータ保護</span>
          </div>
        </div>
        
        <!-- セキュリティについて -->
        <div class="glass-panel bg-blue-500/10 rounded-lg p-6 border border-blue-400/30">
          <h4 class="font-semibold text-blue-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            </svg>
            セキュリティについて
          </h4>
          
          <div class="space-y-4">
            <div class="bg-blue-600/20 border border-blue-400/40 rounded-lg p-4">
              <h5 class="font-medium text-blue-300 mb-2">🔒 データベースアクセス制御</h5>
              <ul class="text-sm space-y-1 text-gray-300">
                <li>• <strong>限定アクセス</strong>：データベースにアクセスできるのは<strong class="text-blue-300">ウェブアプリをデプロイしたユーザー</strong>と<strong class="text-blue-300">サービスアカウント</strong>のみ</li>
                <li>• <strong>完全非公開設定</strong>：システム上、データベースは非公開設定が必須となっており、外部からのアクセスは一切不可能</li>
                <li>• <strong>個別データ分離</strong>：各ユーザーのデータは専用スプレッドシートで完全分離</li>
                <li>• <strong>自動権限管理</strong>：サービスアカウントへの編集権限付与を自動実行</li>
              </ul>
            </div>
            
            <div class="bg-green-600/20 border border-green-400/40 rounded-lg p-4">
              <h5 class="font-medium text-green-300 mb-2">🛡️ 多層セキュリティ対策</h5>
              <ul class="text-sm space-y-1 text-gray-300">
                <li>• <strong>暗号化認証</strong>：JWT ベースのサービスアカウント認証とトークン自動更新</li>
                <li>• <strong>ドメイン制限</strong>：組織展開時のドメインベースアクセス制御</li>
                <li>• <strong>入力検証</strong>：全入力データの包括的検証とサニタイゼーション</li>
                <li>• <strong>監査ログ</strong>：システム活動の完全追跡とログ記録</li>
              </ul>
            </div>
            
            <div class="bg-purple-600/20 border border-purple-400/40 rounded-lg p-4">
              <h5 class="font-medium text-purple-300 mb-2">👥 ユーザー保護</h5>
              <ul class="text-sm space-y-1 text-gray-300">
                <li>• <strong>学習者データ保護</strong>：一般ユーザーは他の回答者データや基盤データベースにアクセス不可</li>
                <li>• <strong>管理者権限分離</strong>：階層的アクセスレベルによる適切な権限管理</li>
                <li>• <strong>セッションセキュリティ</strong>：自動クリーンアップ機能付きセキュアセッション管理</li>
              </ul>
            </div>
          </div>
          
          <div class="mt-4 p-3 bg-blue-800/30 rounded text-sm text-blue-100">
            <strong>📋 重要</strong>：回答ボード使用者の個人情報や回答データは厳重に保護され、教育目的以外での使用や第三者による不正アクセスを防ぐ設計となっています。
          </div>
        </div>
        
        <!-- Google連携の利点 -->
        <div class="glass-panel bg-green-500/10 rounded-lg p-6 border border-green-400/30">
          <h4 class="font-semibold text-green-400 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24">
              <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285f4"/>
              <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34a853"/>
              <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#fbbc05"/>
              <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#ea4335"/>
            </svg>
            Google連携の利点
          </h4>
          <ul class="text-sm space-y-2 text-gray-300">
            <li>• <strong class="text-green-300">自動フォーム作成</strong>：回答収集フォームの即座生成</li>
            <li>• <strong class="text-green-300">リアルタイム同期</strong>：フォーム回答の即座反映</li>
            <li>• <strong class="text-green-300">セキュアな共有</strong>：学校ドメイン内でのデータ管理</li>
            <li>• <strong class="text-green-300">バックアップ機能</strong>：Google Drive による自動バックアップ</li>
            <li>• <strong class="text-green-300">分析活用</strong>：Google Sheets での詳細データ分析</li>
          </ul>
        </div>
      </div>
      
      <div class="flex justify-end mt-6">
        <button type="button" id="usage-guide-modal-close-btn" class="btn btn-primary">理解しました</button>
      </div>
    </div>
  </div>
</div>

<!-- セキュリティモーダル -->
<div id="security-modal" class="fixed inset-0 bg-black/80 z-50 hidden" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-full p-4">
    <div class="glass-panel rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-cyan-400">セキュリティとデータ保護</h3>
        <button type="button" id="security-modal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-300">
        <div class="glass-panel bg-blue-500/10 rounded-lg p-4 border border-blue-400/30">
          <h4 class="font-semibold text-blue-400 mb-2">🔒 データの暗号化と保護</h4>
          <p class="text-sm">すべてのデータ通信はHTTPS暗号化により保護されており、Google Workspace のセキュリティ基準に準拠しています。学習者の個人情報は適切に保護されます。</p>
        </div>
        
        <div class="glass-panel bg-green-500/10 rounded-lg p-4 border border-green-400/30">
          <h4 class="font-semibold text-green-400 mb-2">👥 アクセス制御</h4>
          <p class="text-sm">管理者権限により、教師のみがシート設定や公開・非公開の切り替えを行えます。学習者は閲覧と回答のみ可能で、他の学習者のデータを変更することはできません。</p>
        </div>
        
        <div class="glass-panel bg-purple-500/10 rounded-lg p-4 border border-purple-400/30">
          <h4 class="font-semibold text-purple-400 mb-2">📊 データの管理と保存</h4>
          <p class="text-sm">回答データはGoogle スプレッドシートに保存され、学校のGoogle Workspace 管理ポリシーに従って管理されます。データは教育目的でのみ使用されます。</p>
        </div>
        
        <div class="glass-panel bg-yellow-500/10 rounded-lg p-4 border border-yellow-400/30">
          <h4 class="font-semibold text-yellow-400 mb-2">🛡️ プライバシー設定</h4>
          <p class="text-sm">名前の表示・非表示、リアクション数の表示設定により、学習環境に応じて適切なプライバシーレベルを設定できます。匿名での議論も可能です。</p>
        </div>
        
        <div class="glass-panel bg-red-500/10 rounded-lg p-4 border border-red-400/30">
          <h4 class="font-semibold text-red-400 mb-2">⚠️ 注意事項</h4>
          <p class="text-sm">機密性の高い個人情報や学外秘の内容は投稿しないよう、学習者に事前に指導してください。適切な利用ガイドラインを設定することが重要です。</p>
        </div>
      </div>
      
      <div class="flex justify-end mt-6">
        <button type="button" id="security-modal-confirm" class="btn btn-primary">理解しました</button>
      </div>
    </div>
  </div>
</div>

<script>
// 共通モーダル管理クラス
class SharedModals {
  constructor() {
    this.setupEventListeners();
  }

  // 確認モーダルの表示
  showConfirmation(title, message, onConfirm, onCancel) {
    const modal = document.getElementById('confirmation-modal');
    const titleEl = document.getElementById('modal-title');
    const messageEl = document.getElementById('modal-message');
    const confirmBtn = document.getElementById('modal-confirm-btn');
    const cancelBtn = document.getElementById('modal-cancel-btn');

    // null checks for modal elements
    if (!modal || !titleEl || !messageEl || !confirmBtn || !cancelBtn) {
      console.error('モーダル要素が見つかりません');
      return;
    }

    titleEl.textContent = title;
    messageEl.textContent = message;
    
    modal.classList.remove('hidden');

    // イベントリスナーを一度削除してから追加
    confirmBtn.onclick = () => {
      this.hideModal('confirmation-modal');
      if (onConfirm) onConfirm();
    };
    
    cancelBtn.onclick = () => {
      this.hideModal('confirmation-modal');
      if (onCancel) onCancel();
    };
  }

  // アラートモーダルの表示
  showAlert(title, message, type = 'info') {
    const modal = document.getElementById('alert-modal');
    const titleEl = document.getElementById('alert-modal-title');
    const messageEl = document.getElementById('alert-modal-message');
    const iconEl = document.getElementById('alert-modal-icon');
    const closeBtn = document.getElementById('alert-modal-close-btn');

    // null checks for modal elements
    if (!modal || !titleEl || !messageEl || !iconEl || !closeBtn) {
      console.error('アラートモーダル要素が見つかりません');
      return;
    }

    titleEl.textContent = title;
    messageEl.textContent = message;
    
    // アイコンとカラーを設定
    const typeConfig = {
      info: { color: 'text-blue-400', icon: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },
      success: { color: 'text-green-400', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' },
      warning: { color: 'text-yellow-400', icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z' },
      error: { color: 'text-red-400', icon: 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' }
    };
    
    const config = typeConfig[type] || typeConfig.info;
    titleEl.className = `text-xl font-bold ${config.color}`;
    iconEl.className = `w-8 h-8 ${config.color}`;
    iconEl.querySelector('path').setAttribute('d', config.icon);
    
    modal.classList.remove('hidden');
    
    closeBtn.onclick = () => this.hideModal('alert-modal');
  }

  // ローディングモーダルの表示
  showLoading(title = '処理中...', message = 'しばらくお待ちください') {
    const modal = document.getElementById('loading-modal');
    const titleEl = document.getElementById('loading-modal-title');
    const messageEl = document.getElementById('loading-modal-message');
    
    if (titleEl) titleEl.textContent = title;
    if (messageEl) messageEl.textContent = message;
    
    if (modal) modal.classList.remove('hidden');
  }

  // モーダルの非表示
  hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('hidden');
    }
  }

  // イベントリスナーの設定
  setupEventListeners() {
    // ESCキーでモーダルを閉じる
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const modals = [
          'confirmation-modal',
          'publish-modal',
          'privacy-modal',
          'digital-citizenship-modal',
          'teacherGuideModal',
          'alert-modal',
          'loading-modal',
          'security-modal',
          'usage-guide-modal'
        ];
        
        modals.forEach(modalId => {
          const modal = document.getElementById(modalId);
          if (modal && !modal.classList.contains('hidden')) {
            this.hideModal(modalId);
          }
        });
      }
    });

    // クローズボタンの設定
    const closeButtons = [
      'digital-citizenship-modal-close',
      'digital-citizenship-modal-close-btn',
      'teacherGuideModal-close',
      'teacherGuideModal-close-btn',
      'usage-guide-modal-close',
      'usage-guide-modal-close-btn'
    ];
    
    closeButtons.forEach(buttonId => {
      const button = document.getElementById(buttonId);
      if (button) {
        button.onclick = () => {
          if (buttonId.includes('digital-citizenship')) {
            this.hideModal('digital-citizenship-modal');
          } else if (buttonId.includes('teacherGuide')) {
            this.hideModal('teacherGuideModal');
          } else if (buttonId.includes('usage-guide')) {
            this.hideModal('usage-guide-modal');
          }
        };
      }
    });
  }
}

// グローバルインスタンスの作成
window.sharedModals = new SharedModals();
</script>