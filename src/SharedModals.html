<!-- SharedModals.html - 共通モーダルコンポーネント -->
<!-- GAS include用のモーダルコンポーネント集 -->

<!-- 確認モーダル -->
<div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-6 max-w-md w-full">
    <h3 id="modal-title" class="text-xl font-bold text-cyan-400 mb-4"></h3>
    <p id="modal-message" class="text-gray-300 mb-6"></p>
    <div class="flex justify-end gap-3">
      <button type="button" id="modal-cancel-btn" class="btn btn-secondary">キャンセル</button>
      <button type="button" id="modal-confirm-btn" class="btn btn-primary">はい、実行します</button>
    </div>
  </div>
</div>

<!-- 公開モーダル -->
<div id="publish-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-6 max-w-md w-full">
    <h3 class="text-xl font-bold text-cyan-400 mb-4">
      <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      公開準備完了
    </h3>
    <p class="text-gray-300 mb-6">
      シートの設定が完了しました。<br>
      学習者がアクセスできるよう公開しますか？
    </p>
    <div class="flex justify-end gap-3">
      <button type="button" id="publish-modal-private-btn" class="btn btn-secondary">非公開のまま</button>
      <button type="button" id="publish-modal-publish-btn" class="btn btn-primary">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
        </svg>
        公開する
      </button>
    </div>
  </div>
</div>

<!-- プライバシーモーダル -->
<div id="privacy-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="glass-panel rounded-xl p-6 max-w-lg w-full mx-4">
    <div class="flex items-center gap-3 mb-4">
      <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
      </svg>
      <h3 class="text-xl font-bold text-yellow-400">プライバシーとデータ保護</h3>
    </div>
    <div class="space-y-4 text-gray-300">
      <p>このシステムは教育目的でのみ使用されます。</p>
      <div class="glass-panel bg-yellow-500/10 rounded-lg p-4 border border-yellow-400/30">
        <h4 class="font-semibold text-yellow-400 mb-2">重要な注意事項</h4>
        <ul class="text-sm space-y-1">
          <li>• 個人情報は適切に保護されます</li>
          <li>• 回答データは教育目的でのみ使用されます</li>
          <li>• 管理者は適切なアクセス権限を持っています</li>
          <li>• データは法的要件に従って管理されます</li>
        </ul>
      </div>
    </div>
    <div class="flex justify-end gap-3 mt-6">
      <button type="button" id="privacy-modal-cancel" class="btn btn-secondary">キャンセル</button>
      <button type="button" id="privacy-modal-continue" class="btn btn-primary">理解しました、継続</button>
    </div>
  </div>
</div>

<!-- デジタルシティズンシップモーダル -->
<div id="digital-citizenship-modal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="glass-panel rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold text-cyan-400">デジタルシティズンシップ</h3>
      <button type="button" id="digital-citizenship-modal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="space-y-6 text-gray-300">
      <div class="glass-panel bg-blue-500/10 rounded-lg p-4 border border-blue-400/30">
        <h4 class="font-semibold text-blue-400 mb-2">🌐 責任あるデジタル利用</h4>
        <p class="text-sm">デジタルツールを使用する際は、倫理的で責任ある行動を心がけましょう。</p>
      </div>
      
      <div class="glass-panel bg-green-500/10 rounded-lg p-4 border border-green-400/30">
        <h4 class="font-semibold text-green-400 mb-2">🤝 相互尊重</h4>
        <p class="text-sm">他の利用者を尊重し、建設的なコミュニケーションを行いましょう。</p>
      </div>
      
      <div class="glass-panel bg-purple-500/10 rounded-lg p-4 border border-purple-400/30">
        <h4 class="font-semibold text-purple-400 mb-2">🛡️ プライバシー保護</h4>
        <p class="text-sm">個人情報を適切に保護し、他者のプライバシーも尊重しましょう。</p>
      </div>
      
      <div class="glass-panel bg-red-500/10 rounded-lg p-4 border border-red-400/30">
        <h4 class="font-semibold text-red-400 mb-2">⚖️ 法的・倫理的責任</h4>
        <p class="text-sm">デジタル空間でも法的・倫理的責任を理解し、適切に行動しましょう。</p>
      </div>
    </div>
    
    <div class="flex justify-end mt-6">
      <button type="button" id="digital-citizenship-modal-close-btn" class="btn btn-primary">理解しました</button>
    </div>
  </div>
</div>

<!-- 教師ガイドモーダル -->
<div id="teacherGuideModal" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 hidden" role="dialog" aria-modal="true">
  <div class="glass-panel rounded-xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-cyan-400">教師向けガイド</h2>
      <button type="button" id="teacherGuideModal-close" class="p-2 text-gray-400 transition-colors rounded-full hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500" aria-label="閉じる">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <div class="space-y-6 text-gray-300">
      <div class="glass-panel bg-blue-500/10 rounded-lg p-4 border border-blue-400/30">
        <h3 class="font-semibold text-blue-400 mb-2">📚 学習目標の設定</h3>
        <p class="text-sm">明確な学習目標を設定し、学習者がアクティブに参加できる環境を作りましょう。</p>
      </div>
      
      <div class="glass-panel bg-green-500/10 rounded-lg p-4 border border-green-400/30">
        <h3 class="font-semibold text-green-400 mb-2">🎯 効果的な質問設計</h3>
        <p class="text-sm">学習者の思考を促進する質問を設計し、多様な回答を引き出しましょう。</p>
      </div>
      
      <div class="glass-panel bg-purple-500/10 rounded-lg p-4 border border-purple-400/30">
        <h3 class="font-semibold text-purple-400 mb-2">📊 データ活用</h3>
        <p class="text-sm">収集したデータを分析し、学習指導の改善に活用しましょう。</p>
      </div>
    </div>
    
    <div class="flex justify-end mt-6">
      <button type="button" id="teacherGuideModal-close-btn" class="btn btn-primary">理解しました</button>
    </div>
  </div>
</div>

<!-- 汎用アラートモーダル -->
<div id="alert-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-6 max-w-md w-full">
    <div class="flex items-center gap-3 mb-4">
      <svg id="alert-modal-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 id="alert-modal-title" class="text-xl font-bold"></h3>
    </div>
    <p id="alert-modal-message" class="text-gray-300 mb-6"></p>
    <div class="flex justify-end">
      <button type="button" id="alert-modal-close-btn" class="btn btn-primary">OK</button>
    </div>
  </div>
</div>

<!-- ローディングモーダル -->
<div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-6 max-w-md w-full text-center">
    <div class="spinner mx-auto mb-4"></div>
    <h3 id="loading-modal-title" class="text-xl font-bold text-cyan-400 mb-2">処理中...</h3>
    <p id="loading-modal-message" class="text-gray-300">しばらくお待ちください</p>
  </div>
</div>

<script>
// 共通モーダル管理クラス
class SharedModals {
  constructor() {
    this.setupEventListeners();
  }

  // 確認モーダルの表示
  showConfirmation(title, message, onConfirm, onCancel) {
    const modal = document.getElementById('confirmation-modal');
    const titleEl = document.getElementById('modal-title');
    const messageEl = document.getElementById('modal-message');
    const confirmBtn = document.getElementById('modal-confirm-btn');
    const cancelBtn = document.getElementById('modal-cancel-btn');

    titleEl.textContent = title;
    messageEl.textContent = message;
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');

    // イベントリスナーを一度削除してから追加
    confirmBtn.onclick = () => {
      this.hideModal('confirmation-modal');
      if (onConfirm) onConfirm();
    };
    
    cancelBtn.onclick = () => {
      this.hideModal('confirmation-modal');
      if (onCancel) onCancel();
    };
  }

  // アラートモーダルの表示
  showAlert(title, message, type = 'info') {
    const modal = document.getElementById('alert-modal');
    const titleEl = document.getElementById('alert-modal-title');
    const messageEl = document.getElementById('alert-modal-message');
    const iconEl = document.getElementById('alert-modal-icon');
    const closeBtn = document.getElementById('alert-modal-close-btn');

    titleEl.textContent = title;
    messageEl.textContent = message;
    
    // アイコンとカラーを設定
    const typeConfig = {
      info: { color: 'text-blue-400', icon: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },
      success: { color: 'text-green-400', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' },
      warning: { color: 'text-yellow-400', icon: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z' },
      error: { color: 'text-red-400', icon: 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z' }
    };
    
    const config = typeConfig[type] || typeConfig.info;
    titleEl.className = `text-xl font-bold ${config.color}`;
    iconEl.className = `w-8 h-8 ${config.color}`;
    iconEl.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${config.icon}"></path>`;
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');

    closeBtn.onclick = () => this.hideModal('alert-modal');
  }

  // ローディングモーダルの表示
  showLoading(title = '処理中...', message = 'しばらくお待ちください') {
    const modal = document.getElementById('loading-modal');
    const titleEl = document.getElementById('loading-modal-title');
    const messageEl = document.getElementById('loading-modal-message');

    titleEl.textContent = title;
    messageEl.textContent = message;
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  // モーダルの非表示
  hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  }

  // イベントリスナーの設定
  setupEventListeners() {
    // ESCキーでモーダルを閉じる
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const modals = [
          'confirmation-modal',
          'publish-modal',
          'privacy-modal',
          'digital-citizenship-modal',
          'teacherGuideModal',
          'alert-modal'
        ];
        
        modals.forEach(modalId => {
          const modal = document.getElementById(modalId);
          if (modal && !modal.classList.contains('hidden')) {
            this.hideModal(modalId);
          }
        });
      }
    });

    // クローズボタンの設定
    const closeButtons = [
      'digital-citizenship-modal-close',
      'digital-citizenship-modal-close-btn',
      'teacherGuideModal-close',
      'teacherGuideModal-close-btn'
    ];
    
    closeButtons.forEach(buttonId => {
      const button = document.getElementById(buttonId);
      if (button) {
        button.onclick = () => {
          if (buttonId.includes('digital-citizenship')) {
            this.hideModal('digital-citizenship-modal');
          } else if (buttonId.includes('teacherGuide')) {
            this.hideModal('teacherGuideModal');
          }
        };
      }
    });
  }
}

// グローバルインスタンスの作成
window.sharedModals = new SharedModals();
</script>