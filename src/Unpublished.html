<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <base target="_top">
    <title>StudyQuest -ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰- - å›ç­”ãƒœãƒ¼ãƒ‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <?= include('UnifiedStyles'); ?>
</head>
<body class="bg-gray-800 text-white flex items-center justify-center h-screen">
    <div class="text-center p-4 max-w-lg">
        <? if (typeof isOwner !== 'undefined' && isOwner) { ?>
            <!-- ç®¡ç†è€…ç”¨ç”»é¢ï¼šçµ±åˆã•ã‚ŒãŸç®¡ç†ãƒ‘ãƒãƒ« -->
            <div class="glass-panel rounded-xl p-8 shadow-2xl">
                <h1 class="text-3xl font-bold mb-4 text-yellow-300">StudyQuest -ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰- ç®¡ç†ç”»é¢</h1>
                <p class="text-gray-400 mb-6">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†</p>
                
                <? if (typeof ownerName !== 'undefined' && ownerName) { ?>
                <p class="text-xs text-gray-500 mb-4">ç®¡ç†è€…: <?= ownerName ?></p>
                <? } ?>
                
                <!-- ç”Ÿå¾’ç”¨URLè¡¨ç¤º -->
                <div class="mb-6 p-4 bg-gray-700 rounded-lg">
                    <p class="text-sm text-gray-400 mb-2">ç”Ÿå¾’ç”¨URLï¼ˆå›ºå®šï¼‰:</p>
                    <div class="flex gap-2">
                        <input type="text" id="board-url" readonly value="<?= boardUrl || '' ?>"
                               class="flex-1 p-2 bg-gray-600 border border-gray-500 rounded text-sm cursor-pointer hover:bg-gray-500"
                               onclick="this.select()">
                        <button type="button" onclick="copyBoardUrl()" 
                                class="px-3 py-2 bg-cyan-600 hover:bg-cyan-700 rounded text-sm">
                          ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">ã“ã®URLã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€åº¦ç”Ÿå¾’ã«å…±æœ‰ã™ã‚Œã°ã€ãšã£ã¨ä½¿ã„ç¶šã‘ã‚‰ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLå…¥åŠ› - æ”¹å–„ç‰ˆ -->
                <div class="mb-8 text-center">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-cyan-500/20 to-blue-500/20 flex items-center justify-center border-2 border-cyan-400/30">
                        <svg class="w-10 h-10 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold mb-3 text-white">ã“ã“ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼</h3>
                    <p class="text-gray-400 mb-6">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è¿½åŠ ã—ã¦ã€ç¾ã—ã„å›ç­”ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†</p>
                    
                    <div class="max-w-md mx-auto space-y-4">
                        <div class="bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg p-4 border border-blue-400/30 glass-panel slide-in">
                            <h3 class="font-semibold text-blue-300 mb-2 flex items-center gap-2">
                              <span role="img" aria-label="ã‚¢ã‚¤ãƒ‡ã‚¢">ğŸ’¡</span>
                              ç°¡å˜3ã‚¹ãƒ†ãƒƒãƒ—
                            </h3>
                            <ol class="text-sm text-blue-200 text-left space-y-1 list-decimal list-inside" role="list">
                                <li>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’ã‚³ãƒ”ãƒ¼</li>
                                <li>ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è²¼ã‚Šä»˜ã‘</li>
                                <li>ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                            </ol>
                        </div>
                        
                        <div class="space-y-3">
                            <input type="url" id="spreadsheet-url-input" 
                                   placeholder="https://docs.google.com/spreadsheets/d/..."
                                   class="w-full p-4 rounded-lg bg-gray-700 border-2 border-gray-600 text-white focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 text-center transition-all"
                                   aria-label="Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›">
                            <button type="button" id="add-spreadsheet-btn" 
                                    class="cta-button w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-lg font-bold text-lg transition-all transform hover:scale-105 shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-gray-800"
                                    aria-label="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ã‚·ã‚¹ãƒ†ãƒ ã«è¿½åŠ ">
                              <span role="img" aria-label="ãƒ­ã‚±ãƒƒãƒˆ">ğŸš€</span> ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ 
                            </button>
                        </div>
                        <p class="text-xs text-gray-500">URLå½¢å¼: https://docs.google.com/spreadsheets/d/[ID]/edit</p>
                    </div>
                </div>

                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
                <div id="message-area" class="mb-4 text-center text-sm h-5" aria-live="polite" role="status"></div>
                
                <!-- èª¬æ˜ -->
                <div class="text-left space-y-2 text-sm text-gray-300">
                    <p>ğŸ“ <strong>ä½¿ã„æ–¹:</strong></p>
                    <ol class="list-decimal list-inside space-y-1 ml-4">
                        <li>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’ä¸Šè¨˜ã«å…¥åŠ›</li>
                        <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã€å›ç­”ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                        <li>ç”Ÿå¾’ç”¨URLã‚’ç”Ÿå¾’ã«å…±æœ‰ã—ã¦ãã ã•ã„</li>
                    </ol>
                </div>
            </div>
        <? } else { ?>
            <!-- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ç”»é¢ -->
            <div class="glass-panel rounded-xl p-8 shadow-2xl">
                <h1 class="text-4xl font-bold mb-4 text-yellow-300">ç¾åœ¨ã¯æº–å‚™ä¸­ã§ã™</h1>
                <p class="text-gray-400 mb-4">å…ˆç”ŸãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®šã—ãŸã‚‰ã€å›ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                
                <? if (typeof ownerName !== 'undefined' && ownerName) { ?>
                <p class="text-xs text-gray-500">ç®¡ç†è€…: <?= ownerName ?></p>
                <? } ?>
                
                <div class="mt-6">
                    <button type="button" onclick="location.reload()" 
                            class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold">
                        æ›´æ–°
                    </button>
                </div>
            </div>
        <? } ?>
    </div>

    <script>
        function copyBoardUrl() {
            const urlInput = document.getElementById('board-url');
            if (urlInput) {
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(urlInput.value);
                    } else {
                        urlInput.select();
                        document.execCommand('copy');
                    }
                    showMessage('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
                } catch (error) {
                    showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('message-area');
            if (messageArea) {
                const colors = {
                    success: 'text-green-400 success-state',
                    error: 'text-red-400 error-state', 
                    info: 'text-blue-400'
                };
                messageArea.className = `mb-4 text-center text-sm min-h-[1.25rem] ${colors[type] || 'text-gray-400'}`;
                messageArea.textContent = message;
                
                // Add visual feedback animation
                if (type === 'success' || type === 'error') {
                    setTimeout(() => {
                        messageArea.classList.remove('success-state', 'error-state');
                    }, 600);
                }
                
                setTimeout(() => {
                    messageArea.textContent = '';
                    messageArea.className = 'mb-4 text-center text-sm min-h-[1.25rem]';
                }, 3000);
            }
        }

        // ç®¡ç†è€…ç”¨æ©Ÿèƒ½
        <? if (typeof isOwner !== 'undefined' && isOwner) { ?>
        document.getElementById('add-spreadsheet-btn').addEventListener('click', function() {
            const urlInput = document.getElementById('spreadsheet-url-input');
            const url = urlInput.value.trim();
            
            if (!url) {
                showMessage('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // URLå½¢å¼ãƒã‚§ãƒƒã‚¯
            const googleSheetsPattern = /^https:\/\/docs\.google\.com\/spreadsheets\/d\/[a-zA-Z0-9-_]{10,}/;
            if (!googleSheetsPattern.test(url)) {
                showMessage('æœ‰åŠ¹ãªGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            this.disabled = true;
            this.classList.add('loading-state');
            this.innerHTML = '<span role="img" aria-label="èª­ã¿è¾¼ã¿ä¸­">â³</span> è¿½åŠ ä¸­...';
            showMessage('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ä¸­...', 'info');
            
            // ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
            google.script.run
                .withSuccessHandler((result) => {
                    showMessage(result.message || 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ', 'success');
                    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å›ç­”ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                })
                .withFailureHandler((error) => {
                    showMessage('ã‚¨ãƒ©ãƒ¼: ' + (error.message || 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ'), 'error');
                    this.disabled = false;
                    this.classList.remove('loading-state');
                    this.innerHTML = '<span role="img" aria-label="ãƒ­ã‚±ãƒƒãƒˆ">ğŸš€</span> ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ';
                })
                .addSpreadsheetUrl(url);
        });

        // Enterã‚­ãƒ¼ã§ã‚‚è¿½åŠ 
        document.getElementById('spreadsheet-url-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('add-spreadsheet-btn').click();
            }
        });
        <? } ?>
    </script>
</body>
</html>