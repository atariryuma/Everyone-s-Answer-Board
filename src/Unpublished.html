<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <title>StudyQuest - å›ç­”ãƒœãƒ¼ãƒ‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { margin: 0; }
      .glass-panel { 
        background: rgba(26,27,38,0.7); 
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px); 
        border: 1px solid rgba(255,255,255,0.1); 
      }
    </style>
</head>
<body class="bg-gray-800 text-white flex items-center justify-center h-screen">
    <div class="text-center p-4 max-w-lg">
        <? if (typeof isOwner !== 'undefined' && isOwner) { ?>
            <!-- ç®¡ç†è€…ç”¨ç”»é¢ï¼šçµ±åˆã•ã‚ŒãŸç®¡ç†ãƒ‘ãƒãƒ« -->
            <div class="glass-panel rounded-xl p-8 shadow-2xl">
                <h1 class="text-3xl font-bold mb-4 text-yellow-300">StudyQuest ç®¡ç†ç”»é¢</h1>
                <p class="text-gray-400 mb-6">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¦å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†</p>
                
                <? if (typeof ownerName !== 'undefined' && ownerName) { ?>
                <p class="text-xs text-gray-500 mb-4">ç®¡ç†è€…: <?= ownerName ?></p>
                <? } ?>
                
                <!-- ç”Ÿå¾’ç”¨URLè¡¨ç¤º -->
                <div class="mb-6 p-4 bg-gray-700 rounded-lg">
                    <p class="text-sm text-gray-400 mb-2">ç”Ÿå¾’ç”¨URLï¼ˆå›ºå®šï¼‰:</p>
                    <div class="flex gap-2">
                        <input type="text" id="board-url" readonly value="<?= boardUrl || '' ?>"
                               class="flex-1 p-2 bg-gray-600 border border-gray-500 rounded text-sm cursor-pointer hover:bg-gray-500"
                               onclick="this.select()">
                        <button type="button" onclick="copyBoardUrl()" 
                                class="px-3 py-2 bg-cyan-600 hover:bg-cyan-700 rounded text-sm">
                          ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">ã“ã®URLã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€åº¦ç”Ÿå¾’ã«å…±æœ‰ã™ã‚Œã°ã€ãšã£ã¨ä½¿ã„ç¶šã‘ã‚‰ã‚Œã¾ã™ã€‚</p>
                </div>
                
                <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLå…¥åŠ› -->
                <div class="mb-6">
                    <h3 class="font-semibold mb-3 text-left">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ </h3>
                    <div class="space-y-3">
                        <div class="flex gap-2">
                            <input type="url" id="spreadsheet-url-input" 
                                   placeholder="https://docs.google.com/spreadsheets/d/..."
                                   class="flex-1 p-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-2 focus:ring-cyan-400">
                            <button type="button" id="add-spreadsheet-btn" 
                                    class="px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold">
                              è¿½åŠ 
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 text-left">Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>

                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
                <div id="message-area" class="mb-4 text-center text-sm h-5" aria-live="polite" role="status"></div>
                
                <!-- èª¬æ˜ -->
                <div class="text-left space-y-2 text-sm text-gray-300">
                    <p>ğŸ“ <strong>ä½¿ã„æ–¹:</strong></p>
                    <ol class="list-decimal list-inside space-y-1 ml-4">
                        <li>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’ä¸Šè¨˜ã«å…¥åŠ›</li>
                        <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã€å›ç­”ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</li>
                        <li>ç”Ÿå¾’ç”¨URLã‚’ç”Ÿå¾’ã«å…±æœ‰ã—ã¦ãã ã•ã„</li>
                    </ol>
                </div>
            </div>
        <? } else { ?>
            <!-- ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ç”»é¢ -->
            <div class="glass-panel rounded-xl p-8 shadow-2xl">
                <h1 class="text-4xl font-bold mb-4 text-yellow-300">ç¾åœ¨ã¯æº–å‚™ä¸­ã§ã™</h1>
                <p class="text-gray-400 mb-4">å…ˆç”ŸãŒã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¨­å®šã—ãŸã‚‰ã€å›ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                
                <? if (typeof ownerName !== 'undefined' && ownerName) { ?>
                <p class="text-xs text-gray-500">ç®¡ç†è€…: <?= ownerName ?></p>
                <? } ?>
                
                <div class="mt-6">
                    <button type="button" onclick="location.reload()" 
                            class="px-6 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold">
                        æ›´æ–°
                    </button>
                </div>
            </div>
        <? } ?>
    </div>

    <script>
        function copyBoardUrl() {
            const urlInput = document.getElementById('board-url');
            if (urlInput) {
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(urlInput.value);
                    } else {
                        urlInput.select();
                        document.execCommand('copy');
                    }
                    showMessage('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
                } catch (error) {
                    showMessage('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('message-area');
            if (messageArea) {
                const colors = {
                    success: 'text-green-400',
                    error: 'text-red-400',
                    info: 'text-blue-400'
                };
                messageArea.className = `mb-4 text-center text-sm h-5 ${colors[type] || 'text-gray-400'}`;
                messageArea.textContent = message;
                
                setTimeout(() => {
                    messageArea.textContent = '';
                }, 3000);
            }
        }

        // ç®¡ç†è€…ç”¨æ©Ÿèƒ½
        <? if (typeof isOwner !== 'undefined' && isOwner) { ?>
        document.getElementById('add-spreadsheet-btn').addEventListener('click', function() {
            const urlInput = document.getElementById('spreadsheet-url-input');
            const url = urlInput.value.trim();
            
            if (!url) {
                showMessage('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // URLå½¢å¼ãƒã‚§ãƒƒã‚¯
            const googleSheetsPattern = /^https:\/\/docs\.google\.com\/spreadsheets\/d\/[a-zA-Z0-9-_]{10,}/;
            if (!googleSheetsPattern.test(url)) {
                showMessage('æœ‰åŠ¹ãªGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            this.disabled = true;
            this.textContent = 'è¿½åŠ ä¸­...';
            showMessage('ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ä¸­...', 'info');
            
            // ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
            google.script.run
                .withSuccessHandler((result) => {
                    showMessage(result.message || 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ', 'success');
                    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å›ç­”ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                })
                .withFailureHandler((error) => {
                    showMessage('ã‚¨ãƒ©ãƒ¼: ' + (error.message || 'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ'), 'error');
                    this.disabled = false;
                    this.textContent = 'è¿½åŠ ';
                })
                .addSpreadsheetUrl(url);
        });

        // Enterã‚­ãƒ¼ã§ã‚‚è¿½åŠ 
        document.getElementById('spreadsheet-url-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('add-spreadsheet-btn').click();
            }
        });
        <? } ?>
    </script>
</body>
</html>