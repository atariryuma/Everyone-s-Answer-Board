<script>

const SYSTEM_CONSTANTS = {
  TIMEOUTS: {
    DEFAULT_FLOW_TIMEOUT: 300000,
    PROGRESS_HIDE_DELAY: 2000,
    POLLING_INTERVAL: 30000,
    UI_UPDATE_DELAY: 300,
    VERIFICATION_DELAY: 2000,
    QUICK_START_HIDE_DELAY: 3000,
    ERROR_DISPLAY_DURATION: 5000,
    SUCCESS_DISPLAY_DURATION: 3000
  },

  CUSTOM_SETUP: {
    TOTAL_STEPS: 6,
    STEP_TIMES: {
      ANALYSIS: 12,
      FORM_CREATION: 20,
      AI_DETECTION: 25,
      CONFIG_SAVE: 8,
      CACHE_CLEAR: 8,
      RESPONSE: 5
    },
    PROGRESS_UPDATE_INTERVAL: 150,
    MAX_RETRY_COUNT: 3,
    CANCEL_CONFIRMATION_MESSAGE: 'カスタムセットアップをキャンセルしますか？\nキャンセルすると、セットアップが未完了の状態で残る可能性があります。'
  },

  QUICK_START: {
    TOTAL_STEPS: 4,
    STEP_TIMES: {
      FOLDER_CREATION: 30,
      FORM_CREATION: 60,
      BOARD_SETUP: 45,
      COMPLETION: 15
    },
    PROGRESS_UPDATE_INTERVAL: 300,
    MAX_POLLING_ATTEMPTS: 10,
    CONFIRMATION_MESSAGE: '現在公開中の回答ボードを停止し、新しいフォームとボードを作成しますか？\n\n・既存の回答データは保持されます\n・新しいフォームとスプレッドシートを作成します\n・高精度なAI列検出を実行します\n・作成後に自動的に再公開します'
  },

  FLOW_EXECUTION: {
    DEBUG_MODE: false,
    MAX_CONCURRENT_FLOWS: 5,
    QUEUE_TIMEOUT: 60000,
    CLEANUP_INTERVAL: 300000
  },

  ERROR_HANDLING: {
    MAX_ERROR_HISTORY: 50,
    LOG_LEVELS: {
      DEBUG: 3,
      INFO: 2,
      WARN: 1,
      ERROR: 0
    },
    RETRY_DELAYS: [1000, 2000, 5000],
    CRITICAL_ERROR_THRESHOLD: 5
  },

  UI: {
    ANIMATION_DURATION: 300,
    FADE_DURATION: 200,
    PROGRESS_BAR_TRANSITION: 700,
    TOOLTIP_DELAY: 500,
    AUTO_SAVE_INTERVAL: 30000,
    NOTIFICATION_STACK_LIMIT: 5
  },

  ELEMENTS: {
    CUSTOM_PROGRESS: 'customsetup-progress',
    QUICK_PROGRESS: 'quickstart-progress',
    CUSTOM_CANCEL_BTN: 'customsetup-cancel-btn',
    QUICK_START_BTN: 'quickstart-btn',
    MESSAGE_AREA: 'message-area',
    PROGRESS_BAR: 'progress-bar',
    CUSTOM_PROGRESS_BAR: 'custom-progress-bar'
  },

  CSS_CLASSES: {
    HIDDEN: 'hidden',
    ACTIVE: 'active',
    COMPLETED: 'completed',
    ERROR: 'error',
    LOADING: 'loading',
    ANIMATE_PULSE: 'animate-pulse',
    FADE_IN: 'fade-in',
    FADE_OUT: 'fade-out'
  },

  STORAGE_KEYS: {
    USER_PREFERENCES: 'studyquest_user_preferences',
    FORM_DRAFT: 'studyquest_form_draft',
    SESSION_STATE: 'studyquest_session_state',
    ERROR_HISTORY: 'studyquest_error_history',
    PERFORMANCE_METRICS: 'studyquest_performance_metrics'
  },

  PERFORMANCE: {
    DOM_CACHE_SIZE: 100,
    DEBOUNCE_DELAY: 250,
    THROTTLE_DELAY: 100,
    METRICS_SAMPLE_RATE: 0.1,
    MEMORY_CLEANUP_THRESHOLD: 50
  }
};

Object.freeze(SYSTEM_CONSTANTS);
Object.freeze(SYSTEM_CONSTANTS.TIMEOUTS);
Object.freeze(SYSTEM_CONSTANTS.CUSTOM_SETUP);
Object.freeze(SYSTEM_CONSTANTS.QUICK_START);
Object.freeze(SYSTEM_CONSTANTS.FLOW_EXECUTION);
Object.freeze(SYSTEM_CONSTANTS.ERROR_HANDLING);
Object.freeze(SYSTEM_CONSTANTS.UI);
Object.freeze(SYSTEM_CONSTANTS.ELEMENTS);
Object.freeze(SYSTEM_CONSTANTS.CSS_CLASSES);
Object.freeze(SYSTEM_CONSTANTS.STORAGE_KEYS);
Object.freeze(SYSTEM_CONSTANTS.PERFORMANCE);

window.SYSTEM_CONSTANTS = SYSTEM_CONSTANTS;

window.getTimeout = (key) => SYSTEM_CONSTANTS.TIMEOUTS[key] || SYSTEM_CONSTANTS.TIMEOUTS.DEFAULT_FLOW_TIMEOUT;
window.getStepTime = (flow, step) => SYSTEM_CONSTANTS[flow.toUpperCase()]?.STEP_TIMES?.[step.toUpperCase()] || 30;
window.getElement = (key) => document.getElementById(SYSTEM_CONSTANTS.ELEMENTS[key]);
window.addClass = (element, className) => element?.classList.add(SYSTEM_CONSTANTS.CSS_CLASSES[className]);
window.removeClass = (element, className) => element?.classList.remove(SYSTEM_CONSTANTS.CSS_CLASSES[className]);

console.log('✅ System Constants loaded and frozen');
</script>
