<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <title>æ•™è‚²ç¾å ´ã®ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å›ç­”ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„: å¤–éƒ¨CDNä¾å­˜ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«åŒ–ã‚’æ¨å¥¨ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --color-primary: #8be9fd;
      --color-background: #1a1b26;
      --color-surface: rgba(26, 27, 38, 0.7);
      --color-text: #c0caf5;
      --color-border: rgba(255, 255, 255, 0.1);
      --color-success: #10b981;
      --color-error: #ef4444;
      --color-warning: #f59e0b;
    }
    
    .glass-panel {
      background: var(--color-surface);
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      border: 1px solid var(--color-border);
      transition: all 0.3s ease;
    }
    .glass-panel:hover {
      border-color: rgba(255, 255, 255, 0.2);
      transform: translate3d(0, -2px, 0);
    }
    
    button:disabled { 
      opacity: 0.5; 
      cursor: not-allowed; 
    }
    button:not(:disabled):hover {
      transform: translate3d(0, -2px, 0);
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }
    button:active:not(:disabled) {
      transform: translate3d(0, 0, 0);
    }
    
    :focus-visible { 
      outline: 3px solid var(--color-primary); 
      outline-offset: 2px; 
      border-radius: 4px; 
    }
    
    .spinner {
      animation: spin 1s linear infinite;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(139, 233, 253, 0.3);
      border-top: 2px solid var(--color-primary);
      border-radius: 50%;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    
    .step-indicator {
      text-align: center;
      position: relative;
      z-index: 10;
      transition: all 0.3s ease;
    }
    .step-indicator.completed .step-number {
      background-color: var(--color-primary);
      color: #000;
      box-shadow: 0 0 10px rgba(139, 233, 253, 0.5);
    }
    .step-indicator.active .step-number {
      background-color: var(--color-warning);
      color: #000;
      animation: pulse 2s infinite;
    }
    
    #progress-bar {
      transition: width 0.8s ease-in-out;
      background: linear-gradient(90deg, var(--color-primary), #50fa7b);
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    .shake {
      animation: shake 0.5s ease-out;
    }
    
    .feature-card {
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    .feature-card:hover {
      border-color: var(--color-primary);
      transform: translate3d(0, -4px, 0);
      box-shadow: 0 12px 24px rgba(139, 233, 253, 0.1);
    }
    
    .cta-button {
      position: relative;
      overflow: hidden;
    }
    .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .cta-button:hover::before {
      left: 100%;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26, 27, 38, 0.9);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; will-change: opacity; }
      to { opacity: 1; }
    }
    @keyframes slideIn {
      from { opacity: 0; will-change: opacity; }
      to { opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { will-change: transform; }
      50% { transform: scale3d(1.05, 1.05, 1); }
    }
    @keyframes shake {
      0%, 100% { will-change: transform; }
      25% { transform: translate3d(-5px, 0, 0); }
      75% { transform: translate3d(5px, 0, 0); }
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
      .glass-panel {
        margin: 1rem;
        padding: 1.5rem;
      }
      .step-indicator .step-number {
        width: 1.5rem;
        height: 1.5rem;
        font-size: 0.75rem;
      }
    }
    
    /* Performance optimizations */
    .fade-in, .slide-in, .pulse, .shake {
      will-change: auto;
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* Low-end device optimizations */
    @media (max-width: 768px) and (max-resolution: 150dpi) {
      .glass-panel {
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        background: rgba(26, 27, 38, 0.95);
      }
      .feature-card:hover {
        transform: none;
        box-shadow: 0 4px 8px rgba(139, 233, 253, 0.1);
      }
    }
  </style>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans min-h-screen flex items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-8 max-w-2xl w-full shadow-2xl">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-yellow-300 mb-2">StudyQuest -ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰-</h1>
      <p class="text-gray-400">æ•™è‚²ç¾å ´ã®ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å›ç­”ãƒœãƒ¼ãƒ‰</p>
    </div>
    
    <!-- Domain Information -->
    <div id="domain-info-section" class="mb-6 hidden">
      <div id="domain-match-panel" class="glass-panel bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-lg p-4 border border-green-400/30 mb-4 hidden">
        <div class="flex items-center">
          <svg class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <p class="text-green-400 text-sm font-semibold">å¯¾å¿œãƒ‰ãƒ¡ã‚¤ãƒ³</p>
            <p class="text-green-200 text-xs" id="domain-match-text"></p>
          </div>
        </div>
      </div>
      
      <div id="domain-mismatch-panel" class="glass-panel bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-lg p-4 border border-yellow-400/30 mb-4 hidden">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-yellow-400 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
          <div>
            <p class="text-yellow-400 text-sm font-semibold">ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸ä¸€è‡´ã®è­¦å‘Š</p>
            <p class="text-yellow-200 text-xs mb-2" id="domain-mismatch-text"></p>
            <p class="text-yellow-100 text-xs">ã“ã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã¯ <span id="deploy-domain" class="font-semibold"></span> ãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Hero Section with CTA -->
    <div class="mb-8 text-center fade-in">
      <div class="glass-panel bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded-xl p-6 border border-cyan-400/30 mb-6 feature-card">
        <h2 class="text-2xl font-bold text-white mb-2">ç„¡æ–™ã§ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã‚’å§‹ã‚ã‚ˆã†ï¼</h2>
        <p class="text-cyan-200 mb-4">æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ãªãŸå°‚ç”¨ã®ãƒœãƒ¼ãƒ‰ã‚’ä½œæˆã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’é‡è¦–ã—ãŸè¨­è¨ˆã§ã€å®‰å¿ƒã—ã¦æˆæ¥­ã§æ´»ç”¨ã§ãã¾ã™ã€‚</p>
        <button type="button" 
                class="cta-button px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold rounded-lg transition-all transform hover:scale-105 shadow-lg text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-gray-800"
                aria-label="æ–°è¦ç™»éŒ²ã«é€²ã‚€">
          ã„ã¾ã™ãå§‹ã‚ã‚‹ â†’
        </button>
      </div>
    </div>

    <!-- Progress Steps -->
    <div class="mb-8 slide-in">
      <div class="flex items-center justify-between relative">
        <div class="absolute top-4 left-0 right-0 h-0.5 bg-gray-600 rounded-full"></div>
        <div class="absolute top-4 left-0 h-0.5 bg-gradient-to-r from-cyan-400 to-blue-400 transition-all duration-500 rounded-full" id="progress-bar"></div>
        
        <div class="step-indicator completed" id="step-1" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3" aria-label="ã‚¹ãƒ†ãƒƒãƒ—1: ç†è§£">
          <div class="step-number w-8 h-8 rounded-full bg-cyan-400 text-white flex items-center justify-center font-bold text-sm relative z-10 transition-all">1</div>
          <span class="text-xs mt-2 block text-cyan-400">ç†è§£</span>
        </div>
        <div class="step-indicator" id="step-2" role="progressbar" aria-valuenow="2" aria-valuemin="1" aria-valuemax="3" aria-label="ã‚¹ãƒ†ãƒƒãƒ—2: ç¢ºèª">
          <div class="step-number w-8 h-8 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm relative z-10 transition-all">2</div>
          <span class="text-xs mt-2 block text-gray-400">ç¢ºèª</span>
        </div>
        <div class="step-indicator" id="step-3" role="progressbar" aria-valuenow="3" aria-valuemin="1" aria-valuemax="3" aria-label="ã‚¹ãƒ†ãƒƒãƒ—3: é–‹å§‹">
          <div class="step-number w-8 h-8 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm relative z-10 transition-all">3</div>
          <span class="text-xs mt-2 block text-gray-400">é–‹å§‹</span>
        </div>
      </div>
    </div>

    <div class="space-y-6">
      <!-- ã‚¹ãƒ†ãƒƒãƒ—1: èª¬æ˜ -->
      <article class="glass-panel rounded-lg p-6 feature-card fade-in" id="section-1">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <div class="w-6 h-6 rounded-full bg-cyan-400 text-white flex items-center justify-center font-bold text-sm">1</div>
          ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã¨ã¯
        </h2>
        <ul class="text-sm text-gray-300 space-y-3 mb-6" role="list">
          <li class="flex items-start gap-3 slide-in">
            <span class="text-green-400 text-lg" role="img" aria-label="ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯">âœ“</span>
            <span>Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å›ç­”ã‚’ã€ç¾ã—ã„ãƒœãƒ¼ãƒ‰å½¢å¼ã§è¡¨ç¤ºã—ã¾ã™</span>
          </li>
          <li class="flex items-start gap-3 slide-in">
            <span class="text-green-400 text-lg" role="img" aria-label="ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯">âœ“</span>
            <span>ç”Ÿå¾’åŒå£«ã§ã€Œã„ã„ã­ï¼ã€ã€Œãªã‚‹ã»ã©ï¼ã€ã€Œã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„ï¼ã€ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã§ãã¾ã™</span>
          </li>
          <li class="flex items-start gap-3 slide-in">
            <span class="text-green-400 text-lg" role="img" aria-label="ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯">âœ“</span>
            <span>å…ˆç”Ÿã¯é‡è¦ãªå›ç­”ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã§ãã¾ã™</span>
          </li>
        </ul>

        <!-- Digital Citizenship Education Section -->
        <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 mb-4">
          <div class="flex items-start gap-3">
            <div class="w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C20.168 18.477 18.582 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
              </svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-blue-200 mb-2">ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ã‚·ãƒ†ã‚£ã‚ºãƒ³ã‚·ãƒƒãƒ—æ•™è‚²ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
              <p class="text-xs text-blue-300 leading-relaxed">
                ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã¯ã€ãƒ‡ã‚¸ã‚¿ãƒ«ç¤¾ä¼šã§è‰¯ã„å¸‚æ°‘ã¨ãªã‚‹ãŸã‚ã®å­¦ç¿’ã‚’æ”¯æ´ã—ã¾ã™ã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç©ºé–“ã§ã‚‚äº’ã„ã‚’å°Šé‡ã—ã€å»ºè¨­çš„ãªå¯¾è©±ã‚’è‚²ã‚€ç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚
              </p>
            </div>
          </div>
        </div>

        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <div class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
              </svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-green-200 mb-2">å¿ƒç†çš„å®‰å…¨æ€§ã‚’é‡è¦–ã—ãŸè¨­è¨ˆ</p>
              <ul class="text-xs text-green-300 leading-relaxed space-y-1">
                <li>â€¢ <strong>åŒ¿åæ€§ã®ã‚µãƒãƒ¼ãƒˆ</strong>ï¼šç”Ÿå¾’ãŒå®‰å¿ƒã—ã¦æ„è¦‹ã‚’è¡¨ç¾ã§ãã¾ã™</li>
                <li>â€¢ <strong>æ•°å€¤ã®éè¡¨ç¤º</strong>ï¼šç«¶äº‰ã‚ˆã‚Šå”åŠ›ã‚’é‡è¦–ã—ãŸç’°å¢ƒã‚’ä½œã‚Šã¾ã™</li>
                <li>â€¢ <strong>è‰²ã«ã‚ˆã‚‹è­˜åˆ¥</strong>ï¼šæ•°ã‚’æ°—ã«ã›ãšãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®é¡ã‚’æŠŠæ¡ã§ãã¾ã™</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- StudyQuestã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ -->
        <div class="mt-6 p-4 bg-purple-900/20 border border-purple-500/30 rounded-lg glass-panel">
          <h3 class="font-semibold text-purple-400 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
          </h3>
          <ul class="text-sm text-purple-200 space-y-2" role="list">
            <li>â€¢ <strong>ãƒ‡ãƒ¼ã‚¿åˆ†é›¢</strong>: ç”Ÿå¾’ã®å›ç­”ãƒ‡ãƒ¼ã‚¿ã¯ã€ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨ã¯åˆ¥ã®å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚</li>
            <li>â€¢ <strong>å³æ ¼ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡</strong>: ã‚ãªãŸã®Google Workspaceãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã«é™å®šã—ã€ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’é˜²ãã¾ã™ã€‚</li>
            <li>â€¢ <strong>XSSå¯¾ç­–</strong>: æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®åŸ‹ã‚è¾¼ã¿ã‚’é˜²ããŸã‚ã€å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å³é‡ã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚</li>
            <li>â€¢ <strong>ãƒ¬ãƒ¼ãƒˆåˆ¶é™</strong>: çŸ­æ™‚é–“ã§ã®é€£ç¶šæ“ä½œã‚’åˆ¶é™ã—ã€ã‚·ã‚¹ãƒ†ãƒ ã¸ã®è² è·ã‚„æ‚ªç”¨ã‚’é˜²ãã¾ã™ã€‚</li>
            <li>â€¢ <strong>è‡ªå‹•éå…¬é–‹æ©Ÿèƒ½</strong>: å…¬é–‹ã•ã‚ŒãŸãƒœãƒ¼ãƒ‰ã¯ä¸€å®šæ™‚é–“ã§è‡ªå‹•çš„ã«éå…¬é–‹ã«ãªã‚Šã€æ„å›³ã—ãªã„æƒ…å ±å…¬é–‹ã‚’é˜²ãã¾ã™ã€‚</li>
            <li>â€¢ <strong>Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½æ´»ç”¨</strong>: Google Apps Scriptã®çµ„ã¿è¾¼ã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ï¼ˆä¾‹: ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°å¯¾ç­–ï¼‰ã‚’æœ€å¤§é™ã«æ´»ç”¨ã—ã¦ã„ã¾ã™ã€‚</li>
          </ul>
        </div>
      </article>
      
      <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³• -->
      <article class="glass-panel rounded-lg p-6 feature-card fade-in" id="section-2">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <div class="w-6 h-6 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm" id="step-2-icon">2</div>
          ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•
        </h2>
        <div class="border border-cyan-500 rounded-lg p-4 bg-cyan-900/20 glass-panel">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-cyan-400 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            <div>
              <div class="font-semibold text-white mb-2">å®‰å…¨ã§ç°¡å˜ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
              <div class="text-sm text-gray-300 leading-relaxed">
                ã‚ãªãŸå°‚ç”¨ã®Googleãƒ•ã‚©ãƒ¼ãƒ ã¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è‡ªå‹•ã§ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®è¨­å®šã«ã¯ã€Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã¨ã®é€£æºãŒå«ã¾ã‚Œã‚‹ãŸã‚ã€<strong>å®Œäº†ã¾ã§1åˆ†ã»ã©ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</strong>ã€‚å®Œäº†å¾Œã€ã‚ãªãŸå°‚ç”¨ã®å›ºå®šURLã®å›ç­”ãƒœãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã€è¤‡æ•°ã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦ä½¿ç”¨ã§ãã¾ã™ã€‚
              </div>
            </div>
          </div>
        </div>
        
        <!-- é‡è¦ãªæ³¨æ„äº‹é … -->
        <div class="mt-4 p-4 bg-yellow-900/30 border border-yellow-600/50 rounded-lg glass-panel">
          <h3 class="font-semibold text-yellow-400 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            é‡è¦ãªãŠçŸ¥ã‚‰ã›
          </h3>
          <ul class="text-sm text-yellow-200 space-y-2" role="list">
            <li class="slide-in">â€¢ ä¸€åº¦ç™»éŒ²ã™ã‚‹ã¨ã€<strong>å›ºå®šURLã®å›ç­”ãƒœãƒ¼ãƒ‰</strong>ãŒã‚ãªãŸå°‚ç”¨ã§ä½œæˆã•ã‚Œã¾ã™</li>
            <li class="slide-in">â€¢ ç™»éŒ²å¾Œã¯<strong>ç®¡ç†ç”»é¢ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è¿½åŠ </strong>ã—ã¦ä½¿ç”¨ã§ãã¾ã™</li>
            <li class="slide-in">â€¢ ç”Ÿå¾’ã«ã¯<strong>åŒã˜URLã‚’å…±æœ‰</strong>ã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã€æˆæ¥­ã”ã¨ã«URLã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“</li>
          </ul>
        </div>
      </article>
      
      <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª -->
      <article class="glass-panel rounded-lg p-6 feature-card fade-in" id="section-3">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <div class="w-6 h-6 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm" id="step-3-icon">3</div>
          ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª
        </h2>
        <div class="bg-gray-800 rounded-lg p-4 glass-panel">
          <p class="text-sm text-gray-400 mb-1">ç™»éŒ²ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</p>
          <p id="user-email" class="text-white font-semibold flex items-center gap-2">
            <svg class="w-4 h-4 spinner" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" fill="currentColor"></path>
            </svg>
            ç¢ºèªä¸­...
          </p>
        </div>
      </article>
      
      <!-- ç™»éŒ²ãƒœã‚¿ãƒ³ -->
      <button
        type="button"
        id="register-btn"
        class="cta-button w-full py-3 px-6 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-gray-800 fade-in"
        disabled
        aria-label="ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã®ç™»éŒ²ã‚’é–‹å§‹ã™ã‚‹"
      >
        ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹
      </button>
      
      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
      <div id="message-area" class="text-center min-h-[24px]" role="alert" aria-live="polite"></div>

      <!-- Existing board info -->
      <div id="existing-board-area" class="hidden"></div>

      <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="result-area" class="hidden"></div>
    </div>
    
    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="text-center mt-8 text-xs text-gray-500 fade-in">
      <p>&copy; 2025 StudyQuest. All rights reserved.</p>
    </footer>
  </div>
  
  <script>
    let userEmail = '';
    let currentStep = 1;
    let domainInfo = null;

    function escapeHtml(str) {
      if (!str) return '';
      return str.toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—ã—ã¦è¡¨ç¤º
    function loadDomainInfo() {
      google.script.run
        .withSuccessHandler(displayDomainInfo)
        .withFailureHandler(error => {
          console.error('ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®å–å¾—ã«å¤±æ•—:', error);
        })
        .getDeployUserDomainInfo();
    }

    // ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®è¡¨ç¤º
    function displayDomainInfo(info) {
      domainInfo = info;
      const section = document.getElementById('domain-info-section');
      const matchPanel = document.getElementById('domain-match-panel');
      const mismatchPanel = document.getElementById('domain-mismatch-panel');
      
      if (!info || info.error) {
        console.warn('ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', info?.error);
        return;
      }

      section.classList.remove('hidden');

      if (info.isDomainMatch) {
        // ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒä¸€è‡´ã—ã¦ã„ã‚‹å ´åˆ
        matchPanel.classList.remove('hidden');
        mismatchPanel.classList.add('hidden');
        document.getElementById('domain-match-text').textContent = 
          `ã“ã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã¯ ${info.deployDomain} ãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨ã§ã™ã€‚ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ${info.currentDomain}ï¼‰ã§åˆ©ç”¨ã§ãã¾ã™ã€‚`;
      } else {
        // ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒä¸ä¸€è‡´ã®å ´åˆ
        matchPanel.classList.add('hidden');
        mismatchPanel.classList.remove('hidden');
        document.getElementById('domain-mismatch-text').textContent = 
          `ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ${info.currentDomain}ï¼‰ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
        document.getElementById('deploy-domain').textContent = info.deployDomain;
      }
    }
    
    // Scroll to registration function
    function scrollToRegistration() {
      document.getElementById('section-3').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
      updateStep(3);
    }
    
    // Update step progress
    function updateStep(step) {
      currentStep = step;
      
      // Update progress bar with performance optimization
      const progressBar = document.getElementById('progress-bar');
      requestAnimationFrame(() => {
        progressBar.style.width = `${(step / 3) * 100}%`;
      });
      
      // Update step indicators
      for (let i = 1; i <= 3; i++) {
        const stepElement = document.getElementById(`step-${i}`);
        const stepIndicator = document.getElementById(`step-${i}`);
        
        if (stepElement) {
          if (i <= step) {
            stepElement.classList.add('completed');
            const stepCircle = stepElement.querySelector('div');
            if (stepCircle) {
              stepCircle.className = 'w-8 h-8 rounded-full bg-cyan-400 text-white flex items-center justify-center font-bold text-sm relative z-10';
            }
            const stepLabel = stepElement.querySelector('span');
            if (stepLabel) {
              stepLabel.className = 'text-xs mt-2 block text-cyan-400';
            }
          } else {
            stepElement.classList.remove('completed');
            const stepCircle = stepElement.querySelector('div');
            if (stepCircle) {
              stepCircle.className = 'w-8 h-8 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm relative z-10';
            }
            const stepLabel = stepElement.querySelector('span');
            if (stepLabel) {
              stepLabel.className = 'text-xs mt-2 block text-gray-400';
            }
          }
        }
        
        // Update section-specific icons (for steps 2 and 3)
        const iconElement = document.getElementById(`step-${i}-icon`);
        if (iconElement) {
          if (i <= step) {
            iconElement.className = 'w-6 h-6 rounded-full bg-cyan-400 text-white flex items-center justify-center font-bold text-sm';
          } else {
            iconElement.className = 'w-6 h-6 rounded-full bg-gray-600 text-white flex items-center justify-center font-bold text-sm';
          }
        }
      }
    }
    
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: èªè¨¼çŠ¶æ…‹ã®æ¤œè¨¼
    async function verifyAuthentication() {
      return new Promise((resolve, reject) => {
        google.script.run
          .withSuccessHandler(result => {
            if (result && result.authenticated && result.email) {
              resolve(result);
            } else {
              reject(new Error('èªè¨¼ãŒå¿…è¦ã§ã™'));
            }
          })
          .withFailureHandler(reject)
          .verifyUserAuthentication();
      });
    }

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
    window.addEventListener('DOMContentLoaded', async () => {
      // scrollToRegistrationã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      const scrollToRegistrationBtn = document.querySelector('button[aria-label="æ–°è¦ç™»éŒ²ã«é€²ã‚€"]');
      if (scrollToRegistrationBtn) {
        scrollToRegistrationBtn.addEventListener('click', scrollToRegistration);
      }

      try {
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
        const authResult = await verifyAuthentication();
        const email = authResult.email;
        
        userEmail = email;
        document.getElementById('user-email').textContent = email || 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã§ãã¾ã›ã‚“';

        if (email) {
          updateStep(2); // Account verification step
          
          // ã¾ãšæ—¢å­˜ãƒœãƒ¼ãƒ‰æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯
          google.script.run
            .withSuccessHandler((existingBoard) => {
              // userIdãŒç„¡åŠ¹ãªå ´åˆã¯æ—¢å­˜ãƒœãƒ¼ãƒ‰ãŒãªã„ã¨ã—ã¦æ‰±ã†
              if (existingBoard && existingBoard.userId && existingBoard.userId !== 'undefined' && existingBoard.userId !== '' && existingBoard.userId !== null) {
                // æœ‰åŠ¹ãªæ—¢å­˜ãƒœãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆ
                updateStep(3);
                showExistingBoard(existingBoard);
              } else {
                // æ—¢å­˜ãƒœãƒ¼ãƒ‰ãŒãªã„ã€ã¾ãŸã¯ç„¡åŠ¹ãªuserIdã®å ´åˆã¯ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
                updateStep(3);
                document.getElementById('register-btn').disabled = false;
                showMessage('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸã€‚ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹å§‹ã§ãã¾ã™ã€‚', 'success');
              }
            })
            .withFailureHandler((error) => {
              // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º
              console.warn('æ—¢å­˜ãƒœãƒ¼ãƒ‰ç¢ºèªã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ');
              
              // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã‚‚ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆæ–°è¦ç™»éŒ²ã¨ã—ã¦æ‰±ã†ï¼‰
              document.getElementById('register-btn').disabled = false;
              showMessage('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸã€‚StudyQuestã‚’é–‹å§‹ã§ãã¾ã™ã€‚', 'success');
            })
            .getExistingBoard();
        } else {
          showMessage('Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚', 'error');
        }
      } catch (error) {
        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å®‰å…¨ãªå‡¦ç†
        console.warn('èªè¨¼ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        document.getElementById('user-email').textContent = 'èªè¨¼ã‚¨ãƒ©ãƒ¼';
        showMessage('èªè¨¼ãŒå¿…è¦ã§ã™ã€‚Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚', 'error');
      }
    });
    
    // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆçµ±åˆç‰ˆã§ã¯è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®ã¿ï¼‰
    // document.querySelectorAll('input[name="setup-method"]').forEach(radio => {
    //   radio.addEventListener('change', (e) => {
    //     const existingInput = document.getElementById('existing-sheet-input');
    //     if (e.target.value === 'existing') {
    //       existingInput.style.display = 'block';
    //     } else {
    //       existingInput.style.display = 'none';
    //     }
    //   });
    // });

    // Enterã‚­ãƒ¼å¯¾å¿œï¼ˆç™»éŒ²ãƒœã‚¿ãƒ³ç”¨ï¼‰
    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !document.getElementById('register-btn').disabled) {
        // Registration page doesn't have URL input field, so just trigger registration if focused
        const registerBtn = document.getElementById('register-btn');
        if (registerBtn && !registerBtn.disabled) {
          registerBtn.click();
        }
      }
    });
    
    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
    function validateInput(value, type) {
      if (!value || typeof value !== 'string') return false;
      
      switch (type) {
        case 'email':
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        case 'method':
          return ['auto', 'manual'].includes(value);
        default:
          return value.length > 0 && value.length < 1000;
      }
    }

    // ç™»éŒ²å‡¦ç†
    document.getElementById('register-btn').addEventListener('click', async () => {
      const btn = document.getElementById('register-btn');
      const messageArea = document.getElementById('message-area');
      
      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–: å…¥åŠ›æ¤œè¨¼
      if (!userEmail || !validateInput(userEmail, 'email')) {
        showMessage('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¿…è¦ã§ã™ã€‚', 'error');
        return;
      }
      
      // çµ±åˆç‰ˆã§ã¯å¸¸ã«è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      const setupMethod = 'auto';
      const spreadsheetUrl = 'AUTO_CREATE';
      
      // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      btn.disabled = true;
      btn.innerHTML = `
        <svg class="w-5 h-5 spinner inline-block mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" fill="currentColor"></path>
        </svg>
        ç™»éŒ²å‡¦ç†ä¸­...
      `;
      showMessage('å›ç­”ãƒœãƒ¼ãƒ‰ã‚’æº–å‚™ä¸­ã§ã™...', 'info');
      
      // ç™»éŒ²å‡¦ç†ã‚’å®Ÿè¡Œ
      google.script.run

        .withSuccessHandler(result => {
          showMessage(result.message || 'ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');

          const adminUrl = result.adminUrl || '';
          const viewUrl = result.viewUrl || '';
          
          if (!adminUrl || !viewUrl) {
            showMessage('ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªURLãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚', 'error');
            console.error('URL generation failed:', { adminUrl, viewUrl, result });
            
            // ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å†è©¦è¡Œ
            setTimeout(() => {
              showMessage('ãƒšãƒ¼ã‚¸ã‚’è‡ªå‹•çš„ã«æ›´æ–°ã—ã¦ã„ã¾ã™...', 'info');
              window.location.reload();
            }, 3000);
            return;
          }
          
          // çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã«URLã‚’è¡¨ç¤º
          const resultArea = document.getElementById('result-area');
          const adminUrlInput = document.createElement('input');
          adminUrlInput.type = 'text';
          adminUrlInput.value = adminUrl;
          adminUrlInput.readOnly = true;
          adminUrlInput.id = 'admin-url';
          adminUrlInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
          adminUrlInput.onclick = function() { this.select(); };
          
          const viewUrlInput = document.createElement('input');
          viewUrlInput.type = 'text';
          viewUrlInput.value = viewUrl;
          viewUrlInput.readOnly = true;
          viewUrlInput.id = 'view-url';
          viewUrlInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
          viewUrlInput.onclick = function() { this.select(); };
          
          const adminLink = document.createElement('a');
          adminLink.href = adminUrl;
          adminLink.target = '_blank';
          adminLink.className = 'block w-full text-center px-4 py-3 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-colors';
          adminLink.textContent = 'ç®¡ç†ç”»é¢ã‚’é–‹ã â†’';
          
          resultArea.innerHTML = `
            <div class="glass-panel rounded-lg p-6 space-y-6">
              <div class="text-center">
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <h3 class="font-bold text-2xl text-green-400 mb-2">ğŸ‰ ç™»éŒ²å®Œäº†ï¼</h3>
                <p class="text-gray-300">ã‚ãªãŸå°‚ç”¨ã®å›ç­”ãƒœãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã¾ã—ãŸ</p>
              </div>
              
              <div class="bg-gradient-to-r from-green-500/20 to-blue-500/20 rounded-lg p-4 border border-green-400/30">
                <h4 class="font-bold text-white mb-2">âœ¨ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h4>
                <p class="text-sm text-green-200 mb-3" id="setup-guidance">
                  ã¾ãšã¯ã€ãƒœãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚„è³ªå•ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚æº–å‚™ãŒã§ããŸã‚‰ã€ç”Ÿå¾’ã«URLã‚’å…±æœ‰ã—ã¦å›ç­”ã‚’å‹Ÿé›†ã§ãã¾ã™ã€‚
                </p>
                <div class="text-center">
                  <div class="inline-block px-4 py-2 bg-white/10 rounded-lg">
                    <span class="text-xs text-gray-300">â±ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã¯æ•°ç§’ã‹ã‚‰æ•°åç§’ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</span>
                  </div>
                </div>
              </div>
              
              <div class="space-y-3">
                <div>
                  <label class="text-sm text-gray-400 block mb-1">ç®¡ç†ç”»é¢URLï¼ˆå…ˆç”Ÿç”¨ï¼‰:</label>
                  <div class="flex gap-2" id="admin-url-container">
                    <button onclick="copyToClipboard('admin-url')"
                      class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                      ã‚³ãƒ”ãƒ¼
                    </button>
                  </div>
                </div>
                
                <div>
                  <label class="text-sm text-gray-400 block mb-1">ç”Ÿå¾’ç”¨URL:</label>
                  <div class="flex gap-2" id="view-url-container">
                    <button onclick="copyToClipboard('view-url')"
                      class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                      ã‚³ãƒ”ãƒ¼
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="pt-4 space-y-3" id="admin-link-container">
                <div class="text-center">
                  <p class="text-sm text-gray-400 mb-3">ç®¡ç†ç”»é¢ã‚’é–‹ã„ã¦ã€æœ€åˆã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼</p>
                </div>
                <button onclick="location.reload()"
                  class="block w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition-colors">
                  åˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç™»éŒ²
                </button>
              </div>
            </div>
          `;
          
          // å®‰å…¨ã«DOMè¦ç´ ã‚’è¿½åŠ 
          const adminContainer = document.getElementById('admin-url-container');
          adminContainer.insertBefore(adminUrlInput, adminContainer.firstChild);
          
          const viewContainer = document.getElementById('view-url-container');
          viewContainer.insertBefore(viewUrlInput, viewContainer.firstChild);
          
          const linkContainer = document.getElementById('admin-link-container');
          linkContainer.insertBefore(adminLink, linkContainer.firstChild);
          
          // è‡ªå‹•ä½œæˆã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆURLã‚‚è¡¨ç¤º
          if (result.autoCreated) {
            const additionalContainer = document.createElement('div');
            additionalContainer.className = 'space-y-3';
            
            // Googleãƒ•ã‚©ãƒ¼ãƒ ï¼ˆç”Ÿå¾’å›ç­”ç”¨ï¼‰
            if (result.formUrl) {
              const formContainer = document.createElement('div');
              formContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">ç”Ÿå¾’å›ç­”ç”¨Googleãƒ•ã‚©ãƒ¼ãƒ :</label>
                <div class="flex gap-2">
                  <input type="text" value="${escapeHtml(result.formUrl)}" readonly
                    id="created-form-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('created-form-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    ã‚³ãƒ”ãƒ¼
                  </button>
                  <a href="${escapeHtml(result.formUrl)}" target="_blank" rel="noopener noreferrer"
                    class="px-3 py-2 bg-blue-700 hover:bg-blue-600 rounded text-sm transition-colors">
                    é–‹ã
                  </a>
                </div>
              `;
              additionalContainer.appendChild(formContainer);
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ç”¨URL
            if (result.editFormUrl) {
              const editFormContainer = document.createElement('div');
              editFormContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">ãƒ•ã‚©ãƒ¼ãƒ ç·¨é›†ç”¨URLï¼ˆå…ˆç”Ÿç”¨ï¼‰:</label>
                <div class="flex gap-2">
                  <input type="text" value="${escapeHtml(result.editFormUrl)}" readonly
                    id="edit-form-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('edit-form-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    ã‚³ãƒ”ãƒ¼
                  </button>
                  <a href="${escapeHtml(result.editFormUrl)}" target="_blank" rel="noopener noreferrer"
                    class="px-3 py-2 bg-green-700 hover:bg-green-600 rounded text-sm transition-colors">
                    ç·¨é›†
                  </a>
                </div>
              `;
              additionalContainer.appendChild(editFormContainer);
            }
            
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆãƒ‡ãƒ¼ã‚¿ç¢ºèªç”¨ï¼‰
            if (result.spreadsheetUrl) {
              const spreadsheetContainer = document.createElement('div');
              spreadsheetContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">å›ç­”ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼‰:</label>
                <div class="flex gap-2">
                  <input type="text" value="${escapeHtml(result.spreadsheetUrl)}" readonly
                    id="created-spreadsheet-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('created-spreadsheet-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    ã‚³ãƒ”ãƒ¼
                  </button>
                  <a href="${escapeHtml(result.spreadsheetUrl)}" target="_blank" rel="noopener noreferrer"
                    class="px-3 py-2 bg-green-700 hover:bg-green-600 rounded text-sm transition-colors">
                    ç¢ºèª
                  </a>
                </div>
              `;
              additionalContainer.appendChild(spreadsheetContainer);
            }
            
            // ç®¡ç†ç”»é¢URLã®å‰ã«æŒ¿å…¥
            const adminContainer = document.getElementById('admin-url-container').parentElement;
            adminContainer.parentElement.insertBefore(additionalContainer, adminContainer);
            
            // ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
            if (result.formUrl) {
              document.getElementById('setup-guidance').textContent = 
                'Googleãƒ•ã‚©ãƒ¼ãƒ ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã—ãŸï¼ç”Ÿå¾’ã«ãƒ•ã‚©ãƒ¼ãƒ URLã‚’å…±æœ‰ã—ã¦å›ç­”ã‚’åé›†ã—ã€å›ç­”ãƒœãƒ¼ãƒ‰ã§çµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚';
            } else {
              document.getElementById('setup-guidance').textContent = 
                'ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã—ãŸã€‚ãƒ‡ãƒ¼ã‚¿ã‚’æ‰‹å‹•ã§å…¥åŠ›ã™ã‚‹ã‹ã€åˆ¥é€”Googleãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚';
            }
          }
          
          resultArea.classList.remove('hidden');
          btn.style.display = 'none';
          
          // æ—¢å­˜ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå…¥åŠ›ã‚’ç„¡åŠ¹åŒ–
          const existingInput = document.getElementById('spreadsheet-url');
          if (existingInput) {
            existingInput.disabled = true;
          }

          showMessage('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ç®¡ç†ç”»é¢ã‚’é–‹ã„ã¦è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'info');
        })
        .withFailureHandler(error => {
          showMessage(`ã‚¨ãƒ©ãƒ¼: ${error.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'}`, 'error');
          btn.disabled = false;
          btn.textContent = 'ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹';
        })
        .registerNewUser(userEmail);
    });
    
    // æ—¢å­˜ãƒœãƒ¼ãƒ‰æƒ…å ±ã®è¡¨ç¤º
    function showExistingBoard(data) {
      if (!data) return;
      
      // ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
      const registerBtn = document.getElementById('register-btn');
      registerBtn.style.display = 'none';
      
      const area = document.getElementById('existing-board-area');
      const adminInput = document.createElement('input');
      adminInput.type = 'text';
      adminInput.value = data.adminUrl;
      adminInput.readOnly = true;
      adminInput.id = 'existing-admin-url';
      adminInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
      adminInput.onclick = function() { this.select(); };

      const viewInput = document.createElement('input');
      viewInput.type = 'text';
      viewInput.value = data.viewUrl;
      viewInput.readOnly = true;
      viewInput.id = 'existing-view-url';
      viewInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
      viewInput.onclick = function() { this.select(); };

      const adminLink = document.createElement('a');
      adminLink.href = data.adminUrl;
      adminLink.target = '_blank';
      adminLink.className = 'block w-full text-center px-4 py-3 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-colors';
      adminLink.textContent = 'ç®¡ç†ç”»é¢ã‚’é–‹ã â†’';

      area.innerHTML = `
        <div class="glass-panel rounded-lg p-6 space-y-6">
          <div class="text-center">
            <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 class="font-bold text-2xl text-green-400 mb-2">âœ… æ—¢ã«ç™»éŒ²æ¸ˆã¿ã§ã™</h3>
            <p class="text-gray-300">ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯æ—¢ã«ã¿ã‚“ãªã®å›ç­”ãƒœãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™</p>
          </div>
          
          <div class="bg-gradient-to-r from-blue-500/20 to-cyan-500/20 rounded-lg p-4 border border-blue-400/30">
            <h4 class="font-bold text-white mb-2">ğŸ“‹ ã”åˆ©ç”¨ä¸­ã®ãƒœãƒ¼ãƒ‰</h4>
            <p class="text-sm text-blue-200">ä»¥ä¸‹ã®URLã‹ã‚‰ã„ã¤ã§ã‚‚ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™</p>
          </div>
          <div class="space-y-3">
            <div>
              <label class="text-sm text-gray-400 block mb-1">ç®¡ç†ç”»é¢URLï¼ˆå…ˆç”Ÿç”¨ï¼‰:</label>
              <div class="flex gap-2" id="existing-admin-container">
                <button onclick="copyToClipboard('existing-admin-url')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">ã‚³ãƒ”ãƒ¼</button>
              </div>
            </div>
            <div>
              <label class="text-sm text-gray-400 block mb-1">ç”Ÿå¾’ç”¨URL:</label>
              <div class="flex gap-2" id="existing-view-container">
                <button onclick="copyToClipboard('existing-view-url')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">ã‚³ãƒ”ãƒ¼</button>
              </div>
            </div>
          </div>
          <div id="existing-admin-link-container"></div>
        </div>`;

      const adminContainer = document.getElementById('existing-admin-container');
      adminContainer.insertBefore(adminInput, adminContainer.firstChild);
      const viewContainer = document.getElementById('existing-view-container');
      viewContainer.insertBefore(viewInput, viewContainer.firstChild);
      const linkContainer = document.getElementById('existing-admin-link-container');
      linkContainer.appendChild(adminLink);

      area.classList.remove('hidden');
      
      // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      showMessage('æ—¢å­˜ã®å›ç­”ãƒœãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ç®¡ç†ç”»é¢ã‹ã‚‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ã€‚', 'success');
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºé–¢æ•°
    function showMessage(message, type) {
      const messageArea = document.getElementById('message-area');
      const icons = {
        error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
      };
      const colors = {
        error: 'text-red-400',
        success: 'text-green-400',
        info: 'text-blue-400'
      };
      
      messageArea.className = `text-center min-h-[24px] ${colors[type] || 'text-gray-400'} flex items-center justify-center gap-2`;
      messageArea.innerHTML = `${icons[type] || ''}<span>${escapeHtml(message)}</span>`;
    }
    
    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆç¾ä»£çš„ãªAPIã‚’ä½¿ç”¨ï¼‰
    async function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const button = element.parentElement.querySelector('button');
      const originalText = button ? button.textContent : '';
      
      try {
        // ç¾ä»£çš„ãªClipboard APIã‚’ä½¿ç”¨
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(element.value);
        } else {
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¾“æ¥ã®æ–¹æ³•
          element.select();
          element.setSelectionRange(0, 99999); // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
          document.execCommand('copy');
        }
        
        // ã‚³ãƒ”ãƒ¼å®Œäº†ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
        if (button) {
          button.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
          button.classList.add('bg-green-700');
          
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-700');
          }, 2000);
        }
      } catch (error) {
        console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        if (button) {
          button.textContent = 'âœ— ã‚³ãƒ”ãƒ¼å¤±æ•—';
          button.classList.add('bg-red-700');
          
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-red-700');
          }, 2000);
        }
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‰ãƒ¡ã‚¤ãƒ³æƒ…å ±ã‚’å–å¾—
    document.addEventListener('DOMContentLoaded', function() {
      loadDomainInfo();
    });
  </script>
</body>
</html>
