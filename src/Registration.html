<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <title>StudyQuest - 新規登録</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass-panel {
      background: rgba(26,27,38,0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    button:disabled { 
      opacity: 0.5; 
      cursor: not-allowed; 
    }
    :focus-visible { 
      outline: 3px solid #8be9fd; 
      outline-offset: 2px; 
      border-radius: 4px; 
    }
    .spinner {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-[#1a1b26] text-gray-200 font-sans min-h-screen flex items-center justify-center p-4">
  <div class="glass-panel rounded-xl p-8 max-w-2xl w-full shadow-2xl">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-yellow-300 mb-2">StudyQuest</h1>
      <p class="text-gray-400">みんなの回答ボード - 新規登録</p>
    </div>
    
    <div class="space-y-6">
      <!-- ステップ1: 説明 -->
      <div class="glass-panel rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          StudyQuestとは
        </h2>
        <ul class="text-sm text-gray-300 space-y-2">
          <li class="flex items-start gap-2">
            <span class="text-green-400">✓</span>
            <span>Googleスプレッドシートの回答を、美しいボード形式で表示します</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-400">✓</span>
            <span>生徒同士で「いいね」「なるほど」「気になる」のリアクションができます</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-green-400">✓</span>
            <span>先生は重要な回答をハイライトできます</span>
          </li>
        </ul>
      </div>
      
      <!-- ステップ2: セットアップ方法 -->
      <div class="glass-panel rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          セットアップ方法
        </h2>
        <div class="border border-cyan-500 rounded-lg p-4 bg-cyan-900/20">
          <div class="flex items-start gap-3">
            <svg class="w-6 h-6 text-cyan-400 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            <div>
              <div class="font-semibold text-white mb-2">簡単セットアップ</div>
              <div class="text-sm text-gray-300 leading-relaxed">
                回答ボード用Googleフォームを自動作成します。あなた専用の固定URLの回答ボードが作成され、複数のスプレッドシートを切り替えて使用できます。
              </div>
            </div>
          </div>
        </div>
        
        <!-- 重要な注意事項 -->
        <div class="mt-4 p-4 bg-yellow-900/30 border border-yellow-600/50 rounded-lg">
          <h3 class="font-semibold text-yellow-400 mb-2 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            重要なお知らせ
          </h3>
          <ul class="text-sm text-yellow-200 space-y-1">
            <li>• 一度登録すると、<strong>固定URLの回答ボード</strong>があなた専用で作成されます</li>
            <li>• 登録後は<strong>管理画面でスプレッドシートのURLを追加</strong>して使用できます</li>
            <li>• 生徒には<strong>同じURLを共有</strong>し続けることができ、授業ごとにURLを変える必要がありません</li>
          </ul>
        </div>
      </div>
      
      <!-- ステップ3: アカウント確認 -->
      <div class="glass-panel rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4 text-cyan-400 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          アカウント確認
        </h2>
        <div class="bg-gray-800 rounded-lg p-4">
          <p class="text-sm text-gray-400 mb-1">登録するアカウント:</p>
          <p id="user-email" class="text-white font-semibold flex items-center gap-2">
            <svg class="w-4 h-4 spinner" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" fill="currentColor"></path>
            </svg>
            確認中...
          </p>
        </div>
      </div>
      
      <!-- 登録ボタン -->
      <button
        type="button"
        id="register-btn"
        class="w-full py-3 px-6 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg"
        disabled
      >
        StudyQuestを開始する
      </button>
      
      <!-- メッセージエリア -->
      <div id="message-area" class="text-center min-h-[24px]" role="alert" aria-live="polite"></div>

      <!-- Existing board info -->
      <div id="existing-board-area" class="hidden"></div>

      <!-- 結果表示エリア -->
      <div id="result-area" class="hidden"></div>
    </div>
    
    <!-- フッター -->
    <div class="text-center mt-8 text-xs text-gray-500">
      <p>StudyQuest - 教育現場のためのインタラクティブ回答ボード</p>
    </div>
  </div>
  
  <script>
    let userEmail = '';
    
    // ユーザーメールアドレスを取得
    window.addEventListener('DOMContentLoaded', () => {
      google.script.run
        .withSuccessHandler(email => {
          userEmail = email;
          document.getElementById('user-email').textContent = email || 'メールアドレスを取得できません';

          if (email) {
            // まず既存ボード情報をチェック
            google.script.run
              .withSuccessHandler((existingBoard) => {
                if (existingBoard) {
                  // 既存ボードがある場合
                  showExistingBoard(existingBoard);
                } else {
                  // 既存ボードがない場合のみボタンを有効化
                  document.getElementById('register-btn').disabled = false;
                  showMessage('アカウント確認が完了しました。StudyQuestを開始できます。', 'success');
                }
              })
              .withFailureHandler((error) => {
                console.error('既存ボード確認エラー:', error);
                // エラーが発生した場合もボタンを有効化（新規登録として扱う）
                document.getElementById('register-btn').disabled = false;
                showMessage('アカウント確認が完了しました。StudyQuestを開始できます。', 'success');
              })
              .getExistingBoard();
          } else {
            showMessage('Googleアカウントでログインしてください。', 'error');
          }
        })
        .withFailureHandler(error => {
          document.getElementById('user-email').textContent = 'エラー: メールアドレスを取得できません';
          showMessage('認証エラーが発生しました。', 'error');
        })
        .getActiveUserEmail();
    });
    
    // セットアップ方法の切り替え（統合版では自動セットアップのみ）
    // document.querySelectorAll('input[name="setup-method"]').forEach(radio => {
    //   radio.addEventListener('change', (e) => {
    //     const existingInput = document.getElementById('existing-sheet-input');
    //     if (e.target.value === 'existing') {
    //       existingInput.style.display = 'block';
    //     } else {
    //       existingInput.style.display = 'none';
    //     }
    //   });
    // });

    // URLフィールドのEnterキー対応
    document.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !document.getElementById('register-btn').disabled) {
        const urlInput = document.getElementById('spreadsheet-url');
        if (urlInput && document.activeElement === urlInput) {
          document.getElementById('register-btn').click();
        }
      }
    });
    
    // 登録処理
    document.getElementById('register-btn').addEventListener('click', async () => {
      const btn = document.getElementById('register-btn');
      const messageArea = document.getElementById('message-area');
      // 統合版では常に自動セットアップ
      const setupMethod = 'auto';
      const spreadsheetUrl = 'AUTO_CREATE';
      
      // ボタンを無効化
      btn.disabled = true;
      btn.innerHTML = `
        <svg class="w-5 h-5 spinner inline-block mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" fill="currentColor"></path>
        </svg>
        登録処理中...
      `;
      showMessage('スプレッドシートを確認しています...', 'info');
      
      // 登録処理を実行
      google.script.run

        .withSuccessHandler(result => {
          showMessage(result.message || '登録が完了しました！', 'success');

          const adminUrl = result.adminUrl || '';
          const viewUrl = result.viewUrl || '';
          
          if (!adminUrl || !viewUrl) {
            showMessage('エラー: 無効なURLが生成されました。', 'error');
            return;
          }
          
          // 結果表示エリアにURLを表示
          const resultArea = document.getElementById('result-area');
          const adminUrlInput = document.createElement('input');
          adminUrlInput.type = 'text';
          adminUrlInput.value = adminUrl;
          adminUrlInput.readOnly = true;
          adminUrlInput.id = 'admin-url';
          adminUrlInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
          adminUrlInput.onclick = function() { this.select(); };
          
          const viewUrlInput = document.createElement('input');
          viewUrlInput.type = 'text';
          viewUrlInput.value = viewUrl;
          viewUrlInput.readOnly = true;
          viewUrlInput.id = 'view-url';
          viewUrlInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
          viewUrlInput.onclick = function() { this.select(); };
          
          const adminLink = document.createElement('a');
          adminLink.href = adminUrl;
          adminLink.target = '_blank';
          adminLink.className = 'block w-full text-center px-4 py-3 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-colors';
          adminLink.textContent = '管理画面を開く →';
          
          resultArea.innerHTML = `
            <div class="glass-panel rounded-lg p-6 space-y-4">
              <h3 class="font-bold text-lg text-green-400 flex items-center gap-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                登録完了！
              </h3>
              
              <p class="text-sm text-gray-300">
                あなた専用の回答ボードが作成されました。以下のURLをブックマークして、いつでもアクセスできるようにしてください。
              </p>
              <p class="text-sm text-gray-300" id="setup-guidance">
                管理画面でスプレッドシートURLを追加すると、生徒用URLで即座に表示されます。複数のスプレッドシートを切り替えて使用できます。
              </p>
              
              <div class="space-y-3">
                <div>
                  <label class="text-sm text-gray-400 block mb-1">管理画面URL（先生用）:</label>
                  <div class="flex gap-2" id="admin-url-container">
                    <button onclick="copyToClipboard('admin-url')"
                      class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                      コピー
                    </button>
                  </div>
                </div>
                
                <div>
                  <label class="text-sm text-gray-400 block mb-1">生徒用URL:</label>
                  <div class="flex gap-2" id="view-url-container">
                    <button onclick="copyToClipboard('view-url')"
                      class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                      コピー
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="pt-4 space-y-2" id="admin-link-container">
                <button onclick="location.reload()"
                  class="block w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition-colors">
                  別のスプレッドシートを登録
                </button>
              </div>
            </div>
          `;
          
          // 安全にDOM要素を追加
          const adminContainer = document.getElementById('admin-url-container');
          adminContainer.insertBefore(adminUrlInput, adminContainer.firstChild);
          
          const viewContainer = document.getElementById('view-url-container');
          viewContainer.insertBefore(viewUrlInput, viewContainer.firstChild);
          
          const linkContainer = document.getElementById('admin-link-container');
          linkContainer.insertBefore(adminLink, linkContainer.firstChild);
          
          // 自動作成の場合はフォーム・スプレッドシートURLも表示
          if (result.autoCreated) {
            const additionalContainer = document.createElement('div');
            additionalContainer.className = 'space-y-3';
            
            // Googleフォーム（生徒回答用）
            if (result.formUrl) {
              const formContainer = document.createElement('div');
              formContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">生徒回答用Googleフォーム:</label>
                <div class="flex gap-2">
                  <input type="text" value="${result.formUrl}" readonly
                    id="created-form-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('created-form-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    コピー
                  </button>
                  <a href="${result.formUrl}" target="_blank"
                    class="px-3 py-2 bg-blue-700 hover:bg-blue-600 rounded text-sm transition-colors">
                    開く
                  </a>
                </div>
              `;
              additionalContainer.appendChild(formContainer);
            }
            
            // フォーム編集用URL
            if (result.editFormUrl) {
              const editFormContainer = document.createElement('div');
              editFormContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">フォーム編集用URL（先生用）:</label>
                <div class="flex gap-2">
                  <input type="text" value="${result.editFormUrl}" readonly
                    id="edit-form-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('edit-form-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    コピー
                  </button>
                  <a href="${result.editFormUrl}" target="_blank"
                    class="px-3 py-2 bg-green-700 hover:bg-green-600 rounded text-sm transition-colors">
                    編集
                  </a>
                </div>
              `;
              additionalContainer.appendChild(editFormContainer);
            }
            
            // スプレッドシート（データ確認用）
            if (result.spreadsheetUrl) {
              const spreadsheetContainer = document.createElement('div');
              spreadsheetContainer.innerHTML = `
                <label class="text-sm text-gray-400 block mb-1">回答データ（スプレッドシート）:</label>
                <div class="flex gap-2">
                  <input type="text" value="${result.spreadsheetUrl}" readonly
                    id="created-spreadsheet-url"
                    class="flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700"
                    onclick="this.select()">
                  <button onclick="copyToClipboard('created-spreadsheet-url')"
                    class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">
                    コピー
                  </button>
                  <a href="${result.spreadsheetUrl}" target="_blank"
                    class="px-3 py-2 bg-green-700 hover:bg-green-600 rounded text-sm transition-colors">
                    確認
                  </a>
                </div>
              `;
              additionalContainer.appendChild(spreadsheetContainer);
            }
            
            // 管理画面URLの前に挿入
            const adminContainer = document.getElementById('admin-url-container').parentElement;
            adminContainer.parentElement.insertBefore(additionalContainer, adminContainer);
            
            // ガイダンスメッセージを更新
            if (result.formUrl) {
              document.getElementById('setup-guidance').textContent = 
                'Googleフォームが自動作成されました！生徒にフォームURLを共有して回答を収集し、回答ボードで結果を確認できます。';
            } else {
              document.getElementById('setup-guidance').textContent = 
                'スプレッドシートが自動作成されました。データを手動で入力するか、別途Googleフォームを作成してご利用ください。';
            }
          }
          
          resultArea.classList.remove('hidden');
          btn.style.display = 'none';
          
          // 既存スプレッドシート入力を無効化
          const existingInput = document.getElementById('spreadsheet-url');
          if (existingInput) {
            existingInput.disabled = true;
          }

          showMessage('登録が完了しました。管理画面リンクをクリックして設定を確認してください。', 'info');
        })
        .withFailureHandler(error => {
          showMessage(`エラー: ${error.message || '登録に失敗しました'}`, 'error');
          btn.disabled = false;
          btn.textContent = 'StudyQuestを開始する';
        })
        .registerNewUser(spreadsheetUrl);
    });
    
    // 既存ボード情報の表示
    function showExistingBoard(data) {
      if (!data) return;
      
      // 登録ボタンを非表示にする
      const registerBtn = document.getElementById('register-btn');
      registerBtn.style.display = 'none';
      
      const area = document.getElementById('existing-board-area');
      const adminInput = document.createElement('input');
      adminInput.type = 'text';
      adminInput.value = data.adminUrl;
      adminInput.readOnly = true;
      adminInput.id = 'existing-admin-url';
      adminInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
      adminInput.onclick = function() { this.select(); };

      const viewInput = document.createElement('input');
      viewInput.type = 'text';
      viewInput.value = data.viewUrl;
      viewInput.readOnly = true;
      viewInput.id = 'existing-view-url';
      viewInput.className = 'flex-1 p-2 bg-gray-800 border border-gray-600 rounded text-sm cursor-pointer hover:bg-gray-700';
      viewInput.onclick = function() { this.select(); };

      const adminLink = document.createElement('a');
      adminLink.href = data.adminUrl;
      adminLink.target = '_blank';
      adminLink.className = 'block w-full text-center px-4 py-3 bg-cyan-600 hover:bg-cyan-700 rounded-lg font-semibold transition-colors';
      adminLink.textContent = '管理画面を開く →';

      area.innerHTML = `
        <div class="glass-panel rounded-lg p-6 space-y-4">
          <h3 class="font-bold text-lg text-green-400 flex items-center gap-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            既に登録済みの回答ボードがあります
          </h3>
          <p class="text-sm text-gray-300">
            あなたのアカウントには既にStudyQuestの回答ボードが設定されています。以下のURLをご利用ください。
          </p>
          <div class="space-y-3">
            <div>
              <label class="text-sm text-gray-400 block mb-1">管理画面URL（先生用）:</label>
              <div class="flex gap-2" id="existing-admin-container">
                <button onclick="copyToClipboard('existing-admin-url')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">コピー</button>
              </div>
            </div>
            <div>
              <label class="text-sm text-gray-400 block mb-1">生徒用URL:</label>
              <div class="flex gap-2" id="existing-view-container">
                <button onclick="copyToClipboard('existing-view-url')" class="px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors">コピー</button>
              </div>
            </div>
          </div>
          <div id="existing-admin-link-container"></div>
        </div>`;

      const adminContainer = document.getElementById('existing-admin-container');
      adminContainer.insertBefore(adminInput, adminContainer.firstChild);
      const viewContainer = document.getElementById('existing-view-container');
      viewContainer.insertBefore(viewInput, viewContainer.firstChild);
      const linkContainer = document.getElementById('existing-admin-link-container');
      linkContainer.appendChild(adminLink);

      area.classList.remove('hidden');
      
      // 成功メッセージを表示
      showMessage('既存の回答ボードが見つかりました。管理画面からスプレッドシートを追加できます。', 'success');
    }

    // メッセージ表示関数
    function showMessage(message, type) {
      const messageArea = document.getElementById('message-area');
      const icons = {
        error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
        info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
      };
      const colors = {
        error: 'text-red-400',
        success: 'text-green-400',
        info: 'text-blue-400'
      };
      
      messageArea.className = `text-center min-h-[24px] ${colors[type] || 'text-gray-400'} flex items-center justify-center gap-2`;
      messageArea.innerHTML = `${icons[type] || ''}<span>${message}</span>`;
    }
    
    // クリップボードにコピー（現代的なAPIを使用）
    async function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const button = element.parentElement.querySelector('button');
      const originalText = button ? button.textContent : '';
      
      try {
        // 現代的なClipboard APIを使用
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(element.value);
        } else {
          // フォールバック: 従来の方法
          element.select();
          element.setSelectionRange(0, 99999); // モバイル対応
          document.execCommand('copy');
        }
        
        // コピー完了の視覚的フィードバック
        if (button) {
          button.textContent = '✓ コピー済み';
          button.classList.add('bg-green-700');
          
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-700');
          }, 2000);
        }
      } catch (error) {
        console.error('コピーに失敗しました:', error);
        if (button) {
          button.textContent = '✗ コピー失敗';
          button.classList.add('bg-red-700');
          
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-red-700');
          }, 2000);
        }
      }
    }
  </script>
</body>
</html>
