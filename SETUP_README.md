# StudyQuest 統合セットアップガイド

## 🚀 デプロイ管理者向け：1コマンドセットアップ

StudyQuestを新しい環境にデプロイする際は、**Setup.gs**の`studyQuestSetup()`関数を1回実行するだけで、すべての環境設定が完了します。

## 📋 セットアップ手順

### ステップ1: プロジェクトの準備
1. Google Apps Scriptプロジェクトにソースコードを配置
2. 必要な権限を確認
   - Google Sheets API
   - Google Drive API
   - Google Forms API（オプション）

### ステップ2: ウェブアプリとして公開
1. Google Apps Scriptエディタで「デプロイ」→「新しいデプロイ」
2. 「種類」を「ウェブアプリ」に選択
3. 実行ユーザーとアクセス権限を設定：
   - **実行ユーザー**: 「自分」
   - **アクセスできるユーザー**: 「全員」（または組織内のみ）
4. 「デプロイ」をクリック
5. 生成されたURLを確認（後で使用）

### ステップ3: 統合セットアップ実行

#### 自動セットアップ（推奨）
```javascript
// Apps Scriptエディタで実行
studyQuestSetup()
```

#### 手動DEPLOY_ID指定（自動抽出失敗時）
```javascript
// ウェブアプリURLから DEPLOY_ID を取得
// 例: https://script.google.com/macros/s/AKfycbxExample123456789/exec
//     → DEPLOY_ID: AKfycbxExample123456789

studyQuestSetup("AKfycbxExample123456789")
```

## 📊 セットアップで実行される処理

### 1. 環境情報取得
- 現在のスクリプト情報
- 実行ユーザー情報
- タイムゾーン設定

### 2. DEPLOY_ID設定
- ウェブアプリURLからの自動抽出
- プロダクション/開発環境の判定
- URL変換設定の初期化

### 3. ユーザーデータベース作成
- `StudyQuest_UserDatabase` スプレッドシート作成
- ユーザー管理テーブルの初期化
- 必要なヘッダー行の設定

### 4. URL設定初期化
- ウェブアプリURLの設定
- 本番環境/開発環境の適切な設定
- URL変換ロジックの初期化

### 5. 設定テスト
- 全設定項目の検証
- 権限確認
- 基本動作テスト

## ✅ セットアップ成功後の確認事項

セットアップ完了後、ログに表示される「次のステップ」に従って以下を確認してください：

### 1. 管理パネルアクセステスト
```
https://script.google.com/macros/s/YOUR_DEPLOY_ID/exec?mode=admin
```
- 管理画面が正常に表示されることを確認
- スプレッドシートの追加テスト

### 2. 新規登録テスト
```
https://script.google.com/macros/s/YOUR_DEPLOY_ID/exec
```
- 「新規登録」ボタンが表示されることを確認
- テストユーザーでの登録実行

### 3. 回答ボード機能テスト
- スプレッドシートに列設定を行う
- 回答ボードの表示確認
- リアクション機能の動作確認

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### DEPLOY_ID自動抽出に失敗
**症状**: "DEPLOY_IDの自動抽出に失敗しました"
**解決方法**: 
1. ウェブアプリURLを確認
2. URLから手動でDEPLOY_IDを抽出
3. `studyQuestSetup("YOUR_DEPLOY_ID")`で再実行

#### 権限エラー
**症状**: "認証が必要です"
**解決方法**:
1. Google Apps Scriptでの権限承認を完了
2. Google Sheets、Drive APIの有効化確認
3. ユーザーアカウントの権限確認

#### データベース作成エラー
**症状**: "ユーザーデータベース作成エラー"
**解決方法**:
1. Google Driveの容量確認
2. スプレッドシート作成権限の確認
3. 手動でのスプレッドシート作成テスト

## 🔄 旧バージョンからの移行

### 既存の`setup()`関数について
- 旧`setup()`関数は非推奨になりました
- 実行時に警告が表示されますが、動作は継続
- 新規デプロイでは`studyQuestSetup()`を使用してください

### 移行手順
1. 既存環境での`studyQuestSetup()`実行
2. 動作確認後、旧関数の削除を検討
3. 新機能（環境別URL対応など）の活用

## 📚 関連ドキュメント

- **Code.gs**: メインアプリケーション機能
- **config.gs**: スプレッドシート設定管理
- **Setup.gs**: この統合セットアップ機能
- **AdminPanel.html**: 管理画面UI
- **Page.html**: メイン回答ボード画面

## 🎉 セットアップ完了！

セットアップが正常に完了したら、StudyQuestの全機能が利用可能になります。

- **管理者**: 管理パネルでスプレッドシートと表示設定を管理
- **エンドユーザー**: 新規登録から回答ボード利用まで
- **開発者**: `/dev`と`/exec`環境の使い分け

質問や問題がある場合は、セットアップログの詳細を確認するか、開発チームにお問い合わせください。