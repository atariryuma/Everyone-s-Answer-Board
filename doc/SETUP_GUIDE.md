# StudyQuest - みんなの回答ボード: セットアップガイド

このガイドでは、「StudyQuest - みんなの回答ボード」アプリケーションのセットアップ手順を詳細に説明します。本アプリケーションは、メインアプリケーションと「管理者向けログ記録API」の2つのGoogle Apps Script (GAS) プロジェクトで構成されており、それぞれをデプロイする必要があります。

## 1. 前提条件

*   Googleアカウント（Google Workspaceドメイン推奨）
*   Google Apps Scriptの基本的な知識
*   `clasp` (Command Line Apps Script Project) のインストール（任意ですが推奨）
    ```bash
    npm install -g @google/clasp
    ```

## 2. 管理者向けログ記録APIのセットアップ

このAPIは、メインアプリケーションのユーザー情報と監査ログを保存するためのデータベースとして機能します。メインアプリケーションをデプロイする前に、このAPIをセットアップする必要があります。

### 2.1. Google Apps Scriptプロジェクトの作成とコードのコピー

1.  [script.google.com](https://script.google.com) にアクセスし、新しいGASプロジェクトを作成します。
2.  プロジェクト名を「`Admin Logger API`」など、分かりやすい名前に変更します。
3.  このリポジトリの `Admin Logger API/` ディレクトリにある以下のファイルの内容を、GASエディタにコピー＆ペーストします。
    *   `Code.gs` の内容を、GASエディタの `コード.gs` に貼り付けます。
    *   `appsscript.json` の内容を、GASエディタの「プロジェクトの設定」（歯車アイコン）>「`appsscript.json` マニフェストファイルをエディタで表示」にチェックを入れ、表示された `appsscript.json` に貼り付けます。
    *   `DeploymentGuide.html` の内容を、「ファイル」>「新規作成」>「HTMLファイル」から `DeploymentGuide.html` という名前でファイルを作成し、内容を貼り付けます。
4.  全てのファイルを保存します（💾アイコン）。

### 2.2. データベースの初期化

1.  Google Apps Scriptエディタで、`Code.gs` ファイルを開きます。
2.  エディタ上部の関数選択ドロップダウンから `initializeDatabase` を選択し、実行ボタン（▶️）をクリックします。
3.  初回実行時には、必要な権限の承認を求められます。画面の指示に従って承認してください。
4.  これにより、スプレッドシートに「Users」というシートが作成され、ヘッダー行が設定されます。

### 2.3. APIのデプロイ

1.  GASエディタ右上の「**デプロイ**」ボタンを押し、「**新しいデプロイ**」を選択します。
2.  「種類の選択」で歯車アイコンをクリックし、「**ウェブアプリ**」を選択します。
3.  以下の設定でデプロイします。
    *   **実行者**: 「`自分`」（デプロイしたユーザーの権限で実行されます）
    *   **アクセスできるユーザー**: 「`全員`」（匿名ユーザーを含む）
4.  「**デプロイ**」ボタンを押します。初回は「承認」を求められるので、画面の指示に従って許可してください。
5.  デプロイが完了すると、「ウェブアプリURL」が表示されます。このURLを**コピーして大切に保管してください**。これはメインアプリケーションのセットアップで必要になります。

## 3. メインアプリケーションのセットアップ

このアプリケーションは、ユーザーが回答ボードにアクセスするための主要なインターフェースを提供します。

### 3.1. 新しいGoogle Apps Scriptプロジェクトの作成とコードのコピー

1.  [script.google.com](https://script.google.com) にアクセスし、新しいGASプロジェクトを作成します。
2.  プロジェクト名を「`みんなの回答ボード`」など、分かりやすい名前に変更します。
3.  このリポジリの `src/` ディレクトリにあるすべてのファイル（`.gs` と `.html`）の内容を、作成したプロジェクトにコピー＆ペーストします。
    *   `Code.gs` の内容は、GASエディタの `コード.gs` に貼り付けます。
    *   `config.gs` の内容は、GASエディタの `config.gs` に貼り付けます（ファイルが存在しない場合は「ファイル」>「新規作成」>「スクリプト」から作成）。
    *   `ErrorHandling.gs` の内容は、GASエディタの `ErrorHandling.gs` に貼り付けます。
    *   `SetupCode.gs` の内容は、GASエディタの `SetupCode.gs` に貼り付けます。
    *   その他の `.html` ファイルは、「ファイル」>「新規作成」>「HTMLファイル」から同名のファイルを作成し、内容を貼り付けてください。
    *   `appsscript.json` の内容を、GASエディタの「プロジェクトの設定」（歯車アイコン）>「`appsscript.json` マニフェストファイルをエディタで表示」にチェックを入れ、表示された `appsscript.json` に貼り付けます。
4.  全てのファイルを保存します（💾アイコン）。

### 3.2. メインアプリケーションのデプロイ

1.  GASエディタ右上の「**デプロイ**」ボタンを押し、「**新しいデプロイ**」を選択します。
2.  「種類の選択」で歯車アイコンをクリックし、「**ウェブアプリ**」を選択します。
3.  以下の設定でデプロイします。
    *   **説明**: （空欄でOK）
    *   **実行者**: `自分`
    *   **アクセスできるユーザー**: あなたの学校のドメイン（例: `naha-okinawa.ed.jp`）または「`全員`」（テスト目的の場合）
4.  「**デプロイ**」ボタンを押します。初回は「承認」を求められるので、画面の指示に従って許可してください。
5.  表示された**ウェブアプリURL**をコピーして、大切に保管してください。これがあなたの「みんなの回答ボード」の基本URLになります。

### 3.3. 初期設定（Logger APIとの連携）

1.  コピーしたメインアプリケーションのウェブアプリURLの末尾に `?setup=true` を付けて、ブラウザでアクセスします。
    *   例: `https://script.google.com/macros/s/xxxxx/exec?setup=true`
2.  セットアップページが表示されます。ここで、**「管理者向けログ記録API」のデプロイ時にコピーしたウェブアプリURL**を入力し、「設定を保存してデータベースを作成」ボタンをクリックします。
3.  設定が正常に保存されると、完了メッセージが表示されます。

## 4. アプリケーションの利用開始

### 4.1. 管理画面へのアクセス

1.  メインアプリケーションのウェブアプリURLの末尾に `?mode=admin` を付けて、ブラウザでアクセスします。
    *   例: `https://script.google.com/macros/s/xxxxx/exec?mode=admin`
2.  これがあなたの**管理画面**です。ブックマークしておきましょう。

### 4.2. 新しい回答ボードの作成

1.  管理画面の「クイックアクション」から「**新しいボードを作成して公開**」ボタンを押すだけで、すぐに授業で使える回答ボードが完成します。
2.  または、「既存のスプレッドシートをボードとして利用」から、既存のGoogleスプレッドシートのURLを入力してボードとして設定することも可能です。

### 4.3. 授業での利用

1.  管理画面で作成された**GoogleフォームのURL**を生徒に共有し、回答を投稿してもらいます。
2.  管理画面下部に表示される**ボードのURL**を生徒に共有すると、全員の回答をリアルタイムで見ることができます。

## 5. トラブルシューティング

*   **権限エラー**: Google Apps Scriptのプロジェクト設定で、実行者とアクセスできるユーザーの設定が正しいか確認してください。
*   **API接続エラー**: 「管理者向けログ記録API」が正しくデプロイされ、URLがメインアプリケーションに正しく設定されているか確認してください。Logger APIのGASプロジェクトで `testDeployment()` 関数を実行してログを確認することも有効です。
*   **スプレッドシートアクセスエラー**: メインアプリケーションが使用するスプレッドシートへのアクセス権限があるか確認してください。