# AIエージェントの理念とシステム概要

このドキュメントは、「みんなの回答ボード」システムの全体像を理解し、開発者が円滑に開発を進めるための指針を提供します。

## 1. 理念と教育的価値

「みんなの回答ボード」は、生徒たちが安心して多様な意見を共有し、活発な議論を通じて学びを深めることを目的としたウェブアプリケーションです。以下の教育的価値を重視しています。

*   **心理的安全性**: 匿名での意見表明を可能にし、生徒が評価や批判を恐れずに本音で発言できる環境を提供します。
*   **多様性の尊重**: さまざまな意見や視点に触れることで、生徒が他者を理解し、多様な価値観を受け入れる姿勢を育みます。
*   **共感的コミュニケーション**: 「いいね！」「なるほど！」といったリアクション機能を通じて、言葉だけでなく非言語的な共感や関心を表現する機会を提供します。
*   **デジタル・シティズンシップの育成**: オンライン空間での責任ある行動、建設的な対話、情報リテラシーの重要性を実践的に学びます。

## 2. デザインの方向性とカラーパレット

ユーザーインターフェース（UI）は、モダンでクリーンなデザインを基調としています。

### デザイン原則

*   **シンプルさと直感性**: 複雑な操作を排除し、誰でも簡単に利用できる直感的なUIを目指します。
*   **視覚的な奥行きと透明感**: 「ガラスモーフィズム」のスタイルを多用し、要素間に視覚的な階層と奥行きを与えます。`glass-panel` クラスがその代表です。
*   **アクセシビリティ**: 視認性の高い配色と適切なコントラストを確保し、多様なユーザーが利用しやすいデザインを心がけます。

### カラーパレット

主要なカラーはCSS変数として定義されており、一貫したデザインを保ちます。

*   `--color-primary`: `#8be9fd` (シアン系) - アプリケーションの主要なインタラクティブ要素や強調色に使用されます。
*   `--color-background`: `#1a1b26` (ダーク系) - 全体の背景色として、コンテンツの視認性を高めます。
*   `--color-surface`: `rgba(26,27,38,0.7)` - ガラスモーフィズムの背景色として、透明感と奥行きを表現します。
*   `--color-text`: `#c0caf5` (ライトグレー系) - 主要なテキスト色として、ダークな背景とのコントラストを確保します。
*   `--color-border`: `rgba(255,255,255,0.1)` - 要素の境界線に使用され、ガラスモーフィズムの質感を強調します。
*   `--color-accent`: `#facc15` (イエロー系) - 特定の要素やハイライトに使用されるアクセントカラーです。
*   **セマンティックカラー**:
    *   `--color-success`: `#10b981` (緑) - 成功メッセージや肯定的なアクション。
    *   `--color-error`: `#ef4444` (赤) - エラーメッセージや危険なアクション。
    *   `--color-warning`: `#f59e0b` (黄) - 警告メッセージや注意喚起。
    *   `--color-info`: `#3b82f6` (青) - 情報提供や中立的なメッセージ。

## 3. 技術スタックと主要な仕様

本システムは、Google Workspace環境に深く統合されたGoogle Apps Script (GAS) を中心に構築されています。

### 技術スタック

*   **フロントエンド**:
    *   **HTML**: ユーザーインターフェースの構造を定義します。
    *   **CSS**: [Tailwind CSS](https://tailwindcss.com/) を利用し、ユーティリティファーストのアプローチで迅速なスタイリングを実現しています。カスタムCSS変数も多用されています。
    *   **JavaScript**: Google Apps Scriptの `HtmlService` を通じて提供され、クライアントサイドのインタラクティブな挙動を制御します。
*   **バックエンド**:
    *   **Google Apps Script (GAS)**: Googleのサーバーレスプラットフォーム上で動作し、スプレッドシートとの連携、ユーザー管理、認証、API連携などの主要なビジネスロジックを担います。
*   **データ永続化**:
    *   **Google スプレッドシート**: 回答データ、ユーザー情報、アプリケーション設定など、すべてのデータがGoogleスプレッドシートに保存されます。これにより、非開発者でもデータの確認や編集が容易になります。
*   **認証・認可**:
    *   **Googleアカウント認証**: GASの `Session` サービスを利用し、Googleアカウントによる認証を行います。
    *   **ドメインベースのアクセス制御**: アプリケーションは特定のGoogle Workspaceドメイン内での利用を想定しており、ドメインが一致しないユーザーからのアクセスを制限します。
    *   **マルチテナント対応**: ユーザーごとに異なるスプレッドシートを管理し、独立した回答ボードを提供します。
*   **開発ツール**:
    *   **`clasp`**: Google Apps Scriptプロジェクトをローカル環境で開発・管理するためのCLIツールです。
    *   **`jest`**: JavaScriptのテストフレームワークで、バックエンド（GAS）ロジックの単体テストに使用されます。
*   **API連携**:
    *   **Admin Logger API**: 監査ログの記録やキャッシュの無効化など、管理機能の補助として利用される外部API（GASで実装されている可能性が高い）。

### 主要な仕様

*   **ウェブアプリ形式でのデプロイ**: アプリケーションはGoogle Apps Scriptのウェブアプリとしてデプロイされ、特定のURLを通じてアクセスされます。
*   **自動非公開タイマー**: 公開された回答ボードは、セキュリティとプライバシー保護のため、6時間経過すると自動的に非公開になります。管理画面から再公開が可能です。
*   **リアルタイム更新**: Googleスプレッドシートの変更がリアルタイムでフロントエンドに反映されるよう、ポーリングなどの仕組みが導入されています。
*   **設定の柔軟性**: 管理者は、表示するシートの選択、列のマッピング、名前やリアクション数の表示/非表示など、ボードの表示設定を柔軟にカスタマイズできます。
*   **パフォーマンス最適化**: キャッシュメカニズム（メモリ内キャッシュ、`CacheService`）やDOM操作の最適化（仮想スクロール、デバウンス、スロットリング）により、大規模なデータセットでもスムーズな動作を目指しています。
*   **エラーハンドリング**: ユーザーには安全なメッセージを表示し、詳細なエラー情報はサーバーサイドのログに記録されます。